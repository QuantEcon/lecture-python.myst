

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>81. Multiple Good Allocation Mechanisms &#8212; Intermediate Quantitative Economics with Python</title>
    <script src="https://unpkg.com/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/tippy.js@6.3.1/dist/tippy-bundle.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
        <script>
            MathJax = {
            loader: {load: ['[tex]/boldsymbol', '[tex]/textmacros']},
            tex: {
                packages: {'[+]': ['boldsymbol', 'textmacros']},
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                processEscapes: true,
                macros: {
                    "argmax" : "arg\\,max",
                    "argmin" : "arg\\,min",
                    "col"    : "col",
                    "Span"   :  "span",
                    "epsilon": "\\varepsilon",
                    "EE": "\\mathbb{E}",
                    "PP": "\\mathbb{P}",
                    "RR": "\\mathbb{R}",
                    "NN": "\\mathbb{N}",
                    "ZZ": "\\mathbb{Z}",
                    "aA": "\\mathcal{A}",
                    "bB": "\\mathcal{B}",
                    "cC": "\\mathcal{C}",
                    "dD": "\\mathcal{D}",
                    "eE": "\\mathcal{E}",
                    "fF": "\\mathcal{F}",
                    "gG": "\\mathcal{G}",
                    "hH": "\\mathcal{H}",
                }
            },
            svg: {
                fontCache: 'global',
                scale: 0.92,
                displayAlign: "center",
            },
            };
        </script>
    
    
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/quantecon-book-theme.css?digest=b09b2da44b9015b4fa76ea072fa2d8f7faee5492" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/exercise.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>


    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/scripts/quantecon-book-theme.js?digest=eed9c059a3ee152aae2353ec732f0a6d12e6aa07"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-J0SMYR4SG3"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-J0SMYR4SG3');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"tex": {"macros": {"argmax": "arg\\,max", "argmin": "arg\\,min"}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'house_auction';</script>
    <link rel="canonical" href="https://python.quantecon.org/house_auction.html" />
    <link rel="shortcut icon" href="_static/lectures-favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="82. Troubleshooting" href="troubleshooting.html" />
    <link rel="prev" title="80. First-Price and Second-Price Auctions" href="two_auctions.html" />

<!-- Normal Meta Tags -->
<meta name="author" context="Thomas J. Sargent &amp; John Stachurski" />
<meta name="keywords" content="Python, QuantEcon, Quantitative Economics, Economics, Sloan, Alfred P. Sloan Foundation, Tom J. Sargent, John Stachurski" />
<meta name="description" content=This website presents a set of lectures on quantitative economic modeling, designed and written by Thomas J. Sargent and John Stachurski. />

<!-- Twitter tags -->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@quantecon" />
<meta name="twitter:title" content="Multiple Good Allocation Mechanisms"/>
<meta name="twitter:description" content="This website presents a set of lectures on quantitative economic modeling, designed and written by Thomas J. Sargent and John Stachurski.">
<meta name="twitter:creator" content="@quantecon">
<meta name="twitter:image" content="https://assets.quantecon.org/img/qe-twitter-logo.png">

<!-- Opengraph tags -->
<meta property="og:title" content="Multiple Good Allocation Mechanisms" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://python.quantecon.org/house_auction.html" />
<meta property="og:image" content="https://assets.quantecon.org/img/qe-og-logo.png" />
<meta property="og:description" content="This website presents a set of lectures on quantitative economic modeling, designed and written by Thomas J. Sargent and John Stachurski." />
<meta property="og:site_name" content="Intermediate Quantitative Economics with Python" />
<meta name="theme-color" content="#ffffff" />

  </head>
<body>


    <span id="top"></span>

    <div class="qe-wrapper">

        <div class="qe-main">

            <div class="qe-page" id=house_auction>

                <div class="qe-page__toc">

                    <div class="inner">

                        
                        <div class="qe-page__toc-header">
                            On this page
                        </div>


                        <nav id="bd-toc-nav" class="qe-page__toc-nav">
                            <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">81.1. Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ascending-bids-auction-for-multiple-goods">81.2. Ascending Bids Auction for Multiple Goods</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-benevolent-planner">81.3. A Benevolent Planner</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#equivalence-of-allocations">81.4. Equivalence of Allocations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ascending-bid-auction">81.5. Ascending Bid Auction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-setting">81.5.1. Basic Setting</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pseudocode">81.6. Pseudocode</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#an-example">81.7. An Example</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#round-1">81.7.1. round 1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#round-2">81.7.2. round 2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#round-3">81.7.3. round 3</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#round-4">81.7.4. round 4</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#round-5">81.7.5. round 5</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-python-class">81.8. A Python Class</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#robustness-checks">81.9. Robustness Checks</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-groves-clarke-mechanism">81.10. A Groves-Clarke Mechanism</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#an-example-solved-by-hand">81.11. An Example Solved by Hand</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#another-python-class">81.12. Another Python Class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#elaborations">81.12.1. Elaborations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#social-cost">81.12.2. Social Cost</a></li>
</ul>
</li>
</ul>
                            <p class="logo">
                                
                                    
                                    <a href=https://quantecon.org><img src="_static/qe-logo-large.png" class="logo logo-img" alt="logo"></a>
                                    
                                    
                                
                            </p>

                            <p class="powered">Powered by <a href="https://jupyterbook.org/">Jupyter Book</a></p>

                        </nav>

                        <div class="qe-page__toc-footer">
                            
                            
                            <p><a href="#top"><strong>Back to top</strong></a></p>
                        </div>

                    </div>

                </div>

                <div class="qe-page__header">

                    <div class="qe-page__header-copy">

                        <p class="qe-page__header-heading"><a href="intro.html">Intermediate Quantitative Economics with Python</a></p>

                        <p class="qe-page__header-subheading">Multiple Good Allocation Mechanisms</p>

                    </div>
                    <!-- length 2, since its a string and empty dict has length 2 - {} -->
                        <p class="qe-page__header-authors" font-size="18">
                            
                                
                                    <a href="http://www.tomsargent.com/" target="_blank"><span>Thomas J. Sargent</span></a>
                                
                            
                                
                                    and <a href="https://johnstachurski.net/" target="_blank"><span>John Stachurski</span></a>
                                
                            
                        </p>


                </div> <!-- .page__header -->



                
                <main class="qe-page__content" role="main">
                    
                    <div>
                        
  <section class="tex2jax_ignore mathjax_ignore" id="multiple-good-allocation-mechanisms">
<h1><span class="section-number">81. </span>Multiple Good Allocation Mechanisms<a class="headerlink" href="#multiple-good-allocation-mechanisms" title="Permalink to this heading">#</a></h1>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>prettytable
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: prettytable in /opt/conda/envs/quantecon/lib/python3.11/site-packages (3.9.0)
Requirement already satisfied: wcwidth in /opt/conda/envs/quantecon/lib/python3.11/site-packages (from prettytable) (0.2.5)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Yellow">WARNING: Running pip as the &#39;root&#39; user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv</span>

</pre></div>
</div>
</div>
</details>
</div>
<section id="overview">
<h2><span class="section-number">81.1. </span>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">#</a></h2>
<p>This lecture describes two mechanisms for allocating <span class="math notranslate nohighlight">\(n\)</span> private goods (“houses”)  to <span class="math notranslate nohighlight">\(m\)</span> people (“buyers”).</p>
<p>We assume that  <span class="math notranslate nohighlight">\(m &gt; n\)</span> so that there are more potential buyers than there are houses.</p>
<p>Prospective buyers regard the houses  as <strong>substitutes</strong>.</p>
<p>Buyer <span class="math notranslate nohighlight">\(j\)</span> attaches  value <span class="math notranslate nohighlight">\(v_{ij}\)</span> to house <span class="math notranslate nohighlight">\(i\)</span>.</p>
<p>These  values are <strong>private</strong></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(v_{ij}\)</span> is  known only to person <span class="math notranslate nohighlight">\(j\)</span> unless person <span class="math notranslate nohighlight">\(j\)</span> chooses to tell someone.</p></li>
</ul>
<p>We require that a mechanism allocate <strong>at most</strong> one house to one prospective buyer.</p>
<p>We describe two distinct mechanisms</p>
<ul class="simple">
<li><p>A multiple rounds, ascending bid auction</p></li>
<li><p>A special case of a Groves-Clarke <span id="id1">[<a class="reference internal" href="zreferences.html#id22" title="T. Groves. Incentives in teams. Econometrica, 41:617-631, 1973.">Gro73</a>]</span>, <span id="id2">[<a class="reference internal" href="zreferences.html#id23" title="E. Clarke. Multipart pricing of public goods. Public Choice, 8:19-33, 1971.">Cla71</a>]</span> mechanism with a benevolent social planner</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In 1994, the multiple rounds, ascending bid auction was actually used by Stanford University to sell leases to 9 lots on the Stanford campus to eligible faculty members.</p>
</div>
<p>We begin with  overviews of the two mechanisms.</p>
</section>
<section id="ascending-bids-auction-for-multiple-goods">
<h2><span class="section-number">81.2. </span>Ascending Bids Auction for Multiple Goods<a class="headerlink" href="#ascending-bids-auction-for-multiple-goods" title="Permalink to this heading">#</a></h2>
<p>An auction is administered by an <strong>auctioneer</strong></p>
<p>The auctioneer has an <span class="math notranslate nohighlight">\(n \times 1\)</span> vector <span class="math notranslate nohighlight">\(r\)</span> of reservation prices on the <span class="math notranslate nohighlight">\(n\)</span> houses.</p>
<p>The auctioneer sells house <span class="math notranslate nohighlight">\(i\)</span> only if the final price bid for it exceeds <span class="math notranslate nohighlight">\(r_i\)</span></p>
<p>The auctioneer  allocates all <span class="math notranslate nohighlight">\(n\)</span> houses <strong>simultaneously</strong></p>
<p>The auctioneer does not know bidders’ private values <span class="math notranslate nohighlight">\(v_{ij}\)</span></p>
<p>There are multiple <strong>rounds</strong></p>
<ul class="simple">
<li><p>during each round, active participants can submit bids on any of the  <span class="math notranslate nohighlight">\(n\)</span> houses</p></li>
<li><p>each bidder can bid on only one house during one round</p></li>
<li><p>a person who was high bidder on a particular house in one round  is understood to submit  that same bid for the same  house in the next round</p></li>
<li><p>between rounds, a bidder who was not a high bidder can change the house on which he/she chooses to bid</p></li>
<li><p>the auction ends when the price of no house changes from one round to the next</p></li>
<li><p>all <span class="math notranslate nohighlight">\(n\)</span> houses are allocated after the final round</p></li>
<li><p>house <span class="math notranslate nohighlight">\(i\)</span>  is retained by the auctioneer if not prospective buyer offers more that <span class="math notranslate nohighlight">\(r_i\)</span> for the house</p></li>
</ul>
<p>In this auction,  person <span class="math notranslate nohighlight">\(j\)</span> never tells anyone else his/her private values <span class="math notranslate nohighlight">\(v_{ij}\)</span></p>
</section>
<section id="a-benevolent-planner">
<h2><span class="section-number">81.3. </span>A Benevolent Planner<a class="headerlink" href="#a-benevolent-planner" title="Permalink to this heading">#</a></h2>
<p>This mechanism is designed so that all prospective buyers voluntarily choose to reveal their private values to a <strong>social planner</strong> who uses them to construct a socially optimal allocation.</p>
<p>Among all feasible allocations,  a <strong>socially optimal allocation</strong> maximizes the sum of  private values across all prospective buyers.</p>
<p>The planner tells everyone in advance how he/she will allocate houses based on the matrix of values that prospective buyers report.</p>
<p>The mechanism provide every prospective buyer an incentive to reveal his vector of private values to the planner.</p>
<p>After the planner receives everyone’s vector of private values, the planner deploys a <strong>sequential</strong> algorithm to determine an <strong>allocation</strong> of houses and a set of <strong>fees</strong> that he charges awardees  for the negative <strong>externality</strong> that their presence impose on other prospective buyers.</p>
</section>
<section id="equivalence-of-allocations">
<h2><span class="section-number">81.4. </span>Equivalence of Allocations<a class="headerlink" href="#equivalence-of-allocations" title="Permalink to this heading">#</a></h2>
<p>Remarkably, these two mechanisms can produce virtually identical allocations.</p>
<p>We construct Python code for both mechanism.</p>
<p>We also work out some examples by hand or almost by hand.</p>
<p>Next, let’s dive down into the details.</p>
</section>
<section id="ascending-bid-auction">
<h2><span class="section-number">81.5. </span>Ascending Bid Auction<a class="headerlink" href="#ascending-bid-auction" title="Permalink to this heading">#</a></h2>
<section id="basic-setting">
<h3><span class="section-number">81.5.1. </span>Basic Setting<a class="headerlink" href="#basic-setting" title="Permalink to this heading">#</a></h3>
<p>We start with  a more detailed description of the setting.</p>
<ul class="simple">
<li><p>A seller owns <span class="math notranslate nohighlight">\(n\)</span> houses that he wants to sell for the maximum possible amounts to a  set of <span class="math notranslate nohighlight">\(m\)</span> prospective eligible buyers.</p></li>
<li><p>The seller wants to sell at most one house to each potential  buyer.</p></li>
<li><p>There are <span class="math notranslate nohighlight">\(m\)</span> potential eligible buyers, identified by <span class="math notranslate nohighlight">\(j = [1, 2, \ldots, m]\)</span></p>
<ul>
<li><p>Each potential  buyer is permitted  to buy at most  one house.</p></li>
<li><p>Buyer <span class="math notranslate nohighlight">\(j\)</span> would be willing to pay at most <span class="math notranslate nohighlight">\(v_{ij}\)</span> for house <span class="math notranslate nohighlight">\(i\)</span>.</p></li>
<li><p>Buyer <span class="math notranslate nohighlight">\(j\)</span>  knows <span class="math notranslate nohighlight">\(v_{ij}, i= 1, \ldots , n\)</span>, but no one else does.</p></li>
<li><p>If buyer <span class="math notranslate nohighlight">\(j\)</span> pays <span class="math notranslate nohighlight">\(p_i\)</span> for house <span class="math notranslate nohighlight">\(i\)</span>, he enjoys surplus value <span class="math notranslate nohighlight">\(v_{ij} - p_i\)</span>.</p></li>
<li><p>Each buyer <span class="math notranslate nohighlight">\(j\)</span> wants to choose the <span class="math notranslate nohighlight">\(i\)</span> that maximizes his/her surplus value <span class="math notranslate nohighlight">\(v_{ij} - p_i\)</span>.</p></li>
<li><p>The seller wants to maximize <span class="math notranslate nohighlight">\(\sum_i p_i\)</span>.</p></li>
</ul>
</li>
</ul>
<p>The seller conducts a <strong>simultaneous, multiple goods, ascending bid auction</strong>.</p>
<p>Outcomes of the  auction  are</p>
<ul class="simple">
<li><p>An <span class="math notranslate nohighlight">\(n \times 1\)</span> vector <span class="math notranslate nohighlight">\(p\)</span> of sales prices <span class="math notranslate nohighlight">\(p = [p_1, \ldots, p_n]\)</span> for the
<span class="math notranslate nohighlight">\(n\)</span> houses.</p></li>
<li><p>An <span class="math notranslate nohighlight">\(n \times m\)</span> matrix <span class="math notranslate nohighlight">\(Q\)</span> of <span class="math notranslate nohighlight">\(0\)</span>’s and <span class="math notranslate nohighlight">\(1\)</span>’s, where <span class="math notranslate nohighlight">\(Q_{ij} = 1\)</span> if and only if person <span class="math notranslate nohighlight">\(j\)</span> bought house <span class="math notranslate nohighlight">\(i\)</span>.</p></li>
<li><p>An <span class="math notranslate nohighlight">\(n \times m\)</span> matrix <span class="math notranslate nohighlight">\(S\)</span> of surplus values consisting of all zeros unless
person <span class="math notranslate nohighlight">\(j\)</span> bought house <span class="math notranslate nohighlight">\(i\)</span>, in which case <span class="math notranslate nohighlight">\(S_{ij} = v_{ij} - p_i\)</span></p></li>
</ul>
<p>We describe  rules for the auction it terms of  <strong>pseudo  code</strong>.</p>
<p>The pseudo code will provide a road map for writing Python code to implement the auction.</p>
</section>
</section>
<section id="pseudocode">
<h2><span class="section-number">81.6. </span>Pseudocode<a class="headerlink" href="#pseudocode" title="Permalink to this heading">#</a></h2>
<p>Here is a quick sketch of a possible simple structure for our Python code</p>
<p><strong>Inputs:</strong></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(n, m\)</span>.</p></li>
<li><p>an <span class="math notranslate nohighlight">\(n \times m\)</span> non-negative matrix <span class="math notranslate nohighlight">\(v\)</span> of  private values</p></li>
<li><p>an <span class="math notranslate nohighlight">\(n \times 1\)</span> vector <span class="math notranslate nohighlight">\(r\)</span>  of seller-specified reservation prices</p></li>
<li><p>the seller will not accept a price less than <span class="math notranslate nohighlight">\(r_i\)</span> for house <span class="math notranslate nohighlight">\(i\)</span></p></li>
<li><p>we are free to think of these reservation prices as private values of a fictitious <span class="math notranslate nohighlight">\(m +1\)</span> th buyer who does not actually participate in the auction</p></li>
<li><p>initial bids can be thought of starting at <span class="math notranslate nohighlight">\(r\)</span></p></li>
<li><p>a scalar <span class="math notranslate nohighlight">\(\epsilon\)</span> of seller-specified minimum price-bid increments</p></li>
</ul>
<p>For each round of the auction, new bids on a house  must be at least the prevailing highest bid so far <strong>plus</strong> <span class="math notranslate nohighlight">\(\epsilon\)</span></p>
<p><strong>Auction Protocols</strong></p>
<ul class="simple">
<li><p>the auction consists of a  finite number of <strong>rounds</strong></p></li>
<li><p>in each round, a prospective buyer can bid on one and only one house</p></li>
<li><p>after each round,  a  house is temporarily awarded to the person who made the  highest bid for that house</p>
<ul>
<li><p>temporarily winning bids on each house are announced</p></li>
<li><p>this sets the stage to move on to the next round</p></li>
</ul>
</li>
<li><p>a new round is held</p>
<ul>
<li><p>bids for temporary winners from the previous round are again attached to the houses on which they bid; temporary winners of the last round  leave their bids from the previous round unchanged</p></li>
<li><p>all other active  prospective buyers must submit a new bid on some house</p></li>
<li><p>new bids on a house must be at least equal to the prevailing temporary price that won the last round <strong>plus</strong> <span class="math notranslate nohighlight">\(\epsilon\)</span></p></li>
<li><p>if a person does not submit a new bid and was also not a temporary winner from the previous round, that  person must  drop out of the auction permanently</p></li>
<li><p>for each house, the highest bid, whether it is a new bid or was the temporary winner from the previous round, is announced, with the person who made that new (temporarily) winning bid being (temporarily) awarded the house to start the next round</p></li>
</ul>
</li>
<li><p>rounds continue until no price on <strong>any</strong> house changes from the previous round</p></li>
<li><p>houses are sold to the winning bidders from the final round at the prices that they bid</p></li>
</ul>
<p><strong>Outputs:</strong></p>
<ul class="simple">
<li><p>an <span class="math notranslate nohighlight">\(n \times 1\)</span> vector <span class="math notranslate nohighlight">\(p\)</span> of sales prices</p></li>
<li><p>an <span class="math notranslate nohighlight">\(n \times m\)</span> matrix <span class="math notranslate nohighlight">\(S\)</span> of surplus values consisting of all zeros unless
person <span class="math notranslate nohighlight">\(j\)</span> bought house <span class="math notranslate nohighlight">\(i\)</span>, in which case <span class="math notranslate nohighlight">\(S_{ij} = v_{ij} - p_i\)</span></p></li>
<li><p>an <span class="math notranslate nohighlight">\(n \times (m+1)\)</span>  matrix <span class="math notranslate nohighlight">\(Q\)</span> of <span class="math notranslate nohighlight">\(0\)</span>’s and <span class="math notranslate nohighlight">\(1\)</span>’s that tells which buyer bought which  house.  (The last column  accounts for unsold houses.)</p></li>
</ul>
<p><strong>Proposed buyer strategy:</strong></p>
<p>In this pseudo code and the actual Python code below, we’ll assume that all buyers choose to use the following  strategy</p>
<ul class="simple">
<li><p>The strategy is optimal  for each buyer</p></li>
</ul>
<p>Each buyer <span class="math notranslate nohighlight">\(j = 1, \ldots, m\)</span> uses the same strategy.</p>
<p>The strategy has the form:</p>
<ul class="simple">
<li><p>Let <span class="math notranslate nohighlight">\(\check p^t\)</span> be the <span class="math notranslate nohighlight">\(n \times 1\)</span> vector of  prevailing highest-bid prices  at the beginning of round <span class="math notranslate nohighlight">\(t\)</span></p></li>
<li><p>Let <span class="math notranslate nohighlight">\(\epsilon&gt;0\)</span> be the minimum bid increment specified by the seller</p></li>
<li><p>For each prospective buyer <span class="math notranslate nohighlight">\(j\)</span>, compute the index of the best house to bid on during round <span class="math notranslate nohighlight">\(t\)</span>, namely
<span class="math notranslate nohighlight">\(\hat i_t = \textrm{argmax}_i\{  [  v_{ij} - \check p^t_i - \epsilon  ]\}\)</span></p></li>
<li><p>If <span class="math notranslate nohighlight">\(\max_i\{  [  v_{ij} - \check p^t_i - \epsilon  ]\} \)</span>  <span class="math notranslate nohighlight">\(\leq\)</span></font> <span class="math notranslate nohighlight">\(0\)</span>, person <span class="math notranslate nohighlight">\(j\)</span> permanently drops out of the auction at round <span class="math notranslate nohighlight">\(t\)</span></p></li>
<li><p>If  <span class="math notranslate nohighlight">\(v_{\hat i_t, j} - \check p^t_i - \epsilon&gt;0\)</span>, person <span class="math notranslate nohighlight">\(j\)</span> bids <span class="math notranslate nohighlight">\(\check p^t_i + \epsilon\)</span> on house <span class="math notranslate nohighlight">\(j\)</span></p></li>
</ul>
<p><strong>Resolving ambiguities</strong>: The protocols  we have described so far leave open two possible sources of ambiguity.</p>
<p>(1) <strong>The optimal bid choice for buyers in each round.</strong> It is possible that a buyer has the same surplus value for multiple houses. The  argmax function in Python always returns the first argmax element. We instead  prefer to randomize among such winner. For that reason,  we write our own argmax function below.</p>
<p>(2) <strong>Seller’s choice of winner if same price bid cast by several buyers.</strong> To resolve  this ambiguity, we use the np.random.choice function below.</p>
<p>Given the randomness in outcomes, it is possible that different  allocations  of houses could emerge from the same inputs.</p>
<p>However, this will happen only when the bid price increment <span class="math notranslate nohighlight">\(\epsilon\)</span> is nonnegligible.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">prettytable</span> <span class="k">as</span> <span class="nn">pt</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">suppress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="an-example">
<h2><span class="section-number">81.7. </span>An Example<a class="headerlink" href="#an-example" title="Permalink to this heading">#</a></h2>
<p>Before building a Python class, let’s step by step solve things almost “by hand”  to grasp  how the auction proceeds.</p>
<p>A step-by-step procedure also helps reduce bugs, especially when the value matrix is peculiar (e.g. the differences between values are negligible, a column containing identical values or multiple buyers have the same valuation etc.).</p>
<p>Fortunately, our auction  behaves well and  robustly with various peculiar matrices.</p>
<p>We provide some examples later in this lecture.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
              <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
              <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
<span class="n">n</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">shape</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">ϵ</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">buyer_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">house_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">v</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 8,  5,  9,  4],
       [ 4, 11,  7,  4],
       [ 9,  7,  6,  4]])
</pre></div>
</div>
</div>
</div>
<p>Remember that column indexes <span class="math notranslate nohighlight">\(j\)</span> indicate buyers and row indexes <span class="math notranslate nohighlight">\(i\)</span> indicate houses.</p>
<p>The above value matrix <span class="math notranslate nohighlight">\(v\)</span> is peculiar in the sense that Buyer 3 (indexed from 0) puts the same value <span class="math notranslate nohighlight">\(4\)</span> on  every house being sold.</p>
<p>Maybe buyer 3 is a bureaucrat who purchases these house simply by following  instructions from his superior.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([2, 1, 0])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">find_argmax_with_randomness</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    We build our own verion of argmax function such that the argmax index will be returned randomly</span>
<span class="sd">    when there are multiple maximum values. This function is similiar to np.argmax(v,axis=0)</span>

<span class="sd">    Parameters:</span>
<span class="sd">    ----------</span>
<span class="sd">    v: 2 dimensional np.array</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">n</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">index_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">result</span><span class="o">=</span><span class="p">[]</span>

    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="n">max_value</span> <span class="o">=</span> <span class="n">v</span><span class="p">[:,</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">index_array</span><span class="p">[</span><span class="n">v</span><span class="p">[:,</span><span class="n">ii</span><span class="p">]</span> <span class="o">==</span> <span class="n">max_value</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">present_dict</span><span class="p">(</span><span class="n">dt</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A function that present the information in table.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    ----------</span>
<span class="sd">    dt: dictionary.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ymtb</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">PrettyTable</span><span class="p">()</span>
    <span class="n">ymtb</span><span class="o">.</span><span class="n">field_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;House Number&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">dt</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
    <span class="n">ymtb</span><span class="o">.</span><span class="n">add_row</span><span class="p">([</span><span class="s1">&#39;Buyer&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">dt</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ymtb</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Check Kick Off Condition</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_kick_off_condition</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">ϵ</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A function that checks whether the auction could be initiated given the reservation price and value matrix.</span>
<span class="sd">    To avoid the situation that the reservation prices are so high that no one would even bid in the first round.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    ----------</span>
<span class="sd">    v : value matrix of the shape (n,m).</span>

<span class="sd">    r: the reservation price</span>

<span class="sd">    ϵ: the minimun price increment in each round</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># we convert the price vector to a matrix in the same shape as value matrix to facilitate subtraction</span>
    <span class="n">p_start</span> <span class="o">=</span> <span class="p">(</span><span class="n">ϵ</span><span class="o">+</span><span class="n">r</span><span class="p">)[:,</span><span class="kc">None</span><span class="p">]</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">m</span><span class="p">)[</span><span class="kc">None</span><span class="p">,:]</span>

    <span class="n">surplus_value</span> <span class="o">=</span> <span class="n">v</span> <span class="o">-</span> <span class="n">p_start</span>
    <span class="n">buyer_decision</span> <span class="o">=</span> <span class="p">(</span><span class="n">surplus_value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">buyer_decision</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">check_kick_off_condition</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">ϵ</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<section id="round-1">
<h3><span class="section-number">81.7.1. </span>round 1<a class="headerlink" href="#round-1" title="Permalink to this heading">#</a></h3>
<p><strong>submit bid</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">submit_initial_bid</span><span class="p">(</span><span class="n">p_initial</span><span class="p">,</span> <span class="n">ϵ</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A function that describes the bid information in the first round.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    ----------</span>
<span class="sd">    p_initial: the price (or the reservation prices) at the beginning of auction.</span>

<span class="sd">    v: the value matrix</span>

<span class="sd">    ϵ: the minimun price increment in each round</span>

<span class="sd">    Returns:</span>
<span class="sd">    ----------</span>
<span class="sd">    p: price array after this round of bidding</span>

<span class="sd">    bid_info: a dictionary that contains bidding information (house number as keys and buyer as values).</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">p_initial</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">p_start_mat</span> <span class="o">=</span> <span class="p">(</span><span class="n">ϵ</span> <span class="o">+</span> <span class="n">p</span><span class="p">)[:,</span><span class="kc">None</span><span class="p">]</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">m</span><span class="p">)[</span><span class="kc">None</span><span class="p">,:]</span>
    <span class="n">surplus_value</span> <span class="o">=</span> <span class="n">v</span> <span class="o">-</span> <span class="n">p_start_mat</span>

    <span class="c1"># we only care about active buyers who have positve surplus values</span>
    <span class="n">active_buyer_diagnosis</span> <span class="o">=</span> <span class="p">(</span><span class="n">surplus_value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">active_buyer_list</span> <span class="o">=</span> <span class="n">buyer_list</span><span class="p">[</span><span class="n">active_buyer_diagnosis</span><span class="p">]</span>
    <span class="n">active_buyer_surplus_value</span> <span class="o">=</span> <span class="n">surplus_value</span><span class="p">[:,</span><span class="n">active_buyer_diagnosis</span><span class="p">]</span>
    <span class="n">active_buyer_choice</span> <span class="o">=</span> <span class="n">find_argmax_with_randomness</span><span class="p">(</span><span class="n">active_buyer_surplus_value</span><span class="p">)</span>
    <span class="c1"># choice means the favourite houses given the current price and ϵ</span>

    <span class="c1"># we only retain the unique house index because prices increase once at one round</span>
    <span class="n">house_bid</span> <span class="o">=</span>  <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">active_buyer_choice</span><span class="p">))</span>
    <span class="n">p</span><span class="p">[</span><span class="n">house_bid</span><span class="p">]</span> <span class="o">+=</span> <span class="n">ϵ</span>

    <span class="n">bid_info</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">house_num</span> <span class="ow">in</span> <span class="n">house_bid</span><span class="p">:</span>
        <span class="n">bid_info</span><span class="p">[</span><span class="n">house_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">active_buyer_list</span><span class="p">[</span><span class="n">active_buyer_choice</span> <span class="o">==</span> <span class="n">house_num</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">p</span><span class="p">,</span> <span class="n">bid_info</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span><span class="p">,</span> <span class="n">bid_info</span> <span class="o">=</span> <span class="n">submit_initial_bid</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">ϵ</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([3, 2, 1])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">present_dict</span><span class="p">(</span><span class="n">bid_info</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------------+-----+-----+-------+
| House Number |  0  |  1  |   2   |
+--------------+-----+-----+-------+
|    Buyer     | [2] | [1] | [0 3] |
+--------------+-----+-----+-------+
</pre></div>
</div>
</div>
</div>
<p><strong>check terminal condition</strong></p>
<p>Notice that  two buyers bid for house 2 (indexed from 0).</p>
<p>Because the auction protocol does not specify  a selection rule in this case, we simply select a winner <strong>randomly</strong>.</p>
<p>This is reasonable because the seller can’t distinguish these buyers and  doesn’t know the valuation of each buyer.</p>
<p>It is both convenient and practical for him to just pick a winner randomly.</p>
<p>There is a  50% probability that Buyer 3 is chosen as the winner for house 2, although he values it less than buyer 0.</p>
<p>In this case, buyer 0 has to bid one more time with a higher price, which crowds out Buyer 3.</p>
<p>Therefore, final price could be 3 or 4, depending on the winner in the last round.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_terminal_condition</span><span class="p">(</span><span class="n">bid_info</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A function that checks whether the auction ends.</span>

<span class="sd">    Recall that the auction ends when either losers have non-positive surplus values for each house</span>
<span class="sd">    or there is no loser (every buyer gets a house).</span>

<span class="sd">    Parameters:</span>
<span class="sd">    ----------</span>
<span class="sd">    bid_info: a dictionary that contains bidding information of house numbers (as keys) and buyers (as values).</span>

<span class="sd">    p: np.array. price array of houses</span>

<span class="sd">    v: value matrix</span>

<span class="sd">    Returns:</span>
<span class="sd">    ----------</span>
<span class="sd">    allocation: a dictionary that descirbe how the houses bid are assigned.</span>

<span class="sd">    winner_list: a list of winners</span>

<span class="sd">    loser_list: a list of losers</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># there may be several buyers bidding one house, we choose a winner randomly</span>
    <span class="n">winner_list</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">bid_info</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">bid_info</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>

    <span class="n">allocation</span> <span class="o">=</span> <span class="p">{</span><span class="n">house_num</span><span class="p">:</span><span class="n">winner</span> <span class="k">for</span> <span class="n">house_num</span><span class="p">,</span><span class="n">winner</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bid_info</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="n">winner_list</span><span class="p">)}</span>

    <span class="n">loser_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">buyer_list</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">winner_list</span><span class="p">))</span>
    <span class="n">loser_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">loser_set</span><span class="p">)</span>
    <span class="n">loser_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">loser_list</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">loser_num</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The auction ends because every buyer gets one house.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">allocation</span><span class="p">,</span><span class="n">winner_list</span><span class="p">,</span><span class="n">loser_list</span>

    <span class="n">p_mat</span> <span class="o">=</span> <span class="p">(</span><span class="n">ϵ</span> <span class="o">+</span> <span class="n">p</span><span class="p">)[:,</span><span class="kc">None</span><span class="p">]</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">loser_num</span><span class="p">)[</span><span class="kc">None</span><span class="p">,:]</span>
    <span class="n">loser_surplus_value</span> <span class="o">=</span> <span class="n">v</span><span class="p">[:,</span><span class="n">loser_list</span><span class="p">]</span> <span class="o">-</span> <span class="n">p_mat</span>
    <span class="n">loser_decision</span> <span class="o">=</span> <span class="p">(</span><span class="n">loser_surplus_value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="n">loser_decision</span><span class="o">.</span><span class="n">any</span><span class="p">()))</span>

    <span class="k">return</span> <span class="n">allocation</span><span class="p">,</span><span class="n">winner_list</span><span class="p">,</span><span class="n">loser_list</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">allocation</span><span class="p">,</span><span class="n">winner_list</span><span class="p">,</span><span class="n">loser_list</span> <span class="o">=</span> <span class="n">check_terminal_condition</span><span class="p">(</span><span class="n">bid_info</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">present_dict</span><span class="p">(</span><span class="n">allocation</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------------+---+---+---+
| House Number | 0 | 1 | 2 |
+--------------+---+---+---+
|    Buyer     | 2 | 1 | 0 |
+--------------+---+---+---+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">winner_list</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[2, 1, 0]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">loser_list</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[3]
</pre></div>
</div>
</div>
</div>
</section>
<section id="round-2">
<h3><span class="section-number">81.7.2. </span>round 2<a class="headerlink" href="#round-2" title="Permalink to this heading">#</a></h3>
<p>From the second round on, the auction proceeds differently from the first round.</p>
<p>Now only active losers (those who have positive surplus values) have  an incentive to submit bids to displace temporary winners from the previous round.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">submit_bid</span><span class="p">(</span><span class="n">loser_list</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ϵ</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">bid_info</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A function that executes the bid operation after the first round.</span>
<span class="sd">    After the first round, only active losers would cast a new bid with price as old price + increment.</span>
<span class="sd">    By such bid, winners of last round are replaced by the active losers.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    ----------</span>
<span class="sd">    loser_list: a list that includes the indexes of losers</span>

<span class="sd">    p: np.array. price array of houses</span>

<span class="sd">    ϵ: minimum increment of bid price</span>

<span class="sd">    v: value matrix</span>

<span class="sd">    bid_info: a dictionary that contains bidding information of house numbers (as keys) and buyers (as values).</span>

<span class="sd">    Returns:</span>
<span class="sd">    ----------</span>
<span class="sd">    p_end: a price array after this round of bidding</span>

<span class="sd">    bid_info: a dictionary that contains updated bidding information.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">p_end</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">loser_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">loser_list</span><span class="p">)</span>
    <span class="n">p_mat</span> <span class="o">=</span> <span class="p">(</span><span class="n">ϵ</span> <span class="o">+</span> <span class="n">p_end</span><span class="p">)[:,</span><span class="kc">None</span><span class="p">]</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">loser_num</span><span class="p">)[</span><span class="kc">None</span><span class="p">,:]</span>
    <span class="n">loser_surplus_value</span> <span class="o">=</span> <span class="n">v</span><span class="p">[:,</span><span class="n">loser_list</span><span class="p">]</span> <span class="o">-</span> <span class="n">p_mat</span>
    <span class="n">loser_decision</span> <span class="o">=</span> <span class="p">(</span><span class="n">loser_surplus_value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">active_loser_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">loser_list</span><span class="p">)[</span><span class="n">loser_decision</span><span class="p">]</span>
    <span class="n">active_loser_surplus_value</span> <span class="o">=</span> <span class="n">loser_surplus_value</span><span class="p">[:,</span><span class="n">loser_decision</span><span class="p">]</span>
    <span class="n">active_loser_choice</span> <span class="o">=</span> <span class="n">find_argmax_with_randomness</span><span class="p">(</span><span class="n">active_loser_surplus_value</span><span class="p">)</span>

    <span class="c1"># we retain the unique house index and increasing the corresponding bid price</span>
    <span class="n">house_bid</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">active_loser_choice</span><span class="p">))</span>
    <span class="n">p_end</span><span class="p">[</span><span class="n">house_bid</span><span class="p">]</span> <span class="o">+=</span> <span class="n">ϵ</span>

    <span class="c1"># we record the bidding information from active losers</span>
    <span class="n">bid_info_active_loser</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">house_num</span> <span class="ow">in</span> <span class="n">house_bid</span><span class="p">:</span>
        <span class="n">bid_info_active_loser</span><span class="p">[</span><span class="n">house_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">active_loser_list</span><span class="p">[</span><span class="n">active_loser_choice</span> <span class="o">==</span> <span class="n">house_num</span><span class="p">]</span>

    <span class="c1"># we update the bidding information according to the bidding from actice losers</span>
    <span class="k">for</span> <span class="n">house_num</span> <span class="ow">in</span> <span class="n">bid_info_active_loser</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">bid_info</span><span class="p">[</span><span class="n">house_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">bid_info_active_loser</span><span class="p">[</span><span class="n">house_num</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">p_end</span><span class="p">,</span><span class="n">bid_info</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span><span class="p">,</span><span class="n">bid_info</span> <span class="o">=</span> <span class="n">submit_bid</span><span class="p">(</span><span class="n">loser_list</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ϵ</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">bid_info</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([3, 2, 2])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">present_dict</span><span class="p">(</span><span class="n">bid_info</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------------+-----+-----+-----+
| House Number |  0  |  1  |  2  |
+--------------+-----+-----+-----+
|    Buyer     | [2] | [1] | [3] |
+--------------+-----+-----+-----+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">allocation</span><span class="p">,</span><span class="n">winner_list</span><span class="p">,</span><span class="n">loser_list</span> <span class="o">=</span> <span class="n">check_terminal_condition</span><span class="p">(</span><span class="n">bid_info</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">present_dict</span><span class="p">(</span><span class="n">allocation</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------------+---+---+---+
| House Number | 0 | 1 | 2 |
+--------------+---+---+---+
|    Buyer     | 2 | 1 | 3 |
+--------------+---+---+---+
</pre></div>
</div>
</div>
</div>
</section>
<section id="round-3">
<h3><span class="section-number">81.7.3. </span>round 3<a class="headerlink" href="#round-3" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span><span class="p">,</span><span class="n">bid_info</span> <span class="o">=</span> <span class="n">submit_bid</span><span class="p">(</span><span class="n">loser_list</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ϵ</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">bid_info</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([3, 2, 3])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">present_dict</span><span class="p">(</span><span class="n">bid_info</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------------+-----+-----+-----+
| House Number |  0  |  1  |  2  |
+--------------+-----+-----+-----+
|    Buyer     | [2] | [1] | [0] |
+--------------+-----+-----+-----+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">allocation</span><span class="p">,</span><span class="n">winner_list</span><span class="p">,</span><span class="n">loser_list</span> <span class="o">=</span> <span class="n">check_terminal_condition</span><span class="p">(</span><span class="n">bid_info</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">present_dict</span><span class="p">(</span><span class="n">allocation</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------------+---+---+---+
| House Number | 0 | 1 | 2 |
+--------------+---+---+---+
|    Buyer     | 2 | 1 | 0 |
+--------------+---+---+---+
</pre></div>
</div>
</div>
</div>
</section>
<section id="round-4">
<h3><span class="section-number">81.7.4. </span>round 4<a class="headerlink" href="#round-4" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span><span class="p">,</span><span class="n">bid_info</span> <span class="o">=</span> <span class="n">submit_bid</span><span class="p">(</span><span class="n">loser_list</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ϵ</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">bid_info</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([3, 3, 3])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">present_dict</span><span class="p">(</span><span class="n">bid_info</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------------+-----+-----+-----+
| House Number |  0  |  1  |  2  |
+--------------+-----+-----+-----+
|    Buyer     | [2] | [3] | [0] |
+--------------+-----+-----+-----+
</pre></div>
</div>
</div>
</div>
<p>Notice that  Buyer 3 now switches  to bid for house 1 having recongized that  house 2 is no longer his best option.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">allocation</span><span class="p">,</span><span class="n">winner_list</span><span class="p">,</span><span class="n">loser_list</span> <span class="o">=</span> <span class="n">check_terminal_condition</span><span class="p">(</span><span class="n">bid_info</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">present_dict</span><span class="p">(</span><span class="n">allocation</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------------+---+---+---+
| House Number | 0 | 1 | 2 |
+--------------+---+---+---+
|    Buyer     | 2 | 3 | 0 |
+--------------+---+---+---+
</pre></div>
</div>
</div>
</div>
</section>
<section id="round-5">
<h3><span class="section-number">81.7.5. </span>round 5<a class="headerlink" href="#round-5" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span><span class="p">,</span><span class="n">bid_info</span> <span class="o">=</span> <span class="n">submit_bid</span><span class="p">(</span><span class="n">loser_list</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ϵ</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">bid_info</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([3, 4, 3])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">present_dict</span><span class="p">(</span><span class="n">bid_info</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------------+-----+-----+-----+
| House Number |  0  |  1  |  2  |
+--------------+-----+-----+-----+
|    Buyer     | [2] | [1] | [0] |
+--------------+-----+-----+-----+
</pre></div>
</div>
</div>
</div>
<p>Now Buyer 1 bids for house 1 again with price at 4, which crowds out Buyer 3, marking the end of the auction.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">allocation</span><span class="p">,</span><span class="n">winner_list</span><span class="p">,</span><span class="n">loser_list</span> <span class="o">=</span> <span class="n">check_terminal_condition</span><span class="p">(</span><span class="n">bid_info</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">present_dict</span><span class="p">(</span><span class="n">allocation</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------------+---+---+---+
| House Number | 0 | 1 | 2 |
+--------------+---+---+---+
|    Buyer     | 2 | 1 | 0 |
+--------------+---+---+---+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># as for the houses unsold</span>

<span class="n">house_unsold_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">house_list</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">allocation</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>
<span class="n">house_unsold_list</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">total_revenue</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">allocation</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">total_revenue</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="a-python-class">
<h2><span class="section-number">81.8. </span>A Python Class<a class="headerlink" href="#a-python-class" title="Permalink to this heading">#</a></h2>
<p>Above we simulated an ascending bid auction step by step.</p>
<p>When defining  functions, we repeatedly computed some intermediate objects because our Python function loses track of variables once the  function is executed.</p>
<p>That of course led  to redundancy in our code</p>
<p>It is much more efficient  to collect all of the aforementioned code into a class that  records information about all rounds.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ascending_bid_auction</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">ϵ</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A class that simulates an ascending bid auction for houses.</span>

<span class="sd">        Given buyers&#39; value matrix, sellers&#39; reservation prices and minimum increment of bid prices,</span>
<span class="sd">        this class can execute an ascending bid auction and present information round by round until the end.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        ----------</span>
<span class="sd">        v: 2 dimensional value matrix</span>

<span class="sd">        r: np.array of reservation prices</span>

<span class="sd">        ϵ: minimum increment of bid price</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">r</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ϵ</span> <span class="o">=</span> <span class="n">ϵ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buyer_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">house_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bid_info_history</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allocation_history</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">winner_history</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loser_history</span> <span class="o">=</span> <span class="p">[]</span>


    <span class="k">def</span> <span class="nf">find_argmax_with_randomness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="n">n</span><span class="p">,</span><span class="n">m</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">index_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">result</span><span class="o">=</span><span class="p">[]</span>

        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
            <span class="n">max_value</span> <span class="o">=</span> <span class="n">v</span><span class="p">[:,</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">index_array</span><span class="p">[</span><span class="n">v</span><span class="p">[:,</span><span class="n">ii</span><span class="p">]</span> <span class="o">==</span> <span class="n">max_value</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">check_kick_off_condition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># we convert the price vector to a matrix in the same shape as value matrix to facilitate subtraction</span>
        <span class="n">p_start</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ϵ</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">)[:,</span><span class="kc">None</span><span class="p">]</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">)[</span><span class="kc">None</span><span class="p">,:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surplus_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">-</span> <span class="n">p_start</span>
        <span class="n">buyer_decision</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">surplus_value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">buyer_decision</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">submit_initial_bid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># we intend to find the optimal choice of each buyer</span>
        <span class="n">p_start_mat</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ϵ</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)[:,</span><span class="kc">None</span><span class="p">]</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">)[</span><span class="kc">None</span><span class="p">,:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surplus_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">-</span> <span class="n">p_start_mat</span>

        <span class="c1"># we only care about active buyers who have positve surplus values</span>
        <span class="n">active_buyer_diagnosis</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">surplus_value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">active_buyer_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buyer_list</span><span class="p">[</span><span class="n">active_buyer_diagnosis</span><span class="p">]</span>
        <span class="n">active_buyer_surplus_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">surplus_value</span><span class="p">[:,</span><span class="n">active_buyer_diagnosis</span><span class="p">]</span>
        <span class="n">active_buyer_choice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_argmax_with_randomness</span><span class="p">(</span><span class="n">active_buyer_surplus_value</span><span class="p">)</span>

        <span class="c1"># we only retain the unique house index because prices increase once at one round</span>
        <span class="n">house_bid</span> <span class="o">=</span>  <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">active_buyer_choice</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">house_bid</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ϵ</span>

        <span class="n">bid_info</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">house_num</span> <span class="ow">in</span> <span class="n">house_bid</span><span class="p">:</span>
            <span class="n">bid_info</span><span class="p">[</span><span class="n">house_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">active_buyer_list</span><span class="p">[</span><span class="n">active_buyer_choice</span> <span class="o">==</span> <span class="n">house_num</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bid_info_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bid_info</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The bid information is&#39;</span><span class="p">)</span>
        <span class="n">ymtb</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">PrettyTable</span><span class="p">()</span>
        <span class="n">ymtb</span><span class="o">.</span><span class="n">field_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;House Number&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">bid_info</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="n">ymtb</span><span class="o">.</span><span class="n">add_row</span><span class="p">([</span><span class="s1">&#39;Buyer&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">bid_info</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">ymtb</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The bid prices for houses are&#39;</span><span class="p">)</span>
        <span class="n">ymtb</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">PrettyTable</span><span class="p">()</span>
        <span class="n">ymtb</span><span class="o">.</span><span class="n">field_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;House Number&#39;</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">house_list</span><span class="p">]</span>
        <span class="n">ymtb</span><span class="o">.</span><span class="n">add_row</span><span class="p">([</span><span class="s1">&#39;Price&#39;</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">ymtb</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">winner_list</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">bid_info</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">bid_info</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">winner_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">winner_list</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">allocation</span> <span class="o">=</span> <span class="p">{</span><span class="n">house_num</span><span class="p">:[</span><span class="n">winner</span><span class="p">]</span> <span class="k">for</span> <span class="n">house_num</span><span class="p">,</span><span class="n">winner</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bid_info</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">winner_list</span><span class="p">)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allocation_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allocation</span><span class="p">)</span>

        <span class="n">loser_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buyer_list</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">winner_list</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loser_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">loser_set</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loser_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loser_list</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The winners are&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">winner_list</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The losers are&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loser_list</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">check_terminal_condition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">loser_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loser_list</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">loser_num</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The auction ends because every buyer gets one house.&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="n">p_mat</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ϵ</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)[:,</span><span class="kc">None</span><span class="p">]</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">loser_num</span><span class="p">)[</span><span class="kc">None</span><span class="p">,:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loser_surplus_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[:,</span><span class="bp">self</span><span class="o">.</span><span class="n">loser_list</span><span class="p">]</span> <span class="o">-</span> <span class="n">p_mat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loser_decision</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loser_surplus_value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="o">~</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loser_decision</span><span class="o">.</span><span class="n">any</span><span class="p">())</span>


    <span class="k">def</span> <span class="nf">submit_bid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">bid_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">allocation_history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># we only record the bid info of winner</span>

        <span class="n">loser_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loser_list</span><span class="p">)</span>
        <span class="n">p_mat</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ϵ</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)[:,</span><span class="kc">None</span><span class="p">]</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">loser_num</span><span class="p">)[</span><span class="kc">None</span><span class="p">,:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loser_surplus_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[:,</span><span class="bp">self</span><span class="o">.</span><span class="n">loser_list</span><span class="p">]</span> <span class="o">-</span> <span class="n">p_mat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loser_decision</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loser_surplus_value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">active_loser_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loser_list</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">loser_decision</span><span class="p">]</span>
        <span class="n">active_loser_surplus_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loser_surplus_value</span><span class="p">[:,</span><span class="bp">self</span><span class="o">.</span><span class="n">loser_decision</span><span class="p">]</span>
        <span class="n">active_loser_choice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_argmax_with_randomness</span><span class="p">(</span><span class="n">active_loser_surplus_value</span><span class="p">)</span>

        <span class="c1"># we retain the unique house index and increasing the corresponding bid price</span>
        <span class="n">house_bid</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">active_loser_choice</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">house_bid</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ϵ</span>

        <span class="c1"># we record the bidding information from active losers</span>
        <span class="n">bid_info_active_loser</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">house_num</span> <span class="ow">in</span> <span class="n">house_bid</span><span class="p">:</span>
            <span class="n">bid_info_active_loser</span><span class="p">[</span><span class="n">house_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">active_loser_list</span><span class="p">[</span><span class="n">active_loser_choice</span> <span class="o">==</span> <span class="n">house_num</span><span class="p">]</span>

        <span class="c1"># we update the bidding information according to the bidding from actice losers</span>
        <span class="k">for</span> <span class="n">house_num</span> <span class="ow">in</span> <span class="n">bid_info_active_loser</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">bid_info</span><span class="p">[</span><span class="n">house_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">bid_info_active_loser</span><span class="p">[</span><span class="n">house_num</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bid_info_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bid_info</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The bid information is&#39;</span><span class="p">)</span>
        <span class="n">ymtb</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">PrettyTable</span><span class="p">()</span>
        <span class="n">ymtb</span><span class="o">.</span><span class="n">field_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;House Number&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">bid_info</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="n">ymtb</span><span class="o">.</span><span class="n">add_row</span><span class="p">([</span><span class="s1">&#39;Buyer&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">bid_info</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">ymtb</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The bid prices for houses are&#39;</span><span class="p">)</span>
        <span class="n">ymtb</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">PrettyTable</span><span class="p">()</span>
        <span class="n">ymtb</span><span class="o">.</span><span class="n">field_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;House Number&#39;</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">house_list</span><span class="p">]</span>
        <span class="n">ymtb</span><span class="o">.</span><span class="n">add_row</span><span class="p">([</span><span class="s1">&#39;Price&#39;</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">ymtb</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">winner_list</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">bid_info</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">bid_info</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">winner_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">winner_list</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">allocation</span> <span class="o">=</span> <span class="p">{</span><span class="n">house_num</span><span class="p">:[</span><span class="n">winner</span><span class="p">]</span> <span class="k">for</span> <span class="n">house_num</span><span class="p">,</span><span class="n">winner</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bid_info</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">winner_list</span><span class="p">)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allocation_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allocation</span><span class="p">)</span>

        <span class="n">loser_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buyer_list</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">winner_list</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loser_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">loser_set</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loser_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loser_list</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The winners are&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">winner_list</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The losers are&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loser_list</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">start_auction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The Ascending Bid Auction for Houses&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Basic Information: </span><span class="si">%d</span><span class="s1"> houses, </span><span class="si">%d</span><span class="s1"> buyers&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">))</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The valuation matrix is as follows&#39;</span><span class="p">)</span>
        <span class="n">ymtb</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">PrettyTable</span><span class="p">()</span>
        <span class="n">ymtb</span><span class="o">.</span><span class="n">field_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Buyer Number&#39;</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">))]</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
            <span class="n">ymtb</span><span class="o">.</span><span class="n">add_row</span><span class="p">([</span><span class="s1">&#39;House </span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ii</span><span class="p">),</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">ii</span><span class="p">,:]])</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">ymtb</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The reservation prices for houses are&#39;</span><span class="p">)</span>
        <span class="n">ymtb</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">PrettyTable</span><span class="p">()</span>
        <span class="n">ymtb</span><span class="o">.</span><span class="n">field_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;House Number&#39;</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">house_list</span><span class="p">]</span>
        <span class="n">ymtb</span><span class="o">.</span><span class="n">add_row</span><span class="p">([</span><span class="s1">&#39;Price&#39;</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">ymtb</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The minimum increment of bid price is </span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">ϵ</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">ctr</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_kick_off_condition</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Auction starts successfully&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Round </span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span> <span class="n">ctr</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">submit_initial_bid</span><span class="p">()</span>

            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_terminal_condition</span><span class="p">():</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Auction ends&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The final result is as follows&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The allocation plan is&#39;</span><span class="p">)</span>
                    <span class="n">ymtb</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">PrettyTable</span><span class="p">()</span>
                    <span class="n">ymtb</span><span class="o">.</span><span class="n">field_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;House Number&#39;</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
                    <span class="n">ymtb</span><span class="o">.</span><span class="n">add_row</span><span class="p">([</span><span class="s1">&#39;Buyer&#39;</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">ymtb</span><span class="p">)</span>

                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The bid prices for houses are&#39;</span><span class="p">)</span>
                    <span class="n">ymtb</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">PrettyTable</span><span class="p">()</span>
                    <span class="n">ymtb</span><span class="o">.</span><span class="n">field_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;House Number&#39;</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">house_list</span><span class="p">]</span>
                    <span class="n">ymtb</span><span class="o">.</span><span class="n">add_row</span><span class="p">([</span><span class="s1">&#39;Price&#39;</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">])</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">ymtb</span><span class="p">)</span>

                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The winners are&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">winner_list</span><span class="p">)</span>

                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The losers are&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loser_list</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">house_unsold_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">house_list</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The houses unsold are&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">house_unsold_list</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">total_revenue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The total revenue is </span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_revenue</span><span class="p">)</span>

                    <span class="k">break</span>

                <span class="n">ctr</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Round </span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span> <span class="n">ctr</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">submit_bid</span><span class="p">()</span>

            <span class="c1"># we compute the surplus matrix S and the quantity matrix X as required in 1.1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">jj</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># the last column records the houses unsold</span>
            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">jj</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">house_unsold_list</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="c1"># we sort the allocation result by the house number</span>
            <span class="n">house_sold_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">house_sold_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

            <span class="n">dict_temp</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">house_sold_list</span><span class="p">:</span>
                <span class="n">dict_temp</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">allocation</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">allocation</span> <span class="o">=</span> <span class="n">dict_temp</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The auction can not start because of high reservation prices&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s use our class to conduct the auction described in one of the above examples.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">9</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">]])</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ϵ</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">auction_1</span> <span class="o">=</span> <span class="n">ascending_bid_auction</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">ϵ</span><span class="p">)</span>

<span class="n">auction_1</span><span class="o">.</span><span class="n">start_auction</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The Ascending Bid Auction for Houses


Basic Information: 3 houses, 4 buyers
The valuation matrix is as follows
+--------------+---+----+---+---+
| Buyer Number | 0 | 1  | 2 | 3 |
+--------------+---+----+---+---+
|   House 0    | 8 | 5  | 9 | 4 |
|   House 1    | 4 | 11 | 7 | 4 |
|   House 2    | 9 | 7  | 6 | 4 |
+--------------+---+----+---+---+
The reservation prices for houses are
+--------------+---+---+---+
| House Number | 0 | 1 | 2 |
+--------------+---+---+---+
|    Price     | 2 | 1 | 0 |
+--------------+---+---+---+
The minimum increment of bid price is 1.00


Auction starts successfully


Round 1
The bid information is
+--------------+-----+-----+-------+
| House Number |  0  |  1  |   2   |
+--------------+-----+-----+-------+
|    Buyer     | [2] | [1] | [0 3] |
+--------------+-----+-----+-------+
The bid prices for houses are
+--------------+---+---+---+
| House Number | 0 | 1 | 2 |
+--------------+---+---+---+
|    Price     | 3 | 2 | 1 |
+--------------+---+---+---+
The winners are
[2, 1, 0]
The losers are
[3]


Round 2
The bid information is
+--------------+-----+-----+-----+
| House Number |  0  |  1  |  2  |
+--------------+-----+-----+-----+
|    Buyer     | [2] | [1] | [3] |
+--------------+-----+-----+-----+
The bid prices for houses are
+--------------+---+---+---+
| House Number | 0 | 1 | 2 |
+--------------+---+---+---+
|    Price     | 3 | 2 | 2 |
+--------------+---+---+---+
The winners are
[2, 1, 3]
The losers are
[0]


Round 3
The bid information is
+--------------+-----+-----+-----+
| House Number |  0  |  1  |  2  |
+--------------+-----+-----+-----+
|    Buyer     | [2] | [1] | [0] |
+--------------+-----+-----+-----+
The bid prices for houses are
+--------------+---+---+---+
| House Number | 0 | 1 | 2 |
+--------------+---+---+---+
|    Price     | 3 | 2 | 3 |
+--------------+---+---+---+
The winners are
[2, 1, 0]
The losers are
[3]


Round 4
The bid information is
+--------------+-----+-----+-----+
| House Number |  0  |  1  |  2  |
+--------------+-----+-----+-----+
|    Buyer     | [2] | [3] | [0] |
+--------------+-----+-----+-----+
The bid prices for houses are
+--------------+---+---+---+
| House Number | 0 | 1 | 2 |
+--------------+---+---+---+
|    Price     | 3 | 3 | 3 |
+--------------+---+---+---+
The winners are
[2, 3, 0]
The losers are
[1]


Round 5
The bid information is
+--------------+-----+-----+-----+
| House Number |  0  |  1  |  2  |
+--------------+-----+-----+-----+
|    Buyer     | [2] | [1] | [0] |
+--------------+-----+-----+-----+
The bid prices for houses are
+--------------+---+---+---+
| House Number | 0 | 1 | 2 |
+--------------+---+---+---+
|    Price     | 3 | 4 | 3 |
+--------------+---+---+---+
The winners are
[2, 1, 0]
The losers are
[3]


Auction ends


The final result is as follows


The allocation plan is
+--------------+-----+-----+-----+
| House Number |  0  |  1  |  2  |
+--------------+-----+-----+-----+
|    Buyer     | [2] | [1] | [0] |
+--------------+-----+-----+-----+
The bid prices for houses are
+--------------+---+---+---+
| House Number | 0 | 1 | 2 |
+--------------+---+---+---+
|    Price     | 3 | 4 | 3 |
+--------------+---+---+---+
The winners are
[2, 1, 0]
The losers are
[3]
The houses unsold are
[]
The total revenue is 10.00
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># the surplus matrix S</span>

<span class="n">auction_1</span><span class="o">.</span><span class="n">S</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0., 0., 6., 0.],
       [0., 7., 0., 0.],
       [6., 0., 0., 0.]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># the quantity matrix X</span>

<span class="n">auction_1</span><span class="o">.</span><span class="n">Q</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0., 0., 1., 0., 0.],
       [0., 1., 0., 0., 0.],
       [1., 0., 0., 0., 0.]])
</pre></div>
</div>
</div>
</div>
</section>
<section id="robustness-checks">
<h2><span class="section-number">81.9. </span>Robustness Checks<a class="headerlink" href="#robustness-checks" title="Permalink to this heading">#</a></h2>
<p>Let’s do some stress testing of our code by applying it to  auctions characterized by different matrices of private values.</p>
<p><strong>1. number of houses = number of buyers</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">v2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">9</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">9</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">6</span><span class="p">]])</span>

<span class="n">auction_2</span> <span class="o">=</span> <span class="n">ascending_bid_auction</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">ϵ</span><span class="p">)</span>

<span class="n">auction_2</span><span class="o">.</span><span class="n">start_auction</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The Ascending Bid Auction for Houses


Basic Information: 3 houses, 3 buyers
The valuation matrix is as follows
+--------------+---+----+---+
| Buyer Number | 0 | 1  | 2 |
+--------------+---+----+---+
|   House 0    | 8 | 5  | 9 |
|   House 1    | 4 | 11 | 7 |
|   House 2    | 9 | 7  | 6 |
+--------------+---+----+---+
The reservation prices for houses are
+--------------+---+---+---+
| House Number | 0 | 1 | 2 |
+--------------+---+---+---+
|    Price     | 2 | 1 | 0 |
+--------------+---+---+---+
The minimum increment of bid price is 1.00


Auction starts successfully


Round 1
The bid information is
+--------------+-----+-----+-----+
| House Number |  0  |  1  |  2  |
+--------------+-----+-----+-----+
|    Buyer     | [2] | [1] | [0] |
+--------------+-----+-----+-----+
The bid prices for houses are
+--------------+---+---+---+
| House Number | 0 | 1 | 2 |
+--------------+---+---+---+
|    Price     | 3 | 2 | 1 |
+--------------+---+---+---+
The winners are
[2, 1, 0]
The losers are
[]


The auction ends because every buyer gets one house.


Auction ends


The final result is as follows


The allocation plan is
+--------------+-----+-----+-----+
| House Number |  0  |  1  |  2  |
+--------------+-----+-----+-----+
|    Buyer     | [2] | [1] | [0] |
+--------------+-----+-----+-----+
The bid prices for houses are
+--------------+---+---+---+
| House Number | 0 | 1 | 2 |
+--------------+---+---+---+
|    Price     | 3 | 2 | 1 |
+--------------+---+---+---+
The winners are
[2, 1, 0]
The losers are
[]
The houses unsold are
[]
The total revenue is 6.00
</pre></div>
</div>
</div>
</div>
<p><strong>2. multilple excess buyers</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">v3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">],[</span><span class="mi">9</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">]])</span>

<span class="n">auction_3</span> <span class="o">=</span> <span class="n">ascending_bid_auction</span><span class="p">(</span><span class="n">v3</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">ϵ</span><span class="p">)</span>

<span class="n">auction_3</span><span class="o">.</span><span class="n">start_auction</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The Ascending Bid Auction for Houses


Basic Information: 3 houses, 5 buyers
The valuation matrix is as follows
+--------------+---+----+---+---+---+
| Buyer Number | 0 | 1  | 2 | 3 | 4 |
+--------------+---+----+---+---+---+
|   House 0    | 8 | 5  | 9 | 4 | 3 |
|   House 1    | 4 | 11 | 7 | 4 | 6 |
|   House 2    | 9 | 7  | 6 | 4 | 2 |
+--------------+---+----+---+---+---+
The reservation prices for houses are
+--------------+---+---+---+
| House Number | 0 | 1 | 2 |
+--------------+---+---+---+
|    Price     | 2 | 1 | 0 |
+--------------+---+---+---+
The minimum increment of bid price is 1.00


Auction starts successfully


Round 1
The bid information is
+--------------+-----+-------+-------+
| House Number |  0  |   1   |   2   |
+--------------+-----+-------+-------+
|    Buyer     | [2] | [1 4] | [0 3] |
+--------------+-----+-------+-------+
The bid prices for houses are
+--------------+---+---+---+
| House Number | 0 | 1 | 2 |
+--------------+---+---+---+
|    Price     | 3 | 2 | 1 |
+--------------+---+---+---+
The winners are
[2, 4, 3]
The losers are
[0, 1]


Round 2
The bid information is
+--------------+-----+-----+-----+
| House Number |  0  |  1  |  2  |
+--------------+-----+-----+-----+
|    Buyer     | [2] | [1] | [0] |
+--------------+-----+-----+-----+
The bid prices for houses are
+--------------+---+---+---+
| House Number | 0 | 1 | 2 |
+--------------+---+---+---+
|    Price     | 3 | 3 | 2 |
+--------------+---+---+---+
The winners are
[2, 1, 0]
The losers are
[3, 4]


Round 3
The bid information is
+--------------+-----+-----+-----+
| House Number |  0  |  1  |  2  |
+--------------+-----+-----+-----+
|    Buyer     | [2] | [4] | [3] |
+--------------+-----+-----+-----+
The bid prices for houses are
+--------------+---+---+---+
| House Number | 0 | 1 | 2 |
+--------------+---+---+---+
|    Price     | 3 | 4 | 3 |
+--------------+---+---+---+
The winners are
[2, 4, 3]
The losers are
[0, 1]


Round 4
The bid information is
+--------------+-----+-----+-----+
| House Number |  0  |  1  |  2  |
+--------------+-----+-----+-----+
|    Buyer     | [2] | [1] | [0] |
+--------------+-----+-----+-----+
The bid prices for houses are
+--------------+---+---+---+
| House Number | 0 | 1 | 2 |
+--------------+---+---+---+
|    Price     | 3 | 5 | 4 |
+--------------+---+---+---+
The winners are
[2, 1, 0]
The losers are
[3, 4]


Auction ends


The final result is as follows


The allocation plan is
+--------------+-----+-----+-----+
| House Number |  0  |  1  |  2  |
+--------------+-----+-----+-----+
|    Buyer     | [2] | [1] | [0] |
+--------------+-----+-----+-----+
The bid prices for houses are
+--------------+---+---+---+
| House Number | 0 | 1 | 2 |
+--------------+---+---+---+
|    Price     | 3 | 5 | 4 |
+--------------+---+---+---+
The winners are
[2, 1, 0]
The losers are
[3, 4]
The houses unsold are
[]
The total revenue is 12.00
</pre></div>
</div>
</div>
</div>
<p><strong>3. more houses than buyers</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">v4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">9</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">9</span><span class="p">],[</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]])</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

<span class="n">auction_4</span> <span class="o">=</span> <span class="n">ascending_bid_auction</span><span class="p">(</span><span class="n">v4</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">ϵ</span><span class="p">)</span>

<span class="n">auction_4</span><span class="o">.</span><span class="n">start_auction</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The Ascending Bid Auction for Houses


Basic Information: 5 houses, 3 buyers
The valuation matrix is as follows
+--------------+---+----+---+
| Buyer Number | 0 | 1  | 2 |
+--------------+---+----+---+
|   House 0    | 8 | 5  | 4 |
|   House 1    | 4 | 11 | 7 |
|   House 2    | 9 | 7  | 9 |
|   House 3    | 6 | 4  | 5 |
|   House 4    | 2 | 2  | 2 |
+--------------+---+----+---+
The reservation prices for houses are
+--------------+---+---+---+---+---+
| House Number | 0 | 1 | 2 | 3 | 4 |
+--------------+---+---+---+---+---+
|    Price     | 2 | 1 | 0 | 1 | 1 |
+--------------+---+---+---+---+---+
The minimum increment of bid price is 1.00


Auction starts successfully


Round 1
The bid information is
+--------------+-----+-------+
| House Number |  1  |   2   |
+--------------+-----+-------+
|    Buyer     | [1] | [0 2] |
+--------------+-----+-------+
The bid prices for houses are
+--------------+---+---+---+---+---+
| House Number | 0 | 1 | 2 | 3 | 4 |
+--------------+---+---+---+---+---+
|    Price     | 2 | 2 | 1 | 1 | 1 |
+--------------+---+---+---+---+---+
The winners are
[1, 2]
The losers are
[0]


Round 2
The bid information is
+--------------+-----+-----+
| House Number |  1  |  2  |
+--------------+-----+-----+
|    Buyer     | [1] | [0] |
+--------------+-----+-----+
The bid prices for houses are
+--------------+---+---+---+---+---+
| House Number | 0 | 1 | 2 | 3 | 4 |
+--------------+---+---+---+---+---+
|    Price     | 2 | 2 | 2 | 1 | 1 |
+--------------+---+---+---+---+---+
The winners are
[1, 0]
The losers are
[2]


Round 3
The bid information is
+--------------+-----+-----+
| House Number |  1  |  2  |
+--------------+-----+-----+
|    Buyer     | [1] | [2] |
+--------------+-----+-----+
The bid prices for houses are
+--------------+---+---+---+---+---+
| House Number | 0 | 1 | 2 | 3 | 4 |
+--------------+---+---+---+---+---+
|    Price     | 2 | 2 | 3 | 1 | 1 |
+--------------+---+---+---+---+---+
The winners are
[1, 2]
The losers are
[0]


Round 4
The bid information is
+--------------+-----+-----+
| House Number |  1  |  2  |
+--------------+-----+-----+
|    Buyer     | [1] | [0] |
+--------------+-----+-----+
The bid prices for houses are
+--------------+---+---+---+---+---+
| House Number | 0 | 1 | 2 | 3 | 4 |
+--------------+---+---+---+---+---+
|    Price     | 2 | 2 | 4 | 1 | 1 |
+--------------+---+---+---+---+---+
The winners are
[1, 0]
The losers are
[2]


Round 5
The bid information is
+--------------+-----+-----+
| House Number |  1  |  2  |
+--------------+-----+-----+
|    Buyer     | [2] | [0] |
+--------------+-----+-----+
The bid prices for houses are
+--------------+---+---+---+---+---+
| House Number | 0 | 1 | 2 | 3 | 4 |
+--------------+---+---+---+---+---+
|    Price     | 2 | 3 | 4 | 1 | 1 |
+--------------+---+---+---+---+---+
The winners are
[2, 0]
The losers are
[1]


Round 6
The bid information is
+--------------+-----+-----+
| House Number |  1  |  2  |
+--------------+-----+-----+
|    Buyer     | [1] | [0] |
+--------------+-----+-----+
The bid prices for houses are
+--------------+---+---+---+---+---+
| House Number | 0 | 1 | 2 | 3 | 4 |
+--------------+---+---+---+---+---+
|    Price     | 2 | 4 | 4 | 1 | 1 |
+--------------+---+---+---+---+---+
The winners are
[1, 0]
The losers are
[2]


Round 7
The bid information is
+--------------+-----+-----+
| House Number |  1  |  2  |
+--------------+-----+-----+
|    Buyer     | [1] | [2] |
+--------------+-----+-----+
The bid prices for houses are
+--------------+---+---+---+---+---+
| House Number | 0 | 1 | 2 | 3 | 4 |
+--------------+---+---+---+---+---+
|    Price     | 2 | 4 | 5 | 1 | 1 |
+--------------+---+---+---+---+---+
The winners are
[1, 2]
The losers are
[0]


Round 8
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The bid information is
+--------------+-----+-----+-----+
| House Number |  1  |  2  |  0  |
+--------------+-----+-----+-----+
|    Buyer     | [1] | [2] | [0] |
+--------------+-----+-----+-----+
The bid prices for houses are
+--------------+---+---+---+---+---+
| House Number | 0 | 1 | 2 | 3 | 4 |
+--------------+---+---+---+---+---+
|    Price     | 3 | 4 | 5 | 1 | 1 |
+--------------+---+---+---+---+---+
The winners are
[1, 2, 0]
The losers are
[]


The auction ends because every buyer gets one house.


Auction ends


The final result is as follows


The allocation plan is
+--------------+-----+-----+-----+
| House Number |  1  |  2  |  0  |
+--------------+-----+-----+-----+
|    Buyer     | [1] | [2] | [0] |
+--------------+-----+-----+-----+
The bid prices for houses are
+--------------+---+---+---+---+---+
| House Number | 0 | 1 | 2 | 3 | 4 |
+--------------+---+---+---+---+---+
|    Price     | 3 | 4 | 5 | 1 | 1 |
+--------------+---+---+---+---+---+
The winners are
[1, 2, 0]
The losers are
[]
The houses unsold are
[3, 4]
The total revenue is 12.00
</pre></div>
</div>
</div>
</div>
<p><strong>4. some houses have extremely high reservation prices</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">v5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">9</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">9</span><span class="p">],[</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]])</span>
<span class="n">r3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

<span class="n">auction_5</span> <span class="o">=</span> <span class="n">ascending_bid_auction</span><span class="p">(</span><span class="n">v5</span><span class="p">,</span> <span class="n">r3</span><span class="p">,</span> <span class="n">ϵ</span><span class="p">)</span>

<span class="n">auction_5</span><span class="o">.</span><span class="n">start_auction</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The Ascending Bid Auction for Houses


Basic Information: 5 houses, 3 buyers
The valuation matrix is as follows
+--------------+---+----+---+
| Buyer Number | 0 | 1  | 2 |
+--------------+---+----+---+
|   House 0    | 8 | 5  | 4 |
|   House 1    | 4 | 11 | 7 |
|   House 2    | 9 | 7  | 9 |
|   House 3    | 6 | 4  | 5 |
|   House 4    | 2 | 2  | 2 |
+--------------+---+----+---+
The reservation prices for houses are
+--------------+----+---+---+---+---+
| House Number | 0  | 1 | 2 | 3 | 4 |
+--------------+----+---+---+---+---+
|    Price     | 10 | 1 | 0 | 1 | 1 |
+--------------+----+---+---+---+---+
The minimum increment of bid price is 1.00


Auction starts successfully


Round 1
The bid information is
+--------------+-----+-------+
| House Number |  1  |   2   |
+--------------+-----+-------+
|    Buyer     | [1] | [0 2] |
+--------------+-----+-------+
The bid prices for houses are
+--------------+----+---+---+---+---+
| House Number | 0  | 1 | 2 | 3 | 4 |
+--------------+----+---+---+---+---+
|    Price     | 10 | 2 | 1 | 1 | 1 |
+--------------+----+---+---+---+---+
The winners are
[1, 0]
The losers are
[2]


Round 2
The bid information is
+--------------+-----+-----+
| House Number |  1  |  2  |
+--------------+-----+-----+
|    Buyer     | [1] | [2] |
+--------------+-----+-----+
The bid prices for houses are
+--------------+----+---+---+---+---+
| House Number | 0  | 1 | 2 | 3 | 4 |
+--------------+----+---+---+---+---+
|    Price     | 10 | 2 | 2 | 1 | 1 |
+--------------+----+---+---+---+---+
The winners are
[1, 2]
The losers are
[0]


Round 3
The bid information is
+--------------+-----+-----+
| House Number |  1  |  2  |
+--------------+-----+-----+
|    Buyer     | [1] | [0] |
+--------------+-----+-----+
The bid prices for houses are
+--------------+----+---+---+---+---+
| House Number | 0  | 1 | 2 | 3 | 4 |
+--------------+----+---+---+---+---+
|    Price     | 10 | 2 | 3 | 1 | 1 |
+--------------+----+---+---+---+---+
The winners are
[1, 0]
The losers are
[2]


Round 4
The bid information is
+--------------+-----+-----+
| House Number |  1  |  2  |
+--------------+-----+-----+
|    Buyer     | [1] | [2] |
+--------------+-----+-----+
The bid prices for houses are
+--------------+----+---+---+---+---+
| House Number | 0  | 1 | 2 | 3 | 4 |
+--------------+----+---+---+---+---+
|    Price     | 10 | 2 | 4 | 1 | 1 |
+--------------+----+---+---+---+---+
The winners are
[1, 2]
The losers are
[0]


Round 5
The bid information is
+--------------+-----+-----+
| House Number |  1  |  2  |
+--------------+-----+-----+
|    Buyer     | [1] | [0] |
+--------------+-----+-----+
The bid prices for houses are
+--------------+----+---+---+---+---+
| House Number | 0  | 1 | 2 | 3 | 4 |
+--------------+----+---+---+---+---+
|    Price     | 10 | 2 | 5 | 1 | 1 |
+--------------+----+---+---+---+---+
The winners are
[1, 0]
The losers are
[2]


Round 6
The bid information is
+--------------+-----+-----+
| House Number |  1  |  2  |
+--------------+-----+-----+
|    Buyer     | [2] | [0] |
+--------------+-----+-----+
The bid prices for houses are
+--------------+----+---+---+---+---+
| House Number | 0  | 1 | 2 | 3 | 4 |
+--------------+----+---+---+---+---+
|    Price     | 10 | 3 | 5 | 1 | 1 |
+--------------+----+---+---+---+---+
The winners are
[2, 0]
The losers are
[1]


Round 7
The bid information is
+--------------+-----+-----+
| House Number |  1  |  2  |
+--------------+-----+-----+
|    Buyer     | [1] | [0] |
+--------------+-----+-----+
The bid prices for houses are
+--------------+----+---+---+---+---+
| House Number | 0  | 1 | 2 | 3 | 4 |
+--------------+----+---+---+---+---+
|    Price     | 10 | 4 | 5 | 1 | 1 |
+--------------+----+---+---+---+---+
The winners are
[1, 0]
The losers are
[2]


Round 8
The bid information is
+--------------+-----+-----+
| House Number |  1  |  2  |
+--------------+-----+-----+
|    Buyer     | [1] | [2] |
+--------------+-----+-----+
The bid prices for houses are
+--------------+----+---+---+---+---+
| House Number | 0  | 1 | 2 | 3 | 4 |
+--------------+----+---+---+---+---+
|    Price     | 10 | 4 | 6 | 1 | 1 |
+--------------+----+---+---+---+---+
The winners are
[1, 2]
The losers are
[0]


Round 9
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The bid information is
+--------------+-----+-----+-----+
| House Number |  1  |  2  |  3  |
+--------------+-----+-----+-----+
|    Buyer     | [1] | [2] | [0] |
+--------------+-----+-----+-----+
The bid prices for houses are
+--------------+----+---+---+---+---+
| House Number | 0  | 1 | 2 | 3 | 4 |
+--------------+----+---+---+---+---+
|    Price     | 10 | 4 | 6 | 2 | 1 |
+--------------+----+---+---+---+---+
The winners are
[1, 2, 0]
The losers are
[]


The auction ends because every buyer gets one house.


Auction ends


The final result is as follows


The allocation plan is
+--------------+-----+-----+-----+
| House Number |  1  |  2  |  3  |
+--------------+-----+-----+-----+
|    Buyer     | [1] | [2] | [0] |
+--------------+-----+-----+-----+
The bid prices for houses are
+--------------+----+---+---+---+---+
| House Number | 0  | 1 | 2 | 3 | 4 |
+--------------+----+---+---+---+---+
|    Price     | 10 | 4 | 6 | 2 | 1 |
+--------------+----+---+---+---+---+
The winners are
[1, 2, 0]
The losers are
[]
The houses unsold are
[0, 4]
The total revenue is 12.00
</pre></div>
</div>
</div>
</div>
<p><strong>5. reservation prices are so high that the auction can’t start</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">])</span>

<span class="n">auction_6</span> <span class="o">=</span> <span class="n">ascending_bid_auction</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">r4</span><span class="p">,</span> <span class="n">ϵ</span><span class="p">)</span>

<span class="n">auction_6</span><span class="o">.</span><span class="n">start_auction</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The Ascending Bid Auction for Houses


Basic Information: 3 houses, 4 buyers
The valuation matrix is as follows
+--------------+---+----+---+---+
| Buyer Number | 0 | 1  | 2 | 3 |
+--------------+---+----+---+---+
|   House 0    | 8 | 5  | 9 | 4 |
|   House 1    | 4 | 11 | 7 | 4 |
|   House 2    | 9 | 7  | 6 | 4 |
+--------------+---+----+---+---+
The reservation prices for houses are
+--------------+----+----+----+
| House Number | 0  | 1  | 2  |
+--------------+----+----+----+
|    Price     | 15 | 15 | 15 |
+--------------+----+----+----+
The minimum increment of bid price is 1.00


The auction can not start because of high reservation prices
</pre></div>
</div>
</div>
</div>
</section>
<section id="a-groves-clarke-mechanism">
<h2><span class="section-number">81.10. </span>A Groves-Clarke Mechanism<a class="headerlink" href="#a-groves-clarke-mechanism" title="Permalink to this heading">#</a></h2>
<p>We now decribe an alternative way for society to allocate <span class="math notranslate nohighlight">\(n\)</span>  houses to <span class="math notranslate nohighlight">\(m\)</span> possible buyers in a way that maximizes
total value across all potential buyers.</p>
<p>We continue to assume that each buyer can purchase at most one house.</p>
<p>The mechanism  is a very special case of a Groves-Clarke mechanism <span id="id3">[<a class="reference internal" href="zreferences.html#id22" title="T. Groves. Incentives in teams. Econometrica, 41:617-631, 1973.">Gro73</a>]</span>, <span id="id4">[<a class="reference internal" href="zreferences.html#id23" title="E. Clarke. Multipart pricing of public goods. Public Choice, 8:19-33, 1971.">Cla71</a>]</span>.</p>
<p>Its special structure substantially simplifies writing Python code to find an optimal allocation.</p>
<p>Our mechanims works like this.</p>
<ul class="simple">
<li><p>The values <span class="math notranslate nohighlight">\(V_{ij}\)</span> are private information to person <span class="math notranslate nohighlight">\(j\)</span></p></li>
<li><p>The mechanism makes each person <span class="math notranslate nohighlight">\(j\)</span> willing to  tell a social planner his private values <span class="math notranslate nohighlight">\(V_{i,j}\)</span> for all <span class="math notranslate nohighlight">\(i = 1, \ldots, n\)</span>.</p></li>
<li><p>The social planner  asks all potential bidders to tell the planner  their private values <span class="math notranslate nohighlight">\(V_{ij}\)</span></p></li>
<li><p>The social planner tells no one these, but uses them to allocate houses and set prices</p></li>
<li><p>The mechanism is designed in a way that makes all prospective buyers want to tell the planner their private values</p>
<ul>
<li><p>truth telling is a dominant strategy for each potential buyer</p></li>
</ul>
</li>
<li><p>The planner finds a house, bidder pair with highest private value by computing
<span class="math notranslate nohighlight">\((\tilde i, \tilde j) = \operatorname{argmax} (V_{ij})\)</span></p></li>
<li><p>The planner assigns house <span class="math notranslate nohighlight">\(\tilde i \)</span> to buyer <span class="math notranslate nohighlight">\(\tilde j\)</span></p></li>
<li><p>The planner charges buyer <span class="math notranslate nohighlight">\(\tilde j\)</span> the price <span class="math notranslate nohighlight">\(\max_{- \tilde j} V_{\tilde i,  j}\)</span>, where   <span class="math notranslate nohighlight">\(- \tilde j\)</span> means all <span class="math notranslate nohighlight">\(j\)</span>’s except <span class="math notranslate nohighlight">\(\tilde j\)</span>.</p></li>
<li><p>The planner creates a   matrix of private values for the remaining houses <span class="math notranslate nohighlight">\(-\tilde i\)</span> by deleting row (i.e., house) <span class="math notranslate nohighlight">\(\tilde i\)</span> and column (i.e., buyer) <span class="math notranslate nohighlight">\(\tilde j\)</span> from <span class="math notranslate nohighlight">\(V\)</span>.</p>
<ul>
<li><p>(But in doing this, the planner keeps track of the  real names of the bidders and the houses).</p></li>
</ul>
</li>
<li><p>The planner returns  to the original step and repeat it.</p></li>
<li><p>The planner iterates until all <span class="math notranslate nohighlight">\(n\)</span>  houses  are allocated and the charges for  all <span class="math notranslate nohighlight">\(n\)</span> houses are set.</p></li>
</ul>
</section>
<section id="an-example-solved-by-hand">
<h2><span class="section-number">81.11. </span>An Example Solved by Hand<a class="headerlink" href="#an-example-solved-by-hand" title="Permalink to this heading">#</a></h2>
<p>Let’s see how our Groves-Clarke algorithm would work for the following simple  matrix <span class="math notranslate nohighlight">\(V\)</span> matrix of private values</p>
<div class="math notranslate nohighlight">
\[
V =\begin{bmatrix} 10 &amp; 9 &amp; 8 &amp; 7 &amp; 6 \cr
                    9 &amp; 9 &amp; 7 &amp; 6 &amp; 6 \cr
                    8 &amp; 6 &amp; 6 &amp; 9 &amp; 4 \cr
                    7 &amp; 5 &amp; 6 &amp; 4 &amp; 9 \end{bmatrix}
\]</div>
<p><strong>Remark:</strong> In the first step, when the highest private value corresponds to more than one house, bidder pairs, we choose the pair with the highest sale price. If a highest sale price corresponds to two or more pairs with highest private values, we randomly choose one.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">666</span><span class="p">)</span>

<span class="n">V_orig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>  <span class="c1"># record the origianl values</span>
                   <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
                   <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                   <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">]])</span>
<span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">V_orig</span><span class="p">)</span>  <span class="c1"># used iteratively</span>
<span class="n">n</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">shape</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="c1"># prices of houses</span>
<span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span> <span class="c1"># keep record the status of houses and buyers</span>
</pre></div>
</div>
</div>
</div>
<p><strong>First assignment</strong></p>
<p>First, we find house, bidder pair with highest private value.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">V</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">V</span><span class="p">))</span>
<span class="n">i</span><span class="p">,</span> <span class="n">j</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([0]), array([0]))
</pre></div>
</div>
</div>
</div>
<p>So, house 0 will be sold to buyer 0 at a price of 9. We then update the sale price of house 0 and the status matrix Q.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">j</span><span class="p">))</span>
<span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">p</span><span class="p">,</span> <span class="n">Q</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([9., 0., 0., 0.]),
 array([[1., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0.]]))
</pre></div>
</div>
</div>
</div>
<p>Then we remove row 0 and column 0 from <span class="math notranslate nohighlight">\(V\)</span>. To keep the real number of houses and buyers, we set this row and this column to -1, which will have the same result as removing them since <span class="math notranslate nohighlight">\(V \geq 0\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">V</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">V</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[-1, -1, -1, -1, -1],
       [-1,  9,  7,  6,  6],
       [-1,  6,  6,  9,  4],
       [-1,  5,  6,  4,  9]])
</pre></div>
</div>
</div>
</div>
<p><strong>Second assignment</strong></p>
<p>We find house, bidder pair with the highest private value again.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">V</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">V</span><span class="p">))</span>
<span class="n">i</span><span class="p">,</span> <span class="n">j</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([1, 2, 3]), array([1, 3, 4]))
</pre></div>
</div>
</div>
</div>
<p>In this special example, there are three pairs (1, 1), (2, 3) and (3, 4) with the highest private value. To solve this problem, we choose the one with highest sale price.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p_candidate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)):</span>
    <span class="n">p_candidate</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="p">:],</span> <span class="n">j</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
<span class="n">k</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p_candidate</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">p_candidate</span><span class="p">))</span>
<span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">j</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
<span class="n">i</span><span class="p">,</span> <span class="n">j</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([1]), array([1]))
</pre></div>
</div>
</div>
</div>
<p>So, house 1 will be sold to buyer 1 at a price of 7. We update matrices.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">j</span><span class="p">))</span>
<span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">V</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">p</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">V</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([9., 7., 0., 0.]),
 array([[1., 0., 0., 0., 0.],
        [0., 1., 0., 0., 0.],
        [0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0.]]),
 array([[-1, -1, -1, -1, -1],
        [-1, -1, -1, -1, -1],
        [-1, -1,  6,  9,  4],
        [-1, -1,  6,  4,  9]]))
</pre></div>
</div>
</div>
</div>
<p><strong>Third assignment</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">V</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">V</span><span class="p">))</span>
<span class="n">i</span><span class="p">,</span> <span class="n">j</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([2, 3]), array([3, 4]))
</pre></div>
</div>
</div>
</div>
<p>In this special example, there are two pairs (2, 3) and (3, 4) with the highest private value.</p>
<p>To resolve the  assignment, we choose the one with highest sale price.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p_candidate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)):</span>
    <span class="n">p_candidate</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="p">:],</span> <span class="n">j</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
<span class="n">k</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p_candidate</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">p_candidate</span><span class="p">))</span>
<span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">j</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
<span class="n">i</span><span class="p">,</span> <span class="n">j</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([2, 3]), array([3, 4]))
</pre></div>
</div>
</div>
</div>
<p>The two pairs even have the same sale price.</p>
<p>We randomly choose one pair.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">j</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
<span class="n">i</span><span class="p">,</span> <span class="n">j</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2, 3)
</pre></div>
</div>
</div>
</div>
<p>Finally, house 2 will be sold to buyer 3.</p>
<p>We update matrices accordingly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">j</span><span class="p">))</span>
<span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">V</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">p</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">V</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([9., 7., 6., 0.]),
 array([[1., 0., 0., 0., 0.],
        [0., 1., 0., 0., 0.],
        [0., 0., 0., 1., 0.],
        [0., 0., 0., 0., 0.]]),
 array([[-1, -1, -1, -1, -1],
        [-1, -1, -1, -1, -1],
        [-1, -1, -1, -1, -1],
        [-1, -1,  6, -1,  9]]))
</pre></div>
</div>
</div>
</div>
<p><strong>Fourth assignment</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">V</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">V</span><span class="p">))</span>
<span class="n">i</span><span class="p">,</span> <span class="n">j</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([3]), array([4]))
</pre></div>
</div>
</div>
</div>
<p>House 3 will be sold to buyer 4.</p>
<p>The final outcome  follows.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">j</span><span class="p">))</span>
<span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">V</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">V_orig</span><span class="o">*</span><span class="n">Q</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="nd">@Q</span>
<span class="n">p</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">S</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([9., 7., 6., 6.]),
 array([[1., 0., 0., 0., 0.],
        [0., 1., 0., 0., 0.],
        [0., 0., 0., 1., 0.],
        [0., 0., 0., 0., 1.]]),
 array([[-1, -1, -1, -1, -1],
        [-1, -1, -1, -1, -1],
        [-1, -1, -1, -1, -1],
        [-1, -1, -1, -1, -1]]),
 array([[1., 0., 0., 0., 0.],
        [0., 2., 0., 0., 0.],
        [0., 0., 0., 3., 0.],
        [0., 0., 0., 0., 3.]]))
</pre></div>
</div>
</div>
</div>
</section>
<section id="another-python-class">
<h2><span class="section-number">81.12. </span>Another Python Class<a class="headerlink" href="#another-python-class" title="Permalink to this heading">#</a></h2>
<p>It is efficient to assemble our calculations in a single Python Class.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">GC_Mechanism</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">V</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implementation of the special Groves Clarke Mechanism for house auction.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        ----------</span>
<span class="sd">        V: 2 dimensional private value matrix</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">V_orig</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="o">.</span><span class="n">shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">find_argmax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find the house-buyer pair with the highest value.</span>
<span class="sd">        When the highest private value corresponds to more than one house, bidder pairs,</span>
<span class="sd">        we choose the pair with the highest sale price.</span>
<span class="sd">        Moreoever, if the highest sale price corresponds to two or more pairs with highest private value,</span>
<span class="sd">        We randomly choose one.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        ----------</span>
<span class="sd">        V: 2 dimensional private value matrix with -1 indicating revomed rows and columns</span>

<span class="sd">        Returns:</span>
<span class="sd">        ----------</span>
<span class="sd">        i: the index of the sold house</span>

<span class="sd">        j: the index of the buyer</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">))</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">p_candidate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)):</span>
                <span class="n">p_candidate</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="p">:],</span> <span class="n">j</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
            <span class="n">k</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p_candidate</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">p_candidate</span><span class="p">))</span>
            <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">j</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">k</span><span class="p">])</span>
                <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">j</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span>

    <span class="k">def</span> <span class="nf">update_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">j</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">def</span> <span class="nf">calculate_surplus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_orig</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span><span class="nd">@self</span><span class="o">.</span><span class="n">Q</span>

    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_argmax</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;House </span><span class="si">%i</span><span class="s2"> is sold to buyer </span><span class="si">%i</span><span class="s2"> at price </span><span class="si">%i</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculate_surplus</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Prices of house:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The status matrix:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The surplus matrix:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">666</span><span class="p">)</span>

<span class="n">V_orig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
                   <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
                   <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                   <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">]])</span>
<span class="n">gc_mechanism</span> <span class="o">=</span> <span class="n">GC_Mechanism</span><span class="p">(</span><span class="n">V_orig</span><span class="p">)</span>
<span class="n">gc_mechanism</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>House 0 is sold to buyer 0 at price 9


House 1 is sold to buyer 1 at price 7


House 2 is sold to buyer 3 at price 6


House 3 is sold to buyer 4 at price 6


Prices of house:
 [9. 7. 6. 6.]


The status matrix:
 [[1. 0. 0. 0. 0.]
 [0. 1. 0. 0. 0.]
 [0. 0. 0. 1. 0.]
 [0. 0. 0. 0. 1.]]


The surplus matrix:
 [[1. 0. 0. 0. 0.]
 [0. 2. 0. 0. 0.]
 [0. 0. 0. 3. 0.]
 [0. 0. 0. 0. 3.]]
</pre></div>
</div>
</div>
</div>
<section id="elaborations">
<h3><span class="section-number">81.12.1. </span>Elaborations<a class="headerlink" href="#elaborations" title="Permalink to this heading">#</a></h3>
<p>Here we use some additional notation designed to conform with standard notation in parts of the VCG literature.</p>
<p>We want to verify that our pseudo code is indeed a <strong>pivot mechanism</strong>, also called a <strong>VCG</strong> (Vickrey-Clarke-Groves) mechanism.</p>
<ul class="simple">
<li><p>The mechanism is named after <span id="id5">[<a class="reference internal" href="zreferences.html#id22" title="T. Groves. Incentives in teams. Econometrica, 41:617-631, 1973.">Gro73</a>]</span>, <span id="id6">[<a class="reference internal" href="zreferences.html#id23" title="E. Clarke. Multipart pricing of public goods. Public Choice, 8:19-33, 1971.">Cla71</a>]</span>, and <span id="id7">[<a class="reference internal" href="zreferences.html#id24" title="W. Vickrey. Counterspeculation, auctions, and competitive sealed tenders. Journal of Finance, 16:8-37, 1961.">Vic61</a>]</span>.</p></li>
</ul>
<p>To prepare for verifying this, we add some notation.</p>
<p>Let <span class="math notranslate nohighlight">\(X\)</span> be the set of feasible allocations of houses under the protocols above (i.e., at most one house to each person).</p>
<p>Let <span class="math notranslate nohighlight">\(X(v)\)</span> be the allocation that the mechanism chooses for matrix <span class="math notranslate nohighlight">\(v\)</span> of private values.</p>
<p>The mechanism maps a matrix <span class="math notranslate nohighlight">\(v\)</span> of private values into an <span class="math notranslate nohighlight">\(x \in X\)</span>.</p>
<p>Let <span class="math notranslate nohighlight">\(v_j(x)\)</span> be the value that person <span class="math notranslate nohighlight">\(j\)</span> attaches to allocation <span class="math notranslate nohighlight">\(x \in X\)</span>.</p>
<p>Let <span class="math notranslate nohighlight">\(\check t_j(v)\)</span> the payment that the mechanism charges person <span class="math notranslate nohighlight">\(j\)</span>.</p>
<p>The  VCG mechanism chooses the allocation</p>
<div class="math notranslate nohighlight" id="equation-eq-gc1">
<span class="eqno">(81.1)<a class="headerlink" href="#equation-eq-gc1" title="Permalink to this equation">#</a></span>\[
X(v)  = \operatorname{argmax}_{x \in X} \sum_{j=1}^m v_j(x)
\]</div>
<p>and charges person <span class="math notranslate nohighlight">\(j\)</span> a “social cost”</p>
<div class="math notranslate nohighlight" id="equation-eq-gc2">
<span class="eqno">(81.2)<a class="headerlink" href="#equation-eq-gc2" title="Permalink to this equation">#</a></span>\[
\check t_j(v) = \max_{x \in  X} \sum_{k \neq j} v_k(x) -  \sum_{k \neq j} v_k(X(v))
\]</div>
<p>In our setting, equation <a class="reference internal" href="#equation-eq-gc1">(81.1)</a> says that the VCG allocation allocates houses to maximize the total value of the successful prospective buyers.</p>
<p>In our setting, equation <a class="reference internal" href="#equation-eq-gc2">(81.2)</a> says that the mechanism charges people for the externality that their presence in society imposes on other prospective buyers.</p>
<p>Thus, notice that according to equation <a class="reference internal" href="#equation-eq-gc2">(81.2)</a>:</p>
<ul class="simple">
<li><p>unsuccessful prospective buyers pay <span class="math notranslate nohighlight">\(0\)</span> because removing  them from “society” would not affect the allocation chosen by the mechanim</p></li>
<li><p>successful prospective buyers pay the difference between the total value society could achieve without them present and the total value that others present in society do achieve under the mechanism.</p></li>
</ul>
<p>The generalized second-price auction described in our pseudo code above does indeed satisfy (1).
We want to compute <span class="math notranslate nohighlight">\(\check t_j\)</span> for <span class="math notranslate nohighlight">\(j = 1, \ldots, m\)</span> and compare with <span class="math notranslate nohighlight">\(p_j\)</span> from the second price auction.</p>
</section>
<section id="social-cost">
<h3><span class="section-number">81.12.2. </span>Social Cost<a class="headerlink" href="#social-cost" title="Permalink to this heading">#</a></h3>
<p>Using the GC_Mechanism class, we can  calculate the social cost of each buyer.</p>
<p>Let’s see a simpler example with private value matrix</p>
<div class="math notranslate nohighlight">
\[
V =\begin{bmatrix} 10 &amp; 9 &amp; 8 &amp; 7 &amp; 6 \cr
                    9 &amp; 8 &amp; 7 &amp; 6 &amp; 6 \cr
                    8 &amp; 7 &amp; 6 &amp; 5 &amp; 4 \end{bmatrix}
\]</div>
<p>To begin with, we implement the GC mechanism and see the outcome.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">666</span><span class="p">)</span>

<span class="n">V_orig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
                   <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
                   <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
<span class="n">gc_mechanism</span> <span class="o">=</span> <span class="n">GC_Mechanism</span><span class="p">(</span><span class="n">V_orig</span><span class="p">)</span>
<span class="n">gc_mechanism</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>House 0 is sold to buyer 0 at price 9


House 1 is sold to buyer 1 at price 7


House 2 is sold to buyer 2 at price 5


Prices of house:
 [9. 7. 5.]


The status matrix:
 [[1. 0. 0. 0. 0.]
 [0. 1. 0. 0. 0.]
 [0. 0. 1. 0. 0.]]


The surplus matrix:
 [[1. 0. 0. 0. 0.]
 [0. 1. 0. 0. 0.]
 [0. 0. 1. 0. 0.]]
</pre></div>
</div>
</div>
</div>
<p>We exclude buyer 0 and calculate the allocation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">V_exc_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">V_orig</span><span class="p">)</span>
<span class="n">V_exc_0</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">V_exc_0</span>
<span class="n">gc_mechanism_exc_0</span> <span class="o">=</span> <span class="n">GC_Mechanism</span><span class="p">(</span><span class="n">V_exc_0</span><span class="p">)</span>
<span class="n">gc_mechanism_exc_0</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>House 0 is sold to buyer 1 at price 8


House 1 is sold to buyer 2 at price 6


House 2 is sold to buyer 3 at price 4


Prices of house:
 [8. 6. 4.]


The status matrix:
 [[0. 1. 0. 0. 0.]
 [0. 0. 1. 0. 0.]
 [0. 0. 0. 1. 0.]]


The surplus matrix:
 [[-0.  1.  0.  0.  0.]
 [-0.  0.  1.  0.  0.]
 [-0.  0.  0.  1.  0.]]
</pre></div>
</div>
</div>
</div>
<p>Calculate the social cost of buyer 0.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The social cost of buyer 0:&quot;</span><span class="p">,</span>
     <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">gc_mechanism_exc_0</span><span class="o">.</span><span class="n">Q</span><span class="o">*</span><span class="n">gc_mechanism_exc_0</span><span class="o">.</span><span class="n">V_orig</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">gc_mechanism</span><span class="o">.</span><span class="n">Q</span><span class="o">*</span><span class="n">gc_mechanism</span><span class="o">.</span><span class="n">V_orig</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The social cost of buyer 0: 7.0
</pre></div>
</div>
</div>
</div>
<p>Repeat this process for buyer 1 and buyer 2</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">V_exc_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">V_orig</span><span class="p">)</span>
<span class="n">V_exc_1</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">V_exc_1</span>
<span class="n">gc_mechanism_exc_1</span> <span class="o">=</span> <span class="n">GC_Mechanism</span><span class="p">(</span><span class="n">V_exc_1</span><span class="p">)</span>
<span class="n">gc_mechanism_exc_1</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The social cost of buyer 1:&quot;</span><span class="p">,</span>
     <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">gc_mechanism_exc_1</span><span class="o">.</span><span class="n">Q</span><span class="o">*</span><span class="n">gc_mechanism_exc_1</span><span class="o">.</span><span class="n">V_orig</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">gc_mechanism</span><span class="o">.</span><span class="n">Q</span><span class="o">*</span><span class="n">gc_mechanism</span><span class="o">.</span><span class="n">V_orig</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>House 0 is sold to buyer 0 at price 8


House 1 is sold to buyer 2 at price 6


House 2 is sold to buyer 3 at price 4


Prices of house:
 [8. 6. 4.]


The status matrix:
 [[1. 0. 0. 0. 0.]
 [0. 0. 1. 0. 0.]
 [0. 0. 0. 1. 0.]]


The surplus matrix:
 [[ 2. -0.  0.  0.  0.]
 [ 0. -0.  1.  0.  0.]
 [ 0. -0.  0.  1.  0.]]

The social cost of buyer 1: 6.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">V_exc_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">V_orig</span><span class="p">)</span>
<span class="n">V_exc_2</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">V_exc_2</span>
<span class="n">gc_mechanism_exc_2</span> <span class="o">=</span> <span class="n">GC_Mechanism</span><span class="p">(</span><span class="n">V_exc_2</span><span class="p">)</span>
<span class="n">gc_mechanism_exc_2</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The social cost of buyer 2:&quot;</span><span class="p">,</span>
     <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">gc_mechanism_exc_2</span><span class="o">.</span><span class="n">Q</span><span class="o">*</span><span class="n">gc_mechanism_exc_2</span><span class="o">.</span><span class="n">V_orig</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">gc_mechanism</span><span class="o">.</span><span class="n">Q</span><span class="o">*</span><span class="n">gc_mechanism</span><span class="o">.</span><span class="n">V_orig</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>House 0 is sold to buyer 0 at price 9


House 1 is sold to buyer 1 at price 6


House 2 is sold to buyer 3 at price 4


Prices of house:
 [9. 6. 4.]


The status matrix:
 [[1. 0. 0. 0. 0.]
 [0. 1. 0. 0. 0.]
 [0. 0. 0. 1. 0.]]


The surplus matrix:
 [[ 1.  0. -0.  0.  0.]
 [ 0.  2. -0.  0.  0.]
 [ 0.  0. -0.  1.  0.]]

The social cost of buyer 2: 5.0
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                    </div>
                    
                </main> <!-- .page__content -->
                


                <footer class="qe-page__footer">

                    <p><a href="https://creativecommons.org/licenses/by-sa/4.0/"><img src="https://licensebuttons.net/l/by-sa/4.0/80x15.png"></a></p>

                    <p>Creative Commons License &ndash; This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International.</p>

                </footer> <!-- .page__footer -->

            </div> <!-- .page -->

            

            
            <div class="qe-sidebar bd-sidebar inactive" id="site-navigation">

                <div class="qe-sidebar__header">


                    Contents

                </div>

                <nav class="qe-sidebar__nav" id="qe-sidebar-nav" aria-label="Main navigation">
                    <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tools and Techniques
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="geom_series.html">
   1. Geometric Series for Elementary Economics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="sir_model.html">
   2. Modeling COVID 19
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="linear_algebra.html">
   3. Linear Algebra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="qr_decomp.html">
   4. QR Decomposition
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="complex_and_trig.html">
   5. Complex Numbers and Trigonometry
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="eig_circulant.html">
   6. Circulant Matrices
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="svd_intro.html">
   7. Singular Value Decomposition (SVD)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="var_dmd.html">
   8. VARs and DMDs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="newton_method.html">
   9. Using Newton’s Method to Solve Economic Models
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Elementary Statistics
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="prob_matrix.html">
   10. Elementary Probability with Matrices
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lln_clt.html">
   11. LLN and CLT
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="prob_meaning.html">
   12. Two Meanings of Probability
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="multi_hyper.html">
   13. Multivariate Hypergeometric Distribution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="multivariate_normal.html">
   14. Multivariate Normal Distribution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="heavy_tails.html">
   15. Heavy-Tailed Distributions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="hoist_failure.html">
   16. Fault Tree Uncertainties
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="back_prop.html">
   17. Introduction to Artificial Neural Networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rand_resp.html">
   18. Randomized Response Surveys
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="util_rand_resp.html">
   19. Expected Utilities of Random Responses
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Linear Programming
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="lp_intro.html">
   20. Linear Programming
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="opt_transport.html">
   21. Optimal Transport
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="von_neumann_model.html">
   22. Von Neumann Growth Model (and a Generalization)
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introduction to Dynamics
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="scalar_dynam.html">
   23. Dynamics in One Dimension
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="finite_markov.html">
   24. Finite Markov Chains
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="inventory_dynamics.html">
   25. Inventory Dynamics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="linear_models.html">
   26. Linear State Space Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="samuelson.html">
   27. Samuelson Multiplier-Accelerator
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="kesten_processes.html">
   28. Kesten Processes and Firm Dynamics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wealth_dynamics.html">
   29. Wealth Distribution Dynamics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="kalman.html">
   30. A First Look at the Kalman Filter
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="kalman_2.html">
   31. Another Look at the Kalman Filter
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="short_path.html">
   32. Shortest Paths
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Search
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_model.html">
   33. Job Search I: The McCall Search Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_model_with_separation.html">
   34. Job Search II: Search and Separation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_fitted_vfi.html">
   35. Job Search III: Fitted Value Function Iteration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_correlated.html">
   36. Job Search IV: Correlated Wage Offers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="career.html">
   37. Job Search V: Modeling Career Choice
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="jv.html">
   38. Job Search VI: On-the-Job Search
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_q.html">
   39. Job Search VII: A McCall Worker Q-Learns
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Consumption, Savings and Capital
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="cass_koopmans_1.html">
   40. Cass-Koopmans Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cass_koopmans_2.html">
   41. Cass-Koopmans Competitive Equilibrium
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cake_eating_problem.html">
   42. Cake Eating I: Introduction to Optimal Saving
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cake_eating_numerical.html">
   43. Cake Eating II: Numerical Methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="optgrowth.html">
   44. Optimal Growth I: The Stochastic Optimal Growth Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="optgrowth_fast.html">
   45. Optimal Growth II: Accelerating the Code with Numba
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="coleman_policy_iter.html">
   46. Optimal Growth III: Time Iteration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="egm_policy_iter.html">
   47. Optimal Growth IV: The Endogenous Grid Method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ifp.html">
   48. The Income Fluctuation Problem I: Basic Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ifp_advanced.html">
   49. The Income Fluctuation Problem II: Stochastic Returns on Assets
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Bayes Law
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="bayes_nonconj.html">
   50. Non-Conjugate Priors
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ar1_bayes.html">
   51. Posterior Distributions for  AR(1) Parameters
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ar1_turningpts.html">
   52. Forecasting  an AR(1) Process
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Information
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="odu.html">
   53. Job Search VII: Search with Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="likelihood_ratio_process.html">
   54. Likelihood Ratio Processes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="imp_sample.html">
   55. Computing Mean of a Likelihood Ratio Process
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wald_friedman.html">
   56. A Problem that Stumped Milton Friedman
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="exchangeable.html">
   57. Exchangeability and Bayesian Updating
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="likelihood_bayes.html">
   58. Likelihood Ratio Processes and Bayesian Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mix_model.html">
   59. Incorrect Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="navy_captain.html">
   60. Bayesian versus Frequentist Decision Rules
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  LQ Control
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="lqcontrol.html">
   61. LQ Control: Foundations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lagrangian_lqdp.html">
   62. Lagrangian for LQ Control
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cross_product_trick.html">
   63. Eliminating Cross Products
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="perm_income.html">
   64. The Permanent Income Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="perm_income_cons.html">
   65. Permanent Income II: LQ Techniques
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lq_inventories.html">
   66. Production Smoothing via Inventories
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Multiple Agent Models
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="schelling.html">
   67. Schelling’s Segregation Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lake_model.html">
   68. A Lake Model of Employment and Unemployment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rational_expectations.html">
   69. Rational Expectations Equilibrium
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="re_with_feedback.html">
   70. Stability in Linear Rational Expectations Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="markov_perf.html">
   71. Markov Perfect Equilibrium
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="uncertainty_traps.html">
   72. Uncertainty Traps
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="aiyagari.html">
   73. The Aiyagari Model
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Asset Pricing and Finance
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="markov_asset.html">
   74. Asset Pricing: Finite State Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ge_arrow.html">
   75. Competitive Equilibria with Arrow Securities
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="harrison_kreps.html">
   76. Heterogeneous Beliefs and Bubbles
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Data and Empirics
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="pandas_panel.html">
   77. Pandas for Panel Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ols.html">
   78. Linear Regression in Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mle.html">
   79. Maximum Likelihood Estimation
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Auctions
 </span>
</p>
<ul class="current nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="two_auctions.html">
   80. First-Price and Second-Price Auctions
  </a>
 </li>
 <li class="toctree-l1 current active active">
  <a class="current reference internal" href="#">
   81. Multiple Good Allocation Mechanisms
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Other
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="troubleshooting.html">
   82. Troubleshooting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="zreferences.html">
   83. References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="status.html">
   84. Execution Statistics
  </a>
 </li>
</ul>

                </nav>

                <div class="qe-sidebar__footer">

                </div>

            </div> <!-- .sidebar -->
            
        </div> <!-- .main -->

        <div class="qe-toolbar">

            <div class="qe-toolbar__inner">

                <ul class="qe-toolbar__main">
                    <li data-tippy-content="Table of Contents" class="btn__sidebar"><i data-feather="menu"></i></li>
                    <li data-tippy-content="Home"><a href="intro.html"><i data-feather="home"></i></a></li>
                    <li class="btn__qelogo"><a href="https://quantecon.org" title=""><span class="show-for-sr">QuantEcon</span></a></li>
                </ul>

                <ul class="qe-toolbar__links">
                    <li class="btn__search">
                        <form action="search.html" method="get">
                            <input type="search" class="form-control" name="q" id="search-input" placeholder="Search..." aria-label="Search..." autocomplete="off" accesskey="k">
                            <i data-feather="search" id="search-icon"></i>
                        </form>
                    </li>
                    <li data-tippy-content="Fullscreen" class="btn__fullscreen"><i data-feather="maximize"></i></li>
                    <li data-tippy-content="Increase font size" class="btn__plus"><i data-feather="plus-circle"></i></li>
                    <li data-tippy-content="Decrease font size" class="btn__minus"><i data-feather="minus-circle"></i></li>
                    <li data-tippy-content="Change contrast" class="btn__contrast"><i data-feather="sunset"></i></li>
                    <li data-tippy-content="Download Notebook"><a href="/_notebooks/house_auction.ipynb" download><i data-feather="download-cloud"></i></a></li>
                    <li class="settings-button" id="settingsButton"><div data-tippy-content="Launch Notebook"><i data-feather="play-circle"></i></div></li>
                        <li class="download-pdf" id="downloadButton"><i data-feather="file"></i></li>
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/QuantEcon/lecture-python.myst/blob/main/lectures/house_auction.md" download><i data-feather="github"></i></a></li>
                </ul>

            </div>

        </div> <!-- .toolbar -->
        <div id="downloadPDFModal" style="display: none;">
            <ul class="pdf-options" style="display: block;">
                <li class="download-pdf-book" onClick="window.print()">
                    <p>Lecture (PDF)</p>
                </li>
                <li class="download-pdf-file">
                    <a href="/_pdf/quantecon-python.pdf" download><p>Book (PDF)</p></a>
                </li>
            </ul>
        </div>
        <div id="settingsModal" style="display: none;">
            <p class="modal-title"> Notebook Launcher </p>
            <div class="modal-desc">
            <p>
                Choose public or private cloud service for "Launch" button.
            </p>
            </div>
            <p class="modal-subtitle">Select a server</p>
            <ul class="modal-servers">
            <li class="active launcher-public">
                <span class="label">Public</span>
                <select id="launcher-public-input">
                
                    <option value="https://colab.research.google.com/github/QuantEcon/lecture-python.notebooks/blob/master/house_auction.ipynb">Colab</option>
                
                </select>
                <i class="fas fa-check-circle"></i>
            </li>
            <li class="launcher-private">
                <span class="label">Private</span>
                <input type="text" id="launcher-private-input" data-repourl="https://github.com/QuantEcon/lecture-python.notebooks" data-urlpath="tree/lecture-python.notebooks/house_auction.ipynb" data-branch=master>
                <i class="fas fa-check-circle"></i>
            </li>
            </ul>
            <p class="launch"><a href="https://colab.research.google.com/github/QuantEcon/lecture-python.notebooks/blob/master/house_auction.ipynb" id="advancedLaunchButton" target="_blank">Launch Notebook</a></p>
            <script>
                // QuantEcon Notebook Launcher
                const launcherTypeElements = document.querySelectorAll('#settingsModal .modal-servers li');
                // Highlight the server type if previous selection exists
                if (typeof localStorage.launcherType !== 'undefined') {
                  for (var i = 0; i < launcherTypeElements.length; i++) {
                    launcherTypeElements[i].classList.remove('active');
                    if ( launcherTypeElements[i].classList.contains(localStorage.launcherType) ) {
                      launcherTypeElements[i].classList.add('active');
                    }
                  }
                }
                // Highlight server type on click and set local storage value
                for (var i = 0; i < launcherTypeElements.length; i++) {
                  launcherTypeElements[i].addEventListener('click', function() {
                    for (var j = 0; j < launcherTypeElements.length; j++) {
                      launcherTypeElements[j].classList.remove('active');
                    }
                    this.classList.add('active');
                    if ( this.classList.contains('launcher-private') ) {
                      localStorage.launcherType = 'launcher-private';
                    } else if ( this.classList.contains('launcher-public') ) {
                      localStorage.launcherType = 'launcher-public';
                    }
                    setLaunchServer();
                  })
                }
                const launcherPublic = document.getElementById('launcher-public-input');
                const launcherPrivate = document.getElementById('launcher-private-input');
                const pageName = "house_auction";
                const repoURL = "https://github.com/QuantEcon/lecture-python.notebooks";
                const urlPath = "tree/lecture-python.notebooks/house_auction.ipynb";
                const branch = "master"
                const launchNotebookLink = document.getElementById('advancedLaunchButton');

                // Highlight public server option if previous selection exists
                if (typeof localStorage.launcherPublic !== 'undefined') {
                  launcherPublic.value = localStorage.launcherPublic;
                }
                // Update local storage upon public server selection
                launcherPublic.addEventListener('change', (event) => {
                  setLaunchServer();
                });
                // Populate private server input if previous entry exists
                if (typeof localStorage.launcherPrivate !== 'undefined') {
                  launcherPrivate.value = localStorage.launcherPrivate;
                }
                // Update local storage when a private server is entered
                launcherPrivate.addEventListener('input', (event) => {
                  setLaunchServer();
                });

                // Function to update the "Launch Notebook" link href
                function setLaunchServer() {
                  launchNotebookLink.removeAttribute("style")
                  if ( localStorage.launcherType == 'launcher-private' ) {
                    let repoPrefix = "/jupyter/hub/user-redirect/git-pull?repo=" + repoURL + "&branch=" + branch + "&urlpath=" + urlPath;
                    launcherPrivateValue = launcherPrivate.value
                    if (!launcherPrivateValue) {
                        launchNotebookLink.removeAttribute("href")
                        launchNotebookLink.style.background = "grey"
                        return
                    }
                    localStorage.launcherPrivate = launcherPrivateValue;
                    privateServer = localStorage.launcherPrivate.replace(/\/$/, "")
                    if (!privateServer.includes("http")) {
                        privateServer = "http://" + privateServer
                    }
                    launchNotebookLinkURL = privateServer + repoPrefix;
                  } else if ( localStorage.launcherType == 'launcher-public' ) {
                    launcherPublicValue = launcherPublic.options[launcherPublic.selectedIndex].value;
                    localStorage.launcherPublic = launcherPublicValue;
                    launchNotebookLinkURL = localStorage.launcherPublic;
                  }
                  if (launchNotebookLinkURL) launchNotebookLink.href = launchNotebookLinkURL;
                }
                // Check if user has previously selected a server
                if ( (typeof localStorage.launcherPrivate !== 'undefined') || (typeof localStorage.launcherPublic !== 'undefined') ) {
                  setLaunchServer();
                }
                </script>

        </div>

    </div> <!-- .wrapper-->
  </body>
</html>