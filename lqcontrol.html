

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>62. LQ Control: Foundations &#8212; Quantitative Economics with Python</title>
    <script src="https://unpkg.com/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/tippy.js@6.3.1/dist/tippy-bundle.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
        <script>
            MathJax = {
            loader: {load: ['[tex]/boldsymbol', '[tex]/textmacros']},
            tex: {
                packages: {'[+]': ['boldsymbol', 'textmacros']},
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                processEscapes: true,
                macros: {
                    "argmax" : "arg\\,max",
                    "argmin" : "arg\\,min",
                    "col"    : "col",
                    "Span"   :  "span",
                    "epsilon": "\\varepsilon",
                    "EE": "\\mathbb{E}",
                    "PP": "\\mathbb{P}",
                    "RR": "\\mathbb{R}",
                    "NN": "\\mathbb{N}",
                    "ZZ": "\\mathbb{Z}",
                    "aA": "\\mathcal{A}",
                    "bB": "\\mathcal{B}",
                    "cC": "\\mathcal{C}",
                    "dD": "\\mathcal{D}",
                    "eE": "\\mathcal{E}",
                    "fF": "\\mathcal{F}",
                    "gG": "\\mathcal{G}",
                    "hH": "\\mathcal{H}",
                }
            },
            svg: {
                fontCache: 'global',
                scale: 0.92,
                displayAlign: "center",
            },
            };
        </script>
    
    
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/quantecon-book-theme.279dae03c5caae754d20501e3fa00bbf.css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/exercise.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />


    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script src="_static/quantecon-book-theme.15b0c36fffe88f468997fa7b698991d3.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"tex": {"macros": {"argmax": "arg\\,max", "argmin": "arg\\,min"}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'lqcontrol';</script>
    <link rel="canonical" href="https://python.quantecon.org/lqcontrol.html" />
    <link rel="shortcut icon" href="_static/lectures-favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="63. Lagrangian for LQ Control" href="lagrangian_lqdp.html" />
    <link rel="prev" title="61. Bayesian versus Frequentist Decision Rules" href="navy_captain.html" />

<!-- Normal Meta Tags -->
<meta name="author" context="Thomas J. Sargent &amp; John Stachurski" />
<meta name="keywords" content="Python, QuantEcon, Quantitative Economics, Economics, Sloan, Alfred P. Sloan Foundation, Tom J. Sargent, John Stachurski" />
<meta name="description" content=This website presents a set of lectures on quantitative economic modeling, designed and written by Thomas J. Sargent and John Stachurski. />

<!-- Twitter tags -->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@quantecon" />
<meta name="twitter:title" content="LQ Control: Foundations"/>
<meta name="twitter:description" content="This website presents a set of lectures on quantitative economic modeling, designed and written by Thomas J. Sargent and John Stachurski.">
<meta name="twitter:creator" content="@quantecon">
<meta name="twitter:image" content="https://assets.quantecon.org/img/qe-twitter-logo.png">

<!-- Opengraph tags -->
<meta property="og:title" content="LQ Control: Foundations" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://python.quantecon.org/lqcontrol.html" />
<meta property="og:image" content="https://assets.quantecon.org/img/qe-og-logo.png" />
<meta property="og:description" content="This website presents a set of lectures on quantitative economic modeling, designed and written by Thomas J. Sargent and John Stachurski." />
<meta property="og:site_name" content="Quantitative Economics with Python" />
<meta name="theme-color" content="#ffffff" />

  </head>
<body>


    <span id="top"></span>

    <div class="qe-wrapper">

        <div class="qe-main">

            <div class="qe-page" id=lqcontrol>

                <div class="qe-page__toc">

                    <div class="inner">

                        
                        <div class="qe-page__toc-header">
                            On this page
                        </div>


                        <nav id="bd-toc-nav" class="qe-page__toc-nav">
                            <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">62.1. Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">62.2. Introduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-law-of-motion">62.2.1. The Law of Motion</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-1">62.2.1.1. Example 1</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-2">62.2.1.2. Example 2</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#preferences">62.2.2. Preferences</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">62.2.2.1. Example 1</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">62.2.2.2. Example 2</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optimality-finite-horizon">62.3. Optimality – Finite Horizon</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-objective">62.3.1. The Objective</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#information">62.3.2. Information</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#solution">62.3.3. Solution</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">62.4. Implementation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#an-application">62.4.1. An Application</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extensions-and-comments">62.5. Extensions and Comments</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-varying-parameters">62.5.1. Time-Varying Parameters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-a-cross-product-term">62.5.2. Adding a Cross-Product Term</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#infinite-horizon">62.5.3. Infinite Horizon</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#certainty-equivalence">62.5.4. Certainty Equivalence</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#further-applications">62.6. Further Applications</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#application-1-age-dependent-income-process">62.6.1. Application 1: Age-Dependent Income Process</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#application-2-a-permanent-income-model-with-retirement">62.6.2. Application 2: A Permanent Income Model with Retirement</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#application-3-monopoly-with-adjustment-costs">62.6.3. Application 3: Monopoly with Adjustment Costs</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">62.7. Exercises</a></li>
</ul>
                            <p class="logo">
                                
                                    
                                    <a href=https://quantecon.org><img src="_static/qe-logo-large.png" class="logo" alt="logo"></a>
                                    
                                
                            </p>

                            <p class="powered">Powered by <a href="https://jupyterbook.org/">Jupyter Book</a></p>

                        </nav>

                        <div class="qe-page__toc-footer">
                            
                            
                            <p><a href="#top"><strong>Back to top</strong></a></p>
                        </div>

                    </div>

                </div>

                <div class="qe-page__header">

                    <div class="qe-page__header-copy">

                        <p class="qe-page__header-heading"><a href="intro.html">Quantitative Economics with Python</a></p>

                        <p class="qe-page__header-subheading">LQ Control: Foundations</p>

                    </div>

                    <p class="qe-page__header-authors">Thomas J. Sargent & John Stachurski</p>

                </div> <!-- .page__header -->



                
                <main class="qe-page__content" role="main">
                    
                    <div>
                        
  <div id="qe-notebook-header" align="right" style="text-align:right;">
        <a href="https://quantecon.org/" title="quantecon.org">
                <img style="width:250px;display:inline;" width="250px" src="https://assets.quantecon.org/img/qe-menubar-logo.svg" alt="QuantEcon">
        </a>
</div><section class="tex2jax_ignore mathjax_ignore" id="lq-control-foundations">
<h1><a class="toc-backref" href="#id10"><span class="section-number">62. </span>LQ Control: Foundations</a><a class="headerlink" href="#lq-control-foundations" title="Permalink to this heading">#</a></h1>
<div class="contents topic" id="contents">
<span id="index-0"></span><p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#lq-control-foundations" id="id10">LQ Control: Foundations</a></p>
<ul>
<li><p><a class="reference internal" href="#overview" id="id11">Overview</a></p></li>
<li><p><a class="reference internal" href="#introduction" id="id12">Introduction</a></p></li>
<li><p><a class="reference internal" href="#optimality-finite-horizon" id="id13">Optimality – Finite Horizon</a></p></li>
<li><p><a class="reference internal" href="#implementation" id="id14">Implementation</a></p></li>
<li><p><a class="reference internal" href="#extensions-and-comments" id="id15">Extensions and Comments</a></p></li>
<li><p><a class="reference internal" href="#further-applications" id="id16">Further Applications</a></p></li>
<li><p><a class="reference internal" href="#exercises" id="id17">Exercises</a></p></li>
</ul>
</li>
</ul>
</div>
<p>In addition to what’s in Anaconda, this lecture will need the following libraries:</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install quantecon
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: quantecon in /opt/conda/envs/quantecon/lib/python3.10/site-packages (0.6.0)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: numba in /opt/conda/envs/quantecon/lib/python3.10/site-packages (from quantecon) (0.56.4)
Requirement already satisfied: numpy&gt;=1.17.0 in /opt/conda/envs/quantecon/lib/python3.10/site-packages (from quantecon) (1.23.5)
Requirement already satisfied: scipy&gt;=1.5.0 in /opt/conda/envs/quantecon/lib/python3.10/site-packages (from quantecon) (1.10.0)
Requirement already satisfied: sympy in /opt/conda/envs/quantecon/lib/python3.10/site-packages (from quantecon) (1.11.1)
Requirement already satisfied: requests in /opt/conda/envs/quantecon/lib/python3.10/site-packages (from quantecon) (2.28.1)
Requirement already satisfied: setuptools in /opt/conda/envs/quantecon/lib/python3.10/site-packages (from numba-&gt;quantecon) (65.6.3)
Requirement already satisfied: llvmlite&lt;0.40,&gt;=0.39.0dev0 in /opt/conda/envs/quantecon/lib/python3.10/site-packages (from numba-&gt;quantecon) (0.39.1)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in /opt/conda/envs/quantecon/lib/python3.10/site-packages (from requests-&gt;quantecon) (3.4)
Requirement already satisfied: charset-normalizer&lt;3,&gt;=2 in /opt/conda/envs/quantecon/lib/python3.10/site-packages (from requests-&gt;quantecon) (2.0.4)
Requirement already satisfied: urllib3&lt;1.27,&gt;=1.21.1 in /opt/conda/envs/quantecon/lib/python3.10/site-packages (from requests-&gt;quantecon) (1.26.14)
Requirement already satisfied: certifi&gt;=2017.4.17 in /opt/conda/envs/quantecon/lib/python3.10/site-packages (from requests-&gt;quantecon) (2022.12.7)
Requirement already satisfied: mpmath&gt;=0.19 in /opt/conda/envs/quantecon/lib/python3.10/site-packages/mpmath-1.2.1-py3.10.egg (from sympy-&gt;quantecon) (1.2.1)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Yellow">WARNING: Running pip as the &#39;root&#39; user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv</span>

</pre></div>
</div>
</div>
</details>
</div>
<section id="overview">
<h2><a class="toc-backref" href="#id11"><span class="section-number">62.1. </span>Overview</a><a class="headerlink" href="#overview" title="Permalink to this heading">#</a></h2>
<p>Linear quadratic (LQ) control refers to a class of dynamic optimization problems that have found applications in almost every scientific field.</p>
<p>This lecture provides an introduction to LQ control and its economic applications.</p>
<p>As we will see, LQ systems have a simple structure that makes them an excellent workhorse for a wide variety of economic problems.</p>
<p>Moreover, while the linear-quadratic structure is restrictive, it is in fact far more flexible than it may appear initially.</p>
<p>These themes appear repeatedly below.</p>
<p>Mathematically, LQ control problems are closely related to <a class="reference internal" href="kalman.html"><span class="doc">the Kalman filter</span></a></p>
<ul class="simple">
<li><p>Recursive formulations of linear-quadratic control problems and Kalman filtering problems both involve matrix <strong>Riccati equations</strong>.</p></li>
<li><p>Classical formulations of linear control and linear filtering problems make use of similar matrix decompositions (see for example <a class="reference external" href="https://python-advanced.quantecon.org/lu_tricks.html">this lecture</a> and <a class="reference external" href="https://python-advanced.quantecon.org/classical_filtering.html">this lecture</a>).</p></li>
</ul>
<p>In reading what follows, it will be useful to have some familiarity with</p>
<ul class="simple">
<li><p>matrix manipulations</p></li>
<li><p>vectors of random variables</p></li>
<li><p>dynamic programming and the Bellman equation (see for example <a class="reference internal" href="short_path.html"><span class="doc">this lecture</span></a> and <a class="reference internal" href="optgrowth.html"><span class="doc">this lecture</span></a>)</p></li>
</ul>
<p>For additional reading on LQ control, see, for example,</p>
<ul class="simple">
<li><p><span id="id1">[<a class="reference internal" href="zreferences.html#id183" title="L Ljungqvist and T J Sargent. Recursive Macroeconomic Theory. MIT Press, 4 edition, 2018.">LS18</a>]</span>, chapter 5</p></li>
<li><p><span id="id2">[<a class="reference internal" href="zreferences.html#id167" title="L P Hansen and T J Sargent. Robustness. Princeton University Press, 2008.">HS08</a>]</span>, chapter 4</p></li>
<li><p><span id="id3">[<a class="reference internal" href="zreferences.html#id169" title="O Hernandez-Lerma and J B Lasserre. Discrete-Time Markov Control Processes: Basic Optimality Criteria. Number Vol 1 in Applications of Mathematics Stochastic Modelling and Applied Probability. Springer, 1996.">HLL96</a>]</span>, section 3.5</p></li>
</ul>
<p>In order to focus on computation, we leave longer proofs to these sources (while trying to provide as much intuition as possible).</p>
<p>Let’s start with some imports:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1">#set default figure size</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">quantecon</span> <span class="kn">import</span> <span class="n">LQ</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="introduction">
<h2><a class="toc-backref" href="#id12"><span class="section-number">62.2. </span>Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this heading">#</a></h2>
<p>The “linear” part of LQ is a linear law of motion for the state, while the “quadratic” part refers to preferences.</p>
<p>Let’s begin with the former, move on to the latter, and then put them together into an optimization problem.</p>
<section id="the-law-of-motion">
<h3><span class="section-number">62.2.1. </span>The Law of Motion<a class="headerlink" href="#the-law-of-motion" title="Permalink to this heading">#</a></h3>
<p>Let <span class="math notranslate nohighlight">\(x_t\)</span> be a vector describing the state of some economic system.</p>
<p>Suppose that <span class="math notranslate nohighlight">\(x_t\)</span> follows a linear law of motion given by</p>
<div class="math notranslate nohighlight" id="equation-lq-lom">
<span class="eqno">(62.1)<a class="headerlink" href="#equation-lq-lom" title="Permalink to this equation">#</a></span>\[x_{t+1} = A x_t + B u_t + C w_{t+1},
\qquad t = 0, 1, 2, \ldots\]</div>
<p>Here</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(u_t\)</span> is a “control” vector, incorporating choices available to a decision-maker confronting the current state <span class="math notranslate nohighlight">\(x_t\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\{w_t\}\)</span> is an uncorrelated zero mean shock process satisfying <span class="math notranslate nohighlight">\(\mathbb E w_t w_t' = I\)</span>, where the right-hand side is the identity matrix</p></li>
</ul>
<p>Regarding the dimensions</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(x_t\)</span> is <span class="math notranslate nohighlight">\(n \times 1\)</span>, <span class="math notranslate nohighlight">\(A\)</span> is <span class="math notranslate nohighlight">\(n \times n\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(u_t\)</span> is <span class="math notranslate nohighlight">\(k \times 1\)</span>, <span class="math notranslate nohighlight">\(B\)</span> is <span class="math notranslate nohighlight">\(n \times k\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(w_t\)</span> is <span class="math notranslate nohighlight">\(j \times 1\)</span>, <span class="math notranslate nohighlight">\(C\)</span> is <span class="math notranslate nohighlight">\(n \times j\)</span></p></li>
</ul>
<section id="example-1">
<h4><span class="section-number">62.2.1.1. </span>Example 1<a class="headerlink" href="#example-1" title="Permalink to this heading">#</a></h4>
<p>Consider a household budget constraint given by</p>
<div class="math notranslate nohighlight">
\[
a_{t+1} + c_t = (1 + r) a_t + y_t
\]</div>
<p>Here <span class="math notranslate nohighlight">\(a_t\)</span> is assets, <span class="math notranslate nohighlight">\(r\)</span> is a fixed interest rate, <span class="math notranslate nohighlight">\(c_t\)</span> is
current consumption, and <span class="math notranslate nohighlight">\(y_t\)</span> is current non-financial income.</p>
<p>If we suppose that <span class="math notranslate nohighlight">\(\{ y_t \}\)</span> is serially uncorrelated and <span class="math notranslate nohighlight">\(N(0,
\sigma^2)\)</span>, then, taking <span class="math notranslate nohighlight">\(\{ w_t \}\)</span> to be standard normal, we can write
the system as</p>
<div class="math notranslate nohighlight">
\[
a_{t+1} = (1 + r) a_t - c_t + \sigma w_{t+1}
\]</div>
<p>This is clearly a special case of <a class="reference internal" href="#equation-lq-lom">(62.1)</a>, with assets being the state and consumption being the control.</p>
</section>
<section id="example-2">
<span id="lq-hhp"></span><h4><span class="section-number">62.2.1.2. </span>Example 2<a class="headerlink" href="#example-2" title="Permalink to this heading">#</a></h4>
<p>One unrealistic feature of the previous model is that non-financial income has a zero mean and is often negative.</p>
<p>This can easily be overcome by adding a sufficiently large mean.</p>
<p>Hence in this example, we take <span class="math notranslate nohighlight">\(y_t = \sigma w_{t+1} + \mu\)</span> for some positive real number <span class="math notranslate nohighlight">\(\mu\)</span>.</p>
<p>Another alteration that’s useful to introduce (we’ll see why soon) is to
change the control variable from consumption
to the deviation of consumption from some “ideal” quantity <span class="math notranslate nohighlight">\(\bar c\)</span>.</p>
<p>(Most parameterizations will be such that <span class="math notranslate nohighlight">\(\bar c\)</span> is large relative to the amount of consumption that is attainable in each period, and hence the household wants to increase consumption.)</p>
<p>For this reason, we now take our control to be <span class="math notranslate nohighlight">\(u_t := c_t - \bar c\)</span>.</p>
<p>In terms of these variables, the budget constraint <span class="math notranslate nohighlight">\(a_{t+1} = (1 + r) a_t - c_t + y_t\)</span> becomes</p>
<div class="math notranslate nohighlight" id="equation-lq-lomwc">
<span class="eqno">(62.2)<a class="headerlink" href="#equation-lq-lomwc" title="Permalink to this equation">#</a></span>\[a_{t+1} = (1 + r) a_t - u_t - \bar c + \sigma w_{t+1} + \mu\]</div>
<p>How can we write this new system in the form of equation <a class="reference internal" href="#equation-lq-lom">(62.1)</a>?</p>
<p>If, as in the previous example, we take <span class="math notranslate nohighlight">\(a_t\)</span> as the state, then we run into a problem:
the law of motion contains some constant terms on the right-hand side.</p>
<p>This means that we are dealing with an <em>affine</em> function, not a linear one
(recall <a class="reference internal" href="linear_algebra.html#la-linear-map"><span class="std std-ref">this discussion</span></a>).</p>
<p>Fortunately, we can easily circumvent this problem by adding an extra state variable.</p>
<p>In particular, if we write</p>
<div class="math notranslate nohighlight" id="equation-lq-lowmc">
<span class="eqno">(62.3)<a class="headerlink" href="#equation-lq-lowmc" title="Permalink to this equation">#</a></span>\[\begin{split}\left(
\begin{array}{c}
a_{t+1} \\
1
\end{array}
\right) =
\left(
\begin{array}{cc}
1 + r &amp; -\bar c + \mu \\
0     &amp; 1
\end{array}
\right)
\left(
\begin{array}{c}
a_t \\
1
\end{array}
\right) +
\left(
\begin{array}{c}
-1 \\
0
\end{array}
\right)
u_t +
\left(
\begin{array}{c}
\sigma \\
0
\end{array}
\right)
w_{t+1}\end{split}\]</div>
<p>then the first row is equivalent to <a class="reference internal" href="#equation-lq-lomwc">(62.2)</a>.</p>
<p>Moreover, the model is now linear and can be written in the form of
<a class="reference internal" href="#equation-lq-lom">(62.1)</a> by setting</p>
<div class="math notranslate nohighlight" id="equation-lq-lowmc2">
<span class="eqno">(62.4)<a class="headerlink" href="#equation-lq-lowmc2" title="Permalink to this equation">#</a></span>\[\begin{split}x_t :=
\left(
\begin{array}{c}
a_t \\
1
\end{array}
\right),
\quad
A :=
\left(
\begin{array}{cc}
1 + r &amp; -\bar c + \mu \\
0     &amp; 1
\end{array}
\right),
\quad
B :=
\left(
\begin{array}{c}
-1 \\
0
\end{array}
\right),
\quad
C :=
\left(
\begin{array}{c}
\sigma \\
0
\end{array}
\right)\end{split}\]</div>
<p>In effect, we’ve bought ourselves linearity by adding another state.</p>
</section>
</section>
<section id="preferences">
<h3><span class="section-number">62.2.2. </span>Preferences<a class="headerlink" href="#preferences" title="Permalink to this heading">#</a></h3>
<p>In the LQ model, the aim is to minimize flow of losses, where time-<span class="math notranslate nohighlight">\(t\)</span> loss is given by the quadratic expression</p>
<div class="math notranslate nohighlight" id="equation-lq-pref-flow">
<span class="eqno">(62.5)<a class="headerlink" href="#equation-lq-pref-flow" title="Permalink to this equation">#</a></span>\[x_t' R x_t + u_t' Q u_t\]</div>
<p>Here</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(R\)</span> is assumed to be <span class="math notranslate nohighlight">\(n \times n\)</span>, symmetric and nonnegative definite.</p></li>
<li><p><span class="math notranslate nohighlight">\(Q\)</span> is assumed to be <span class="math notranslate nohighlight">\(k \times k\)</span>, symmetric and positive definite.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In fact, for many economic problems, the definiteness conditions on <span class="math notranslate nohighlight">\(R\)</span> and <span class="math notranslate nohighlight">\(Q\)</span> can be relaxed.  It is sufficient that certain submatrices of <span class="math notranslate nohighlight">\(R\)</span> and <span class="math notranslate nohighlight">\(Q\)</span> be nonnegative definite. See <span id="id4">[<a class="reference internal" href="zreferences.html#id167" title="L P Hansen and T J Sargent. Robustness. Princeton University Press, 2008.">HS08</a>]</span> for details.</p>
</div>
<section id="id5">
<h4><span class="section-number">62.2.2.1. </span>Example 1<a class="headerlink" href="#id5" title="Permalink to this heading">#</a></h4>
<p>A very simple example that satisfies these assumptions is to take <span class="math notranslate nohighlight">\(R\)</span>
and <span class="math notranslate nohighlight">\(Q\)</span> to be identity matrices so that current loss is</p>
<div class="math notranslate nohighlight">
\[
x_t' I x_t + u_t' I u_t = \| x_t \|^2 + \| u_t \|^2
\]</div>
<p>Thus, for both the state and the control, loss is measured as squared distance from the origin.</p>
<p>(In fact, the general case <a class="reference internal" href="#equation-lq-pref-flow">(62.5)</a> can also be understood in this
way, but with <span class="math notranslate nohighlight">\(R\)</span> and <span class="math notranslate nohighlight">\(Q\)</span> identifying other – non-Euclidean – notions of “distance” from the zero vector.)</p>
<p>Intuitively, we can often think of the state <span class="math notranslate nohighlight">\(x_t\)</span> as representing deviation from a target, such
as</p>
<ul class="simple">
<li><p>deviation of inflation from some target level</p></li>
<li><p>deviation of a firm’s capital stock from some desired quantity</p></li>
</ul>
<p>The aim is to put the state close to the target, while using  controls parsimoniously.</p>
</section>
<section id="id6">
<h4><span class="section-number">62.2.2.2. </span>Example 2<a class="headerlink" href="#id6" title="Permalink to this heading">#</a></h4>
<p>In the household problem <a class="reference internal" href="#lq-hhp"><span class="std std-ref">studied above</span></a>, setting <span class="math notranslate nohighlight">\(R=0\)</span>
and <span class="math notranslate nohighlight">\(Q=1\)</span> yields preferences</p>
<div class="math notranslate nohighlight">
\[
x_t' R x_t + u_t' Q u_t = u_t^2 = (c_t - \bar c)^2
\]</div>
<p>Under this specification, the household’s current loss is the squared deviation of consumption from the ideal level <span class="math notranslate nohighlight">\(\bar c\)</span>.</p>
</section>
</section>
</section>
<section id="optimality-finite-horizon">
<h2><a class="toc-backref" href="#id13"><span class="section-number">62.3. </span>Optimality – Finite Horizon</a><a class="headerlink" href="#optimality-finite-horizon" title="Permalink to this heading">#</a></h2>
<p id="index-1">Let’s now be precise about the optimization problem we wish to consider, and look at how to solve it.</p>
<section id="the-objective">
<h3><span class="section-number">62.3.1. </span>The Objective<a class="headerlink" href="#the-objective" title="Permalink to this heading">#</a></h3>
<p>We will begin with the finite horizon case, with terminal time <span class="math notranslate nohighlight">\(T \in \mathbb N\)</span>.</p>
<p>In this case, the aim is to choose a sequence of controls <span class="math notranslate nohighlight">\(\{u_0, \ldots, u_{T-1}\}\)</span> to minimize the objective</p>
<div class="math notranslate nohighlight" id="equation-lq-object">
<span class="eqno">(62.6)<a class="headerlink" href="#equation-lq-object" title="Permalink to this equation">#</a></span>\[\mathbb E \,
\left\{
    \sum_{t=0}^{T-1} \beta^t (x_t' R x_t + u_t' Q u_t) + \beta^T x_T' R_f x_T
\right\}\]</div>
<p>subject to the law of motion <a class="reference internal" href="#equation-lq-lom">(62.1)</a> and initial state <span class="math notranslate nohighlight">\(x_0\)</span>.</p>
<p>The new objects introduced here are <span class="math notranslate nohighlight">\(\beta\)</span> and the matrix <span class="math notranslate nohighlight">\(R_f\)</span>.</p>
<p>The scalar <span class="math notranslate nohighlight">\(\beta\)</span> is the discount factor, while <span class="math notranslate nohighlight">\(x' R_f x\)</span> gives terminal loss associated with state <span class="math notranslate nohighlight">\(x\)</span>.</p>
<p>Comments:</p>
<ul class="simple">
<li><p>We assume <span class="math notranslate nohighlight">\(R_f\)</span> to be <span class="math notranslate nohighlight">\(n \times n\)</span>, symmetric and nonnegative definite.</p></li>
<li><p>We allow <span class="math notranslate nohighlight">\(\beta = 1\)</span>, and hence include the undiscounted case.</p></li>
<li><p><span class="math notranslate nohighlight">\(x_0\)</span> may itself be random, in which case we require it to be independent of the shock sequence <span class="math notranslate nohighlight">\(w_1, \ldots, w_T\)</span>.</p></li>
</ul>
</section>
<section id="information">
<span id="lq-cp"></span><h3><span class="section-number">62.3.2. </span>Information<a class="headerlink" href="#information" title="Permalink to this heading">#</a></h3>
<p>There’s one constraint we’ve neglected to mention so far, which is that the
decision-maker who solves this LQ problem knows only the present and the past,
not the future.</p>
<p>To clarify this point, consider the sequence of controls <span class="math notranslate nohighlight">\(\{u_0, \ldots, u_{T-1}\}\)</span>.</p>
<p>When choosing these controls, the decision-maker is permitted to take into account the effects of the shocks
<span class="math notranslate nohighlight">\(\{w_1, \ldots, w_T\}\)</span> on the system.</p>
<p>However, it is typically assumed — and will be assumed here — that the
time-<span class="math notranslate nohighlight">\(t\)</span> control <span class="math notranslate nohighlight">\(u_t\)</span> can  be made with knowledge of past and
present shocks only.</p>
<p>The fancy <a class="reference external" href="https://en.wikipedia.org/wiki/Measure_%28mathematics%29">measure-theoretic</a> way of saying this is that <span class="math notranslate nohighlight">\(u_t\)</span> must be measurable with respect to the <span class="math notranslate nohighlight">\(\sigma\)</span>-algebra generated by <span class="math notranslate nohighlight">\(x_0, w_1, w_2,
\ldots, w_t\)</span>.</p>
<p>This is in fact equivalent to stating that <span class="math notranslate nohighlight">\(u_t\)</span> can be written in the form <span class="math notranslate nohighlight">\(u_t = g_t(x_0, w_1, w_2, \ldots, w_t)\)</span> for some Borel measurable function <span class="math notranslate nohighlight">\(g_t\)</span>.</p>
<p>(Just about every function that’s useful for applications is Borel measurable,
so, for the purposes of intuition, you can read that last phrase as “for some function <span class="math notranslate nohighlight">\(g_t\)</span>”)</p>
<p>Now note that <span class="math notranslate nohighlight">\(x_t\)</span> will ultimately depend on the realizations of <span class="math notranslate nohighlight">\(x_0, w_1, w_2, \ldots, w_t\)</span>.</p>
<p>In fact, it turns out that <span class="math notranslate nohighlight">\(x_t\)</span> summarizes all the information about  these historical  shocks that the decision-maker needs to set controls optimally.</p>
<p>More precisely, it can be shown that any optimal control <span class="math notranslate nohighlight">\(u_t\)</span> can always be written as a function of the current state alone.</p>
<p>Hence in what follows we restrict attention to control policies (i.e., functions) of the form <span class="math notranslate nohighlight">\(u_t = g_t(x_t)\)</span>.</p>
<p>Actually, the preceding discussion applies to all standard dynamic programming problems.</p>
<p>What’s special about the LQ case is that – as we shall soon see —  the optimal <span class="math notranslate nohighlight">\(u_t\)</span> turns out to be a linear function of <span class="math notranslate nohighlight">\(x_t\)</span>.</p>
</section>
<section id="solution">
<h3><span class="section-number">62.3.3. </span>Solution<a class="headerlink" href="#solution" title="Permalink to this heading">#</a></h3>
<p>To solve the finite horizon LQ problem we can use a dynamic programming
strategy based on backward induction that is conceptually similar to the approach adopted in <a class="reference internal" href="short_path.html"><span class="doc">this lecture</span></a>.</p>
<p>For reasons that will soon become clear, we first introduce the notation <span class="math notranslate nohighlight">\(J_T(x) = x' R_f x\)</span>.</p>
<p>Now consider the problem of the decision-maker in the second to last period.</p>
<p>In particular, let the time be <span class="math notranslate nohighlight">\(T-1\)</span>, and suppose that the
state is <span class="math notranslate nohighlight">\(x_{T-1}\)</span>.</p>
<p>The decision-maker must trade-off current and (discounted) final losses, and hence
solves</p>
<div class="math notranslate nohighlight">
\[
\min_u \{
x_{T-1}' R x_{T-1} + u' Q u + \beta \,
\mathbb E J_T(A x_{T-1} + B u + C w_T)
\}
\]</div>
<p>At this stage, it is convenient to define the function</p>
<div class="math notranslate nohighlight" id="equation-lq-lsm">
<span class="eqno">(62.7)<a class="headerlink" href="#equation-lq-lsm" title="Permalink to this equation">#</a></span>\[J_{T-1} (x) =
\min_u \{
x' R x + u' Q u + \beta \,
\mathbb E J_T(A x + B u + C w_T)
\}\]</div>
<p>The function <span class="math notranslate nohighlight">\(J_{T-1}\)</span> will be called the <span class="math notranslate nohighlight">\(T-1\)</span> value function, and <span class="math notranslate nohighlight">\(J_{T-1}(x)\)</span> can be thought of as representing total “loss-to-go” from state <span class="math notranslate nohighlight">\(x\)</span> at time <span class="math notranslate nohighlight">\(T-1\)</span> when the decision-maker behaves optimally.</p>
<p>Now let’s step back to <span class="math notranslate nohighlight">\(T-2\)</span>.</p>
<p>For a decision-maker at <span class="math notranslate nohighlight">\(T-2\)</span>, the value <span class="math notranslate nohighlight">\(J_{T-1}(x)\)</span> plays a role analogous to that played by the terminal loss <span class="math notranslate nohighlight">\(J_T(x) = x' R_f x\)</span> for the decision-maker at <span class="math notranslate nohighlight">\(T-1\)</span>.</p>
<p>That is, <span class="math notranslate nohighlight">\(J_{T-1}(x)\)</span> summarizes the future loss associated with moving to state <span class="math notranslate nohighlight">\(x\)</span>.</p>
<p>The decision-maker chooses her control <span class="math notranslate nohighlight">\(u\)</span> to trade off current loss against future loss, where</p>
<ul class="simple">
<li><p>the next period state is <span class="math notranslate nohighlight">\(x_{T-1} = Ax_{T-2} + B u + C w_{T-1}\)</span>, and hence depends on the choice of current control.</p></li>
<li><p>the “cost” of landing in state <span class="math notranslate nohighlight">\(x_{T-1}\)</span> is <span class="math notranslate nohighlight">\(J_{T-1}(x_{T-1})\)</span>.</p></li>
</ul>
<p>Her problem is therefore</p>
<div class="math notranslate nohighlight">
\[
\min_u
\{
x_{T-2}' R x_{T-2} + u' Q u + \beta \,
\mathbb E J_{T-1}(Ax_{T-2} + B u + C w_{T-1})
\}
\]</div>
<p>Letting</p>
<div class="math notranslate nohighlight">
\[
J_{T-2} (x)
= \min_u
\{
x' R x + u' Q u + \beta \,
\mathbb E J_{T-1}(Ax + B u + C w_{T-1})
\}
\]</div>
<p>the pattern for backward induction is now clear.</p>
<p>In particular, we define a sequence of value functions <span class="math notranslate nohighlight">\(\{J_0, \ldots, J_T\}\)</span> via</p>
<div class="math notranslate nohighlight">
\[
J_{t-1} (x)
= \min_u
\{
x' R x + u' Q u + \beta \,
\mathbb E J_{t}(Ax + B u + C w_t)
\}
\quad \text{and} \quad
J_T(x) = x' R_f x
\]</div>
<p>The first equality is the Bellman equation from dynamic programming theory specialized to the finite horizon LQ problem.</p>
<p>Now that we have <span class="math notranslate nohighlight">\(\{J_0, \ldots, J_T\}\)</span>, we can obtain the optimal controls.</p>
<p>As a first step, let’s find out what the value functions look like.</p>
<p>It turns out that every <span class="math notranslate nohighlight">\(J_t\)</span> has the form <span class="math notranslate nohighlight">\(J_t(x) = x' P_t x + d_t\)</span> where <span class="math notranslate nohighlight">\(P_t\)</span> is a <span class="math notranslate nohighlight">\(n \times n\)</span> matrix and <span class="math notranslate nohighlight">\(d_t\)</span> is a constant.</p>
<p>We can show this by induction, starting from <span class="math notranslate nohighlight">\(P_T := R_f\)</span> and <span class="math notranslate nohighlight">\(d_T = 0\)</span>.</p>
<p>Using this notation, <a class="reference internal" href="#equation-lq-lsm">(62.7)</a> becomes</p>
<div class="math notranslate nohighlight" id="equation-lq-fswb">
<span class="eqno">(62.8)<a class="headerlink" href="#equation-lq-fswb" title="Permalink to this equation">#</a></span>\[J_{T-1} (x) =
\min_u \{
x' R x + u' Q u + \beta \,
\mathbb E (A x + B u + C w_T)' P_T (A x + B u + C w_T)
\}\]</div>
<p>To obtain the minimizer, we can take the derivative of the r.h.s. with respect to <span class="math notranslate nohighlight">\(u\)</span> and set it equal to zero.</p>
<p>Applying the relevant rules of <a class="reference internal" href="linear_algebra.html#la-mcalc"><span class="std std-ref">matrix calculus</span></a>, this gives</p>
<div class="math notranslate nohighlight" id="equation-lq-oc0">
<span class="eqno">(62.9)<a class="headerlink" href="#equation-lq-oc0" title="Permalink to this equation">#</a></span>\[u  = - (Q + \beta B' P_T B)^{-1} \beta B' P_T A x\]</div>
<p>Plugging this back into <a class="reference internal" href="#equation-lq-fswb">(62.8)</a> and rearranging yields</p>
<div class="math notranslate nohighlight">
\[
J_{T-1} (x) = x' P_{T-1} x + d_{T-1}
\]</div>
<p>where</p>
<div class="math notranslate nohighlight" id="equation-lq-finr">
<span class="eqno">(62.10)<a class="headerlink" href="#equation-lq-finr" title="Permalink to this equation">#</a></span>\[P_{T-1} = R - \beta^2 A' P_T B (Q + \beta B' P_T B)^{-1} B' P_T A +
\beta A' P_T A\]</div>
<p>and</p>
<div class="math notranslate nohighlight" id="equation-lq-finrd">
<span class="eqno">(62.11)<a class="headerlink" href="#equation-lq-finrd" title="Permalink to this equation">#</a></span>\[d_{T-1} := \beta \mathop{\mathrm{trace}}(C' P_T C)\]</div>
<p>(The algebra is a good exercise — we’ll leave it up to you.)</p>
<p>If we continue working backwards in this manner, it soon becomes clear that <span class="math notranslate nohighlight">\(J_t (x) = x' P_t x + d_t\)</span> as claimed, where <span class="math notranslate nohighlight">\(\{P_t\}\)</span> and <span class="math notranslate nohighlight">\(\{d_t\}\)</span> satisfy the recursions</p>
<div class="math notranslate nohighlight" id="equation-lq-pr">
<span class="eqno">(62.12)<a class="headerlink" href="#equation-lq-pr" title="Permalink to this equation">#</a></span>\[P_{t-1} = R - \beta^2 A' P_t B (Q + \beta B' P_t B)^{-1} B' P_t A +
\beta A' P_t A
\quad \text{with } \quad
P_T = R_f\]</div>
<p>and</p>
<div class="math notranslate nohighlight" id="equation-lq-dd">
<span class="eqno">(62.13)<a class="headerlink" href="#equation-lq-dd" title="Permalink to this equation">#</a></span>\[d_{t-1} = \beta (d_t + \mathop{\mathrm{trace}}(C' P_t C))
\quad \text{with } \quad
d_T = 0\]</div>
<p>Recalling <a class="reference internal" href="#equation-lq-oc0">(62.9)</a>, the minimizers from these backward steps are</p>
<div class="math notranslate nohighlight" id="equation-lq-oc">
<span class="eqno">(62.14)<a class="headerlink" href="#equation-lq-oc" title="Permalink to this equation">#</a></span>\[u_t  = - F_t x_t
\quad \text{where} \quad
F_t := (Q + \beta B' P_{t+1} B)^{-1} \beta B' P_{t+1} A\]</div>
<p>These are the linear optimal control policies we <a class="reference internal" href="#lq-cp"><span class="std std-ref">discussed above</span></a>.</p>
<p>In particular,  the sequence of controls given by <a class="reference internal" href="#equation-lq-oc">(62.14)</a> and <a class="reference internal" href="#equation-lq-lom">(62.1)</a> solves our finite horizon LQ problem.</p>
<p>Rephrasing this more precisely, the sequence <span class="math notranslate nohighlight">\(u_0, \ldots, u_{T-1}\)</span> given by</p>
<div class="math notranslate nohighlight" id="equation-lq-xud">
<span class="eqno">(62.15)<a class="headerlink" href="#equation-lq-xud" title="Permalink to this equation">#</a></span>\[u_t = - F_t x_t
\quad \text{with} \quad
x_{t+1} = (A - BF_t) x_t + C w_{t+1}\]</div>
<p>for <span class="math notranslate nohighlight">\(t = 0, \ldots, T-1\)</span> attains the minimum of <a class="reference internal" href="#equation-lq-object">(62.6)</a> subject to our constraints.</p>
</section>
</section>
<section id="implementation">
<h2><a class="toc-backref" href="#id14"><span class="section-number">62.4. </span>Implementation</a><a class="headerlink" href="#implementation" title="Permalink to this heading">#</a></h2>
<p>We will use code from <a class="reference external" href="https://github.com/QuantEcon/QuantEcon.py/blob/master/quantecon/lqcontrol.py">lqcontrol.py</a>
in <a class="reference external" href="http://quantecon.org/quantecon-py">QuantEcon.py</a>
to solve finite and infinite horizon linear quadratic control problems.</p>
<p>In the module, the various updating, simulation and fixed point methods
are wrapped in a class  called <code class="docutils literal notranslate"><span class="pre">LQ</span></code>, which includes</p>
<ul class="simple">
<li><p>Instance data:</p>
<ul>
<li><p>The required parameters <span class="math notranslate nohighlight">\(Q, R, A, B\)</span> and optional parameters <span class="math notranslate nohighlight">\(C, \beta, T, R_f, N\)</span> specifying a given LQ model</p>
<ul>
<li><p>set <span class="math notranslate nohighlight">\(T\)</span> and <span class="math notranslate nohighlight">\(R_f\)</span> to <code class="docutils literal notranslate"><span class="pre">None</span></code> in the infinite horizon case</p></li>
<li><p>set <code class="docutils literal notranslate"><span class="pre">C</span> <span class="pre">=</span> <span class="pre">None</span></code> (or zero) in the deterministic case</p></li>
</ul>
</li>
<li><p>the value function and policy data</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(d_t, P_t, F_t\)</span> in the finite horizon case</p></li>
<li><p><span class="math notranslate nohighlight">\(d, P, F\)</span> in the infinite horizon case</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Methods:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">update_values</span></code> — shifts <span class="math notranslate nohighlight">\(d_t, P_t, F_t\)</span> to their <span class="math notranslate nohighlight">\(t-1\)</span> values via <a class="reference internal" href="#equation-lq-pr">(62.12)</a>, <a class="reference internal" href="#equation-lq-dd">(62.13)</a> and <a class="reference internal" href="#equation-lq-oc">(62.14)</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stationary_values</span></code> — computes <span class="math notranslate nohighlight">\(P, d, F\)</span> in the infinite horizon case</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">compute_sequence</span></code> —- simulates the dynamics of <span class="math notranslate nohighlight">\(x_t, u_t, w_t\)</span> given <span class="math notranslate nohighlight">\(x_0\)</span> and assuming standard normal shocks</p></li>
</ul>
</li>
</ul>
<section id="an-application">
<span id="lq-mfpa"></span><h3><span class="section-number">62.4.1. </span>An Application<a class="headerlink" href="#an-application" title="Permalink to this heading">#</a></h3>
<p>Early Keynesian models assumed that households have a constant marginal
propensity to consume from current income.</p>
<p>Data contradicted the constancy of the marginal propensity to consume.</p>
<p>In response, Milton Friedman, Franco Modigliani and others built models
based on a consumer’s preference for an intertemporally smooth consumption stream.</p>
<p>(See, for example, <span id="id7">[<a class="reference internal" href="zreferences.html#id161" title="M. Friedman. A Theory of the Consumption Function. Princeton University Press, 1956.">Fri56</a>]</span> or <span id="id8">[<a class="reference internal" href="zreferences.html#id196" title="F. Modigliani and R. Brumberg. Utility analysis and the consumption function: An interpretation of cross-section data. In K.K Kurihara, editor, Post-Keynesian Economics. 1954.">MB54</a>]</span>.)</p>
<p>One property of those models is that households purchase and sell financial assets to make consumption streams smoother than income streams.</p>
<p>The household savings problem <a class="reference internal" href="#lq-hhp"><span class="std std-ref">outlined above</span></a> captures these ideas.</p>
<p>The optimization problem for the household is to choose a consumption sequence in order to minimize</p>
<div class="math notranslate nohighlight" id="equation-lq-pio">
<span class="eqno">(62.16)<a class="headerlink" href="#equation-lq-pio" title="Permalink to this equation">#</a></span>\[\mathbb E \,
\left\{
    \sum_{t=0}^{T-1} \beta^t (c_t - \bar c)^2 + \beta^T q a_T^2
\right\}\]</div>
<p>subject to the sequence of budget constraints <span class="math notranslate nohighlight">\(a_{t+1} = (1 + r) a_t - c_t + y_t, \ t \geq 0\)</span>.</p>
<p>Here <span class="math notranslate nohighlight">\(q\)</span> is a large positive constant, the role of which is to induce the consumer to target zero debt at the end of her life.</p>
<p>(Without such a constraint, the optimal choice is to choose <span class="math notranslate nohighlight">\(c_t = \bar c\)</span> in each period, letting assets adjust accordingly.)</p>
<p>As before we set <span class="math notranslate nohighlight">\(y_t = \sigma w_{t+1} + \mu\)</span> and <span class="math notranslate nohighlight">\(u_t := c_t - \bar c\)</span>, after which the constraint can be written as in <a class="reference internal" href="#equation-lq-lomwc">(62.2)</a>.</p>
<p>We saw how this constraint could be manipulated into the LQ formulation <span class="math notranslate nohighlight">\(x_{t+1} =
Ax_t + Bu_t + Cw_{t+1}\)</span> by setting <span class="math notranslate nohighlight">\(x_t = (a_t \; 1)'\)</span> and using the definitions in <a class="reference internal" href="#equation-lq-lowmc2">(62.4)</a>.</p>
<p>To match with this state and control, the objective function <a class="reference internal" href="#equation-lq-pio">(62.16)</a> can
be written in the form of <a class="reference internal" href="#equation-lq-object">(62.6)</a> by choosing</p>
<div class="math notranslate nohighlight">
\[\begin{split}
Q := 1,
\quad
R :=
\left(
\begin{array}{cc}
0 &amp; 0 \\
0 &amp; 0
\end{array}
\right),
\quad \text{and} \quad
R_f :=
\left(
\begin{array}{cc}
q &amp; 0 \\
0 &amp; 0
\end{array}
\right)
\end{split}\]</div>
<p>Now that the problem is expressed in LQ form, we can proceed to the solution
by applying <a class="reference internal" href="#equation-lq-pr">(62.12)</a> and <a class="reference internal" href="#equation-lq-oc">(62.14)</a>.</p>
<p>After generating shocks <span class="math notranslate nohighlight">\(w_1, \ldots, w_T\)</span>, the dynamics for assets and
consumption can be simulated via <a class="reference internal" href="#equation-lq-xud">(62.15)</a>.</p>
<p>The following figure was computed using <span class="math notranslate nohighlight">\(r = 0.05, \beta = 1 / (1+ r),
\bar c = 2,  \mu = 1, \sigma = 0.25, T = 45\)</span> and <span class="math notranslate nohighlight">\(q = 10^6\)</span>.</p>
<p>The shocks <span class="math notranslate nohighlight">\(\{w_t\}\)</span> were taken to be IID and standard normal.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Model parameters</span>
<span class="n">r</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">β</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">45</span>
<span class="n">c_bar</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">σ</span> <span class="o">=</span> <span class="mf">0.25</span>
<span class="n">μ</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">q</span> <span class="o">=</span> <span class="mf">1e6</span>

<span class="c1"># Formulate as an LQ problem</span>
<span class="n">Q</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">Rf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">Rf</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span>
<span class="n">A</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">r</span><span class="p">,</span> <span class="o">-</span><span class="n">c_bar</span> <span class="o">+</span> <span class="n">μ</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span>              <span class="mi">1</span><span class="p">]]</span>
<span class="n">B</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span> <span class="mi">0</span><span class="p">]]</span>
<span class="n">C</span> <span class="o">=</span> <span class="p">[[</span><span class="n">σ</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

<span class="c1"># Compute solutions and simulate</span>
<span class="n">lq</span> <span class="o">=</span> <span class="n">LQ</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="n">β</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">Rf</span><span class="o">=</span><span class="n">Rf</span><span class="p">)</span>
<span class="n">x0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">xp</span><span class="p">,</span> <span class="n">up</span><span class="p">,</span> <span class="n">wp</span> <span class="o">=</span> <span class="n">lq</span><span class="o">.</span><span class="n">compute_sequence</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>

<span class="c1"># Convert back to assets, consumption and income</span>
<span class="n">assets</span> <span class="o">=</span> <span class="n">xp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>           <span class="c1"># a_t</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">up</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">+</span> <span class="n">c_bar</span>    <span class="c1"># c_t</span>
<span class="n">income</span> <span class="o">=</span> <span class="n">σ</span> <span class="o">*</span> <span class="n">wp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">μ</span>  <span class="c1"># y_t</span>

<span class="c1"># Plot results</span>
<span class="n">n_rows</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">bbox</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">.102</span><span class="p">)</span>
<span class="n">legend_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bbox_to_anchor&#39;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">,</span> <span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;expand&#39;</span><span class="p">}</span>
<span class="n">p_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lw&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">}</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span> <span class="n">income</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;non-financial income&quot;</span><span class="p">,</span>
            <span class="o">**</span><span class="n">p_args</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">)),</span> <span class="n">c</span><span class="p">,</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;consumption&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">p_args</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">income</span> <span class="o">-</span> <span class="n">μ</span><span class="p">),</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;cumulative unanticipated income&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">p_args</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span> <span class="n">assets</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;assets&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">p_args</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="s1">&#39;k-&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="o">**</span><span class="n">legend_args</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/25e7ad6dae21bd69a1e93f22872c53abddffa5a49e659f89fc57f7d7bc7483a7.png" src="_images/25e7ad6dae21bd69a1e93f22872c53abddffa5a49e659f89fc57f7d7bc7483a7.png" />
</div>
</div>
<p>The top panel shows the time path of consumption <span class="math notranslate nohighlight">\(c_t\)</span> and income <span class="math notranslate nohighlight">\(y_t\)</span> in the simulation.</p>
<p>As anticipated by the discussion on consumption smoothing, the time path of
consumption is much smoother than that for income.</p>
<p>(But note that  consumption becomes more irregular towards the end of life,
when the zero final asset requirement impinges more on consumption choices.)</p>
<p>The second panel in the figure shows that the time path of assets <span class="math notranslate nohighlight">\(a_t\)</span> is
closely correlated with cumulative unanticipated income, where the latter is defined as</p>
<div class="math notranslate nohighlight">
\[
z_t := \sum_{j=0}^t \sigma w_t
\]</div>
<p>A key message is that unanticipated windfall gains are saved rather
than consumed, while unanticipated negative shocks are met by reducing assets.</p>
<p>(Again, this relationship breaks down towards the end of life due to the zero final asset requirement.)</p>
<p>These results are relatively robust to changes in parameters.</p>
<p>For example, let’s increase <span class="math notranslate nohighlight">\(\beta\)</span> from <span class="math notranslate nohighlight">\(1 / (1 + r) \approx 0.952\)</span> to <span class="math notranslate nohighlight">\(0.96\)</span> while keeping other parameters fixed.</p>
<p>This consumer is slightly more patient than the last one, and hence puts
relatively more weight on later consumption values.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute solutions and simulate</span>
<span class="n">lq</span> <span class="o">=</span> <span class="n">LQ</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.96</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">Rf</span><span class="o">=</span><span class="n">Rf</span><span class="p">)</span>
<span class="n">x0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">xp</span><span class="p">,</span> <span class="n">up</span><span class="p">,</span> <span class="n">wp</span> <span class="o">=</span> <span class="n">lq</span><span class="o">.</span><span class="n">compute_sequence</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>

<span class="c1"># Convert back to assets, consumption and income</span>
<span class="n">assets</span> <span class="o">=</span> <span class="n">xp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>           <span class="c1"># a_t</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">up</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">+</span> <span class="n">c_bar</span>    <span class="c1"># c_t</span>
<span class="n">income</span> <span class="o">=</span> <span class="n">σ</span> <span class="o">*</span> <span class="n">wp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">μ</span>  <span class="c1"># y_t</span>

<span class="c1"># Plot results</span>
<span class="n">n_rows</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">bbox</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">.102</span><span class="p">)</span>
<span class="n">legend_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bbox_to_anchor&#39;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">,</span> <span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;expand&#39;</span><span class="p">}</span>
<span class="n">p_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lw&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">}</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span> <span class="n">income</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;non-financial income&quot;</span><span class="p">,</span>
             <span class="o">**</span><span class="n">p_args</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">)),</span> <span class="n">c</span><span class="p">,</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;consumption&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">p_args</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">income</span> <span class="o">-</span> <span class="n">μ</span><span class="p">),</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span>
             <span class="n">label</span><span class="o">=</span><span class="s2">&quot;cumulative unanticipated income&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">p_args</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span> <span class="n">assets</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;assets&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">p_args</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="s1">&#39;k-&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="o">**</span><span class="n">legend_args</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/6132a7e8dd9f25bc05cf15f7ac27618554c08e4b827410eae7c022448037827a.png" src="_images/6132a7e8dd9f25bc05cf15f7ac27618554c08e4b827410eae7c022448037827a.png" />
</div>
</div>
<p>We now have a slowly rising consumption stream and a hump-shaped build-up
of assets in the middle periods to fund rising consumption.</p>
<p>However, the essential features are the same: consumption is smooth relative to income, and assets are strongly positively correlated with cumulative unanticipated income.</p>
</section>
</section>
<section id="extensions-and-comments">
<h2><a class="toc-backref" href="#id15"><span class="section-number">62.5. </span>Extensions and Comments</a><a class="headerlink" href="#extensions-and-comments" title="Permalink to this heading">#</a></h2>
<p>Let’s now consider a number of standard extensions to the LQ problem treated above.</p>
<section id="time-varying-parameters">
<h3><span class="section-number">62.5.1. </span>Time-Varying Parameters<a class="headerlink" href="#time-varying-parameters" title="Permalink to this heading">#</a></h3>
<p>In some settings, it can be desirable to allow <span class="math notranslate nohighlight">\(A, B, C, R\)</span> and <span class="math notranslate nohighlight">\(Q\)</span> to depend on <span class="math notranslate nohighlight">\(t\)</span>.</p>
<p>For the sake of simplicity, we’ve chosen not to treat this extension in our implementation given below.</p>
<p>However, the loss of generality is not as large as you might first imagine.</p>
<p>In fact, we can tackle many models with time-varying parameters by suitable choice of state variables.</p>
<p>One illustration is given <a class="reference internal" href="#lq-nsi"><span class="std std-ref">below</span></a>.</p>
<p>For further examples and a more systematic treatment, see <span id="id9">[<a class="reference internal" href="zreferences.html#id166" title="L P Hansen and T J Sargent. Recursive Models of Dynamic Linear Economies. The Gorman Lectures in Economics. Princeton University Press, 2013.">HS13</a>]</span>, section 2.4.</p>
</section>
<section id="adding-a-cross-product-term">
<span id="lq-cpt"></span><h3><span class="section-number">62.5.2. </span>Adding a Cross-Product Term<a class="headerlink" href="#adding-a-cross-product-term" title="Permalink to this heading">#</a></h3>
<p>In some LQ problems, preferences include a cross-product term <span class="math notranslate nohighlight">\(u_t' N x_t\)</span>, so that the objective function becomes</p>
<div class="math notranslate nohighlight" id="equation-lq-object-cp">
<span class="eqno">(62.17)<a class="headerlink" href="#equation-lq-object-cp" title="Permalink to this equation">#</a></span>\[\mathbb E \,
\left\{
    \sum_{t=0}^{T-1} \beta^t (x_t' R x_t + u_t' Q u_t + 2 u_t' N x_t) + \beta^T x_T' R_f x_T
\right\}\]</div>
<p>Our results extend to this case in a straightforward way.</p>
<p>The sequence <span class="math notranslate nohighlight">\(\{P_t\}\)</span> from <a class="reference internal" href="#equation-lq-pr">(62.12)</a> becomes</p>
<div class="math notranslate nohighlight" id="equation-lq-pr-cp">
<span class="eqno">(62.18)<a class="headerlink" href="#equation-lq-pr-cp" title="Permalink to this equation">#</a></span>\[P_{t-1} = R - (\beta B' P_t A + N)'
(Q + \beta B' P_t B)^{-1} (\beta B' P_t A + N) +
\beta A' P_t A
\quad \text{with } \quad
P_T = R_f\]</div>
<p>The policies in <a class="reference internal" href="#equation-lq-oc">(62.14)</a> are modified to</p>
<div class="math notranslate nohighlight" id="equation-lq-oc-cp">
<span class="eqno">(62.19)<a class="headerlink" href="#equation-lq-oc-cp" title="Permalink to this equation">#</a></span>\[u_t  = - F_t x_t
\quad \text{where} \quad
F_t := (Q + \beta B' P_{t+1} B)^{-1} (\beta B' P_{t+1} A + N)\]</div>
<p>The sequence <span class="math notranslate nohighlight">\(\{d_t\}\)</span> is unchanged from <a class="reference internal" href="#equation-lq-dd">(62.13)</a>.</p>
<p>We leave interested readers to confirm these results (the calculations are long but not overly difficult).</p>
</section>
<section id="infinite-horizon">
<span id="lq-ih"></span><h3><span class="section-number">62.5.3. </span>Infinite Horizon<a class="headerlink" href="#infinite-horizon" title="Permalink to this heading">#</a></h3>
<p id="index-2">Finally, we consider the infinite horizon case, with <a class="reference internal" href="#lq-cpt"><span class="std std-ref">cross-product term</span></a>, unchanged dynamics and
objective function given by</p>
<div class="math notranslate nohighlight" id="equation-lq-object-ih">
<span class="eqno">(62.20)<a class="headerlink" href="#equation-lq-object-ih" title="Permalink to this equation">#</a></span>\[\mathbb E \,
\left\{
    \sum_{t=0}^{\infty} \beta^t (x_t' R x_t + u_t' Q u_t + 2 u_t' N x_t)
\right\}\]</div>
<p>In the infinite horizon case, optimal policies can depend on time
only if time itself is a component of the  state vector <span class="math notranslate nohighlight">\(x_t\)</span>.</p>
<p>In other words, there exists a fixed matrix <span class="math notranslate nohighlight">\(F\)</span> such that <span class="math notranslate nohighlight">\(u_t = -
F x_t\)</span> for all <span class="math notranslate nohighlight">\(t\)</span>.</p>
<p>That decision rules are constant over time is intuitive — after all, the decision-maker faces the
same infinite horizon at every stage, with only the current state changing.</p>
<p>Not surprisingly, <span class="math notranslate nohighlight">\(P\)</span> and <span class="math notranslate nohighlight">\(d\)</span> are also constant.</p>
<p>The stationary matrix <span class="math notranslate nohighlight">\(P\)</span> is the solution to the
<a class="reference external" href="https://en.wikipedia.org/wiki/Algebraic_Riccati_equation">discrete-time algebraic Riccati equation</a>.</p>
<div class="math notranslate nohighlight" id="equation-lq-pr-ih">
<span id="riccati-equation"></span><span class="eqno">(62.21)<a class="headerlink" href="#equation-lq-pr-ih" title="Permalink to this equation">#</a></span>\[P = R - (\beta B' P A + N)'
(Q + \beta B' P B)^{-1} (\beta B' P A + N) +
\beta A' P A\]</div>
<p>Equation <a class="reference internal" href="#equation-lq-pr-ih">(62.21)</a> is also called the <em>LQ Bellman equation</em>, and the map
that sends a given <span class="math notranslate nohighlight">\(P\)</span> into the right-hand side of <a class="reference internal" href="#equation-lq-pr-ih">(62.21)</a> is
called the <em>LQ Bellman operator</em>.</p>
<p>The stationary optimal policy for this model is</p>
<div class="math notranslate nohighlight" id="equation-lq-oc-ih">
<span class="eqno">(62.22)<a class="headerlink" href="#equation-lq-oc-ih" title="Permalink to this equation">#</a></span>\[u  = - F x
\quad \text{where} \quad
F = (Q + \beta B' P B)^{-1} (\beta B' P A + N)\]</div>
<p>The sequence <span class="math notranslate nohighlight">\(\{d_t\}\)</span> from <a class="reference internal" href="#equation-lq-dd">(62.13)</a> is replaced by the constant value</p>
<div class="math notranslate nohighlight" id="equation-lq-dd-ih">
<span class="eqno">(62.23)<a class="headerlink" href="#equation-lq-dd-ih" title="Permalink to this equation">#</a></span>\[d
:= \mathop{\mathrm{trace}}(C' P C) \frac{\beta}{1 - \beta}\]</div>
<p>The state evolves according to the time-homogeneous process <span class="math notranslate nohighlight">\(x_{t+1} = (A - BF) x_t + C w_{t+1}\)</span>.</p>
<p>An example infinite horizon problem is treated <a class="reference internal" href="#lqc-mwac"><span class="std std-ref">below</span></a>.</p>
</section>
<section id="certainty-equivalence">
<span id="lq-cert-eq"></span><h3><span class="section-number">62.5.4. </span>Certainty Equivalence<a class="headerlink" href="#certainty-equivalence" title="Permalink to this heading">#</a></h3>
<p>Linear quadratic control problems of the class discussed above have the property of <em>certainty equivalence</em>.</p>
<p>By this, we mean that the optimal policy <span class="math notranslate nohighlight">\(F\)</span> is not affected by the parameters in <span class="math notranslate nohighlight">\(C\)</span>, which specify the shock process.</p>
<p>This can be confirmed by inspecting <a class="reference internal" href="#equation-lq-oc-ih">(62.22)</a> or <a class="reference internal" href="#equation-lq-oc-cp">(62.19)</a>.</p>
<p>It follows that we can ignore uncertainty when solving for optimal behavior, and plug it back in when examining optimal state dynamics.</p>
</section>
</section>
<section id="further-applications">
<h2><a class="toc-backref" href="#id16"><span class="section-number">62.6. </span>Further Applications</a><a class="headerlink" href="#further-applications" title="Permalink to this heading">#</a></h2>
<section id="application-1-age-dependent-income-process">
<span id="lq-nsi"></span><h3><span class="section-number">62.6.1. </span>Application 1: Age-Dependent Income Process<a class="headerlink" href="#application-1-age-dependent-income-process" title="Permalink to this heading">#</a></h3>
<p><a class="reference internal" href="#lq-mfpa"><span class="std std-ref">Previously</span></a> we studied a permanent income model that generated consumption smoothing.</p>
<p>One unrealistic feature of that model is the assumption that the mean of the random income process does not depend on the consumer’s age.</p>
<p>A more realistic income profile is one that rises in early working life, peaks towards the middle and maybe declines toward the end of working life and falls more during retirement.</p>
<p>In this section, we will model this rise and fall as a symmetric inverted “U” using a polynomial in age.</p>
<p>As before, the consumer seeks to minimize</p>
<div class="math notranslate nohighlight" id="equation-lq-pip">
<span class="eqno">(62.24)<a class="headerlink" href="#equation-lq-pip" title="Permalink to this equation">#</a></span>\[\mathbb E \,
\left\{
    \sum_{t=0}^{T-1} \beta^t (c_t - \bar c)^2 + \beta^T q a_T^2
\right\}\]</div>
<p>subject to <span class="math notranslate nohighlight">\(a_{t+1} = (1 + r) a_t - c_t + y_t, \ t \geq 0\)</span>.</p>
<p>For income we now take <span class="math notranslate nohighlight">\(y_t = p(t) + \sigma w_{t+1}\)</span> where <span class="math notranslate nohighlight">\(p(t) := m_0 + m_1 t + m_2 t^2\)</span>.</p>
<p>(In <a class="reference internal" href="#lq-nsi2"><span class="std std-ref">the next section</span></a> we employ some tricks to implement a more sophisticated model.)</p>
<p>The coefficients <span class="math notranslate nohighlight">\(m_0, m_1, m_2\)</span> are chosen such that <span class="math notranslate nohighlight">\(p(0)=0, p(T/2) = \mu,\)</span> and <span class="math notranslate nohighlight">\(p(T)=0\)</span>.</p>
<p>You can confirm that the specification <span class="math notranslate nohighlight">\(m_0 = 0, m_1 = T \mu / (T/2)^2, m_2 = - \mu / (T/2)^2\)</span> satisfies these constraints.</p>
<p>To put this into an LQ setting, consider the budget constraint, which becomes</p>
<div class="math notranslate nohighlight" id="equation-lq-hib">
<span class="eqno">(62.25)<a class="headerlink" href="#equation-lq-hib" title="Permalink to this equation">#</a></span>\[a_{t+1} = (1 + r) a_t - u_t - \bar c + m_1 t + m_2 t^2 + \sigma w_{t+1}\]</div>
<p>The fact that <span class="math notranslate nohighlight">\(a_{t+1}\)</span> is a linear function of
<span class="math notranslate nohighlight">\((a_t, 1, t, t^2)\)</span> suggests taking these four variables as the state
vector <span class="math notranslate nohighlight">\(x_t\)</span>.</p>
<p>Once a good choice of state and control (recall <span class="math notranslate nohighlight">\(u_t = c_t - \bar c\)</span>)
has been made, the remaining specifications fall into place relatively easily.</p>
<p>Thus, for the dynamics we set</p>
<div class="math notranslate nohighlight" id="equation-lq-lowmc3">
<span class="eqno">(62.26)<a class="headerlink" href="#equation-lq-lowmc3" title="Permalink to this equation">#</a></span>\[\begin{split}x_t :=
\left(
\begin{array}{c}
a_t \\
1 \\
t \\
t^2
\end{array}
\right),
\quad
A :=
\left(
\begin{array}{cccc}
1 + r &amp; -\bar c &amp; m_1 &amp; m_2 \\
0     &amp; 1       &amp; 0   &amp; 0   \\
0     &amp; 1       &amp; 1   &amp; 0   \\
0     &amp; 1       &amp; 2   &amp; 1
\end{array}
\right),
\quad
B :=
\left(
\begin{array}{c}
-1 \\
0 \\
0 \\
0
\end{array}
\right),
\quad
C :=
\left(
\begin{array}{c}
\sigma \\
0 \\
0 \\
0
\end{array}
\right)\end{split}\]</div>
<p>If you expand the expression <span class="math notranslate nohighlight">\(x_{t+1} = A x_t + B u_t + C w_{t+1}\)</span> using
this specification, you will find that assets follow <a class="reference internal" href="#equation-lq-hib">(62.25)</a> as desired
and that the other state variables also update appropriately.</p>
<p>To implement preference specification <a class="reference internal" href="#equation-lq-pip">(62.24)</a> we take</p>
<div class="math notranslate nohighlight" id="equation-lq-4sp">
<span class="eqno">(62.27)<a class="headerlink" href="#equation-lq-4sp" title="Permalink to this equation">#</a></span>\[\begin{split}Q := 1,
\quad
R :=
\left(
\begin{array}{cccc}
0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0
\end{array}
\right)
\quad \text{and} \quad
R_f :=
\left(
\begin{array}{cccc}
q &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0
\end{array}
\right)\end{split}\]</div>
<p>The next figure shows a simulation of consumption and assets computed using
the <code class="docutils literal notranslate"><span class="pre">compute_sequence</span></code> method of <code class="docutils literal notranslate"><span class="pre">lqcontrol.py</span></code> with initial assets set to zero.</p>
<figure class="align-default" id="solution-lqc-ex1-fig">
<img alt="_images/solution_lqc_ex1.png" src="_images/solution_lqc_ex1.png" />
</figure>
<p>Once again, smooth consumption is a dominant feature of the sample  paths.</p>
<p>The asset path exhibits dynamics consistent with standard life cycle theory.</p>
<p><a class="reference internal" href="#lqc_ex1"><span class="std std-numref">Exercise 62.1</span></a> gives the full set of parameters used here and asks you to replicate the figure.</p>
</section>
<section id="application-2-a-permanent-income-model-with-retirement">
<span id="lq-nsi2"></span><h3><span class="section-number">62.6.2. </span>Application 2: A Permanent Income Model with Retirement<a class="headerlink" href="#application-2-a-permanent-income-model-with-retirement" title="Permalink to this heading">#</a></h3>
<p>In the <a class="reference internal" href="#lq-nsi"><span class="std std-ref">previous application</span></a>, we generated income dynamics with an inverted U shape using polynomials and placed them in an LQ framework.</p>
<p>It is arguably the case that this income process still contains unrealistic features.</p>
<p>A more common earning profile is where</p>
<ol class="arabic simple">
<li><p>income grows over working life, fluctuating around an increasing trend, with growth flattening off in later years</p></li>
<li><p>retirement follows, with lower but relatively stable (non-financial) income</p></li>
</ol>
<p>Letting <span class="math notranslate nohighlight">\(K\)</span> be the retirement date, we can express these income dynamics
by</p>
<div class="math notranslate nohighlight" id="equation-lq-cases">
<span class="eqno">(62.28)<a class="headerlink" href="#equation-lq-cases" title="Permalink to this equation">#</a></span>\[\begin{split}y_t =
\begin{cases}
p(t) + \sigma w_{t+1} &amp; \quad \text{if } t \leq K  \\
s                     &amp; \quad \text{otherwise }
\end{cases}\end{split}\]</div>
<p>Here</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(p(t) := m_1 t + m_2 t^2\)</span> with the coefficients <span class="math notranslate nohighlight">\(m_1, m_2\)</span> chosen such that <span class="math notranslate nohighlight">\(p(K) = \mu\)</span> and <span class="math notranslate nohighlight">\(p(0) = p(2K)=0\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(s\)</span> is retirement income</p></li>
</ul>
<p>We suppose that preferences are unchanged and given by <a class="reference internal" href="#equation-lq-pio">(62.16)</a>.</p>
<p>The budget constraint is also unchanged and given by <span class="math notranslate nohighlight">\(a_{t+1} = (1 + r) a_t - c_t + y_t\)</span>.</p>
<p>Our aim is to solve this problem and simulate paths using the LQ techniques described in this lecture.</p>
<p>In fact, this is a nontrivial problem, as the kink in the dynamics <a class="reference internal" href="#equation-lq-cases">(62.28)</a> at <span class="math notranslate nohighlight">\(K\)</span> makes it very difficult to express the law of motion as a fixed-coefficient linear system.</p>
<p>However, we can still use our LQ methods here by suitably linking two-component LQ problems.</p>
<p>These two LQ problems describe the consumer’s behavior during her working life (<code class="docutils literal notranslate"><span class="pre">lq_working</span></code>) and retirement (<code class="docutils literal notranslate"><span class="pre">lq_retired</span></code>).</p>
<p>(This is possible because, in the two separate periods of life, the respective income processes
[polynomial trend and constant] each fit the LQ framework.)</p>
<p>The basic idea is that although the whole problem is not a single time-invariant LQ problem, it is
still a dynamic programming problem, and hence we can use appropriate Bellman equations at
every stage.</p>
<p>Based on this logic, we can</p>
<ol class="arabic simple">
<li><p>solve <code class="docutils literal notranslate"><span class="pre">lq_retired</span></code> by the usual backward induction procedure, iterating back to the start of retirement.</p></li>
<li><p>take the start-of-retirement value function generated by this process, and use it as  the terminal condition <span class="math notranslate nohighlight">\(R_f\)</span> to feed into the <code class="docutils literal notranslate"><span class="pre">lq_working</span></code> specification.</p></li>
<li><p>solve <code class="docutils literal notranslate"><span class="pre">lq_working</span></code> by backward induction from this choice of <span class="math notranslate nohighlight">\(R_f\)</span>, iterating back to the start of working life.</p></li>
</ol>
<p>This process gives the entire life-time sequence of value functions and optimal policies.</p>
<p>The next figure shows one simulation based on this procedure.</p>
<figure class="align-default" id="solution-lqc-ex2-fig">
<img alt="_images/solution_lqc_ex2.png" src="_images/solution_lqc_ex2.png" />
</figure>
<p>The full set of parameters used in the simulation is discussed in <a class="reference internal" href="#lqc_ex2"><span class="std std-numref">Exercise 62.2</span></a>, where you are asked to replicate the figure.</p>
<p>Once again, the dominant feature observable in the simulation is consumption
smoothing.</p>
<p>The asset path fits well with standard life cycle theory, with dissaving early
in life followed by later saving.</p>
<p>Assets peak at retirement and subsequently decline.</p>
</section>
<section id="application-3-monopoly-with-adjustment-costs">
<span id="lqc-mwac"></span><h3><span class="section-number">62.6.3. </span>Application 3: Monopoly with Adjustment Costs<a class="headerlink" href="#application-3-monopoly-with-adjustment-costs" title="Permalink to this heading">#</a></h3>
<p>Consider a monopolist facing stochastic inverse demand function</p>
<div class="math notranslate nohighlight">
\[
p_t = a_0 - a_1 q_t + d_t
\]</div>
<p>Here <span class="math notranslate nohighlight">\(q_t\)</span> is output, and the demand shock <span class="math notranslate nohighlight">\(d_t\)</span> follows</p>
<div class="math notranslate nohighlight">
\[
d_{t+1} = \rho d_t + \sigma w_{t+1}
\]</div>
<p>where <span class="math notranslate nohighlight">\(\{w_t\}\)</span> is IID and standard normal.</p>
<p>The monopolist maximizes the expected discounted sum of present and future profits</p>
<div class="math notranslate nohighlight" id="equation-lq-object-mp">
<span class="eqno">(62.29)<a class="headerlink" href="#equation-lq-object-mp" title="Permalink to this equation">#</a></span>\[\mathbb E \,
\left\{
    \sum_{t=0}^{\infty} \beta^t
    \pi_t
\right\}
\quad \text{where} \quad
\pi_t := p_t q_t - c q_t - \gamma (q_{t+1} - q_t)^2\]</div>
<p>Here</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\gamma (q_{t+1} - q_t)^2\)</span> represents adjustment costs</p></li>
<li><p><span class="math notranslate nohighlight">\(c\)</span> is average cost of production</p></li>
</ul>
<p>This can be formulated as an LQ problem and then solved and simulated,
but first let’s study the problem and try to get some intuition.</p>
<p>One way to start thinking about the problem is to consider what would happen
if <span class="math notranslate nohighlight">\(\gamma = 0\)</span>.</p>
<p>Without adjustment costs there is no intertemporal trade-off, so the
monopolist will choose output to maximize current profit in each period.</p>
<p>It’s not difficult to show that profit-maximizing output is</p>
<div class="math notranslate nohighlight">
\[
\bar q_t := \frac{a_0 - c + d_t}{2 a_1}
\]</div>
<p>In light of this discussion, what we might expect for general <span class="math notranslate nohighlight">\(\gamma\)</span> is that</p>
<ul class="simple">
<li><p>if <span class="math notranslate nohighlight">\(\gamma\)</span> is close to zero, then <span class="math notranslate nohighlight">\(q_t\)</span> will track the time path of <span class="math notranslate nohighlight">\(\bar q_t\)</span> relatively closely.</p></li>
<li><p>if <span class="math notranslate nohighlight">\(\gamma\)</span> is larger, then <span class="math notranslate nohighlight">\(q_t\)</span> will be smoother than <span class="math notranslate nohighlight">\(\bar q_t\)</span>, as the monopolist seeks to avoid adjustment costs.</p></li>
</ul>
<p>This intuition turns out to be correct.</p>
<p>The following figures show simulations produced by solving the corresponding LQ problem.</p>
<p>The only difference in parameters across the figures is the size of <span class="math notranslate nohighlight">\(\gamma\)</span></p>
<figure class="align-default">
<img alt="_images/solution_lqc_ex3_g1.png" src="_images/solution_lqc_ex3_g1.png" />
</figure>
<figure class="align-default">
<img alt="_images/solution_lqc_ex3_g10.png" src="_images/solution_lqc_ex3_g10.png" />
</figure>
<figure class="align-default">
<img alt="_images/solution_lqc_ex3_g50.png" src="_images/solution_lqc_ex3_g50.png" />
</figure>
<p>To produce these figures we converted the monopolist problem into an LQ problem.</p>
<p>The key to this conversion is to choose the right state — which can be a bit of an art.</p>
<p>Here we take <span class="math notranslate nohighlight">\(x_t = (\bar q_t \;\, q_t \;\, 1)'\)</span>, while the control is chosen as <span class="math notranslate nohighlight">\(u_t = q_{t+1} - q_t\)</span>.</p>
<p>We also manipulated the profit function slightly.</p>
<p>In <a class="reference internal" href="#equation-lq-object-mp">(62.29)</a>, current profits are <span class="math notranslate nohighlight">\(\pi_t := p_t q_t - c q_t - \gamma (q_{t+1} - q_t)^2\)</span>.</p>
<p>Let’s now replace <span class="math notranslate nohighlight">\(\pi_t\)</span> in <a class="reference internal" href="#equation-lq-object-mp">(62.29)</a> with <span class="math notranslate nohighlight">\(\hat \pi_t := \pi_t - a_1 \bar q_t^2\)</span>.</p>
<p>This makes no difference to the solution, since <span class="math notranslate nohighlight">\(a_1 \bar q_t^2\)</span> does not depend on the controls.</p>
<p>(In fact, we are just adding a constant term to <a class="reference internal" href="#equation-lq-object-mp">(62.29)</a>, and optimizers are not affected by constant terms.)</p>
<p>The reason for making this substitution is that, as you will be able to
verify, <span class="math notranslate nohighlight">\(\hat \pi_t\)</span> reduces to the simple quadratic</p>
<div class="math notranslate nohighlight">
\[
\hat \pi_t = -a_1 (q_t - \bar q_t)^2 - \gamma u_t^2
\]</div>
<p>After negation to convert to a minimization problem, the objective becomes</p>
<div class="math notranslate nohighlight" id="equation-lq-object-mp2">
<span class="eqno">(62.30)<a class="headerlink" href="#equation-lq-object-mp2" title="Permalink to this equation">#</a></span>\[\min
\mathbb E \,
    \sum_{t=0}^{\infty} \beta^t
\left\{
    a_1 ( q_t - \bar q_t)^2 + \gamma u_t^2
\right\}\]</div>
<p>It’s now relatively straightforward to find <span class="math notranslate nohighlight">\(R\)</span> and <span class="math notranslate nohighlight">\(Q\)</span> such that
<a class="reference internal" href="#equation-lq-object-mp2">(62.30)</a> can be written as <a class="reference internal" href="#equation-lq-object-ih">(62.20)</a>.</p>
<p>Furthermore, the matrices <span class="math notranslate nohighlight">\(A, B\)</span> and <span class="math notranslate nohighlight">\(C\)</span> from <a class="reference internal" href="#equation-lq-lom">(62.1)</a>
can be found by writing down the dynamics of each element of the state.</p>
<p><a class="reference internal" href="#lqc_ex3"><span class="std std-numref">Exercise 62.3</span></a> asks you to complete this process, and reproduce the preceding figures.</p>
</section>
</section>
<section id="exercises">
<h2><a class="toc-backref" href="#id17"><span class="section-number">62.7. </span>Exercises</a><a class="headerlink" href="#exercises" title="Permalink to this heading">#</a></h2>
<div class="exercise admonition" id="lqc_ex1">

<p class="admonition-title"><span class="caption-number">Exercise 62.1 </span></p>
<section id="exercise-content">
<p>Replicate the figure with polynomial income <a class="reference internal" href="#solution-lqc-ex1-fig"><span class="std std-ref">shown above</span></a>.</p>
<p>The parameters are <span class="math notranslate nohighlight">\(r = 0.05, \beta = 1 / (1 + r), \bar c = 1.5,  \mu = 2, \sigma = 0.15, T = 50\)</span> and <span class="math notranslate nohighlight">\(q = 10^4\)</span>.</p>
</section>
</div>
<div class="solution dropdown admonition" id="lqcontrol-solution-1">

<p class="admonition-title">Solution to<a class="reference internal" href="#lqc_ex1"> Exercise 62.1</a></p>
<section id="solution-content">
<p>Here’s one solution.</p>
<p>We use some fancy plot commands to get a certain style — feel free to
use simpler ones.</p>
<p>The model is an LQ permanent income / life-cycle model with hump-shaped
income</p>
<div class="math notranslate nohighlight">
\[
y_t = m_1 t + m_2 t^2 + \sigma w_{t+1}
\]</div>
<p>where <span class="math notranslate nohighlight">\(\{w_t\}\)</span> is IID <span class="math notranslate nohighlight">\(N(0, 1)\)</span> and the coefficients
<span class="math notranslate nohighlight">\(m_1\)</span> and <span class="math notranslate nohighlight">\(m_2\)</span> are chosen so that
<span class="math notranslate nohighlight">\(p(t) = m_1 t + m_2 t^2\)</span> has an inverted U shape with</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(p(0) = 0, p(T/2) = \mu\)</span>, and</p></li>
<li><p><span class="math notranslate nohighlight">\(p(T) = 0\)</span></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Model parameters</span>
<span class="n">r</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">β</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">c_bar</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">σ</span> <span class="o">=</span> <span class="mf">0.15</span>
<span class="n">μ</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">q</span> <span class="o">=</span> <span class="mf">1e4</span>
<span class="n">m1</span> <span class="o">=</span> <span class="n">T</span> <span class="o">*</span> <span class="p">(</span><span class="n">μ</span><span class="o">/</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">m2</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">μ</span><span class="o">/</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Formulate as an LQ problem</span>
<span class="n">Q</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">Rf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">Rf</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span>
<span class="n">A</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">r</span><span class="p">,</span> <span class="o">-</span><span class="n">c_bar</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">,</span>          <span class="mi">1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">,</span>          <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">,</span>          <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">1</span><span class="p">]]</span>
<span class="n">B</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
     <span class="p">[</span> <span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span> <span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span> <span class="mi">0</span><span class="p">]]</span>
<span class="n">C</span> <span class="o">=</span> <span class="p">[[</span><span class="n">σ</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

<span class="c1"># Compute solutions and simulate</span>
<span class="n">lq</span> <span class="o">=</span> <span class="n">LQ</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="n">β</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">Rf</span><span class="o">=</span><span class="n">Rf</span><span class="p">)</span>
<span class="n">x0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">xp</span><span class="p">,</span> <span class="n">up</span><span class="p">,</span> <span class="n">wp</span> <span class="o">=</span> <span class="n">lq</span><span class="o">.</span><span class="n">compute_sequence</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>

<span class="c1"># Convert results back to assets, consumption and income</span>
<span class="n">ap</span> <span class="o">=</span> <span class="n">xp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>               <span class="c1"># Assets</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">up</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">+</span> <span class="n">c_bar</span>    <span class="c1"># Consumption</span>
<span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">income</span> <span class="o">=</span> <span class="n">σ</span> <span class="o">*</span> <span class="n">wp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">m1</span> <span class="o">*</span> <span class="n">time</span> <span class="o">+</span> <span class="n">m2</span> <span class="o">*</span> <span class="n">time</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># Income</span>


<span class="c1"># Plot results</span>
<span class="n">n_rows</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">bbox</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">.102</span><span class="p">)</span>
<span class="n">legend_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bbox_to_anchor&#39;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">,</span> <span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;expand&#39;</span><span class="p">}</span>
<span class="n">p_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lw&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">}</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">income</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;non-financial income&quot;</span><span class="p">,</span>
            <span class="o">**</span><span class="n">p_args</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="n">c</span><span class="p">,</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;consumption&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">p_args</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">ap</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;assets&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">p_args</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;k-&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="o">**</span><span class="n">legend_args</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ee2b37f73e999cf8771255731398e3bbd522fc6ee3f7d7b878187ac440ff812a.png" src="_images/ee2b37f73e999cf8771255731398e3bbd522fc6ee3f7d7b878187ac440ff812a.png" />
</div>
</div>
</section>
</div>
<div class="exercise admonition" id="lqc_ex2">

<p class="admonition-title"><span class="caption-number">Exercise 62.2 </span></p>
<section id="exercise-content">
<p>Replicate the figure on work and retirement <a class="reference internal" href="#solution-lqc-ex2-fig"><span class="std std-ref">shown above</span></a>.</p>
<p>The parameters are <span class="math notranslate nohighlight">\(r = 0.05, \beta = 1 / (1 + r), \bar c = 4,  \mu = 4, \sigma = 0.35, K = 40, T = 60, s = 1\)</span> and <span class="math notranslate nohighlight">\(q = 10^4\)</span>.</p>
<p>To understand the overall procedure, carefully read the section containing that figure.</p>
<div class="dropdown admonition hint">
<p class="admonition-title">Hint</p>
<p>First, in order to make our approach work, we must ensure that both LQ problems have the same state variables and control.</p>
<p>As with previous applications, the control can be set to <span class="math notranslate nohighlight">\(u_t = c_t - \bar c\)</span>.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">lq_working</span></code>, <span class="math notranslate nohighlight">\(x_t, A, B, C\)</span> can be chosen as in <a class="reference internal" href="#equation-lq-lowmc3">(62.26)</a>.</p>
<ul class="simple">
<li><p>Recall that <span class="math notranslate nohighlight">\(m_1, m_2\)</span> are chosen so that <span class="math notranslate nohighlight">\(p(K) = \mu\)</span> and <span class="math notranslate nohighlight">\(p(2K)=0\)</span>.</p></li>
</ul>
<p>For <code class="docutils literal notranslate"><span class="pre">lq_retired</span></code>, use the same definition of <span class="math notranslate nohighlight">\(x_t\)</span> and <span class="math notranslate nohighlight">\(u_t\)</span>, but modify <span class="math notranslate nohighlight">\(A, B, C\)</span> to correspond to constant income <span class="math notranslate nohighlight">\(y_t = s\)</span>.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">lq_retired</span></code>, set preferences as in <a class="reference internal" href="#equation-lq-4sp">(62.27)</a>.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">lq_working</span></code>, preferences are the same, except that <span class="math notranslate nohighlight">\(R_f\)</span> should
be replaced by the final value function that emerges from iterating <code class="docutils literal notranslate"><span class="pre">lq_retired</span></code>
back to the start of retirement.</p>
<p>With some careful footwork, the simulation can be generated by patching
together the simulations from these two separate models.</p>
</div>
</section>
</div>
<div class="solution dropdown admonition" id="lqcontrol-solution-3">

<p class="admonition-title">Solution to<a class="reference internal" href="#lqc_ex2"> Exercise 62.2</a></p>
<section id="solution-content">
<p>This is a permanent income / life-cycle model with polynomial growth in
income over working life followed by a fixed retirement income.</p>
<p>The model is solved by combining two LQ programming problems as described in
the lecture.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Model parameters</span>
<span class="n">r</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">β</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">60</span>
<span class="n">K</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">c_bar</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">σ</span> <span class="o">=</span> <span class="mf">0.35</span>
<span class="n">μ</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">q</span> <span class="o">=</span> <span class="mf">1e4</span>
<span class="n">s</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">m1</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">μ</span><span class="o">/</span><span class="n">K</span>
<span class="n">m2</span> <span class="o">=</span> <span class="o">-</span><span class="n">μ</span><span class="o">/</span><span class="n">K</span><span class="o">**</span><span class="mi">2</span>

<span class="c1"># Formulate LQ problem 1 (retirement)</span>
<span class="n">Q</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">Rf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">Rf</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span>
<span class="n">A</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">r</span><span class="p">,</span> <span class="n">s</span> <span class="o">-</span> <span class="n">c_bar</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
<span class="n">B</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
     <span class="p">[</span> <span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span> <span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span> <span class="mi">0</span><span class="p">]]</span>
<span class="n">C</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

<span class="c1"># Initialize LQ instance for retired agent</span>
<span class="n">lq_retired</span> <span class="o">=</span> <span class="n">LQ</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="n">β</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="o">-</span><span class="n">K</span><span class="p">,</span> <span class="n">Rf</span><span class="o">=</span><span class="n">Rf</span><span class="p">)</span>
<span class="c1"># Iterate back to start of retirement, record final value function</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="o">-</span><span class="n">K</span><span class="p">):</span>
    <span class="n">lq_retired</span><span class="o">.</span><span class="n">update_values</span><span class="p">()</span>
<span class="n">Rf2</span> <span class="o">=</span> <span class="n">lq_retired</span><span class="o">.</span><span class="n">P</span>

<span class="c1"># Formulate LQ problem 2 (working life)</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">A</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">r</span><span class="p">,</span> <span class="o">-</span><span class="n">c_bar</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">,</span>          <span class="mi">1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">,</span>          <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">,</span>          <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">1</span><span class="p">]]</span>
<span class="n">B</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
     <span class="p">[</span> <span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span> <span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span> <span class="mi">0</span><span class="p">]]</span>
<span class="n">C</span> <span class="o">=</span> <span class="p">[[</span><span class="n">σ</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

<span class="c1"># Set up working life LQ instance with terminal Rf from lq_retired</span>
<span class="n">lq_working</span> <span class="o">=</span> <span class="n">LQ</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="n">β</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">Rf</span><span class="o">=</span><span class="n">Rf2</span><span class="p">)</span>

<span class="c1"># Simulate working state / control paths</span>
<span class="n">x0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">xp_w</span><span class="p">,</span> <span class="n">up_w</span><span class="p">,</span> <span class="n">wp_w</span> <span class="o">=</span> <span class="n">lq_working</span><span class="o">.</span><span class="n">compute_sequence</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
<span class="c1"># Simulate retirement paths (note the initial condition)</span>
<span class="n">xp_r</span><span class="p">,</span> <span class="n">up_r</span><span class="p">,</span> <span class="n">wp_r</span> <span class="o">=</span> <span class="n">lq_retired</span><span class="o">.</span><span class="n">compute_sequence</span><span class="p">(</span><span class="n">xp_w</span><span class="p">[:,</span> <span class="n">K</span><span class="p">])</span>

<span class="c1"># Convert results back to assets, consumption and income</span>
<span class="n">xp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">xp_w</span><span class="p">,</span> <span class="n">xp_r</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]))</span>
<span class="n">assets</span> <span class="o">=</span> <span class="n">xp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>                  <span class="c1"># Assets</span>

<span class="n">up</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">up_w</span><span class="p">,</span> <span class="n">up_r</span><span class="p">))</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">up</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">+</span> <span class="n">c_bar</span>           <span class="c1"># Consumption</span>

<span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">income_w</span> <span class="o">=</span> <span class="n">σ</span> <span class="o">*</span> <span class="n">wp_w</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">m1</span> <span class="o">*</span> <span class="n">time</span> <span class="o">+</span> <span class="n">m2</span> <span class="o">*</span> <span class="n">time</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># Income</span>
<span class="n">income_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">T</span><span class="o">-</span><span class="n">K</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
<span class="n">income</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">income_w</span><span class="p">,</span> <span class="n">income_r</span><span class="p">))</span>

<span class="c1"># Plot results</span>
<span class="n">n_rows</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">bbox</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">.102</span><span class="p">)</span>
<span class="n">legend_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bbox_to_anchor&#39;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">,</span> <span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;expand&#39;</span><span class="p">}</span>
<span class="n">p_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lw&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">}</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">income</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;non-financial income&quot;</span><span class="p">,</span>
            <span class="o">**</span><span class="n">p_args</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="n">c</span><span class="p">,</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;consumption&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">p_args</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">assets</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;assets&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">p_args</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;k-&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="o">**</span><span class="n">legend_args</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ce76589eb600d79906e402ba09b65146cd9832b41e347c32274782de52256b0a.png" src="_images/ce76589eb600d79906e402ba09b65146cd9832b41e347c32274782de52256b0a.png" />
</div>
</div>
</section>
</div>
<div class="exercise admonition" id="lqc_ex3">

<p class="admonition-title"><span class="caption-number">Exercise 62.3 </span></p>
<section id="exercise-content">
<p>Reproduce the figures from the monopolist application <a class="reference internal" href="#lqc-mwac"><span class="std std-ref">given above</span></a>.</p>
<p>For parameters, use <span class="math notranslate nohighlight">\(a_0 = 5, a_1 = 0.5, \sigma = 0.15, \rho = 0.9,
\beta = 0.95\)</span> and <span class="math notranslate nohighlight">\(c = 2\)</span>, while <span class="math notranslate nohighlight">\(\gamma\)</span> varies between 1 and 50
(see figures).</p>
</section>
</div>
<div class="solution dropdown admonition" id="lqcontrol-solution-5">

<p class="admonition-title">Solution to<a class="reference internal" href="#lqc_ex3"> Exercise 62.3</a></p>
<section id="solution-content">
<p>The first task is to find the matrices <span class="math notranslate nohighlight">\(A, B, C, Q, R\)</span> that define
the LQ problem.</p>
<p>Recall that <span class="math notranslate nohighlight">\(x_t = (\bar q_t \;\, q_t \;\, 1)'\)</span>, while
<span class="math notranslate nohighlight">\(u_t = q_{t+1} - q_t\)</span>.</p>
<p>Letting <span class="math notranslate nohighlight">\(m_0 := (a_0 - c) / 2a_1\)</span> and <span class="math notranslate nohighlight">\(m_1 := 1 / 2 a_1\)</span>, we
can write <span class="math notranslate nohighlight">\(\bar q_t = m_0 + m_1 d_t\)</span>, and then, with some
manipulation</p>
<div class="math notranslate nohighlight">
\[
\bar q_{t+1} = m_0 (1 - \rho) + \rho \bar q_t + m_1 \sigma w_{t+1}
\]</div>
<p>By our definition of <span class="math notranslate nohighlight">\(u_t\)</span>, the dynamics of <span class="math notranslate nohighlight">\(q_t\)</span> are
<span class="math notranslate nohighlight">\(q_{t+1} = q_t + u_t\)</span>.</p>
<p>Using these facts you should be able to build the correct
<span class="math notranslate nohighlight">\(A, B, C\)</span> matrices (and then check them against those found in the
solution code below).</p>
<p>Suitable <span class="math notranslate nohighlight">\(R, Q\)</span> matrices can be found by inspecting the objective
function, which we repeat here for convenience:</p>
<div class="math notranslate nohighlight">
\[
\min
\mathbb E \,
\left\{
    \sum_{t=0}^{\infty} \beta^t
    a_1 ( q_t - \bar q_t)^2 + \gamma u_t^2
\right\}
\]</div>
<p>Our solution code is</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Model parameters</span>
<span class="n">a0</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">a1</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">σ</span> <span class="o">=</span> <span class="mf">0.15</span>
<span class="n">ρ</span> <span class="o">=</span> <span class="mf">0.9</span>
<span class="n">γ</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">β</span> <span class="o">=</span> <span class="mf">0.95</span>
<span class="n">c</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">120</span>

<span class="c1"># Useful constants</span>
<span class="n">m0</span> <span class="o">=</span> <span class="p">(</span><span class="n">a0</span><span class="o">-</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a1</span><span class="p">)</span>
<span class="n">m1</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a1</span><span class="p">)</span>

<span class="c1"># Formulate LQ problem</span>
<span class="n">Q</span> <span class="o">=</span> <span class="n">γ</span>
<span class="n">R</span> <span class="o">=</span> <span class="p">[[</span> <span class="n">a1</span><span class="p">,</span> <span class="o">-</span><span class="n">a1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span><span class="o">-</span><span class="n">a1</span><span class="p">,</span>  <span class="n">a1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span>  <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">]]</span>
<span class="n">A</span> <span class="o">=</span> <span class="p">[[</span><span class="n">ρ</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">m0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">ρ</span><span class="p">)],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>            <span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>            <span class="mi">1</span><span class="p">]]</span>

<span class="n">B</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">C</span> <span class="o">=</span> <span class="p">[[</span><span class="n">m1</span> <span class="o">*</span> <span class="n">σ</span><span class="p">],</span>
     <span class="p">[</span>     <span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span>     <span class="mi">0</span><span class="p">]]</span>

<span class="n">lq</span> <span class="o">=</span> <span class="n">LQ</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="n">β</span><span class="p">)</span>

<span class="c1"># Simulate state / control paths</span>
<span class="n">x0</span> <span class="o">=</span> <span class="p">(</span><span class="n">m0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">xp</span><span class="p">,</span> <span class="n">up</span><span class="p">,</span> <span class="n">wp</span> <span class="o">=</span> <span class="n">lq</span><span class="o">.</span><span class="n">compute_sequence</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">ts_length</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">q_bar</span> <span class="o">=</span> <span class="n">xp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">xp</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>

<span class="c1"># Plot simulation results</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">6.5</span><span class="p">))</span>

<span class="c1"># Some fancy plotting stuff -- simplify if you prefer</span>
<span class="n">bbox</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">.101</span><span class="p">)</span>
<span class="n">legend_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bbox_to_anchor&#39;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">,</span> <span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;expand&#39;</span><span class="p">}</span>
<span class="n">p_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lw&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">}</span>

<span class="n">time</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">time</span><span class="p">)))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">q_bar</span><span class="p">,</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\bar q_t$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$q_t$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="o">**</span><span class="n">legend_args</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;dynamics with $\gamma = </span><span class="si">{</span><span class="n">γ</span><span class="si">}</span><span class="s1">$&#39;</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">q_bar</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">s</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/bbdaf7fcce5457a016461a9a9059695307140ff7ab0abb61712b4aa73faffce2.png" src="_images/bbdaf7fcce5457a016461a9a9059695307140ff7ab0abb61712b4aa73faffce2.png" />
</div>
</div>
</section>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                    </div>
                    
                </main> <!-- .page__content -->
                


                <footer class="qe-page__footer">

                    <p><a href="https://creativecommons.org/licenses/by-sa/4.0/"><img src="https://licensebuttons.net/l/by-sa/4.0/80x15.png"></a></p>

                    <p>Creative Commons License &ndash; This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International.</p>

                </footer> <!-- .page__footer -->

            </div> <!-- .page -->

            

            
            <div class="qe-sidebar bd-sidebar inactive" id="site-navigation">

                <div class="qe-sidebar__header">


                    Contents

                </div>

                <nav class="qe-sidebar__nav" id="qe-sidebar-nav" aria-label="Main navigation">
                    <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tools and Techniques
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="geom_series.html">
   1. Geometric Series for Elementary Economics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="sir_model.html">
   2. Modeling COVID 19
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="linear_algebra.html">
   3. Linear Algebra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="qr_decomp.html">
   4. QR Decomposition
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="complex_and_trig.html">
   5. Complex Numbers and Trigonometry
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="eig_circulant.html">
   6. Circulant Matrices
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="svd_intro.html">
   7. Singular Value Decomposition (SVD)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="var_dmd.html">
   8. VARs and DMDs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="newton_method.html">
   9. Using Newton’s Method to Solve Economic Models
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Elementary Statistics
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="prob_matrix.html">
   10. Elementary Probability with Matrices
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="time_series_with_matrices.html">
   11. Univariate Time Series with Matrix Algebra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lln_clt.html">
   12. LLN and CLT
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="prob_meaning.html">
   13. Two Meanings of Probability
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="multi_hyper.html">
   14. Multivariate Hypergeometric Distribution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="multivariate_normal.html">
   15. Multivariate Normal Distribution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="heavy_tails.html">
   16. Heavy-Tailed Distributions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="hoist_failure.html">
   17. Fault Tree Uncertainties
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="back_prop.html">
   18. Introduction to Artificial Neural Networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rand_resp.html">
   19. Randomized Response Surveys
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="util_rand_resp.html">
   20. Expected Utilities of Random Responses
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Linear Programming
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="lp_intro.html">
   21. Linear Programming
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="opt_transport.html">
   22. Optimal Transport
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="von_neumann_model.html">
   23. Von Neumann Growth Model (and a Generalization)
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introduction to Dynamics
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="scalar_dynam.html">
   24. Dynamics in One Dimension
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ar1_processes.html">
   25. AR1 Processes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="finite_markov.html">
   26. Finite Markov Chains
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="inventory_dynamics.html">
   27. Inventory Dynamics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="linear_models.html">
   28. Linear State Space Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="samuelson.html">
   29. Samuelson Multiplier-Accelerator
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="kesten_processes.html">
   30. Kesten Processes and Firm Dynamics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wealth_dynamics.html">
   31. Wealth Distribution Dynamics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="kalman.html">
   32. A First Look at the Kalman Filter
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="short_path.html">
   33. Shortest Paths
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Search
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_model.html">
   34. Job Search I: The McCall Search Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_model_with_separation.html">
   35. Job Search II: Search and Separation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_fitted_vfi.html">
   36. Job Search III: Fitted Value Function Iteration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_correlated.html">
   37. Job Search IV: Correlated Wage Offers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="career.html">
   38. Job Search V: Modeling Career Choice
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="jv.html">
   39. Job Search VI: On-the-Job Search
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_q.html">
   40. Job Search VII: A McCall Worker Q-Learns
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Consumption, Savings and Capital
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="cass_koopmans_1.html">
   41. Cass-Koopmans Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cass_koopmans_2.html">
   42. Cass-Koopmans Competitive Equilibrium
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cake_eating_problem.html">
   43. Cake Eating I: Introduction to Optimal Saving
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cake_eating_numerical.html">
   44. Cake Eating II: Numerical Methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="optgrowth.html">
   45. Optimal Growth I: The Stochastic Optimal Growth Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="optgrowth_fast.html">
   46. Optimal Growth II: Accelerating the Code with Numba
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="coleman_policy_iter.html">
   47. Optimal Growth III: Time Iteration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="egm_policy_iter.html">
   48. Optimal Growth IV: The Endogenous Grid Method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ifp.html">
   49. The Income Fluctuation Problem I: Basic Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ifp_advanced.html">
   50. The Income Fluctuation Problem II: Stochastic Returns on Assets
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Bayes Law
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="bayes_nonconj.html">
   51. Non-Conjugate Priors
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ar1_bayes.html">
   52. Posterior Distributions for  AR(1) Parameters
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ar1_turningpts.html">
   53. Forecasting  an AR(1) process
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Information
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="odu.html">
   54. Job Search VII: Search with Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="likelihood_ratio_process.html">
   55. Likelihood Ratio Processes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="imp_sample.html">
   56. Computing Mean of a Likelihood Ratio Process
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wald_friedman.html">
   57. A Problem that Stumped Milton Friedman
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="exchangeable.html">
   58. Exchangeability and Bayesian Updating
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="likelihood_bayes.html">
   59. Likelihood Ratio Processes and Bayesian Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mix_model.html">
   60. Incorrect Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="navy_captain.html">
   61. Bayesian versus Frequentist Decision Rules
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  LQ Control
 </span>
</p>
<ul class="current nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1 current active active">
  <a class="current reference internal" href="#">
   62. LQ Control: Foundations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lagrangian_lqdp.html">
   63. Lagrangian for LQ Control
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cross_product_trick.html">
   64. Eliminating Cross Products
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="perm_income.html">
   65. The Permanent Income Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="perm_income_cons.html">
   66. Permanent Income II: LQ Techniques
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lq_inventories.html">
   67. Production Smoothing via Inventories
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Multiple Agent Models
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="schelling.html">
   68. Schelling’s Segregation Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lake_model.html">
   69. A Lake Model of Employment and Unemployment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rational_expectations.html">
   70. Rational Expectations Equilibrium
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="re_with_feedback.html">
   71. Stability in Linear Rational Expectations Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="markov_perf.html">
   72. Markov Perfect Equilibrium
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="uncertainty_traps.html">
   73. Uncertainty Traps
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="aiyagari.html">
   74. The Aiyagari Model
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Asset Pricing and Finance
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="markov_asset.html">
   75. Asset Pricing: Finite State Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ge_arrow.html">
   76. Competitive Equilibria with Arrow Securities
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="harrison_kreps.html">
   77. Heterogeneous Beliefs and Bubbles
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Data and Empirics
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="pandas_panel.html">
   78. Pandas for Panel Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ols.html">
   79. Linear Regression in Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mle.html">
   80. Maximum Likelihood Estimation
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Auctions
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="two_auctions.html">
   81. First-Price and Second-Price Auctions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="house_auction.html">
   82. Multiple Good Allocation Mechanisms
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Other
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="troubleshooting.html">
   83. Troubleshooting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="zreferences.html">
   84. References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="status.html">
   85. Execution Statistics
  </a>
 </li>
</ul>

                </nav>

                <div class="qe-sidebar__footer">

                </div>

            </div> <!-- .sidebar -->
            
        </div> <!-- .main -->

        <div class="qe-toolbar">

            <div class="qe-toolbar__inner">

                <ul class="qe-toolbar__main">
                    <li data-tippy-content="Table of Contents" class="btn__sidebar"><i data-feather="menu"></i></li>
                    <li data-tippy-content="Home"><a href="intro.html"><i data-feather="home"></i></a></li>
                    <li class="btn__qelogo"><a href="https://quantecon.org" title=""><span class="show-for-sr">QuantEcon</span></a></li>
                    <!-- <li class="btn__search">
                        <form action="search.html" method="get">
                            <input type="search" class="form-control" name="q" id="search-input" placeholder="Search..." aria-label="Search..." autocomplete="off">
                            <i data-feather="search"></i>
                        </form>
                    </li> -->
                </ul>

                <ul class="qe-toolbar__links">
                    <li data-tippy-content="Fullscreen" class="btn__fullscreen"><i data-feather="maximize"></i></li>
                    <li data-tippy-content="Increase font size" class="btn__plus"><i data-feather="plus-circle"></i></li>
                    <li data-tippy-content="Decrease font size" class="btn__minus"><i data-feather="minus-circle"></i></li>
                    <li data-tippy-content="Change contrast" class="btn__contrast"><i data-feather="sunset"></i></li>
                    <li data-tippy-content="Download Notebook"><a href="/_notebooks/lqcontrol.ipynb" download><i data-feather="download-cloud"></i></a></li>
                    <li class="settings-button" id="settingsButton"><div data-tippy-content="Launch Notebook"><i data-feather="play-circle"></i></div></li>
                        <li class="download-pdf" id="downloadButton"><i data-feather="file"></i></li>
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/QuantEcon/lecture-python.myst/tree/master/lectures/lqcontrol.md" download><i data-feather="github"></i></a></li>
                </ul>

            </div>

        </div> <!-- .toolbar -->
        <div id="downloadPDFModal" style="display: none;">
            <ul class="pdf-options" style="display: block;">
                <li class="download-pdf-book" onClick="window.print()">
                    <p>Lecture (PDF)</p>
                </li>
                <li class="download-pdf-file">
                    <a href="/_pdf/quantecon-python.pdf" download><p>Book (PDF)</p></a>
                </li>
            </ul>
        </div>
        <div id="settingsModal" style="display: none;">
            <p class="modal-title"> Notebook Launcher </p>
            <div class="modal-desc">
            <p>
                Choose public or private cloud service for "Launch" button.
            </p>
            </div>
            <p class="modal-subtitle">Select a server</p>
            <ul class="modal-servers">
            <li class="active launcher-public">
                <span class="label">Public</span>
                <select id="launcher-public-input">
                
                    <option value="https://mybinder.org/v2/gh/QuantEcon/lecture-python.notebooks/master?urlpath=tree/lqcontrol.ipynb">BinderHub</option>
                
                    <option value="https://colab.research.google.com/github/QuantEcon/lecture-python.notebooks/blob/master/lqcontrol.ipynb">Colab</option>
                
                </select>
                <i class="fas fa-check-circle"></i>
            </li>
            <li class="launcher-private">
                <span class="label">Private</span>
                <input type="text" id="launcher-private-input" data-repourl="https://github.com/QuantEcon/lecture-python.notebooks" data-urlpath="tree/lecture-python.notebooks/lqcontrol.ipynb" data-branch=master>
                <i class="fas fa-check-circle"></i>
            </li>
            </ul>
            <p class="launch"><a href="https://mybinder.org/v2/gh/QuantEcon/lecture-python.notebooks/master?urlpath=tree/lqcontrol.ipynb" id="advancedLaunchButton" target="_blank">Launch Notebook</a></p>
            <script>
                // QuantEcon Notebook Launcher
                const launcherTypeElements = document.querySelectorAll('#settingsModal .modal-servers li');
                // Highlight the server type if previous selection exists
                if (typeof localStorage.launcherType !== 'undefined') {
                  for (var i = 0; i < launcherTypeElements.length; i++) {
                    launcherTypeElements[i].classList.remove('active');
                    if ( launcherTypeElements[i].classList.contains(localStorage.launcherType) ) {
                      launcherTypeElements[i].classList.add('active');
                    }
                  }
                }
                // Highlight server type on click and set local storage value
                for (var i = 0; i < launcherTypeElements.length; i++) {
                  launcherTypeElements[i].addEventListener('click', function() {
                    for (var j = 0; j < launcherTypeElements.length; j++) {
                      launcherTypeElements[j].classList.remove('active');
                    }
                    this.classList.add('active');
                    if ( this.classList.contains('launcher-private') ) {
                      localStorage.launcherType = 'launcher-private';
                    } else if ( this.classList.contains('launcher-public') ) {
                      localStorage.launcherType = 'launcher-public';
                    }
                    setLaunchServer();
                  })
                }
                const launcherPublic = document.getElementById('launcher-public-input');
                const launcherPrivate = document.getElementById('launcher-private-input');
                const pageName = "lqcontrol";
                const repoURL = "https://github.com/QuantEcon/lecture-python.notebooks";
                const urlPath = "tree/lecture-python.notebooks/lqcontrol.ipynb";
                const branch = "master"
                const launchNotebookLink = document.getElementById('advancedLaunchButton');

                // Highlight public server option if previous selection exists
                if (typeof localStorage.launcherPublic !== 'undefined') {
                  launcherPublic.value = localStorage.launcherPublic;
                }
                // Update local storage upon public server selection
                launcherPublic.addEventListener('change', (event) => {
                  setLaunchServer();
                });
                // Populate private server input if previous entry exists
                if (typeof localStorage.launcherPrivate !== 'undefined') {
                  launcherPrivate.value = localStorage.launcherPrivate;
                }
                // Update local storage when a private server is entered
                launcherPrivate.addEventListener('input', (event) => {
                  setLaunchServer();
                });

                // Function to update the "Launch Notebook" link href
                function setLaunchServer() {
                  launchNotebookLink.removeAttribute("style")
                  if ( localStorage.launcherType == 'launcher-private' ) {
                    let repoPrefix = "/jupyter/hub/user-redirect/git-pull?repo=" + repoURL + "&branch=" + branch + "&urlpath=" + urlPath;
                    launcherPrivateValue = launcherPrivate.value
                    if (!launcherPrivateValue) {
                        launchNotebookLink.removeAttribute("href")
                        launchNotebookLink.style.background = "grey"
                        return
                    }
                    localStorage.launcherPrivate = launcherPrivateValue;
                    privateServer = localStorage.launcherPrivate.replace(/\/$/, "")
                    if (!privateServer.includes("http")) {
                        privateServer = "http://" + privateServer
                    }
                    launchNotebookLinkURL = privateServer + repoPrefix;
                  } else if ( localStorage.launcherType == 'launcher-public' ) {
                    launcherPublicValue = launcherPublic.options[launcherPublic.selectedIndex].value;
                    localStorage.launcherPublic = launcherPublicValue;
                    launchNotebookLinkURL = localStorage.launcherPublic;
                  }
                  if (launchNotebookLinkURL) launchNotebookLink.href = launchNotebookLinkURL;
                }
                // Check if user has previously selected a server
                if ( (typeof localStorage.launcherPrivate !== 'undefined') || (typeof localStorage.launcherPublic !== 'undefined') ) {
                  setLaunchServer();
                }
                </script>

        </div>

    </div> <!-- .wrapper-->
  </body>
</html>