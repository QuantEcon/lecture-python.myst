

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>26. A Problem that Stumped Milton Friedman &#8212; Intermediate Quantitative Economics with Python</title>
    <script src="https://unpkg.com/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/tippy.js@6.3.1/dist/tippy-bundle.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
        <script>
            MathJax = {
            loader: {load: ['[tex]/boldsymbol', '[tex]/textmacros']},
            tex: {
                packages: {'[+]': ['boldsymbol', 'textmacros']},
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                processEscapes: true,
                macros: {
                    "argmax" : "arg\\,max",
                    "argmin" : "arg\\,min",
                    "col"    : "col",
                    "Span"   :  "span",
                    "epsilon": "\\varepsilon",
                    "EE": "\\mathbb{E}",
                    "PP": "\\mathbb{P}",
                    "RR": "\\mathbb{R}",
                    "NN": "\\mathbb{N}",
                    "ZZ": "\\mathbb{Z}",
                    "aA": "\\mathcal{A}",
                    "bB": "\\mathcal{B}",
                    "cC": "\\mathcal{C}",
                    "dD": "\\mathcal{D}",
                    "eE": "\\mathcal{E}",
                    "fF": "\\mathcal{F}",
                    "gG": "\\mathcal{G}",
                    "hH": "\\mathcal{H}",
                }
            },
            svg: {
                fontCache: 'global',
                scale: 0.92,
                displayAlign: "center",
            },
            };
        </script>
    
    
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/quantecon-book-theme.css?digest=bd0785fbb14d8d2bd4d9ae501d79ed8d3bc089ec" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/exercise.css" />
    <link rel="stylesheet" type="text/css" href="_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.5ea377869091fd0449014c60fc090103.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>


    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/scripts/quantecon-book-theme.js?digest=d6d86bce9979111653c4c495e33499e1796e172a"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-J0SMYR4SG3"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-J0SMYR4SG3');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"tex": {"macros": {"argmax": "arg\\,max", "argmin": "arg\\,min"}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'wald_friedman';</script>
    <link rel="canonical" href="https://python.quantecon.org/wald_friedman.html" />
    <link rel="shortcut icon" href="_static/lectures-favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="27. A Bayesian Formulation of Friedman and Wald’s Problem" href="wald_friedman_2.html" />
    <link rel="prev" title="25. Mean of a Likelihood Ratio Process" href="imp_sample.html" />

<!-- Normal Meta Tags -->
<meta name="author" context="Thomas J. Sargent &amp; John Stachurski" />
<meta name="keywords" content="Python, QuantEcon, Quantitative Economics, Economics, Sloan, Alfred P. Sloan Foundation, Tom J. Sargent, John Stachurski" />
<meta name="description" content=This website presents a set of lectures on quantitative economic modeling, designed and written by Thomas J. Sargent and John Stachurski. />

<!-- Twitter tags -->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@quantecon" />
<meta name="twitter:title" content="A Problem that Stumped Milton Friedman"/>
<meta name="twitter:description" content="This website presents a set of lectures on quantitative economic modeling, designed and written by Thomas J. Sargent and John Stachurski.">
<meta name="twitter:creator" content="@quantecon">
<meta name="twitter:image" content="https://assets.quantecon.org/img/qe-twitter-logo.png">

<!-- Opengraph tags -->
<meta property="og:title" content="A Problem that Stumped Milton Friedman" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://python.quantecon.org/wald_friedman.html" />
<meta property="og:image" content="https://assets.quantecon.org/img/qe-og-logo.png" />
<meta property="og:description" content="This website presents a set of lectures on quantitative economic modeling, designed and written by Thomas J. Sargent and John Stachurski." />
<meta property="og:site_name" content="Intermediate Quantitative Economics with Python" />
<meta name="theme-color" content="#ffffff" />

  </head>
<body>


    <span id="top"></span>

    <div class="qe-wrapper">

        <div class="qe-main">

            <div class="qe-page" id=wald_friedman>

                <div class="qe-page__toc">

                    <div class="inner">

                        
                        <div class="qe-page__toc-header">
                            On this page
                        </div>


                        <nav id="bd-toc-nav" class="qe-page__toc-nav">
                            <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">26.1. Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#source-of-the-problem">26.2. Source of the Problem</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#neyman-pearson-formulation">26.3. Neyman-Pearson formulation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#walds-sequential-formulation">26.4. Wald’s sequential formulation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#type-i-and-type-ii-errors">26.4.1. Type I and type II errors</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#choices">26.4.2. Choices</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#links-between-a-b-and-alpha-beta">26.5. Links between <span class="math notranslate nohighlight">\(A,B\)</span> and <span class="math notranslate nohighlight">\(\alpha, \beta\)</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simulations">26.6. Simulations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#related-lectures">26.7. Related lectures</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">26.8. Exercises</a></li>
</ul>
                            <p class="logo">
                                
                                    
                                    <a href=https://quantecon.org><img src="_static/qe-logo-large.png" class="logo logo-img" alt="logo"></a>
                                    
                                    
                                
                            </p>

                            <p class="powered">Powered by <a href="https://jupyterbook.org/">Jupyter Book</a></p>

                        </nav>

                        <div class="qe-page__toc-footer">
                            
                            
                            <p><a href="#top"><strong>Back to top</strong></a></p>
                        </div>

                    </div>

                </div>

                <div class="qe-page__header">

                    <div class="qe-page__header-copy">

                        <p class="qe-page__header-heading"><a href="intro.html">Intermediate Quantitative Economics with Python</a></p>

                        <p class="qe-page__header-subheading">A Problem that Stumped Milton Friedman</p>

                    </div>
                    <!-- length 2, since its a string and empty dict has length 2 - {} -->
                        <p class="qe-page__header-authors" font-size="18">
                            
                                
                                    <a href="http://www.tomsargent.com/" target="_blank"><span>Thomas J. Sargent</span></a>
                                
                            
                                
                                    and <a href="https://johnstachurski.net/" target="_blank"><span>John Stachurski</span></a>
                                
                            
                        </p>


                </div> <!-- .page__header -->



                
                <main class="qe-page__content" role="main">
                    
                    <div>
                        
  <section class="tex2jax_ignore mathjax_ignore" id="a-problem-that-stumped-milton-friedman">
<h1><a class="toc-backref" href="#id10"><span class="section-number">26. </span><span class="target" id="index-0"></span>A Problem that Stumped Milton Friedman</a><a class="headerlink" href="#a-problem-that-stumped-milton-friedman" title="Permalink to this heading">#</a></h1>
<p>(and that Abraham Wald solved by inventing sequential analysis)</p>
<div class="contents topic" id="contents">
<span id="index-1"></span><p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#a-problem-that-stumped-milton-friedman" id="id10">A Problem that Stumped Milton Friedman</a></p>
<ul>
<li><p><a class="reference internal" href="#overview" id="id11">Overview</a></p></li>
<li><p><a class="reference internal" href="#source-of-the-problem" id="id12">Source of the Problem</a></p></li>
<li><p><a class="reference internal" href="#neyman-pearson-formulation" id="id13">Neyman-Pearson formulation</a></p></li>
<li><p><a class="reference internal" href="#walds-sequential-formulation" id="id14">Wald’s sequential formulation</a></p></li>
<li><p><a class="reference internal" href="#links-between-a-b-and-alpha-beta" id="id15">Links between <span class="math notranslate nohighlight">\(A,B\)</span> and <span class="math notranslate nohighlight">\(\alpha, \beta\)</span></a></p></li>
<li><p><a class="reference internal" href="#simulations" id="id16">Simulations</a></p></li>
<li><p><a class="reference internal" href="#related-lectures" id="id17">Related lectures</a></p></li>
<li><p><a class="reference internal" href="#exercises" id="id18">Exercises</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="overview">
<h2><a class="toc-backref" href="#id11"><span class="section-number">26.1. </span>Overview</a><a class="headerlink" href="#overview" title="Permalink to this heading">#</a></h2>
<p>This is the first of two lectures about  a statistical decision problem that a US Navy Captain  presented to Milton
Friedman and W. Allen Wallis during World War II when they were analysts at the U.S. Government’s  Statistical Research Group at Columbia University.</p>
<p>This problem led Abraham Wald <span id="id1">[<a class="reference internal" href="zreferences.html#id120" title="Abraham Wald. Sequential Analysis. John Wiley and Sons, New York, 1947.">Wald, 1947</a>]</span> to formulate <strong>sequential analysis</strong>,
an approach to statistical decision problems that is  intimately related to dynamic programming.</p>
<p>In the spirit of <a class="reference internal" href="prob_meaning.html"><span class="doc">this earlier lecture</span></a>, the present lecture and its <a class="reference internal" href="wald_friedman_2.html"><span class="doc">sequel</span></a> approach the problem from two distinct points of view, one frequentist, the other Bayesian.</p>
<p>In this lecture, we describe  Wald’s formulation of the problem from the perspective of a  statistician
working within the Neyman-Pearson tradition of a frequentist statistician who thinks about testing  hypotheses and consequently  use  laws of large numbers to  investigate limiting properties of particular statistics under a given  <strong>hypothesis</strong>, i.e., a vector of <strong>parameters</strong> that pins down a  particular member of a manifold of statistical models that interest the statistician.</p>
<ul class="simple">
<li><p>From <a class="reference internal" href="prob_meaning.html"><span class="doc">this lecture on frequentist and bayesian statistics</span></a>, please remember that a  frequentist statistician routinely calculates functions of sequences of random variables, conditioning on a vector of parameters.</p></li>
</ul>
<p>In <a class="reference internal" href="wald_friedman_2.html"><span class="doc">this related lecture</span></a> we’ll discuss another formulation that adopts   the perspective of a <strong>Bayesian statistician</strong> who views parameters as random variables that are jointly distributed with  observable variables that he is concerned about.</p>
<p>Because we are taking a frequentist perspective that is concerned about relative frequencies conditioned on alternative parameter values, i.e.,
alternative <strong>hypotheses</strong>, key ideas in this lecture</p>
<ul class="simple">
<li><p>Type I and type II statistical errors</p>
<ul>
<li><p>a type I error occurs when you reject a null hypothesis that is true</p></li>
<li><p>a type II error occurs when you accept a null hypothesis that is false</p></li>
</ul>
</li>
<li><p>The <strong>power</strong> of a frequentist statistical test</p></li>
<li><p>The <strong>size</strong> of a frequentist statistical test</p></li>
<li><p>The <strong>critical region</strong> of a statistical test</p></li>
<li><p>A <strong>uniformly most powerful test</strong></p></li>
<li><p>The role of a Law of Large Numbers (LLN) in interpreting <strong>power</strong> and <strong>size</strong> of a frequentist statistical test</p></li>
<li><p>Abraham Wald’s <strong>sequential probability ratio test</strong></p></li>
</ul>
<p>We’ll begin with some imports:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">njit</span><span class="p">,</span> <span class="n">prange</span><span class="p">,</span> <span class="n">vectorize</span><span class="p">,</span> <span class="n">jit</span>
<span class="kn">from</span> <span class="nn">numba.experimental</span> <span class="kn">import</span> <span class="n">jitclass</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">gamma</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">quad</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">beta</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>
</pre></div>
</div>
</div>
</div>
<p>This lecture uses ideas studied in <a class="reference internal" href="likelihood_ratio_process.html"><span class="doc">the lecture on likelihood ratio processes</span></a> and  <a class="reference internal" href="likelihood_bayes.html"><span class="doc">the lecture on Bayesian learning</span></a>.</p>
</section>
<section id="source-of-the-problem">
<h2><a class="toc-backref" href="#id12"><span class="section-number">26.2. </span>Source of the Problem</a><a class="headerlink" href="#source-of-the-problem" title="Permalink to this heading">#</a></h2>
<p>On pages 137-139 of his 1998 book <em>Two Lucky People</em> with Rose Friedman <span id="id2">[<a class="reference internal" href="zreferences.html#id115" title="Milton Friedman and Rose D Friedman. Two Lucky People. University of Chicago Press, 1998.">Friedman and Friedman, 1998</a>]</span>,
Milton Friedman described a problem presented to him and Allen Wallis
during World War II, when they worked at the US Government’s
Statistical Research Group at Columbia University.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See pages 25 and 26  of Allen Wallis’s 1980 article <span id="id3">[<a class="reference internal" href="zreferences.html#id12" title="W Allen Wallis. The statistical research group, 1942–1945. Journal of the American Statistical Association, 75(370):320–330, 1980.">Wallis, 1980</a>]</span>  about the Statistical Research Group at Columbia University during World War II for his account of the episode and  for important contributions  that Harold Hotelling made to formulating the problem.   Also see  chapter 5 of Jennifer Burns’ book about
Milton Friedman <span id="id4">[<a class="reference internal" href="zreferences.html#id13" title="Jennifer Burns. Milton Friedman: The Last Conservative. Farrar, Straus, and Giroux, New York, 2023.">Burns, 2023</a>]</span>.</p>
</div>
<p>Let’s listen to Milton Friedman tell us what happened</p>
<blockquote>
<div><p>In order to understand the story, it is necessary to have an idea of a
simple statistical problem, and of the standard procedure for dealing
with it. The actual problem out of which sequential analysis grew will
serve. The Navy has two alternative designs (say A and B) for a
projectile. It wants to determine which is superior. To do so it
undertakes a series of paired firings. On each round, it assigns the
value 1 or 0 to A accordingly as its performance is superior or inferior
to that of B and conversely 0 or 1 to B. The Navy asks the statistician
how to conduct the test and how to analyze the results.</p>
</div></blockquote>
<blockquote>
<div><p>The standard statistical answer was to specify a number of firings (say
1,000) and a pair of percentages (e.g., 53% and 47%) and tell the client
that if A receives a 1 in more than 53% of the firings, it can be
regarded as superior; if it receives a 1 in fewer than 47%, B can be
regarded as superior; if the percentage is between 47% and 53%, neither
can be so regarded.</p>
</div></blockquote>
<blockquote>
<div><p>When Allen Wallis was discussing such a problem with (Navy) Captain
Garret L. Schuyler, the captain objected that such a test, to quote from
Allen’s account, may prove wasteful. If a wise and seasoned ordnance
officer like Schuyler were on the premises, he would see after the first
few thousand or even few hundred [rounds] that the experiment need not
be completed either because the new method is obviously inferior or
because it is obviously superior beyond what was hoped for
<span class="math notranslate nohighlight">\(\ldots\)</span>.</p>
</div></blockquote>
<p>Friedman and Wallis worked on  the problem for a while but didn’t completely solve it.</p>
<p>Realizing that, they told Abraham Wald about the problem.</p>
<p>That set  Wald on a path that led him  to create  <em>Sequential Analysis</em> <span id="id5">[<a class="reference internal" href="zreferences.html#id120" title="Abraham Wald. Sequential Analysis. John Wiley and Sons, New York, 1947.">Wald, 1947</a>]</span>.</p>
</section>
<section id="neyman-pearson-formulation">
<h2><a class="toc-backref" href="#id13"><span class="section-number">26.3. </span>Neyman-Pearson formulation</a><a class="headerlink" href="#neyman-pearson-formulation" title="Permalink to this heading">#</a></h2>
<p>It is useful to begin by describing the theory underlying the test
that the U.S. Navy told  Captain G. S. Schuyler to use.</p>
<p>Captain Schuyler’s doubts  motivated  him to tell  Milton Friedman and Allen Wallis his conjecture
that superior practical procedures existed.</p>
<p>Evidently, the Navy had told Captain Schuyler to use what was then  a state-of-the-art
Neyman-Pearson  hypothesis test.</p>
<p>We’ll rely on Abraham Wald’s <span id="id6">[<a class="reference internal" href="zreferences.html#id120" title="Abraham Wald. Sequential Analysis. John Wiley and Sons, New York, 1947.">Wald, 1947</a>]</span> elegant summary of Neyman-Pearson theory.</p>
<p>Watch for these features of the setup:</p>
<ul class="simple">
<li><p>the assumption of a <em>fixed</em> sample size <span class="math notranslate nohighlight">\(n\)</span></p></li>
<li><p>the application of laws of large numbers, conditioned on alternative
probability models, to interpret  probabilities <span class="math notranslate nohighlight">\(\alpha\)</span> and
<span class="math notranslate nohighlight">\(\beta\)</span> of the type I and type II errors defined in the Neyman-Pearson theory</p></li>
</ul>
<p>In chapter 1 of <strong>Sequential Analysis</strong> <span id="id7">[<a class="reference internal" href="zreferences.html#id120" title="Abraham Wald. Sequential Analysis. John Wiley and Sons, New York, 1947.">Wald, 1947</a>]</span> Abraham Wald summarizes the
Neyman-Pearson approach to hypothesis testing.</p>
<p>Wald frames the problem as making a decision about a probability
distribution that is partially known.</p>
<p>(You have to assume that <em>something</em> is already known in order to state a well-posed
problem – usually, <em>something</em> means <em>a lot</em>)</p>
<p>By limiting  what is unknown, Wald uses the following simple structure
to illustrate the main ideas:</p>
<ul class="simple">
<li><p>A decision-maker wants to decide which of two distributions
<span class="math notranslate nohighlight">\(f_0\)</span>, <span class="math notranslate nohighlight">\(f_1\)</span> govern an IID random variable <span class="math notranslate nohighlight">\(z\)</span>.</p></li>
<li><p>The null hypothesis <span class="math notranslate nohighlight">\(H_0\)</span> is the statement that <span class="math notranslate nohighlight">\(f_0\)</span>
governs the data.</p></li>
<li><p>The alternative hypothesis <span class="math notranslate nohighlight">\(H_1\)</span> is the statement that
<span class="math notranslate nohighlight">\(f_1\)</span> governs the data.</p></li>
<li><p>The problem is to devise and analyze a test of hypothesis
<span class="math notranslate nohighlight">\(H_0\)</span> against the alternative hypothesis <span class="math notranslate nohighlight">\(H_1\)</span> on the
basis of a sample of a fixed number <span class="math notranslate nohighlight">\(n\)</span> independent
observations <span class="math notranslate nohighlight">\(z_1, z_2, \ldots, z_n\)</span> of the random variable
<span class="math notranslate nohighlight">\(z\)</span>.</p></li>
</ul>
<p>To quote Abraham Wald,</p>
<blockquote>
<div><p>A test procedure leading to the acceptance or rejection of the [null]
hypothesis in question is simply a rule specifying, for each possible
sample of size <span class="math notranslate nohighlight">\(n\)</span>, whether the [null] hypothesis should be accepted
or rejected on the basis of the sample. This may also be expressed as
follows: A test procedure is simply a subdivision of the totality of
all possible samples of size <span class="math notranslate nohighlight">\(n\)</span> into two mutually exclusive
parts, say part 1 and part 2, together with the application of the
rule that the [null] hypothesis be accepted if the observed sample is
contained in part 2. Part 1 is also called the critical region. Since
part 2 is the totality of all samples of size <span class="math notranslate nohighlight">\(n\)</span> which are not
included in part 1, part 2 is uniquely determined by part 1. Thus,
choosing a test procedure is equivalent to determining a critical
region.</p>
</div></blockquote>
<p>Let’s listen to Wald longer:</p>
<blockquote>
<div><p>As a basis for choosing among critical regions the following
considerations have been advanced by Neyman and Pearson: In accepting
or rejecting <span class="math notranslate nohighlight">\(H_0\)</span> we may commit errors of two kinds. We commit
an error of the first kind if we reject <span class="math notranslate nohighlight">\(H_0\)</span> when it is true;
we commit an error of the second kind if we accept <span class="math notranslate nohighlight">\(H_0\)</span> when
<span class="math notranslate nohighlight">\(H_1\)</span> is true. After a particular critical region <span class="math notranslate nohighlight">\(W\)</span> has
been chosen, the probability of committing an error of the first
kind, as well as the probability of committing an error of the second
kind is uniquely determined. The probability of committing an error
of the first kind is equal to the probability, determined by the
assumption that <span class="math notranslate nohighlight">\(H_0\)</span> is true, that the observed sample will be
included in the critical region <span class="math notranslate nohighlight">\(W\)</span>. The probability of
committing an error of the second kind is equal to the probability,
determined on the assumption that <span class="math notranslate nohighlight">\(H_1\)</span> is true, that the
probability will fall outside the critical region <span class="math notranslate nohighlight">\(W\)</span>. For any
given critical region <span class="math notranslate nohighlight">\(W\)</span> we shall denote the probability of an
error of the first kind by <span class="math notranslate nohighlight">\(\alpha\)</span> and the probability of an
error of the second kind by <span class="math notranslate nohighlight">\(\beta\)</span>.</p>
</div></blockquote>
<p>Let’s listen carefully to how Wald applies law of large numbers to
interpret <span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(\beta\)</span>:</p>
<blockquote>
<div><p>The probabilities <span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(\beta\)</span> have the
following important practical interpretation: Suppose that we draw a
large number of samples of size <span class="math notranslate nohighlight">\(n\)</span>. Let <span class="math notranslate nohighlight">\(M\)</span> be the
number of such samples drawn. Suppose that for each of these
<span class="math notranslate nohighlight">\(M\)</span> samples we reject <span class="math notranslate nohighlight">\(H_0\)</span> if the sample is included in
<span class="math notranslate nohighlight">\(W\)</span> and accept <span class="math notranslate nohighlight">\(H_0\)</span> if the sample lies outside
<span class="math notranslate nohighlight">\(W\)</span>. In this way we make <span class="math notranslate nohighlight">\(M\)</span> statements of rejection or
acceptance. Some of these statements will in general be wrong. If
<span class="math notranslate nohighlight">\(H_0\)</span> is true and if <span class="math notranslate nohighlight">\(M\)</span> is large, the probability is
nearly <span class="math notranslate nohighlight">\(1\)</span> (i.e., it is practically certain) that the
proportion of wrong statements (i.e., the number of wrong statements
divided by <span class="math notranslate nohighlight">\(M\)</span>) will be approximately <span class="math notranslate nohighlight">\(\alpha\)</span>. If
<span class="math notranslate nohighlight">\(H_1\)</span> is true, the probability is nearly <span class="math notranslate nohighlight">\(1\)</span> that the
proportion of wrong statements will be approximately <span class="math notranslate nohighlight">\(\beta\)</span>.
Thus, we can say that in the long run [ here Wald applies law of
large numbers by driving <span class="math notranslate nohighlight">\(M \rightarrow \infty\)</span> (our comment,
not Wald’s) ] the proportion of wrong statements will be
<span class="math notranslate nohighlight">\(\alpha\)</span> if <span class="math notranslate nohighlight">\(H_0\)</span> is true and <span class="math notranslate nohighlight">\(\beta\)</span> if
<span class="math notranslate nohighlight">\(H_1\)</span> is true.</p>
</div></blockquote>
<p>The quantity <span class="math notranslate nohighlight">\(\alpha\)</span> is called the <em>size</em> of the critical region,
and the quantity <span class="math notranslate nohighlight">\(1-\beta\)</span> is called the <em>power</em> of the critical
region.</p>
<p>Wald notes that</p>
<blockquote>
<div><p>one critical region <span class="math notranslate nohighlight">\(W\)</span> is more desirable than another if it
has smaller values of <span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(\beta\)</span>. Although
either <span class="math notranslate nohighlight">\(\alpha\)</span> or <span class="math notranslate nohighlight">\(\beta\)</span> can be made arbitrarily small
by a proper choice of the critical region <span class="math notranslate nohighlight">\(W\)</span>, it is impossible
to make both <span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(\beta\)</span> arbitrarily small for a
fixed value of <span class="math notranslate nohighlight">\(n\)</span>, i.e., a fixed sample size.</p>
</div></blockquote>
<p>Wald summarizes Neyman and Pearson’s setup as follows:</p>
<blockquote>
<div><p>Neyman and Pearson show that a region consisting of all samples
<span class="math notranslate nohighlight">\((z_1, z_2, \ldots, z_n)\)</span> which satisfy the inequality</p>
<div class="math notranslate nohighlight">
\[
  \frac{ f_1(z_1) \cdots f_1(z_n)}{f_0(z_1) \cdots f_0(z_n)} \geq k
 \]</div>
<p>is a most powerful critical region for testing the hypothesis
<span class="math notranslate nohighlight">\(H_0\)</span> against the alternative hypothesis <span class="math notranslate nohighlight">\(H_1\)</span>. The term
<span class="math notranslate nohighlight">\(k\)</span> on the right side is a constant chosen so that the region
will have the required size <span class="math notranslate nohighlight">\(\alpha\)</span>.</p>
</div></blockquote>
<p>Wald goes on to discuss Neyman and Pearson’s concept of <em>uniformly most
powerful</em> test.</p>
<p>Here is how Wald introduces the notion of a sequential test</p>
<blockquote>
<div><p>A rule is given for making one of the following three decisions at any stage of
the experiment (at the <span class="math notranslate nohighlight">\(m\)</span> th trial for each integral value of <span class="math notranslate nohighlight">\(m\)</span>): (1) to
accept the hypothesis <span class="math notranslate nohighlight">\(H\)</span>, (2) to reject the hypothesis <span class="math notranslate nohighlight">\(H\)</span>, (3) to
continue the experiment by making an additional observation. Thus, such
a test procedure is carried out sequentially. On the basis of the first
observation, one of the aforementioned decision is made. If the first or
second decision is made, the process is terminated. If the third
decision is made, a second trial is performed. Again, on the basis of
the first two observations, one of the three decision is made. If the
third decision is made, a third trial is performed, and so on. The
process is continued until either the first or the second decisions is
made. The number <span class="math notranslate nohighlight">\(n\)</span> of observations required by such a test procedure is
a random variable, since the value of <span class="math notranslate nohighlight">\(n\)</span> depends on the outcome of the
observations.</p>
</div></blockquote>
</section>
<section id="walds-sequential-formulation">
<h2><a class="toc-backref" href="#id14"><span class="section-number">26.4. </span>Wald’s sequential formulation</a><a class="headerlink" href="#walds-sequential-formulation" title="Permalink to this heading">#</a></h2>
<p>By way of contrast to Neyman and Pearson’s formulation of the problem, in Wald’s formulation</p>
<ul class="simple">
<li><p>The sample size <span class="math notranslate nohighlight">\(n\)</span> is not fixed but rather  a random variable.</p></li>
<li><p>Two  parameters <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(B\)</span> that are related to but distinct from Neyman and Pearson’s  <span class="math notranslate nohighlight">\(\alpha\)</span> and  <span class="math notranslate nohighlight">\(\beta\)</span>;
<span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(B\)</span>  characterize cut-off   rules that Wald  uses to determine the random variable <span class="math notranslate nohighlight">\(n\)</span> as a function of random outcomes.</p></li>
</ul>
<p>Here is how Wald sets up the problem.</p>
<p>A decision-maker can observe a sequence of draws of a random variable <span class="math notranslate nohighlight">\(z\)</span>.</p>
<p>He (or she) wants to know which of two probability distributions <span class="math notranslate nohighlight">\(f_0\)</span> or <span class="math notranslate nohighlight">\(f_1\)</span> governs <span class="math notranslate nohighlight">\(z\)</span>.</p>
<p>We use beta distributions as examples.</p>
<p>We will also work with Jensen-Shannon divergence introduced in <a class="reference internal" href="divergence_measures.html"><span class="doc">Statistical Divergence Measures</span></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@vectorize</span>
<span class="k">def</span> <span class="nf">p</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Beta distribution density function.&quot;&quot;&quot;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">gamma</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">gamma</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">r</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span> <span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">create_beta_density</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a beta density function with specified parameters.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">compute_KL</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute KL divergence KL(f, g)&quot;&quot;&quot;</span>
    <span class="n">integrand</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">w</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">/</span> <span class="n">g</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
    <span class="n">val</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span><span class="n">integrand</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="mf">1e-5</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">val</span>

<span class="k">def</span> <span class="nf">compute_JS</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute Jensen-Shannon divergence&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">m</span><span class="p">(</span><span class="n">w</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">+</span> <span class="n">g</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
    
    <span class="n">js_div</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">compute_KL</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">compute_KL</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">js_div</span>
</pre></div>
</div>
</div>
</div>
<p>The next figure shows two beta distributions</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f0</span> <span class="o">=</span> <span class="n">create_beta_density</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">f1</span> <span class="o">=</span> <span class="n">create_beta_density</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">f0</span><span class="p">(</span><span class="n">grid</span><span class="p">),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$f_0$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">f1</span><span class="p">(</span><span class="n">grid</span><span class="p">),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$f_1$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;$z$ values&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;probability of $z_k$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/069cb35421161f4c4895e2ca18df0619baa841e37da25c54252a43ffba4bfc49.png" src="_images/069cb35421161f4c4895e2ca18df0619baa841e37da25c54252a43ffba4bfc49.png" />
</div>
</div>
<p>Conditional on knowing that successive observations are drawn from distribution <span class="math notranslate nohighlight">\(f_0\)</span>, the sequence of
random variables is independently and identically distributed (IID).</p>
<p>Conditional on knowing that successive observations are drawn from distribution <span class="math notranslate nohighlight">\(f_1\)</span>, the sequence of
random variables is also independently and identically distributed (IID).</p>
<p>But the observer does not know which of the two distributions generated the sequence.</p>
<p>For reasons explained in  <a class="reference external" href="https://python.quantecon.org/exchangeable.html">Exchangeability and Bayesian Updating</a>, this means that the observer thinks that the sequence is not IID.</p>
<p>Consequently, the observer has something to learn, namely, whether the observations are drawn from  <span class="math notranslate nohighlight">\(f_0\)</span> or from <span class="math notranslate nohighlight">\(f_1\)</span>.</p>
<p>The decision maker   wants  to decide which of the  two distributions is generating outcomes.</p>
<section id="type-i-and-type-ii-errors">
<h3><span class="section-number">26.4.1. </span>Type I and type II errors<a class="headerlink" href="#type-i-and-type-ii-errors" title="Permalink to this heading">#</a></h3>
<p>If we regard  <span class="math notranslate nohighlight">\(f=f_0\)</span> as a null hypothesis and <span class="math notranslate nohighlight">\(f=f_1\)</span> as an alternative hypothesis,
then</p>
<ul class="simple">
<li><p>a type I error is an incorrect rejection of a true null hypothesis (a “false positive”)</p></li>
<li><p>a type II error is a failure to reject a false null hypothesis (a “false negative”)</p></li>
</ul>
<p>To repeat ourselves</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\alpha\)</span> is the probability of a type I error</p></li>
<li><p><span class="math notranslate nohighlight">\(\beta\)</span> is the probability of a type II error</p></li>
</ul>
</section>
<section id="choices">
<h3><span class="section-number">26.4.2. </span>Choices<a class="headerlink" href="#choices" title="Permalink to this heading">#</a></h3>
<p>After observing <span class="math notranslate nohighlight">\(z_k, z_{k-1}, \ldots, z_1\)</span>, the decision-maker
chooses among three distinct actions:</p>
<ul class="simple">
<li><p>He decides that <span class="math notranslate nohighlight">\(f = f_0\)</span> and draws no more <span class="math notranslate nohighlight">\(z\)</span>’s</p></li>
<li><p>He decides that <span class="math notranslate nohighlight">\(f = f_1\)</span> and draws no more <span class="math notranslate nohighlight">\(z\)</span>’s</p></li>
<li><p>He postpones deciding  and instead chooses to draw
<span class="math notranslate nohighlight">\(z_{k+1}\)</span></p></li>
</ul>
<p>Wald  defines</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(p_{0m} = f_0(z_1) \cdots f_0(z_m)\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(p_{1m} = f_1(z_1) \cdots f_1(z_m)\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(L_{m} = \frac{p_{1m}}{p_{0m}}\)</span></p></li>
</ul>
<p>Here <span class="math notranslate nohighlight">\(\{L_m\}_{m=0}^\infty\)</span> is a <strong>likelihood ratio process</strong>.</p>
<p>Wald’s sequential  decision rule is parameterized by  real numbers <span class="math notranslate nohighlight">\(B &lt; A\)</span>.</p>
<p>For a given pair <span class="math notranslate nohighlight">\(A, B\)</span>, the decision rule is</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
\textrm { accept } f=f_1 \textrm{ if } L_m \geq A \\
\textrm { accept } f=f_0 \textrm{ if } L_m \leq B \\
\textrm { draw another }  z \textrm{ if }  B &lt; L_m &lt; A
\end{aligned}
\end{split}\]</div>
<p>The following figure illustrates aspects of Wald’s procedure.</p>
<figure class="align-default">
<img alt="_images/wald_dec_rule.png" src="_images/wald_dec_rule.png" />
</figure>
</section>
</section>
<section id="links-between-a-b-and-alpha-beta">
<h2><a class="toc-backref" href="#id15"><span class="section-number">26.5. </span>Links between <span class="math notranslate nohighlight">\(A,B\)</span> and <span class="math notranslate nohighlight">\(\alpha, \beta\)</span></a><a class="headerlink" href="#links-between-a-b-and-alpha-beta" title="Permalink to this heading">#</a></h2>
<p>In chapter 3 of <strong>Sequential Analysis</strong> <span id="id8">[<a class="reference internal" href="zreferences.html#id120" title="Abraham Wald. Sequential Analysis. John Wiley and Sons, New York, 1947.">Wald, 1947</a>]</span>  Wald establishes the inequalities</p>
<div class="math notranslate nohighlight">
\[\begin{split} 
\begin{aligned} 
 \frac{\alpha}{1 -\beta} &amp; \leq \frac{1}{A} \\
 \frac{\beta}{1 - \alpha} &amp; \leq B 
\end{aligned}
\end{split}\]</div>
<p>His analysis of these inequalities leads Wald to recommend the following approximations as rules for setting
<span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(B\)</span> that come close to attaining a decision maker’s target values for probabilities <span class="math notranslate nohighlight">\(\alpha\)</span> of
a  type I  and <span class="math notranslate nohighlight">\(\beta\)</span> of a type II error:</p>
<div class="math notranslate nohighlight" id="equation-eq-waldrule">
<span class="eqno">(26.1)<a class="headerlink" href="#equation-eq-waldrule" title="Permalink to this equation">#</a></span>\[\begin{split}
\begin{aligned}
A \approx a(\alpha,\beta) &amp; \equiv \frac{1-\beta}{\alpha} \\
B \approx b(\alpha,\beta)  &amp; \equiv \frac{\beta}{1-\alpha} 
\end{aligned} 
\end{split}\]</div>
<p>For small values of <span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(\beta\)</span>, Wald shows that approximation  <a class="reference internal" href="#equation-eq-waldrule">(26.1)</a> provides a  good way to set <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(B\)</span>.</p>
<p>In particular, Wald constructs a mathematical argument that leads him to conclude that the use of approximation
<a class="reference internal" href="#equation-eq-waldrule">(26.1)</a> rather than the true functions <span class="math notranslate nohighlight">\(A (\alpha, \beta), B(\alpha,\beta)\)</span> for setting <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(B\)</span></p>
<blockquote>
<div><p><span class="math notranslate nohighlight">\(\ldots\)</span> cannot result in any appreciable increase in the value of either <span class="math notranslate nohighlight">\(\alpha\)</span> or <span class="math notranslate nohighlight">\(\beta\)</span>. In other words,
for all practical purposes the test corresponding to <span class="math notranslate nohighlight">\(A = a(\alpha, \beta), B = b(\alpha,\beta)\)</span> provides as
least the same protection against wrong decisions as the test corresponding to <span class="math notranslate nohighlight">\(A = A(\alpha, \beta)\)</span> and
<span class="math notranslate nohighlight">\(B = b(\alpha, \beta)\)</span>.</p>
</div></blockquote>
<blockquote>
<div><p>Thus, the only disadvantage that may arise from using <span class="math notranslate nohighlight">\( a(\alpha, \beta),  b(\alpha,\beta)\)</span> instead of
<span class="math notranslate nohighlight">\( A(\alpha, \beta),  B(\alpha,\beta)\)</span>, respectively, is that it may result in an appreciable increase in
the  number of observations required by the test.</p>
</div></blockquote>
<p>We’ll write some Python code to help us illustrate Wald’s claims about how <span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(\beta\)</span> are related to the parameters <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(B\)</span>
that characterize his sequential probability ratio test.</p>
</section>
<section id="simulations">
<h2><a class="toc-backref" href="#id16"><span class="section-number">26.6. </span>Simulations</a><a class="headerlink" href="#simulations" title="Permalink to this heading">#</a></h2>
<p>We experiment with different distributions <span class="math notranslate nohighlight">\(f_0\)</span> and <span class="math notranslate nohighlight">\(f_1\)</span> to examine how Wald’s test performs under various conditions.</p>
<p>Our goal in conducting these simulations is to understand  trade-offs between decision speed and accuracy associated with Wald’s  <strong>sequential probability ratio test</strong>.</p>
<p>Specifically, we will watch  how:</p>
<ul class="simple">
<li><p>The decision thresholds <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(B\)</span> (or equivalently the target error rates <span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(\beta\)</span>) affect the average stopping time</p></li>
<li><p>The discrepancy  between distributions <span class="math notranslate nohighlight">\(f_0\)</span> and <span class="math notranslate nohighlight">\(f_1\)</span>  affects  average stopping times</p></li>
</ul>
<p>We will focus on the case where <span class="math notranslate nohighlight">\(f_0\)</span> and <span class="math notranslate nohighlight">\(f_1\)</span> are beta distributions since it is easy to control the overlapping regions of the two densities by adjusting their shape parameters.</p>
<p>First, we define a namedtuple to store all the parameters we need for our simulation studies.</p>
<p>We also compute Wald’s recommended thresholds <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(B\)</span> based on the target type I and type II errors <span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(\beta\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SPRTParams</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;SPRTParams&#39;</span><span class="p">,</span> 
                <span class="p">[</span><span class="s1">&#39;α&#39;</span><span class="p">,</span> <span class="s1">&#39;β&#39;</span><span class="p">,</span>  <span class="c1"># Target type I and type II errors</span>
                <span class="s1">&#39;a0&#39;</span><span class="p">,</span> <span class="s1">&#39;b0&#39;</span><span class="p">,</span> <span class="c1"># Shape parameters for f_0</span>
                <span class="s1">&#39;a1&#39;</span><span class="p">,</span> <span class="s1">&#39;b1&#39;</span><span class="p">,</span> <span class="c1"># Shape parameters for f_1</span>
                <span class="s1">&#39;N&#39;</span><span class="p">,</span>        <span class="c1"># Number of simulations</span>
                <span class="s1">&#39;seed&#39;</span><span class="p">])</span>

<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">compute_wald_thresholds</span><span class="p">(</span><span class="n">α</span><span class="p">,</span> <span class="n">β</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute Wald&#39;s recommended thresholds.&quot;&quot;&quot;</span>
    <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">β</span><span class="p">)</span> <span class="o">/</span> <span class="n">α</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">β</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">α</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">A</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can run the simulation following Wald’s recommendation.</p>
<p>We’ll compare the log-likelihood ratio  to logarithms of the thresholds <span class="math notranslate nohighlight">\(\log(A)\)</span> and <span class="math notranslate nohighlight">\(\log(B)\)</span>.</p>
<p>The following algorithm underlies our simulations.</p>
<ol class="arabic simple">
<li><p>Compute thresholds <span class="math notranslate nohighlight">\(A = \frac{1-\beta}{\alpha}\)</span>, <span class="math notranslate nohighlight">\(B = \frac{\beta}{1-\alpha}\)</span> and work with <span class="math notranslate nohighlight">\(\log A\)</span>, <span class="math notranslate nohighlight">\(\log B\)</span>.</p></li>
<li><p>Given true distribution (either <span class="math notranslate nohighlight">\(f_0\)</span> or <span class="math notranslate nohighlight">\(f_1\)</span>):</p>
<ul class="simple">
<li><p>Initialize log-likelihood ratio <span class="math notranslate nohighlight">\(\log L_0 = 0\)</span></p></li>
<li><p>Repeat:</p>
<ul>
<li><p>Draw observation <span class="math notranslate nohighlight">\(z\)</span> from the true distribution</p></li>
<li><p>Update: <span class="math notranslate nohighlight">\(\log L_{n+1} \leftarrow \log L_n + (\log f_1(z) - \log f_0(z))\)</span></p></li>
<li><p>If <span class="math notranslate nohighlight">\(\log L_{n+1} \geq \log A\)</span>: stop, reject <span class="math notranslate nohighlight">\(H_0\)</span></p></li>
<li><p>If <span class="math notranslate nohighlight">\(\log L_{n+1} \leq \log B\)</span>: stop, accept <span class="math notranslate nohighlight">\(H_0\)</span></p></li>
</ul>
</li>
</ul>
</li>
<li><p>Repeat step 2 for <span class="math notranslate nohighlight">\(N\)</span> replications with <span class="math notranslate nohighlight">\(N/2\)</span> replications
for each distribution, compute the empirical type I error <span class="math notranslate nohighlight">\(\hat{\alpha}\)</span> and type II error <span class="math notranslate nohighlight">\(\hat{\beta}\)</span> with</p></li>
</ol>
<div class="math notranslate nohighlight">
\[
\hat{\alpha} = \frac{\text{$\#$ of times reject } H_0 \text{ when } f_0 \text{ is true}}{\text{$\#$ of replications with } f_0 \text{ true}}
\]</div>
<div class="math notranslate nohighlight">
\[
\hat{\beta} = \frac{\text{$\#$ of times accept } H_0 \text{ when } f_1 \text{ is true}}{\text{$\#$ of replications with } f_1 \text{ true}}
\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">sprt_single_run</span><span class="p">(</span><span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">logA</span><span class="p">,</span> <span class="n">logB</span><span class="p">,</span> <span class="n">true_f0</span><span class="p">,</span> <span class="n">seed</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run a single SPRT until a decision is reached.&quot;&quot;&quot;</span>
    <span class="n">log_L</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">)</span> <span class="k">if</span> <span class="n">true_f0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="c1"># Update log-likelihood ratio</span>
        <span class="n">log_L</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">))</span>
        
        <span class="c1"># Check stopping conditions</span>
        <span class="k">if</span> <span class="n">log_L</span> <span class="o">&gt;=</span> <span class="n">logA</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">n</span><span class="p">,</span> <span class="kc">False</span>  <span class="c1"># Reject H0</span>
        <span class="k">elif</span> <span class="n">log_L</span> <span class="o">&lt;=</span> <span class="n">logB</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">n</span><span class="p">,</span> <span class="kc">True</span>   <span class="c1"># Accept H0</span>

<span class="nd">@njit</span><span class="p">(</span><span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">run_sprt_simulation</span><span class="p">(</span><span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">α</span><span class="p">,</span> <span class="n">β</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">seed</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;SPRT simulation.&quot;&quot;&quot;</span>
    <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">logA</span><span class="p">,</span> <span class="n">logB</span> <span class="o">=</span> <span class="n">compute_wald_thresholds</span><span class="p">(</span><span class="n">α</span><span class="p">,</span> <span class="n">β</span><span class="p">)</span>
    
    <span class="n">stopping_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
    <span class="n">decisions_h0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">)</span>
    <span class="n">truth_h0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">true_f0</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">truth_h0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">true_f0</span>
        
        <span class="n">n</span><span class="p">,</span> <span class="n">accept_f0</span> <span class="o">=</span> <span class="n">sprt_single_run</span><span class="p">(</span>
                        <span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> 
                        <span class="n">logA</span><span class="p">,</span> <span class="n">logB</span><span class="p">,</span> 
                        <span class="n">true_f0</span><span class="p">,</span> <span class="n">seed</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">stopping_times</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
        <span class="n">decisions_h0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">accept_f0</span>
    
    <span class="k">return</span> <span class="n">stopping_times</span><span class="p">,</span> <span class="n">decisions_h0</span><span class="p">,</span> <span class="n">truth_h0</span>

<span class="k">def</span> <span class="nf">run_sprt</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run SPRT simulations with given parameters.&quot;&quot;&quot;</span>
    <span class="n">stopping_times</span><span class="p">,</span> <span class="n">decisions_h0</span><span class="p">,</span> <span class="n">truth_h0</span> <span class="o">=</span> <span class="n">run_sprt_simulation</span><span class="p">(</span>
        <span class="n">params</span><span class="o">.</span><span class="n">a0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">b0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">a1</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">b1</span><span class="p">,</span> 
        <span class="n">params</span><span class="o">.</span><span class="n">α</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">β</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">seed</span>
    <span class="p">)</span>
    
    <span class="c1"># Calculate error rates</span>
    <span class="n">truth_h0_bool</span> <span class="o">=</span> <span class="n">truth_h0</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="n">decisions_h0_bool</span> <span class="o">=</span> <span class="n">decisions_h0</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    
    <span class="n">type_I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">truth_h0_bool</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">decisions_h0_bool</span><span class="p">)</span> \
            <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">truth_h0_bool</span><span class="p">)</span>
    <span class="n">type_II</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">~</span><span class="n">truth_h0_bool</span> <span class="o">&amp;</span> <span class="n">decisions_h0_bool</span><span class="p">)</span> \
            <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">~</span><span class="n">truth_h0_bool</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;stopping_times&#39;</span><span class="p">:</span> <span class="n">stopping_times</span><span class="p">,</span>
        <span class="s1">&#39;decisions_h0&#39;</span><span class="p">:</span> <span class="n">decisions_h0_bool</span><span class="p">,</span>
        <span class="s1">&#39;truth_h0&#39;</span><span class="p">:</span> <span class="n">truth_h0_bool</span><span class="p">,</span>
        <span class="s1">&#39;type_I&#39;</span><span class="p">:</span> <span class="n">type_I</span><span class="p">,</span>
        <span class="s1">&#39;type_II&#39;</span><span class="p">:</span> <span class="n">type_II</span>
    <span class="p">}</span>

<span class="c1"># Run simulation</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">SPRTParams</span><span class="p">(</span><span class="n">α</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">β</span><span class="o">=</span><span class="mf">0.10</span><span class="p">,</span> <span class="n">a0</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">b0</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">a1</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">b1</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">20000</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">run_sprt</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Average stopping time: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;stopping_times&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Empirical type I  error: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;type_I&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> (target = </span><span class="si">{</span><span class="n">params</span><span class="o">.</span><span class="n">α</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Empirical type II error: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;type_II&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> (target = </span><span class="si">{</span><span class="n">params</span><span class="o">.</span><span class="n">β</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Average stopping time: 1.59
Empirical type I  error: 0.012 (target = 0.05)
Empirical type II error: 0.022 (target = 0.1)
</pre></div>
</div>
</div>
</div>
<p>As anticipated in the passage above in which Wald discussed the quality of
<span class="math notranslate nohighlight">\(a(\alpha, \beta), b(\alpha, \beta)\)</span> given in approximation <a class="reference internal" href="#equation-eq-waldrule">(26.1)</a>,
we find that the algorithm actually gives
<strong>lower</strong> type I and type II error rates than the target values.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For recent work on the quality of approximation <a class="reference internal" href="#equation-eq-waldrule">(26.1)</a>, see, e.g., <span id="id9">[<a class="reference internal" href="zreferences.html#id270" title="Lasse Fischer and Aaditya Ramdas. Improving the (approximate) sequential probability ratio test by avoiding overshoot. arXiv preprint arXiv:2410.16076, 2024.">Fischer and Ramdas, 2024</a>]</span>.</p>
</div>
<p>The following code creates a few graphs that illustrate the results of our simulation.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">compute_wald_thresholds</span><span class="p">(</span><span class="n">α</span><span class="p">,</span> <span class="n">β</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute Wald&#39;s recommended thresholds.&quot;&quot;&quot;</span>
    <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">β</span><span class="p">)</span> <span class="o">/</span> <span class="n">α</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">β</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">α</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">A</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">plot_sprt_results</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot SPRT results.&quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    
    <span class="c1"># Distribution plots</span>
    <span class="n">z_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
    <span class="n">f0</span> <span class="o">=</span> <span class="n">create_beta_density</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">a0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">b0</span><span class="p">)</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">create_beta_density</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">a1</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">b1</span><span class="p">)</span>
    
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z_grid</span><span class="p">,</span> <span class="n">f0</span><span class="p">(</span><span class="n">z_grid</span><span class="p">),</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
                 <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;$f_0 = </span><span class="se">\\</span><span class="s1">text</span><span class="se">{{</span><span class="s1">Beta</span><span class="se">}}</span><span class="s1">(</span><span class="si">{</span><span class="n">params</span><span class="o">.</span><span class="n">a0</span><span class="si">}</span><span class="s1">,</span><span class="si">{</span><span class="n">params</span><span class="o">.</span><span class="n">b0</span><span class="si">}</span><span class="s1">)$&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z_grid</span><span class="p">,</span> <span class="n">f1</span><span class="p">(</span><span class="n">z_grid</span><span class="p">),</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
                 <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;$f_1 = </span><span class="se">\\</span><span class="s1">text</span><span class="se">{{</span><span class="s1">Beta</span><span class="se">}}</span><span class="s1">(</span><span class="si">{</span><span class="n">params</span><span class="o">.</span><span class="n">a1</span><span class="si">}</span><span class="s1">,</span><span class="si">{</span><span class="n">params</span><span class="o">.</span><span class="n">b1</span><span class="si">}</span><span class="s1">)$&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">z_grid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> 
                        <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">f0</span><span class="p">(</span><span class="n">z_grid</span><span class="p">),</span> <span class="n">f1</span><span class="p">(</span><span class="n">z_grid</span><span class="p">)),</span> 
                        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;overlap&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;density&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    
    <span class="c1"># Stopping times</span>
    <span class="n">max_n</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;stopping_times&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">101</span><span class="p">)</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_n</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;stopping_times&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s2">&quot;steelblue&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;stopping times (μ=</span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;stopping_times&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> 
                      <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    
    <span class="c1"># Confusion matrix</span>
    <span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">plot_confusion_matrix</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot confusion matrix for SPRT results.&quot;&quot;&quot;</span>
    <span class="n">f0_correct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;truth_h0&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;decisions_h0&#39;</span><span class="p">])</span>
    <span class="n">f0_incorrect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;truth_h0&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;decisions_h0&#39;</span><span class="p">]))</span>
    <span class="n">f1_correct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="o">~</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;truth_h0&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;decisions_h0&#39;</span><span class="p">]))</span>
    <span class="n">f1_incorrect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="o">~</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;truth_h0&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;decisions_h0&#39;</span><span class="p">])</span>
    
    <span class="n">confusion_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">f0_correct</span><span class="p">,</span> <span class="n">f0_incorrect</span><span class="p">],</span> 
                              <span class="p">[</span><span class="n">f1_incorrect</span><span class="p">,</span> <span class="n">f1_correct</span><span class="p">]])</span>
    <span class="n">row_totals</span> <span class="o">=</span> <span class="n">confusion_data</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">confusion_data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;errors: I=</span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;type_I&quot;</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1"> II=</span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;type_II&quot;</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> 
                 <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s1">&#39;accept $H_0$&#39;</span><span class="p">,</span> <span class="s1">&#39;reject $H_0$&#39;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s1">&#39;true $f_0$&#39;</span><span class="p">,</span> <span class="s1">&#39;true $f_1$&#39;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">percent</span> <span class="o">=</span> <span class="n">confusion_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">row_totals</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> \
                        <span class="k">if</span> <span class="n">row_totals</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span> <span class="k">if</span> <span class="n">confusion_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">confusion_data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.5</span> \
                    <span class="k">else</span> <span class="s1">&#39;black&#39;</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">confusion_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s1">(</span><span class="si">{</span><span class="n">percent</span><span class="si">:</span><span class="s1">.1%</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span>
                   <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> 
                   <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Let’s plot the results of our simulation</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_sprt_results</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d03e7b87bb06b9bd21bf0354cc012d85acda25d5b4182a86cfdf1030da469d9e.png" src="_images/d03e7b87bb06b9bd21bf0354cc012d85acda25d5b4182a86cfdf1030da469d9e.png" />
</div>
</div>
<p>In this example, the stopping time stays below 10.</p>
<p>We  can construct a <span class="math notranslate nohighlight">\(2 \times 2\)</span>  “confusion matrix” whose  diagonal elements
count the number of times that Wald’s  decision rule  correctly  accepts and
rejects the null hypothesis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Confusion Matrix data:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Type I error: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;type_I&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Type II error: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;type_II&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Confusion Matrix data:
Type I error: 0.012
Type II error: 0.022
</pre></div>
</div>
</div>
</div>
<p>Next we use our code to study three different <span class="math notranslate nohighlight">\(f_0, f_1\)</span> pairs having different discrepancies between distributions.</p>
<p>We plot the same three graphs we used above for each pair of distributions</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">params_1</span> <span class="o">=</span> <span class="n">SPRTParams</span><span class="p">(</span><span class="n">α</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">β</span><span class="o">=</span><span class="mf">0.10</span><span class="p">,</span> <span class="n">a0</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">b0</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">a1</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">b1</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">results_1</span> <span class="o">=</span> <span class="n">run_sprt</span><span class="p">(</span><span class="n">params_1</span><span class="p">)</span>

<span class="n">params_2</span> <span class="o">=</span> <span class="n">SPRTParams</span><span class="p">(</span><span class="n">α</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">β</span><span class="o">=</span><span class="mf">0.10</span><span class="p">,</span> <span class="n">a0</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">b0</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">a1</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">b1</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">results_2</span> <span class="o">=</span> <span class="n">run_sprt</span><span class="p">(</span><span class="n">params_2</span><span class="p">)</span>

<span class="n">params_3</span> <span class="o">=</span> <span class="n">SPRTParams</span><span class="p">(</span><span class="n">α</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">β</span><span class="o">=</span><span class="mf">0.10</span><span class="p">,</span> <span class="n">a0</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">b0</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">a1</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> 
                      <span class="n">b1</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">results_3</span> <span class="o">=</span> <span class="n">run_sprt</span><span class="p">(</span><span class="n">params_3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_sprt_results</span><span class="p">(</span><span class="n">results_1</span><span class="p">,</span> <span class="n">params_1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8303cb2c05fbdce8145d2412c1624fbb1b2355d58d75aa21f54b5c35cf89e6cb.png" src="_images/8303cb2c05fbdce8145d2412c1624fbb1b2355d58d75aa21f54b5c35cf89e6cb.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_sprt_results</span><span class="p">(</span><span class="n">results_2</span><span class="p">,</span> <span class="n">params_2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c10afcef6e898989b031126482a03baa7f1979c01fe2e4e8f4d0dd35b1e21740.png" src="_images/c10afcef6e898989b031126482a03baa7f1979c01fe2e4e8f4d0dd35b1e21740.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_sprt_results</span><span class="p">(</span><span class="n">results_3</span><span class="p">,</span> <span class="n">params_3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/dbd026a405576a8441e24540cd5e81b9c620b714aee72e10d202059d407c48db.png" src="_images/dbd026a405576a8441e24540cd5e81b9c620b714aee72e10d202059d407c48db.png" />
</div>
</div>
<p>Notice that  the stopping times are less when the  two  distributions are farther apart.</p>
<p>This makes sense.</p>
<p>When two distributions are “far apart”, it should not take too long to decide which one is generating the data.</p>
<p>When two distributions are “close”, it should  takes longer to decide which one is generating the data.</p>
<p>It is tempting to link this pattern to our discussion of <a class="reference internal" href="divergence_measures.html#rel-entropy"><span class="std std-ref">Kullback–Leibler divergence</span></a> in <a class="reference internal" href="likelihood_ratio_process.html"><span class="doc">Likelihood Ratio Processes</span></a>.</p>
<p>While, KL divergence is larger when two distributions differ more, KL divergence is not symmetric, meaning that the KL divergence of distribution <span class="math notranslate nohighlight">\(f\)</span> from distribution <span class="math notranslate nohighlight">\(g\)</span>  is not necessarily equal to the KL
divergence of <span class="math notranslate nohighlight">\(g\)</span> from <span class="math notranslate nohighlight">\(f\)</span>.</p>
<p>If we want a symmetric measure of divergence that actually a metric, we can instead use  <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.spatial.distance.jensenshannon.html">Jensen-Shannon distance</a>.</p>
<p>That is what we shall do now.</p>
<p>We shall compute Jensen-Shannon distance  and plot it against the average stopping times.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">js_dist</span><span class="p">(</span><span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Jensen–Shannon distance&quot;&quot;&quot;</span>
    <span class="n">f0</span> <span class="o">=</span> <span class="n">create_beta_density</span><span class="p">(</span><span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">)</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">create_beta_density</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">)</span>

    <span class="c1"># Mixture</span>
    <span class="n">m</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">w</span><span class="p">:</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">f0</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">+</span> <span class="n">f1</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">compute_KL</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">f0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">compute_KL</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">f1</span><span class="p">))</span>
    
<span class="k">def</span> <span class="nf">generate_β_pairs</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">d_min</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">d_max</span><span class="o">=</span><span class="mf">9.5</span><span class="p">):</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">d_min</span><span class="p">,</span> <span class="n">d_max</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">a0</span> <span class="o">=</span> <span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="n">ds</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">b0</span> <span class="o">=</span> <span class="p">(</span><span class="n">T</span> <span class="o">+</span> <span class="n">ds</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">a0</span><span class="p">))</span>

<span class="n">param_comb</span> <span class="o">=</span> <span class="n">generate_β_pairs</span><span class="p">()</span>

<span class="c1"># Run simulations for each parameter combination</span>
<span class="n">js_dists</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">mean_stopping_times</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">param_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span> <span class="ow">in</span> <span class="n">param_comb</span><span class="p">:</span>
    <span class="c1"># Compute KL divergence</span>
    <span class="n">js_div</span> <span class="o">=</span> <span class="n">js_dist</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">)</span>
    
    <span class="c1"># Run SPRT simulation with a fixed set of parameters d d</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">SPRTParams</span><span class="p">(</span><span class="n">α</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">β</span><span class="o">=</span><span class="mf">0.10</span><span class="p">,</span> <span class="n">a0</span><span class="o">=</span><span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="o">=</span><span class="n">b0</span><span class="p">,</span> 
                        <span class="n">a1</span><span class="o">=</span><span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="o">=</span><span class="n">b1</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">run_sprt</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    
    <span class="n">js_dists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">js_div</span><span class="p">)</span>
    <span class="n">mean_stopping_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;stopping_times&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">param_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">))</span>

<span class="c1"># Create the plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">scatter</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">js_dists</span><span class="p">,</span> <span class="n">mean_stopping_times</span><span class="p">,</span> 
                    <span class="n">s</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Jensen–Shannon distance&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;mean stopping time&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/cd4729272309ab702f8269f190dd361feb657085c52ab30cc2aeffef055cba95.png" src="_images/cd4729272309ab702f8269f190dd361feb657085c52ab30cc2aeffef055cba95.png" />
</div>
</div>
<p>The plot demonstrates a clear negative correlation between relative entropy and mean stopping time.</p>
<p>As  Jensen-Shannon divergence increases (distributions become more separated), the mean stopping time decreases exponentially.</p>
<p>Below are sampled examples from the experiments we have above</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_beta_distributions_grid</span><span class="p">(</span><span class="n">param_list</span><span class="p">,</span> <span class="n">js_dists</span><span class="p">,</span> <span class="n">mean_stopping_times</span><span class="p">,</span> 
                                <span class="n">selected_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot grid of beta distributions with JS distance and stopping times.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">selected_indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">selected_indices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_list</span><span class="p">)</span><span class="o">//</span><span class="mi">6</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_list</span><span class="p">)</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> 
                          <span class="nb">len</span><span class="p">(</span><span class="n">param_list</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">param_list</span><span class="p">)</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">z_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">selected_indices</span><span class="p">):</span>
        <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">i</span> <span class="o">//</span> <span class="mi">3</span><span class="p">,</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">3</span>
        <span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span> <span class="o">=</span> <span class="n">param_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        
        <span class="n">f0</span> <span class="o">=</span> <span class="n">create_beta_density</span><span class="p">(</span><span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">)</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="n">create_beta_density</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">)</span>
        
        <span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z_grid</span><span class="p">,</span> <span class="n">f0</span><span class="p">(</span><span class="n">z_grid</span><span class="p">),</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$f_0$&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z_grid</span><span class="p">,</span> <span class="n">f1</span><span class="p">(</span><span class="n">z_grid</span><span class="p">),</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$f_1$&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">z_grid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> 
                                  <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">f0</span><span class="p">(</span><span class="n">z_grid</span><span class="p">),</span> <span class="n">f1</span><span class="p">(</span><span class="n">z_grid</span><span class="p">)),</span> 
                                  <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">)</span>
        
        <span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;JS dist: </span><span class="si">{</span><span class="n">js_dists</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span>
                               <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Mean time: </span><span class="si">{</span><span class="n">mean_stopping_times</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> 
                               <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;density&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plot_beta_distributions_grid</span><span class="p">(</span><span class="n">param_list</span><span class="p">,</span> <span class="n">js_dists</span><span class="p">,</span> <span class="n">mean_stopping_times</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c2bb5b4876bfbcd81bda74b1a5c8660124756963c353448297f2b94847d44855.png" src="_images/c2bb5b4876bfbcd81bda74b1a5c8660124756963c353448297f2b94847d44855.png" />
</div>
</div>
<p>Again, we find that the stopping time is shorter when the distributions are more separated, as
measured by Jensen-Shannon distance.</p>
<p>Let’s visualize individual likelihood ratio processes to see how they evolve toward the decision boundaries.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_likelihood_paths</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">n_highlight</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_background</span><span class="o">=</span><span class="mi">200</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;visualize likelihood ratio paths.&quot;&quot;&quot;</span>
    <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">logA</span><span class="p">,</span> <span class="n">logB</span> <span class="o">=</span> <span class="n">compute_wald_thresholds</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">α</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">β</span><span class="p">)</span>
    <span class="n">f0</span><span class="p">,</span> <span class="n">f1</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">ab</span><span class="p">:</span> <span class="n">create_beta_density</span><span class="p">(</span><span class="o">*</span><span class="n">ab</span><span class="p">),</span>
             <span class="p">[(</span><span class="n">params</span><span class="o">.</span><span class="n">a0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">b0</span><span class="p">),</span> 
              <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">a1</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">b1</span><span class="p">)])</span>
    
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
    
    <span class="k">for</span> <span class="n">dist_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">true_f0</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span>
        <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;true distribution: $f_0$&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;true distribution: $f_1$&#39;</span><span class="p">)</span>
    <span class="p">]):</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">42</span> <span class="o">+</span> <span class="n">dist_idx</span><span class="p">)</span>
        <span class="n">paths_data</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># Generate paths</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_background</span> <span class="o">+</span> <span class="n">n_highlight</span><span class="p">):</span>
            <span class="n">log_L_path</span><span class="p">,</span> <span class="n">log_L</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">0</span>
            
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">z</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">a0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">b0</span><span class="p">)</span> <span class="k">if</span> <span class="n">true_f0</span> \
                    <span class="k">else</span> <span class="n">rng</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">a1</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">b1</span><span class="p">)</span>
                <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">log_L</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">f1</span><span class="p">(</span><span class="n">z</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">f0</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
                <span class="n">log_L_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">log_L</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">log_L</span> <span class="o">&gt;=</span> <span class="n">logA</span> <span class="ow">or</span> <span class="n">log_L</span> <span class="o">&lt;=</span> <span class="n">logB</span><span class="p">:</span>
                    <span class="n">paths_data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">log_L_path</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">log_L</span> <span class="o">&gt;=</span> <span class="n">logA</span><span class="p">))</span>
                    <span class="k">break</span>
        
        <span class="c1"># Plot background paths</span>
        <span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">decision</span> <span class="ow">in</span> <span class="n">paths_data</span><span class="p">[:</span><span class="n">n_background</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)),</span> <span class="n">path</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span> <span class="k">if</span> <span class="n">decision</span> <span class="k">else</span> <span class="s1">&#39;C0&#39;</span><span class="p">,</span> 
                   <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        
        <span class="c1"># Plot highlighted paths with labels</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">decision</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">paths_data</span><span class="p">[</span><span class="n">n_background</span><span class="p">:]):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)),</span> <span class="n">path</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span> <span class="k">if</span> <span class="n">decision</span> <span class="k">else</span> <span class="s1">&#39;C0&#39;</span><span class="p">,</span> 
                   <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="s1">&#39;reject $H_0$&#39;</span> <span class="k">if</span> <span class="n">decision</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span>
                         <span class="s1">&#39;accept $H_0$&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">decision</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        
        <span class="c1"># Add threshold lines and formatting</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">logA</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
                  <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">log A = </span><span class="si">{</span><span class="n">logA</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">logB</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
                  <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">log B = </span><span class="si">{</span><span class="n">logB</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$n$&#39;</span><span class="p">)</span> 
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\log(L_n)$&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center right&#39;</span><span class="p">)</span>
        
        <span class="n">y_margin</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">logA</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">logB</span><span class="p">))</span> <span class="o">*</span> <span class="mf">0.2</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">logB</span> <span class="o">-</span> <span class="n">y_margin</span><span class="p">,</span> <span class="n">logA</span> <span class="o">+</span> <span class="n">y_margin</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plot_likelihood_paths</span><span class="p">(</span><span class="n">params_3</span><span class="p">,</span> <span class="n">n_highlight</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_background</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f078311a426cab6ea90fc2f5e86e4cce3489dd15d97ea9eadc88d49ba17079de.png" src="_images/f078311a426cab6ea90fc2f5e86e4cce3489dd15d97ea9eadc88d49ba17079de.png" />
</div>
</div>
<p>Next, let’s adjust the decision thresholds <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(B\)</span> and examine how the mean stopping time and the type I and type II error rates change.</p>
<p>In the code below, we adjust  Wald’s rule by adjusting the thresholds <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(B\)</span> using factors <span class="math notranslate nohighlight">\(A_f\)</span> and <span class="math notranslate nohighlight">\(B_f\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@njit</span><span class="p">(</span><span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  
<span class="k">def</span> <span class="nf">run_adjusted_thresholds</span><span class="p">(</span><span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">α</span><span class="p">,</span> <span class="n">β</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">A_f</span><span class="p">,</span> <span class="n">B_f</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;SPRT simulation with adjusted thresholds.&quot;&quot;&quot;</span>
    
    <span class="c1"># Calculate original thresholds  </span>
    <span class="n">A_original</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">β</span><span class="p">)</span> <span class="o">/</span> <span class="n">α</span>
    <span class="n">B_original</span> <span class="o">=</span> <span class="n">β</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">α</span><span class="p">)</span>
    
    <span class="c1"># Apply adjustment factors</span>
    <span class="n">A_adj</span> <span class="o">=</span> <span class="n">A_original</span> <span class="o">*</span> <span class="n">A_f</span>
    <span class="n">B_adj</span> <span class="o">=</span> <span class="n">B_original</span> <span class="o">*</span> <span class="n">B_f</span>
    <span class="n">logA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">A_adj</span><span class="p">)</span>
    <span class="n">logB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">B_adj</span><span class="p">)</span>
    
    <span class="c1"># Pre-allocate arrays</span>
    <span class="n">stopping_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
    <span class="n">decisions_h0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">)</span>
    <span class="n">truth_h0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">)</span>
    
    <span class="c1"># Run simulations in parallel</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">true_f0</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">truth_h0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">true_f0</span>
        
        <span class="n">n</span><span class="p">,</span> <span class="n">accept_f0</span> <span class="o">=</span> <span class="n">sprt_single_run</span><span class="p">(</span><span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> 
                        <span class="n">logA</span><span class="p">,</span> <span class="n">logB</span><span class="p">,</span> <span class="n">true_f0</span><span class="p">,</span> <span class="n">seed</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">stopping_times</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
        <span class="n">decisions_h0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">accept_f0</span>
    
    <span class="k">return</span> <span class="n">stopping_times</span><span class="p">,</span> <span class="n">decisions_h0</span><span class="p">,</span> <span class="n">truth_h0</span><span class="p">,</span> <span class="n">A_adj</span><span class="p">,</span> <span class="n">B_adj</span>

<span class="k">def</span> <span class="nf">run_adjusted</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">A_f</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">B_f</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrapper to run SPRT with adjusted A and B thresholds.&quot;&quot;&quot;</span>
    
    <span class="n">stopping_times</span><span class="p">,</span> <span class="n">decisions_h0</span><span class="p">,</span> <span class="n">truth_h0</span><span class="p">,</span> <span class="n">A_adj</span><span class="p">,</span> <span class="n">B_adj</span> <span class="o">=</span> <span class="n">run_adjusted_thresholds</span><span class="p">(</span>
        <span class="n">params</span><span class="o">.</span><span class="n">a0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">b0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">a1</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">b1</span><span class="p">,</span> 
        <span class="n">params</span><span class="o">.</span><span class="n">α</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">β</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">seed</span><span class="p">,</span> <span class="n">A_f</span><span class="p">,</span> <span class="n">B_f</span>
    <span class="p">)</span>
    <span class="n">truth_h0_bool</span> <span class="o">=</span> <span class="n">truth_h0</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="n">decisions_h0_bool</span> <span class="o">=</span> <span class="n">decisions_h0</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    
    <span class="c1"># Calculate error rates</span>
    <span class="n">type_I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">truth_h0_bool</span> 
                    <span class="o">&amp;</span> <span class="o">~</span><span class="n">decisions_h0_bool</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">truth_h0_bool</span><span class="p">)</span>
    <span class="n">type_II</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">~</span><span class="n">truth_h0_bool</span> 
                    <span class="o">&amp;</span> <span class="n">decisions_h0_bool</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">~</span><span class="n">truth_h0_bool</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;stopping_times&#39;</span><span class="p">:</span> <span class="n">stopping_times</span><span class="p">,</span>
        <span class="s1">&#39;type_I&#39;</span><span class="p">:</span> <span class="n">type_I</span><span class="p">,</span>
        <span class="s1">&#39;type_II&#39;</span><span class="p">:</span> <span class="n">type_II</span><span class="p">,</span>
        <span class="s1">&#39;A_used&#39;</span><span class="p">:</span> <span class="n">A_adj</span><span class="p">,</span>
        <span class="s1">&#39;B_used&#39;</span><span class="p">:</span> <span class="n">B_adj</span>
    <span class="p">}</span>

<span class="n">adjustments</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> 
    <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>    
    <span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">),</span>    
    <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">),</span>    
    <span class="p">(</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">),</span>   
<span class="p">]</span>

<span class="n">results_table</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">A_f</span><span class="p">,</span> <span class="n">B_f</span> <span class="ow">in</span> <span class="n">adjustments</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">run_adjusted</span><span class="p">(</span><span class="n">params_2</span><span class="p">,</span> <span class="n">A_f</span><span class="p">,</span> <span class="n">B_f</span><span class="p">)</span>
    <span class="n">results_table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>
        <span class="n">A_f</span><span class="p">,</span> <span class="n">B_f</span><span class="p">,</span> 
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;stopping_times&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;type_I&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;type_II&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">])</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results_table</span><span class="p">,</span> 
                 <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;A_f&quot;</span><span class="p">,</span> <span class="s2">&quot;B_f&quot;</span><span class="p">,</span> <span class="s2">&quot;mean stop time&quot;</span><span class="p">,</span> 
                          <span class="s2">&quot;Type I error&quot;</span><span class="p">,</span> <span class="s2">&quot;Type II error&quot;</span><span class="p">])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;A_f&quot;</span><span class="p">,</span> <span class="s2">&quot;B_f&quot;</span><span class="p">])</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>mean stop time</th>
      <th>Type I error</th>
      <th>Type II error</th>
    </tr>
    <tr>
      <th>A_f</th>
      <th>B_f</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>5.00</th>
      <th>0.5</th>
      <td>16.1</td>
      <td>0.006</td>
      <td>0.036</td>
    </tr>
    <tr>
      <th>1.00</th>
      <th>1.0</th>
      <td>11.1</td>
      <td>0.033</td>
      <td>0.070</td>
    </tr>
    <tr>
      <th>0.30</th>
      <th>3.0</th>
      <td>5.5</td>
      <td>0.086</td>
      <td>0.195</td>
    </tr>
    <tr>
      <th>0.20</th>
      <th>5.0</th>
      <td>3.4</td>
      <td>0.120</td>
      <td>0.304</td>
    </tr>
    <tr>
      <th>0.15</th>
      <th>7.0</th>
      <td>2.2</td>
      <td>0.146</td>
      <td>0.410</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s pause and think about the table more carefully by referring back to <a class="reference internal" href="#equation-eq-waldrule">(26.1)</a>.</p>
<p>Recall that <span class="math notranslate nohighlight">\(A = \frac{1-\beta}{\alpha}\)</span> and <span class="math notranslate nohighlight">\(B = \frac{\beta}{1-\alpha}\)</span>.</p>
<p>When we multiply <span class="math notranslate nohighlight">\(A\)</span> by a factor less than 1 (making <span class="math notranslate nohighlight">\(A\)</span> smaller), we are effectively making it easier to reject the null hypothesis <span class="math notranslate nohighlight">\(H_0\)</span>.</p>
<p>This increases the probability of Type I errors.</p>
<p>When we multiply <span class="math notranslate nohighlight">\(B\)</span> by a factor greater than 1 (making <span class="math notranslate nohighlight">\(B\)</span> larger), we are making it easier to accept the null hypothesis <span class="math notranslate nohighlight">\(H_0\)</span>.</p>
<p>This increases the probability of Type II errors.</p>
<p>The table confirms this intuition: as <span class="math notranslate nohighlight">\(A\)</span> decreases and <span class="math notranslate nohighlight">\(B\)</span> increases from their optimal Wald values, both Type I and Type II error rates increase, while the mean stopping time decreases.</p>
</section>
<section id="related-lectures">
<h2><a class="toc-backref" href="#id17"><span class="section-number">26.7. </span>Related lectures</a><a class="headerlink" href="#related-lectures" title="Permalink to this heading">#</a></h2>
<p>We’ll dig deeper into some of the ideas used here in the following earlier and later lectures:</p>
<ul class="simple">
<li><p>In <a class="reference internal" href="wald_friedman_2.html"><span class="doc">this sequel</span></a>, we reformulate the problem from the perspective of a <strong>Bayesian statistician</strong> who views parameters as vectors of random variables that are jointly distributed with the observables they are concerned about.</p></li>
<li><p>The concept of <strong>exchangeability</strong>, which underlies much of statistical learning, is explored in depth in our <a class="reference internal" href="exchangeable.html"><span class="doc">lecture on exchangeable random variables</span></a>.</p></li>
<li><p>For a deeper understanding of likelihood ratio processes and their role in frequentist and Bayesian statistical theories, see <a class="reference internal" href="likelihood_ratio_process.html"><span class="doc">Likelihood Ratio Processes</span></a>.</p></li>
<li><p>Building on that foundation, <a class="reference internal" href="likelihood_bayes.html"><span class="doc">Likelihood Ratio Processes and Bayesian Learning</span></a> examines the role of likelihood ratio processes in <strong>Bayesian learning</strong>.</p></li>
<li><p>Finally, <a class="reference internal" href="navy_captain.html"><span class="doc">this later lecture</span></a> revisits the subject discussed here and examines whether the frequentist decision rule that the Navy ordered the captain to use would perform better or worse than Abraham Wald’s sequential decision rule.</p></li>
</ul>
</section>
<section id="exercises">
<h2><a class="toc-backref" href="#id18"><span class="section-number">26.8. </span>Exercises</a><a class="headerlink" href="#exercises" title="Permalink to this heading">#</a></h2>
<p>In the two exercises below, please try to rewrite the entire SPRT suite in this lecture.</p>
<div class="exercise admonition" id="wald_friedman_ex1">

<p class="admonition-title"><span class="caption-number">Exercise 26.1 </span></p>
<section id="exercise-content">
<p>In the first exercise, we apply the sequential probability ratio test to distinguish two models generated by 3-state Markov chains</p>
<p>(For a review on likelihood ratio processes for Markov chains, see <a class="reference internal" href="likelihood_ratio_process.html#lrp-markov"><span class="std std-ref">this section</span></a>.)</p>
<p>Consider distinguishing between two 3-state Markov chain models using Wald’s sequential probability ratio test.</p>
<p>You have competing hypotheses about the transition probabilities:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(H_0\)</span>: The chain follows transition matrix <span class="math notranslate nohighlight">\(P^{(0)}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(H_1\)</span>: The chain follows transition matrix <span class="math notranslate nohighlight">\(P^{(1)}\)</span></p></li>
</ul>
<p>Given transition matrices:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
P^{(0)} = \begin{bmatrix}
0.7 &amp; 0.2 &amp; 0.1 \\
0.3 &amp; 0.5 &amp; 0.2 \\
0.1 &amp; 0.3 &amp; 0.6
\end{bmatrix}, \quad
P^{(1)} = \begin{bmatrix}
0.5 &amp; 0.3 &amp; 0.2 \\
0.2 &amp; 0.6 &amp; 0.2 \\
0.2 &amp; 0.2 &amp; 0.6
\end{bmatrix}
\end{split}\]</div>
<p>For a sequence of observations <span class="math notranslate nohighlight">\((x_0, x_1, \ldots, x_t)\)</span>, the likelihood ratio is:</p>
<div class="math notranslate nohighlight">
\[
\Lambda_t = \frac{\pi_{x_0}^{(1)}}{\pi_{x_0}^{(0)}} \prod_{s=1}^t \frac{P_{x_{s-1},x_s}^{(1)}}{P_{x_{s-1},x_s}^{(0)}}
\]</div>
<p>where <span class="math notranslate nohighlight">\(\pi^{(i)}\)</span> is the stationary distribution under hypothesis <span class="math notranslate nohighlight">\(i\)</span>.</p>
<p>Tasks:</p>
<ol class="arabic simple">
<li><p>Implement the likelihood ratio computation for Markov chains</p></li>
<li><p>Implement Wald’s sequential test with Type I error <span class="math notranslate nohighlight">\(\alpha = 0.05\)</span> and Type II error <span class="math notranslate nohighlight">\(\beta = 0.10\)</span></p></li>
<li><p>Run 1000 simulations under each hypothesis and compute empirical error rates</p></li>
<li><p>Analyze the distribution of stopping times</p></li>
</ol>
<p>The test stops when:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\Lambda_t \geq A = \frac{1-\beta}{\alpha} = 18\)</span>: Reject <span class="math notranslate nohighlight">\(H_0\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\Lambda_t \leq B = \frac{\beta}{1-\alpha} = 0.105\)</span>: Accept <span class="math notranslate nohighlight">\(H_0\)</span></p></li>
</ul>
</section>
</div>
<div class="solution dropdown admonition" id="wald_friedman-solution-1">

<p class="admonition-title">Solution to<a class="reference internal" href="#wald_friedman_ex1"> Exercise 26.1</a></p>
<section id="solution-content">
<p>Below is one solution to the exercise.</p>
<p>In the lecture, we write the code more verbosely to illustrate the concepts clearly.</p>
<p>In the code below, we simplified some of the code structure for a shorter presentation.</p>
<p>First we define the parameters for the Markov chain SPRT</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">MarkovSPRTParams</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;MarkovSPRTParams&#39;</span><span class="p">,</span> 
            <span class="p">[</span><span class="s1">&#39;α&#39;</span><span class="p">,</span> <span class="s1">&#39;β&#39;</span><span class="p">,</span> <span class="s1">&#39;P_0&#39;</span><span class="p">,</span> <span class="s1">&#39;P_1&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;seed&#39;</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">compute_stationary_distribution</span><span class="p">(</span><span class="n">P</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute stationary distribution of transition matrix P.&quot;&quot;&quot;</span>
    <span class="n">eigenvalues</span><span class="p">,</span> <span class="n">eigenvectors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">eigenvalues</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">pi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">eigenvectors</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">pi</span> <span class="o">/</span> <span class="n">pi</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">simulate_markov_chain</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">pi_0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">seed</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simulate a Markov chain path.&quot;&quot;&quot;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    
    <span class="n">cumsum_pi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">pi_0</span><span class="p">)</span>
    <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">cumsum_pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">())</span>
    
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
        <span class="n">cumsum_row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">path</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">cumsum_row</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">())</span>
    
    <span class="k">return</span> <span class="n">path</span>
</pre></div>
</div>
</div>
</div>
<p>Here we define the function that runs SPRT for Markov chains</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">markov_sprt_single_run</span><span class="p">(</span><span class="n">P_0</span><span class="p">,</span> <span class="n">P_1</span><span class="p">,</span> <span class="n">π_0</span><span class="p">,</span> <span class="n">π_1</span><span class="p">,</span> 
                <span class="n">logA</span><span class="p">,</span> <span class="n">logB</span><span class="p">,</span> <span class="n">true_P</span><span class="p">,</span> <span class="n">true_π</span><span class="p">,</span> <span class="n">seed</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run single SPRT for Markov chains.&quot;&quot;&quot;</span>
    <span class="n">max_n</span> <span class="o">=</span> <span class="mi">10000</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">simulate_markov_chain</span><span class="p">(</span><span class="n">true_P</span><span class="p">,</span> <span class="n">true_π</span><span class="p">,</span> <span class="n">max_n</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span>
    
    <span class="n">log_L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">π_1</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">/</span> <span class="n">π_0</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="k">if</span> <span class="n">log_L</span> <span class="o">&gt;=</span> <span class="n">logA</span><span class="p">:</span> <span class="k">return</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">log_L</span> <span class="o">&lt;=</span> <span class="n">logB</span><span class="p">:</span> <span class="k">return</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span>
    
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_n</span><span class="p">):</span>
        <span class="n">prev_state</span><span class="p">,</span> <span class="n">curr_state</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">path</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="n">p_1</span><span class="p">,</span> <span class="n">p_0</span> <span class="o">=</span> <span class="n">P_1</span><span class="p">[</span><span class="n">prev_state</span><span class="p">,</span> <span class="n">curr_state</span><span class="p">],</span> <span class="n">P_0</span><span class="p">[</span><span class="n">prev_state</span><span class="p">,</span> <span class="n">curr_state</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">p_0</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">log_L</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p_1</span> <span class="o">/</span> <span class="n">p_0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">p_1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">log_L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            
        <span class="k">if</span> <span class="n">log_L</span> <span class="o">&gt;=</span> <span class="n">logA</span><span class="p">:</span> <span class="k">return</span> <span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">log_L</span> <span class="o">&lt;=</span> <span class="n">logB</span><span class="p">:</span> <span class="k">return</span> <span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="kc">True</span>
    
    <span class="k">return</span> <span class="n">max_n</span><span class="p">,</span> <span class="n">log_L</span> <span class="o">&lt;</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">run_markov_sprt</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run SPRT for Markov chains.&quot;&quot;&quot;</span>
    <span class="n">π_0</span> <span class="o">=</span> <span class="n">compute_stationary_distribution</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">P_0</span><span class="p">)</span>
    <span class="n">π_1</span> <span class="o">=</span> <span class="n">compute_stationary_distribution</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">P_1</span><span class="p">)</span>
    <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">logA</span><span class="p">,</span> <span class="n">logB</span> <span class="o">=</span> <span class="n">compute_wald_thresholds</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">α</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">β</span><span class="p">)</span>
    
    <span class="n">stopping_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
    <span class="n">decisions_h0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="n">truth_h0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
        <span class="n">true_P</span><span class="p">,</span> <span class="n">true_π</span> <span class="o">=</span> <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">P_0</span><span class="p">,</span> <span class="n">π_0</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">P_1</span><span class="p">,</span> <span class="n">π_1</span><span class="p">)</span>
        <span class="n">truth_h0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span>
        
        <span class="n">n</span><span class="p">,</span> <span class="n">accept_h0</span> <span class="o">=</span> <span class="n">markov_sprt_single_run</span><span class="p">(</span>
            <span class="n">params</span><span class="o">.</span><span class="n">P_0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">P_1</span><span class="p">,</span> <span class="n">π_0</span><span class="p">,</span> <span class="n">π_1</span><span class="p">,</span> <span class="n">logA</span><span class="p">,</span> <span class="n">logB</span><span class="p">,</span> 
            <span class="n">true_P</span><span class="p">,</span> <span class="n">true_π</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">seed</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span>
        
        <span class="n">stopping_times</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
        <span class="n">decisions_h0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">accept_h0</span>
    
    <span class="n">type_I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">truth_h0</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">decisions_h0</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">truth_h0</span><span class="p">)</span>
    <span class="n">type_II</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">~</span><span class="n">truth_h0</span> <span class="o">&amp;</span> <span class="n">decisions_h0</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">~</span><span class="n">truth_h0</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;stopping_times&#39;</span><span class="p">:</span> <span class="n">stopping_times</span><span class="p">,</span> <span class="s1">&#39;decisions_h0&#39;</span><span class="p">:</span> <span class="n">decisions_h0</span><span class="p">,</span>
        <span class="s1">&#39;truth_h0&#39;</span><span class="p">:</span> <span class="n">truth_h0</span><span class="p">,</span> <span class="s1">&#39;type_I&#39;</span><span class="p">:</span> <span class="n">type_I</span><span class="p">,</span> <span class="s1">&#39;type_II&#39;</span><span class="p">:</span> <span class="n">type_II</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can run the SPRT for the Markov chain models and visualize the results</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run Markov chain SPRT</span>
<span class="n">P_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> 
                <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> 
                <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">]])</span>

<span class="n">P_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> 
                <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> 
                <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">]])</span>

<span class="n">params_markov</span> <span class="o">=</span> <span class="n">MarkovSPRTParams</span><span class="p">(</span><span class="n">α</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">β</span><span class="o">=</span><span class="mf">0.10</span><span class="p">,</span> 
                        <span class="n">P_0</span><span class="o">=</span><span class="n">P_0</span><span class="p">,</span> <span class="n">P_1</span><span class="o">=</span><span class="n">P_1</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">results_markov</span> <span class="o">=</span> <span class="n">run_markov_sprt</span><span class="p">(</span><span class="n">params_markov</span><span class="p">)</span>


<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">results_markov</span><span class="p">[</span><span class="s1">&#39;stopping_times&#39;</span><span class="p">],</span> 
            <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;steelblue&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;stopping times&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;frequency&quot;</span><span class="p">)</span>

<span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">results_markov</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/dd38c5b0717b77a2a2033a3be48a3eac5c83bd3cdee8cd8cb766887665baf2a3.png" src="_images/dd38c5b0717b77a2a2033a3be48a3eac5c83bd3cdee8cd8cb766887665baf2a3.png" />
</div>
</div>
</section>
</div>
<div class="exercise admonition" id="wald_friedman_ex2">

<p class="admonition-title"><span class="caption-number">Exercise 26.2 </span></p>
<section id="exercise-content">
<p>In this exercise, apply Wald’s sequential test to distinguish between two VAR(1) models with different dynamics and noise structures.</p>
<p>For a review of the likelihood ratio process with VAR models, see <a class="reference internal" href="likelihood_var.html"><span class="doc">Likelihood Processes for VAR Models</span></a>.</p>
<p>Given VAR models under each hypothesis:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(H_0\)</span>: <span class="math notranslate nohighlight">\(x_{t+1} = A^{(0)} x_t + C^{(0)} w_{t+1}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(H_1\)</span>: <span class="math notranslate nohighlight">\(x_{t+1} = A^{(1)} x_t + C^{(1)} w_{t+1}\)</span></p></li>
</ul>
<p>where <span class="math notranslate nohighlight">\(w_t \sim \mathcal{N}(0, I)\)</span> and:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
A^{(0)} = \begin{bmatrix} 0.8 &amp; 0.1 \\ 0.2 &amp; 0.7 \end{bmatrix}, \quad
C^{(0)} = \begin{bmatrix} 0.3 &amp; 0.1 \\ 0.1 &amp; 0.3 \end{bmatrix}
\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}
A^{(1)} = \begin{bmatrix} 0.6 &amp; 0.2 \\ 0.3 &amp; 0.5 \end{bmatrix}, \quad
C^{(1)} = \begin{bmatrix} 0.4 &amp; 0 \\ 0 &amp; 0.4 \end{bmatrix}
\end{split}\]</div>
<p>Tasks:</p>
<ol class="arabic simple">
<li><p>Implement the VAR likelihood ratio using the functions from the VAR lecture</p></li>
<li><p>Implement Wald’s sequential test with <span class="math notranslate nohighlight">\(\alpha = 0.05\)</span> and <span class="math notranslate nohighlight">\(\beta = 0.10\)</span></p></li>
<li><p>Analyze performance under both hypotheses and with model misspecification</p></li>
<li><p>Compare with the Markov chain case in terms of stopping times and accuracy</p></li>
</ol>
</section>
</div>
<div class="solution dropdown admonition" id="wald_friedman-solution-3">

<p class="admonition-title">Solution to<a class="reference internal" href="#wald_friedman_ex2"> Exercise 26.2</a></p>
<section id="solution-content">
<p>Below is one solution to the exercise.</p>
<p>First we define the parameters for the VAR models and simulator</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">VARSPRTParams</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;VARSPRTParams&#39;</span><span class="p">,</span> 
            <span class="p">[</span><span class="s1">&#39;α&#39;</span><span class="p">,</span> <span class="s1">&#39;β&#39;</span><span class="p">,</span> <span class="s1">&#39;A_0&#39;</span><span class="p">,</span> <span class="s1">&#39;C_0&#39;</span><span class="p">,</span> <span class="s1">&#39;A_1&#39;</span><span class="p">,</span> <span class="s1">&#39;C_1&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;seed&#39;</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">create_var_model</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">C</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create VAR model.&quot;&quot;&quot;</span>
    <span class="n">μ_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">CC</span> <span class="o">=</span> <span class="n">C</span> <span class="o">@</span> <span class="n">C</span><span class="o">.</span><span class="n">T</span>
    <span class="n">Σ_0</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve_discrete_lyapunov</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">CC</span><span class="p">)</span>
    
    <span class="n">CC_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">CC</span> <span class="o">+</span> <span class="mf">1e-10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">CC</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">Σ_0_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Σ_0</span> <span class="o">+</span> <span class="mf">1e-10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">Σ_0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="n">A</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="n">C</span><span class="p">,</span> <span class="s1">&#39;μ_0&#39;</span><span class="p">:</span> <span class="n">μ_0</span><span class="p">,</span> <span class="s1">&#39;Σ_0&#39;</span><span class="p">:</span> <span class="n">Σ_0</span><span class="p">,</span>
        <span class="s1">&#39;CC_inv&#39;</span><span class="p">:</span> <span class="n">CC_inv</span><span class="p">,</span> <span class="s1">&#39;Σ_0_inv&#39;</span><span class="p">:</span> <span class="n">Σ_0_inv</span><span class="p">,</span>
        <span class="s1">&#39;log_det_CC&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">CC</span> <span class="o">+</span> <span class="mf">1e-10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">CC</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))),</span>
        <span class="s1">&#39;log_det_Σ_0&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">Σ_0</span> <span class="o">+</span> <span class="mf">1e-10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">Σ_0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Now we define the likelihood ratio for the VAR models and the SPRT function similar to the
Markov chain case</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">var_log_likelihood</span><span class="p">(</span><span class="n">x_curr</span><span class="p">,</span> <span class="n">x_prev</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute VAR log-likelihood.&quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_curr</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">initial</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">x_curr</span> <span class="o">-</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;μ_0&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;log_det_Σ_0&#39;</span><span class="p">]</span> <span class="o">+</span> 
                      <span class="n">diff</span> <span class="o">@</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;Σ_0_inv&#39;</span><span class="p">]</span> <span class="o">@</span> <span class="n">diff</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">x_curr</span> <span class="o">-</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span> <span class="o">@</span> <span class="n">x_prev</span>
        <span class="k">return</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;log_det_CC&#39;</span><span class="p">]</span> <span class="o">+</span> 
                      <span class="n">diff</span> <span class="o">@</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;CC_inv&#39;</span><span class="p">]</span> <span class="o">@</span> <span class="n">diff</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">var_sprt_single_run</span><span class="p">(</span><span class="n">model_0</span><span class="p">,</span> <span class="n">model_1</span><span class="p">,</span> <span class="n">model_true</span><span class="p">,</span> 
                        <span class="n">logA</span><span class="p">,</span> <span class="n">logB</span><span class="p">,</span> <span class="n">seed</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Single VAR SPRT run.&quot;&quot;&quot;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">max_T</span> <span class="o">=</span> <span class="mi">500</span>
    
    <span class="c1"># Generate VAR path</span>
    <span class="n">Σ_chol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cholesky</span><span class="p">(</span><span class="n">model_true</span><span class="p">[</span><span class="s1">&#39;Σ_0&#39;</span><span class="p">])</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">model_true</span><span class="p">[</span><span class="s1">&#39;μ_0&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">Σ_chol</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">model_true</span><span class="p">[</span><span class="s1">&#39;μ_0&#39;</span><span class="p">]))</span>
    
    <span class="c1"># Initial likelihood ratio</span>
    <span class="n">log_L</span> <span class="o">=</span> <span class="p">(</span><span class="n">var_log_likelihood</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">model_1</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-</span> 
             <span class="n">var_log_likelihood</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">model_0</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">log_L</span> <span class="o">&gt;=</span> <span class="n">logA</span><span class="p">:</span> <span class="k">return</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">log_L</span> <span class="o">&lt;=</span> <span class="n">logB</span><span class="p">:</span> <span class="k">return</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span>
    
    <span class="c1"># Sequential updates</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_T</span><span class="p">):</span>
        <span class="n">x_prev</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">model_true</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">model_true</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span> <span class="o">@</span> <span class="n">x</span> <span class="o">+</span> <span class="n">model_true</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="o">@</span> <span class="n">w</span>
        
        <span class="n">log_L</span> <span class="o">+=</span> <span class="p">(</span><span class="n">var_log_likelihood</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x_prev</span><span class="p">,</span> <span class="n">model_1</span><span class="p">)</span> <span class="o">-</span> 
                 <span class="n">var_log_likelihood</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x_prev</span><span class="p">,</span> <span class="n">model_0</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">log_L</span> <span class="o">&gt;=</span> <span class="n">logA</span><span class="p">:</span> <span class="k">return</span> <span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">log_L</span> <span class="o">&lt;=</span> <span class="n">logB</span><span class="p">:</span> <span class="k">return</span> <span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="kc">True</span>
    
    <span class="k">return</span> <span class="n">max_T</span><span class="p">,</span> <span class="n">log_L</span> <span class="o">&lt;</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">run_var_sprt</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run VAR SPRT.&quot;&quot;&quot;</span>

    <span class="n">model_0</span> <span class="o">=</span> <span class="n">create_var_model</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">A_0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">C_0</span><span class="p">)</span>
    <span class="n">model_1</span> <span class="o">=</span> <span class="n">create_var_model</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">A_1</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">C_1</span><span class="p">)</span>
    <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">logA</span><span class="p">,</span> <span class="n">logB</span> <span class="o">=</span> <span class="n">compute_wald_thresholds</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">α</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">β</span><span class="p">)</span>
    
    <span class="n">stopping_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
    <span class="n">decisions_h0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="n">truth_h0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
        <span class="n">model_true</span> <span class="o">=</span> <span class="n">model_0</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">model_1</span>
        <span class="n">truth_h0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span>
        
        <span class="n">n</span><span class="p">,</span> <span class="n">accept_h0</span> <span class="o">=</span> <span class="n">var_sprt_single_run</span><span class="p">(</span><span class="n">model_0</span><span class="p">,</span> <span class="n">model_1</span><span class="p">,</span> <span class="n">model_true</span><span class="p">,</span> 
                                          <span class="n">logA</span><span class="p">,</span> <span class="n">logB</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">seed</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">stopping_times</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
        <span class="n">decisions_h0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">accept_h0</span>
    
    <span class="n">type_I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">truth_h0</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">decisions_h0</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">truth_h0</span><span class="p">)</span>
    <span class="n">type_II</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">~</span><span class="n">truth_h0</span> <span class="o">&amp;</span> <span class="n">decisions_h0</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">~</span><span class="n">truth_h0</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;stopping_times&#39;</span><span class="p">:</span> <span class="n">stopping_times</span><span class="p">,</span> 
            <span class="s1">&#39;decisions_h0&#39;</span><span class="p">:</span> <span class="n">decisions_h0</span><span class="p">,</span>
            <span class="s1">&#39;truth_h0&#39;</span><span class="p">:</span> <span class="n">truth_h0</span><span class="p">,</span> 
            <span class="s1">&#39;type_I&#39;</span><span class="p">:</span> <span class="n">type_I</span><span class="p">,</span> <span class="s1">&#39;type_II&#39;</span><span class="p">:</span> <span class="n">type_II</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s run SPRT and visualize the results</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run VAR SPRT</span>
<span class="n">A_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> 
                <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">]])</span>
<span class="n">C_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> 
                <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">]])</span>
<span class="n">A_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> 
                <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]])</span>
<span class="n">C_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> 
                <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">]])</span>

<span class="n">params_var</span> <span class="o">=</span> <span class="n">VARSPRTParams</span><span class="p">(</span><span class="n">α</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">β</span><span class="o">=</span><span class="mf">0.10</span><span class="p">,</span> 
                <span class="n">A_0</span><span class="o">=</span><span class="n">A_0</span><span class="p">,</span> <span class="n">C_0</span><span class="o">=</span><span class="n">C_0</span><span class="p">,</span> <span class="n">A_1</span><span class="o">=</span><span class="n">A_1</span><span class="p">,</span> <span class="n">C_1</span><span class="o">=</span><span class="n">C_1</span><span class="p">,</span> 
                <span class="n">N</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">results_var</span> <span class="o">=</span> <span class="n">run_var_sprt</span><span class="p">(</span><span class="n">params_var</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">boxplot</span><span class="p">([</span><span class="n">results_markov</span><span class="p">[</span><span class="s1">&#39;stopping_times&#39;</span><span class="p">],</span> 
             <span class="n">results_var</span><span class="p">[</span><span class="s1">&#39;stopping_times&#39;</span><span class="p">]],</span> 
           <span class="n">tick_labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Markov Chain&#39;</span><span class="p">,</span> <span class="s1">&#39;VAR(1)&#39;</span><span class="p">])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;stopping time&#39;</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">0.2</span><span class="p">,</span> <span class="p">[</span><span class="n">results_markov</span><span class="p">[</span><span class="s1">&#39;type_I&#39;</span><span class="p">],</span> <span class="n">results_var</span><span class="p">[</span><span class="s1">&#39;type_I&#39;</span><span class="p">]],</span> 
        <span class="mf">0.4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Type I&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">,</span> <span class="p">[</span><span class="n">results_markov</span><span class="p">[</span><span class="s1">&#39;type_II&#39;</span><span class="p">],</span> <span class="n">results_var</span><span class="p">[</span><span class="s1">&#39;type_II&#39;</span><span class="p">]],</span> 
        <span class="mf">0.4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Type II&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.10</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">ax2</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s1">&#39;Markov&#39;</span><span class="p">,</span> <span class="s1">&#39;VAR&#39;</span><span class="p">])</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e2810c8bcf961b4e731d0a0d0076412de84cf3efd2dc8fc00a32b90d1c42b09d.png" src="_images/e2810c8bcf961b4e731d0a0d0076412de84cf3efd2dc8fc00a32b90d1c42b09d.png" />
</div>
</div>
</section>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                    </div>
                    
                </main> <!-- .page__content -->
                


                <footer class="qe-page__footer">

                    <p><a href="https://creativecommons.org/licenses/by-sa/4.0/"><img src="https://licensebuttons.net/l/by-sa/4.0/80x15.png"></a></p>

                    <p>Creative Commons License &ndash; This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International.</p>

                </footer> <!-- .page__footer -->

            </div> <!-- .page -->

            

            
            <div class="qe-sidebar bd-sidebar inactive" id="site-navigation">

                <div class="qe-sidebar__header">


                    Contents

                </div>

                <nav class="qe-sidebar__nav" id="qe-sidebar-nav" aria-label="Main navigation">
                    <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tools and Techniques
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="sir_model.html">
   1. Modeling COVID 19
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="linear_algebra.html">
   2. Linear Algebra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="qr_decomp.html">
   3. QR Decomposition
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="eig_circulant.html">
   4. Circulant Matrices
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="svd_intro.html">
   5. Singular Value Decomposition (SVD)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="var_dmd.html">
   6. VARs and DMDs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="newton_method.html">
   7. Using Newton’s Method to Solve Economic Models
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Elementary Statistics
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="prob_matrix.html">
   8. Elementary Probability with Matrices
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stats_examples.html">
   9. Some Probability Distributions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lln_clt.html">
   10. LLN and CLT
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="prob_meaning.html">
   11. Two Meanings of Probability
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="multi_hyper.html">
   12. Multivariate Hypergeometric Distribution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="multivariate_normal.html">
   13. Multivariate Normal Distribution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="hoist_failure.html">
   14. Fault Tree Uncertainties
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="back_prop.html">
   15. Introduction to Artificial Neural Networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rand_resp.html">
   16. Randomized Response Surveys
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="util_rand_resp.html">
   17. Expected Utilities of Random Responses
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Bayes Law
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="bayes_nonconj.html">
   18. Non-Conjugate Priors
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ar1_bayes.html">
   19. Posterior Distributions for  AR(1) Parameters
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ar1_turningpts.html">
   20. Forecasting  an AR(1) Process
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Statistics and Information
 </span>
</p>
<ul class="current nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="divergence_measures.html">
   21. Statistical Divergence Measures
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="likelihood_ratio_process.html">
   22. Likelihood Ratio Processes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="likelihood_ratio_process_2.html">
   23. Heterogeneous Beliefs and Financial Markets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="likelihood_var.html">
   24. Likelihood Processes for VAR Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="imp_sample.html">
   25. Mean of a Likelihood Ratio Process
  </a>
 </li>
 <li class="toctree-l1 current active active">
  <a class="current reference internal" href="#">
   26. A Problem that Stumped Milton Friedman
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wald_friedman_2.html">
   27. A Bayesian Formulation of Friedman and Wald’s Problem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="exchangeable.html">
   28. Exchangeability and Bayesian Updating
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="likelihood_bayes.html">
   29. Likelihood Ratio Processes and Bayesian Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mix_model.html">
   30. Incorrect Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="navy_captain.html">
   31. Bayesian versus Frequentist Decision Rules
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Linear Programming
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="opt_transport.html">
   32. Optimal Transport
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="von_neumann_model.html">
   33. Von Neumann Growth Model (and a Generalization)
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introduction to Dynamics
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="finite_markov.html">
   34. Finite Markov Chains
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="inventory_dynamics.html">
   35. Inventory Dynamics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="linear_models.html">
   36. Linear State Space Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="samuelson.html">
   37. Samuelson Multiplier-Accelerator
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="kesten_processes.html">
   38. Kesten Processes and Firm Dynamics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wealth_dynamics.html">
   39. Wealth Distribution Dynamics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="kalman.html">
   40. A First Look at the Kalman Filter
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="kalman_2.html">
   41. Another Look at the Kalman Filter
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Search
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_model.html">
   42. Job Search I: The McCall Search Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_model_with_separation.html">
   43. Job Search II: Search and Separation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_fitted_vfi.html">
   44. Job Search III: Fitted Value Function Iteration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_correlated.html">
   45. Job Search IV: Correlated Wage Offers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="career.html">
   46. Job Search V: Modeling Career Choice
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="jv.html">
   47. Job Search VI: On-the-Job Search
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_q.html">
   48. Job Search VII: A McCall Worker Q-Learns
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="odu.html">
   49. Job Search VII: Search with Learning
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Consumption, Savings and Capital
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="cass_koopmans_1.html">
   50. Cass-Koopmans Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cass_koopmans_2.html">
   51. Cass-Koopmans Competitive Equilibrium
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cass_fiscal.html">
   52. Cass-Koopmans Model with Distorting Taxes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cass_fiscal_2.html">
   53. Two-Country Model with Distorting Taxes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ak2.html">
   54. Transitions in an Overlapping Generations Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cake_eating_problem.html">
   55. Cake Eating I: Introduction to Optimal Saving
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cake_eating_numerical.html">
   56. Cake Eating II: Numerical Methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="optgrowth.html">
   57. Optimal Growth I: The Stochastic Optimal Growth Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="optgrowth_fast.html">
   58. Optimal Growth II: Accelerating the Code with Numba
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="coleman_policy_iter.html">
   59. Optimal Growth III: Time Iteration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="egm_policy_iter.html">
   60. Optimal Growth IV: The Endogenous Grid Method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ifp.html">
   61. The Income Fluctuation Problem I: Basic Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ifp_advanced.html">
   62. The Income Fluctuation Problem II: Stochastic Returns on Assets
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  LQ Control
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="lqcontrol.html">
   63. LQ Control: Foundations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lagrangian_lqdp.html">
   64. Lagrangian for LQ Control
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cross_product_trick.html">
   65. Eliminating Cross Products
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="perm_income.html">
   66. The Permanent Income Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="perm_income_cons.html">
   67. Permanent Income II: LQ Techniques
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lq_inventories.html">
   68. Production Smoothing via Inventories
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Multiple Agent Models
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="lake_model.html">
   69. A Lake Model of Employment and Unemployment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rational_expectations.html">
   70. Rational Expectations Equilibrium
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="re_with_feedback.html">
   71. Stability in Linear Rational Expectations Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="markov_perf.html">
   72. Markov Perfect Equilibrium
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="uncertainty_traps.html">
   73. Uncertainty Traps
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="aiyagari.html">
   74. The Aiyagari Model
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Asset Pricing and Finance
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="markov_asset.html">
   75. Asset Pricing: Finite State Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ge_arrow.html">
   76. Competitive Equilibria with Arrow Securities
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="harrison_kreps.html">
   77. Heterogeneous Beliefs and Bubbles
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Data and Empirics
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="pandas_panel.html">
   78. Pandas for Panel Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ols.html">
   79. Linear Regression in Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mle.html">
   80. Maximum Likelihood Estimation
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Auctions
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="two_auctions.html">
   81. First-Price and Second-Price Auctions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="house_auction.html">
   82. Multiple Good Allocation Mechanisms
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Other
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="troubleshooting.html">
   83. Troubleshooting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="zreferences.html">
   84. References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="status.html">
   85. Execution Statistics
  </a>
 </li>
</ul>

                </nav>

                <div class="qe-sidebar__footer">

                </div>

            </div> <!-- .sidebar -->
            
        </div> <!-- .main -->

        <div class="qe-toolbar">

            <div class="qe-toolbar__inner">

                <ul class="qe-toolbar__main">
                    <li data-tippy-content="Table of Contents" class="btn__sidebar"><i data-feather="menu"></i></li>
                    <li data-tippy-content="Home"><a href="intro.html"><i data-feather="home"></i></a></li>
                    <li class="btn__qelogo"><a href="https://quantecon.org" title=""><span class="show-for-sr">QuantEcon</span></a></li>
                </ul>

                <ul class="qe-toolbar__links">
                    <li class="btn__search">
                        <form action="search.html" method="get">
                            <input type="search" class="form-control" name="q" id="search-input" placeholder="Search..." aria-label="Search..." autocomplete="off" accesskey="k">
                            <i data-feather="search" id="search-icon"></i>
                        </form>
                    </li>
                    <li data-tippy-content="Fullscreen" class="btn__fullscreen"><i data-feather="maximize"></i></li>
                    <li data-tippy-content="Increase font size" class="btn__plus"><i data-feather="plus-circle"></i></li>
                    <li data-tippy-content="Decrease font size" class="btn__minus"><i data-feather="minus-circle"></i></li>
                    <li data-tippy-content="Change contrast" class="btn__contrast"><i data-feather="sunset"></i></li>
                    <li data-tippy-content="Download Notebook"><a href="/_notebooks/wald_friedman.ipynb" download><i data-feather="download-cloud"></i></a></li>
                    <li class="settings-button" id="settingsButton"><div data-tippy-content="Launch Notebook"><i data-feather="play-circle"></i></div></li>
                        <li class="download-pdf" id="downloadButton"><i data-feather="file"></i></li>
                    <!--
                    # Enable if looking for link to specific document hosted on GitHub
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/QuantEcon/lecture-python.myst/blob/main/lectures/wald_friedman.md" download><i data-feather="github"></i></a></li>
                    -->
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/QuantEcon/lecture-python.myst" download><i data-feather="github"></i></a></li>
                </ul>

            </div>

        </div> <!-- .toolbar -->
        <div id="downloadPDFModal" style="display: none;">
            <ul class="pdf-options" style="display: block;">
                <li class="download-pdf-book" onClick="window.print()">
                    <p>Lecture (PDF)</p>
                </li>
                <li class="download-pdf-file">
                    <a href="/_pdf/quantecon-python.pdf" download><p>Book (PDF)</p></a>
                </li>
            </ul>
        </div>
        <div id="settingsModal" style="display: none;">
            <p class="modal-title"> Notebook Launcher </p>
            <div class="modal-desc">
            <p>
                Choose public or private cloud service for "Launch" button.
            </p>
            </div>
            <p class="modal-subtitle">Select a server</p>
            <ul class="modal-servers">
            <li class="active launcher-public">
                <span class="label">Public</span>
                <select id="launcher-public-input">
                
                    <option value="https://colab.research.google.com/github/QuantEcon/lecture-python.notebooks/blob/main/wald_friedman.ipynb">Colab</option>
                
                </select>
                <i class="fas fa-check-circle"></i>
            </li>
            <li class="launcher-private">
                <span class="label">Private</span>
                <input type="text" id="launcher-private-input" data-repourl="https://github.com/QuantEcon/lecture-python.notebooks" data-urlpath="tree/lecture-python.notebooks/wald_friedman.ipynb" data-branch=main>
                <i class="fas fa-check-circle"></i>
            </li>
            </ul>
            <p class="launch"><a href="https://colab.research.google.com/github/QuantEcon/lecture-python.notebooks/blob/main/wald_friedman.ipynb" id="advancedLaunchButton" target="_blank">Launch Notebook</a></p>
            <script>
                // QuantEcon Notebook Launcher
                const launcherTypeElements = document.querySelectorAll('#settingsModal .modal-servers li');
                // Highlight the server type if previous selection exists
                if (typeof localStorage.launcherType !== 'undefined') {
                  for (var i = 0; i < launcherTypeElements.length; i++) {
                    launcherTypeElements[i].classList.remove('active');
                    if ( launcherTypeElements[i].classList.contains(localStorage.launcherType) ) {
                      launcherTypeElements[i].classList.add('active');
                    }
                  }
                }
                // Highlight server type on click and set local storage value
                for (var i = 0; i < launcherTypeElements.length; i++) {
                  launcherTypeElements[i].addEventListener('click', function() {
                    for (var j = 0; j < launcherTypeElements.length; j++) {
                      launcherTypeElements[j].classList.remove('active');
                    }
                    this.classList.add('active');
                    if ( this.classList.contains('launcher-private') ) {
                      localStorage.launcherType = 'launcher-private';
                    } else if ( this.classList.contains('launcher-public') ) {
                      localStorage.launcherType = 'launcher-public';
                    }
                    setLaunchServer();
                  })
                }
                const launcherPublic = document.getElementById('launcher-public-input');
                const launcherPrivate = document.getElementById('launcher-private-input');
                const pageName = "wald_friedman";
                const repoURL = "https://github.com/QuantEcon/lecture-python.notebooks";
                const urlPath = "tree/lecture-python.notebooks/wald_friedman.ipynb";
                const branch = "main"
                const launchNotebookLink = document.getElementById('advancedLaunchButton');

                // Highlight public server option if previous selection exists
                if (typeof localStorage.launcherPublic !== 'undefined') {
                  launcherPublic.value = localStorage.launcherPublic;
                }
                // Update local storage upon public server selection
                launcherPublic.addEventListener('change', (event) => {
                  setLaunchServer();
                });
                // Populate private server input if previous entry exists
                if (typeof localStorage.launcherPrivate !== 'undefined') {
                  launcherPrivate.value = localStorage.launcherPrivate;
                }
                // Update local storage when a private server is entered
                launcherPrivate.addEventListener('input', (event) => {
                  setLaunchServer();
                });

                // Function to update the "Launch Notebook" link href
                function setLaunchServer() {
                  launchNotebookLink.removeAttribute("style")
                  if ( localStorage.launcherType == 'launcher-private' ) {
                    let repoPrefix = "/jupyter/hub/user-redirect/git-pull?repo=" + repoURL + "&branch=" + branch + "&urlpath=" + urlPath;
                    launcherPrivateValue = launcherPrivate.value
                    if (!launcherPrivateValue) {
                        launchNotebookLink.removeAttribute("href")
                        launchNotebookLink.style.background = "grey"
                        return
                    }
                    localStorage.launcherPrivate = launcherPrivateValue;
                    privateServer = localStorage.launcherPrivate.replace(/\/$/, "")
                    if (!privateServer.includes("http")) {
                        privateServer = "http://" + privateServer
                    }
                    launchNotebookLinkURL = privateServer + repoPrefix;
                  } else if ( localStorage.launcherType == 'launcher-public' ) {
                    launcherPublicValue = launcherPublic.options[launcherPublic.selectedIndex].value;
                    localStorage.launcherPublic = launcherPublicValue;
                    launchNotebookLinkURL = localStorage.launcherPublic;
                  }
                  if (launchNotebookLinkURL) launchNotebookLink.href = launchNotebookLinkURL;
                }
                // Check if user has previously selected a server
                if ( (typeof localStorage.launcherPrivate !== 'undefined') || (typeof localStorage.launcherPublic !== 'undefined') ) {
                  setLaunchServer();
                }
                </script>

        </div>

    </div> <!-- .wrapper-->
  </body>
</html>