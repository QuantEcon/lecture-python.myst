
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>22. Likelihood Ratio Processes &#8212; Intermediate Quantitative Economics with Python</title>
    <script src="https://unpkg.com/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/tippy.js@6.3.1/dist/tippy-bundle.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
        <script>
            MathJax = {
            loader: {load: ['[tex]/boldsymbol', '[tex]/textmacros']},
            tex: {
                packages: {'[+]': ['boldsymbol', 'textmacros']},
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                processEscapes: true,
                macros: {
                    "argmax" : "arg\\,max",
                    "argmin" : "arg\\,min",
                    "col"    : "col",
                    "Span"   :  "span",
                    "epsilon": "\\varepsilon",
                    "EE": "\\mathbb{E}",
                    "PP": "\\mathbb{P}",
                    "RR": "\\mathbb{R}",
                    "NN": "\\mathbb{N}",
                    "ZZ": "\\mathbb{Z}",
                    "aA": "\\mathcal{A}",
                    "bB": "\\mathcal{B}",
                    "cC": "\\mathcal{C}",
                    "dD": "\\mathcal{D}",
                    "eE": "\\mathcal{E}",
                    "fF": "\\mathcal{F}",
                    "gG": "\\mathcal{G}",
                    "hH": "\\mathcal{H}",
                }
            },
            svg: {
                fontCache: 'global',
                scale: 0.92,
                displayAlign: "center",
            },
            };
        </script>
    
    
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" href="_static/styles/quantecon-book-theme.css?digest=3d32f4ec5c55bbd96dbde5c8507c26db016c3d6a" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/exercise.css?v=982b99e0" />
    <link rel="stylesheet" type="text/css" href="_static/proof.css?v=4c010e0d" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>


    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script src="_static/scripts/quantecon-book-theme.js?digest=14c25eb8210b9697743fa54cadcbbf6b0ef0e5bb"></script>
    <script src="_static/scripts/jquery.js?v=5d32c60e"></script>
    <script src="_static/scripts/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-J0SMYR4SG3"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-J0SMYR4SG3');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-J0SMYR4SG3');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"tex": {"macros": {"argmax": "arg\\,max", "argmin": "arg\\,min"}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'likelihood_ratio_process';</script>
    <link rel="canonical" href="https://python.quantecon.org/likelihood_ratio_process.html" />
    <link rel="icon" href="_static/lectures-favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="23. Heterogeneous Beliefs and Financial Markets" href="likelihood_ratio_process_2.html" />
    <link rel="prev" title="21. Statistical Divergence Measures" href="divergence_measures.html" />

<!-- Normal Meta Tags -->
<meta name="author" context="Thomas J. Sargent &amp; John Stachurski" />
<meta name="keywords" content="Python, QuantEcon, Quantitative Economics, Economics, Sloan, Alfred P. Sloan Foundation, Tom J. Sargent, John Stachurski" />
<meta name="description" content=This website presents a set of lectures on quantitative economic modeling, designed and written by Thomas J. Sargent and John Stachurski. />

<!-- Twitter tags -->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@quantecon" />
<meta name="twitter:title" content="Likelihood Ratio Processes"/>
<meta name="twitter:description" content="This website presents a set of lectures on quantitative economic modeling, designed and written by Thomas J. Sargent and John Stachurski.">
<meta name="twitter:creator" content="@quantecon">
<meta name="twitter:image" content="https://assets.quantecon.org/img/qe-twitter-logo.png">

<!-- Opengraph tags -->
<meta property="og:title" content="Likelihood Ratio Processes" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://python.quantecon.org/likelihood_ratio_process.html" />
<meta property="og:image" content="https://assets.quantecon.org/img/qe-og-logo.png" />
<meta property="og:description" content="This website presents a set of lectures on quantitative economic modeling, designed and written by Thomas J. Sargent and John Stachurski." />
<meta property="og:site_name" content="Intermediate Quantitative Economics with Python" />
<meta name="theme-color" content="#ffffff" />

  </head>
<body>

<!-- Override QuantEcon theme colors -->

    <span id="top"></span>

    <div class="qe-wrapper">

        <div class="qe-main">

            <div class="qe-page" id=likelihood_ratio_process>

                <div class="qe-page__toc">

                    <div class="inner">

                        
                        <div class="qe-page__toc-header">
                            On this page
                        </div>


                        <nav id="bd-toc-nav" class="qe-page__toc-nav">
                            <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">22.1. Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">22.2. Likelihood Ratio Process</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#nature-permanently-draws-from-density-g">22.3. Nature permanently draws from density g</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#peculiar-property">22.4. Peculiar property</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#nature-permanently-draws-from-density-f">22.5. Nature permanently draws from density f</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#likelihood-ratio-test">22.6. Likelihood ratio test</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-third-distribution-h">22.6.1. A third distribution <span class="math notranslate nohighlight">\(h\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-helpful-formula">22.6.2. A helpful formula</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hypothesis-testing-and-classification">22.7. Hypothesis testing and classification</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-selection-mistake-probability">22.7.1. Model selection mistake probability</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#classification">22.7.2. Classification</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#error-probability-and-divergence-measures">22.7.3. Error probability and divergence measures</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#markov-chains">22.8. Markov chains</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kl-divergence-rate">22.8.1. KL divergence rate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simulations">22.8.2. Simulations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#related-lectures">22.9. Related lectures</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">22.10. Exercises</a></li>
</ul>
                            <p class="logo">
                                
                                    
                                    <a href=https://quantecon.org><img src="_static/qe-logo-large.png" class="logo logo-img" alt="logo"></a>
                                    
                                    
                                
                            </p>

                            <p class="powered">Powered by <a href="https://jupyterbook.org/en/stable/">Jupyter Book</a></p>

                        </nav>

                        <div class="qe-page__toc-footer">
                            
                            
                            <p><a href="#top"><strong>Back to top</strong></a></p>
                        </div>

                    </div>

                </div>

                <div class="qe-page__header">

                    <div class="qe-page__header-copy">

                        <p class="qe-page__header-heading"><a href="intro.html">Intermediate Quantitative Economics with Python</a></p>

                    </div>

                    <!-- Authors section -->
                        <p class="qe-page__header-authors" font-size="18">
                            
                                
                                    <a href="http://www.tomsargent.com/" target="_blank"><span>Thomas J. Sargent</span></a>
                                
                            
                                
                                    and <a href="https://johnstachurski.net/" target="_blank"><span>John Stachurski</span></a>
                                
                            
                        </p>

                    <!-- Last modified / Changelog dropdown -->
                        <button class="qe-page__header-changed" id="changelog-toggle" aria-expanded="false">
                            Last changed: Nov 23, 2025
                            <span class="changelog-icon">▼</span>
                        </button>

                    <!-- Changelog dropdown content -->
                    <div class="qe-page__header-changelog" id="changelog-content" aria-hidden="true">
                        <h4>Changelog (<a href="https://github.com/QuantEcon/lecture-python.myst/commits/main/lectures/likelihood_ratio_process.md">full history</a>)</h4>
                        <ul class="changelog-list">
                            
                            <li class="changelog-entry">
                                
                                <a href="https://github.com/QuantEcon/lecture-python.myst/commit/a606a21" class="changelog-hash">a606a21</a>
                                
                                <span class="changelog-author">John Stachurski</span>
                                <span class="changelog-time">8 hours ago</span>
                                <span class="changelog-message">Improve cake eating time iteration lecture: fix alpha parameter handling and code style (#729)</span>
                            </li>
                            
                        </ul>
                    </div>

                </div> <!-- .page__header -->



                
                <main class="qe-page__content" role="main">
                    
                    <div>
                        
  <section class="tex2jax_ignore mathjax_ignore" id="likelihood-ratio-processes">
<h1><a class="toc-backref" href="#id5" role="doc-backlink"><span class="section-number">22. </span>Likelihood Ratio Processes</a><a class="headerlink" href="#likelihood-ratio-processes" title="Link to this heading">#</a></h1>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#likelihood-ratio-processes" id="id5">Likelihood Ratio Processes</a></p>
<ul>
<li><p><a class="reference internal" href="#overview" id="id6">Overview</a></p></li>
<li><p><a class="reference internal" href="#id1" id="id7">Likelihood Ratio Process</a></p></li>
<li><p><a class="reference internal" href="#nature-permanently-draws-from-density-g" id="id8">Nature permanently draws from density g</a></p></li>
<li><p><a class="reference internal" href="#peculiar-property" id="id9">Peculiar property</a></p></li>
<li><p><a class="reference internal" href="#nature-permanently-draws-from-density-f" id="id10">Nature permanently draws from density f</a></p></li>
<li><p><a class="reference internal" href="#likelihood-ratio-test" id="id11">Likelihood ratio test</a></p></li>
<li><p><a class="reference internal" href="#hypothesis-testing-and-classification" id="id12">Hypothesis testing and classification</a></p></li>
<li><p><a class="reference internal" href="#markov-chains" id="id13">Markov chains</a></p></li>
<li><p><a class="reference internal" href="#related-lectures" id="id14">Related lectures</a></p></li>
<li><p><a class="reference internal" href="#exercises" id="id15">Exercises</a></p></li>
</ul>
</li>
</ul>
</nav>
<p>In addition to what’s in Anaconda, this lecture will need the following libraries:</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>--upgrade<span class="w"> </span>quantecon
</pre></div>
</div>
</div>
<details class="admonition hide below-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell output</p>
<p class="expanded admonition-title">Hide code cell output</p>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: quantecon in /home/runner/miniconda3/envs/quantecon/lib/python3.13/site-packages (0.10.1)
Requirement already satisfied: numba&gt;=0.49.0 in /home/runner/miniconda3/envs/quantecon/lib/python3.13/site-packages (from quantecon) (0.61.0)
Requirement already satisfied: numpy&gt;=1.17.0 in /home/runner/miniconda3/envs/quantecon/lib/python3.13/site-packages (from quantecon) (2.1.3)
Requirement already satisfied: requests in /home/runner/miniconda3/envs/quantecon/lib/python3.13/site-packages (from quantecon) (2.32.3)
Requirement already satisfied: scipy&gt;=1.5.0 in /home/runner/miniconda3/envs/quantecon/lib/python3.13/site-packages (from quantecon) (1.15.3)
Requirement already satisfied: sympy in /home/runner/miniconda3/envs/quantecon/lib/python3.13/site-packages (from quantecon) (1.13.3)
Requirement already satisfied: llvmlite&lt;0.45,&gt;=0.44.0dev0 in /home/runner/miniconda3/envs/quantecon/lib/python3.13/site-packages (from numba&gt;=0.49.0-&gt;quantecon) (0.44.0)
Requirement already satisfied: charset-normalizer&lt;4,&gt;=2 in /home/runner/miniconda3/envs/quantecon/lib/python3.13/site-packages (from requests-&gt;quantecon) (3.3.2)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in /home/runner/miniconda3/envs/quantecon/lib/python3.13/site-packages (from requests-&gt;quantecon) (3.7)
Requirement already satisfied: urllib3&lt;3,&gt;=1.21.1 in /home/runner/miniconda3/envs/quantecon/lib/python3.13/site-packages (from requests-&gt;quantecon) (2.3.0)
Requirement already satisfied: certifi&gt;=2017.4.17 in /home/runner/miniconda3/envs/quantecon/lib/python3.13/site-packages (from requests-&gt;quantecon) (2025.4.26)
Requirement already satisfied: mpmath&lt;1.4,&gt;=1.1.0 in /home/runner/miniconda3/envs/quantecon/lib/python3.13/site-packages (from sympy-&gt;quantecon) (1.3.0)
</pre></div>
</div>
</div>
</details>
</div>
<section id="overview">
<h2><a class="toc-backref" href="#id6" role="doc-backlink"><span class="section-number">22.1. </span>Overview</a><a class="headerlink" href="#overview" title="Link to this heading">#</a></h2>
<p>This lecture describes likelihood ratio processes and some of their uses.</p>
<p>We’ll study the same setting that is also used in <a class="reference internal" href="exchangeable.html"><span class="doc">this lecture on exchangeability</span></a>.</p>
<p>Among the things that we’ll learn are</p>
<ul class="simple">
<li><p>How a likelihood ratio process is a key ingredient in frequentist hypothesis testing</p></li>
<li><p>How a <strong>receiver operator characteristic curve</strong> summarizes information about a false alarm probability and power in frequentist hypothesis testing</p></li>
<li><p>How a statistician can combine frequentist probabilities of type I and type II errors to form posterior probabilities of mistakes in a model selection or in an individual-classification problem</p></li>
<li><p>How to use a Kullback-Leibler divergence to quantify the difference between two probability distributions with the same support</p></li>
<li><p>How during World War II the United States Navy devised a decision rule for doing quality control on lots of ammunition, a topic that sets the stage for <a class="reference internal" href="wald_friedman.html"><span class="doc">this lecture</span></a></p></li>
<li><p>A peculiar property of likelihood ratio processes</p></li>
</ul>
<p>Let’s start by importing some Python tools.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numba</span><span class="w"> </span><span class="kn">import</span> <span class="n">vectorize</span><span class="p">,</span> <span class="n">jit</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="kn">import</span> <span class="n">gamma</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.integrate</span><span class="w"> </span><span class="kn">import</span> <span class="n">quad</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">brentq</span><span class="p">,</span> <span class="n">minimize_scalar</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">beta</span> <span class="k">as</span> <span class="n">beta_dist</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">Math</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">quantecon</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">qe</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id1">
<h2><a class="toc-backref" href="#id7" role="doc-backlink"><span class="section-number">22.2. </span>Likelihood Ratio Process</a><a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<p>A nonnegative random variable <span class="math notranslate nohighlight">\(W\)</span> has one of two probability density functions, either
<span class="math notranslate nohighlight">\(f\)</span> or <span class="math notranslate nohighlight">\(g\)</span>.</p>
<p>Before the beginning of time, nature once and for all decides whether she will draw a sequence of IID draws from either
<span class="math notranslate nohighlight">\(f\)</span> or <span class="math notranslate nohighlight">\(g\)</span>.</p>
<p>We will sometimes let <span class="math notranslate nohighlight">\(q\)</span> be the density that nature chose once and for all, so
that <span class="math notranslate nohighlight">\(q\)</span> is either <span class="math notranslate nohighlight">\(f\)</span> or <span class="math notranslate nohighlight">\(g\)</span>, permanently.</p>
<p>Nature knows which density it permanently draws from, but we the observers do not.</p>
<p>We know both <span class="math notranslate nohighlight">\(f\)</span> and <span class="math notranslate nohighlight">\(g\)</span> but we don’t know which density nature
chose.</p>
<p>But we want to know.</p>
<p>To do that, we use observations.</p>
<p>We observe a sequence <span class="math notranslate nohighlight">\(\{w_t\}_{t=1}^T\)</span> of <span class="math notranslate nohighlight">\(T\)</span> IID draws that we know came from either <span class="math notranslate nohighlight">\(f\)</span> or <span class="math notranslate nohighlight">\(g\)</span>.</p>
<p>We want to use these observations to infer whether nature chose <span class="math notranslate nohighlight">\(f\)</span> or <span class="math notranslate nohighlight">\(g\)</span>.</p>
<p>A <strong>likelihood ratio process</strong> is a useful tool for this task.</p>
<p>To begin, we define a key component of a likelihood ratio process, namely, the time <span class="math notranslate nohighlight">\(t\)</span> likelihood ratio as the random variable</p>
<div class="math notranslate nohighlight">
\[
\ell (w_t)=\frac{f\left(w_t\right)}{g\left(w_t\right)},\quad t\geq1.
\]</div>
<p>We assume that <span class="math notranslate nohighlight">\(f\)</span> and <span class="math notranslate nohighlight">\(g\)</span> both put positive probabilities on the
same intervals of possible realizations of the random variable <span class="math notranslate nohighlight">\(W\)</span>.</p>
<p>That means that under the <span class="math notranslate nohighlight">\(g\)</span> density, <span class="math notranslate nohighlight">\(\ell (w_t)=
\frac{f\left(w_{t}\right)}{g\left(w_{t}\right)}\)</span>
is a nonnegative random variable with mean <span class="math notranslate nohighlight">\(1\)</span>.</p>
<p>A <strong>likelihood ratio process</strong> for sequence
<span class="math notranslate nohighlight">\(\left\{ w_{t}\right\} _{t=1}^{\infty}\)</span> is defined as</p>
<div class="math notranslate nohighlight">
\[
L\left(w^{t}\right)=\prod_{i=1}^{t} \ell (w_i),
\]</div>
<p>where <span class="math notranslate nohighlight">\(w^t=\{ w_1,\dots,w_t\}\)</span> is a history of
observations up to and including time <span class="math notranslate nohighlight">\(t\)</span>.</p>
<p>Sometimes for shorthand we’ll write <span class="math notranslate nohighlight">\(L_t = L(w^t)\)</span>.</p>
<p>Notice that the likelihood process satisfies the <em>recursion</em></p>
<div class="math notranslate nohighlight">
\[
L(w^t) = \ell (w_t) L (w^{t-1}) .
\]</div>
<p>The likelihood ratio and its logarithm are key tools for making
inferences using a classic frequentist approach due to Neyman and
Pearson <span id="id2">[<a class="reference internal" href="zreferences.html#id269" title="J. Neyman and E. S Pearson. On the problem of the most efficient tests of statistical hypotheses. Phil. Trans. R. Soc. Lond. A. 231 (694–706), pages 289–337, 1933.">Neyman and Pearson, 1933</a>]</span>.</p>
<p>To help us appreciate how things work, the following Python code evaluates <span class="math notranslate nohighlight">\(f\)</span> and <span class="math notranslate nohighlight">\(g\)</span> as two different
Beta distributions, then computes and simulates an associated likelihood
ratio process by generating a sequence <span class="math notranslate nohighlight">\(w^t\)</span> from one of the two
probability distributions, for example, a sequence of IID draws from <span class="math notranslate nohighlight">\(g\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parameters for the two Beta distributions</span>
<span class="n">F_a</span><span class="p">,</span> <span class="n">F_b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
<span class="n">G_a</span><span class="p">,</span> <span class="n">G_b</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">1.2</span>

<span class="nd">@vectorize</span>
<span class="k">def</span><span class="w"> </span><span class="nf">p</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Beta distribution density function.&quot;&quot;&quot;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">gamma</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">gamma</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">r</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span> <span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">jit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">F_a</span><span class="p">,</span> <span class="n">F_b</span><span class="p">))</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">jit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">G_a</span><span class="p">,</span> <span class="n">G_b</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_beta_density</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a beta density function with specified parameters.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">likelihood_ratio</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">f_func</span><span class="p">,</span> <span class="n">g_func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute likelihood ratio for observation(s) w.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">f_func</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">/</span> <span class="n">g_func</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>

<span class="nd">@jit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">simulate_likelihood_ratios</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">f_func</span><span class="p">,</span> <span class="n">g_func</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">500</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate N sets of T observations of the likelihood ratio.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">l_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="n">l_arr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">f_func</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">/</span> <span class="n">g_func</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">l_arr</span>

<span class="k">def</span><span class="w"> </span><span class="nf">simulate_sequences</span><span class="p">(</span><span class="n">distribution</span><span class="p">,</span> <span class="n">f_func</span><span class="p">,</span> <span class="n">g_func</span><span class="p">,</span> 
        <span class="n">F_params</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">G_params</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">),</span> <span class="n">T</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">500</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate N sequences of T observations from specified distribution.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">distribution</span> <span class="o">==</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">F_params</span>
    <span class="k">elif</span> <span class="n">distribution</span> <span class="o">==</span> <span class="s1">&#39;g&#39;</span><span class="p">:</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">G_params</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;distribution must be &#39;f&#39; or &#39;g&#39;&quot;</span><span class="p">)</span>
    
    <span class="n">l_arr</span> <span class="o">=</span> <span class="n">simulate_likelihood_ratios</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">f_func</span><span class="p">,</span> <span class="n">g_func</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">l_seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumprod</span><span class="p">(</span><span class="n">l_arr</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">l_arr</span><span class="p">,</span> <span class="n">l_seq</span>

<span class="k">def</span><span class="w"> </span><span class="nf">plot_likelihood_paths</span><span class="p">(</span><span class="n">l_seq</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Likelihood ratio paths&quot;</span><span class="p">,</span> 
                        <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_paths</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot likelihood ratio paths.&quot;&quot;&quot;</span>
    <span class="n">N</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">l_seq</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">n_show</span> <span class="o">=</span> <span class="n">n_paths</span> <span class="ow">or</span> <span class="nb">min</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_show</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="n">l_seq</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">ylim</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$L(w^t)$&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="nature-permanently-draws-from-density-g">
<span id="nature-likeli"></span><h2><a class="toc-backref" href="#id8" role="doc-backlink"><span class="section-number">22.3. </span>Nature permanently draws from density g</a><a class="headerlink" href="#nature-permanently-draws-from-density-g" title="Link to this heading">#</a></h2>
<p>We first simulate the likelihood ratio process when nature permanently
draws from <span class="math notranslate nohighlight">\(g\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Simulate when nature draws from g</span>
<span class="n">l_arr_g</span><span class="p">,</span> <span class="n">l_seq_g</span> <span class="o">=</span> <span class="n">simulate_sequences</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="p">(</span><span class="n">F_a</span><span class="p">,</span> <span class="n">F_b</span><span class="p">),</span> <span class="p">(</span><span class="n">G_a</span><span class="p">,</span> <span class="n">G_b</span><span class="p">))</span>
<span class="n">plot_likelihood_paths</span><span class="p">(</span><span class="n">l_seq_g</span><span class="p">,</span> 
                     <span class="n">title</span><span class="o">=</span><span class="s2">&quot;$L(w^</span><span class="si">{t}</span><span class="s2">)$ paths when nature draws from g&quot;</span><span class="p">,</span>
                     <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/660a0c9de1b452742ca942c910b4b1dab4a47ae119dad714c6ad04bf4fb96492.png" src="_images/660a0c9de1b452742ca942c910b4b1dab4a47ae119dad714c6ad04bf4fb96492.png" />
</div>
</div>
<p>Evidently, as sample length <span class="math notranslate nohighlight">\(T\)</span> grows, most probability mass
shifts toward zero</p>
<p>To see this more clearly, we plot over time the fraction of
paths <span class="math notranslate nohighlight">\(L\left(w^{t}\right)\)</span> that fall in the interval
<span class="math notranslate nohighlight">\(\left[0, 0.01\right]\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">l_arr_g</span><span class="o">.</span><span class="n">shape</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">l_seq_g</span> <span class="o">&lt;=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">N</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/75e580d220b3090bdd4b530b34432458e40e773cc5cd410366e1b98408657a04.png" src="_images/75e580d220b3090bdd4b530b34432458e40e773cc5cd410366e1b98408657a04.png" />
</div>
</div>
<p>Despite the evident convergence of most probability mass to a
very small interval near <span class="math notranslate nohighlight">\(0\)</span>, the unconditional mean of
<span class="math notranslate nohighlight">\(L\left(w^t\right)\)</span> under probability density <span class="math notranslate nohighlight">\(g\)</span> is
identically <span class="math notranslate nohighlight">\(1\)</span> for all <span class="math notranslate nohighlight">\(t\)</span>.</p>
<p>To verify this assertion, first notice that as mentioned earlier the unconditional mean
<span class="math notranslate nohighlight">\(E\left[\ell \left(w_{t}\right)\bigm|q=g\right]\)</span> is <span class="math notranslate nohighlight">\(1\)</span> for
all <span class="math notranslate nohighlight">\(t\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
E\left[\ell \left(w_{t}\right)\bigm|q=g\right]  &amp;=\int\frac{f\left(w_{t}\right)}{g\left(w_{t}\right)}g\left(w_{t}\right)dw_{t} \\
    &amp;=\int f\left(w_{t}\right)dw_{t} \\
    &amp;=1,
\end{aligned}
\end{split}\]</div>
<p>which immediately implies</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
E\left[L\left(w^{1}\right)\bigm|q=g\right]  &amp;=E\left[\ell \left(w_{1}\right)\bigm|q=g\right]\\
    &amp;=1.\\
\end{aligned}
\end{split}\]</div>
<p>Because <span class="math notranslate nohighlight">\(L(w^t) = \ell(w_t) L(w^{t-1})\)</span> and
<span class="math notranslate nohighlight">\(\{w_t\}_{t=1}^t\)</span> is an IID sequence, we have</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
E\left[L\left(w^{t}\right)\bigm|q=g\right]  &amp;=E\left[L\left(w^{t-1}\right)\ell \left(w_{t}\right)\bigm|q=g\right] \\
         &amp;=E\left[L\left(w^{t-1}\right)E\left[\ell \left(w_{t}\right)\bigm|q=g,w^{t-1}\right]\bigm|q=g\right] \\
     &amp;=E\left[L\left(w^{t-1}\right)E\left[\ell \left(w_{t}\right)\bigm|q=g\right]\bigm|q=g\right] \\
    &amp;=E\left[L\left(w^{t-1}\right)\bigm|q=g\right] \\
\end{aligned}
\end{split}\]</div>
<p>for any <span class="math notranslate nohighlight">\(t \geq 1\)</span>.</p>
<p>Mathematical induction implies
<span class="math notranslate nohighlight">\(E\left[L\left(w^{t}\right)\bigm|q=g\right]=1\)</span> for all
<span class="math notranslate nohighlight">\(t \geq 1\)</span>.</p>
</section>
<section id="peculiar-property">
<h2><a class="toc-backref" href="#id9" role="doc-backlink"><span class="section-number">22.4. </span>Peculiar property</a><a class="headerlink" href="#peculiar-property" title="Link to this heading">#</a></h2>
<p>How can <span class="math notranslate nohighlight">\(E\left[L\left(w^{t}\right)\bigm|q=g\right]=1\)</span> possibly be true when most probability mass of the likelihood
ratio process is piling up near <span class="math notranslate nohighlight">\(0\)</span> as
<span class="math notranslate nohighlight">\(t \rightarrow + \infty\)</span>?</p>
<p>The answer is that as <span class="math notranslate nohighlight">\(t \rightarrow + \infty\)</span>, the
distribution of <span class="math notranslate nohighlight">\(L_t\)</span> becomes more and more fat-tailed:
enough mass shifts to larger and larger values of <span class="math notranslate nohighlight">\(L_t\)</span> to make
the mean of <span class="math notranslate nohighlight">\(L_t\)</span> continue to be one despite most of the probability mass piling up
near <span class="math notranslate nohighlight">\(0\)</span>.</p>
<p>To illustrate this peculiar property, we simulate many paths and
calculate the unconditional mean of <span class="math notranslate nohighlight">\(L\left(w^t\right)\)</span> by
averaging across these many paths at each <span class="math notranslate nohighlight">\(t\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">l_arr_g</span><span class="p">,</span> <span class="n">l_seq_g</span> <span class="o">=</span> <span class="n">simulate_sequences</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> 
                <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="p">(</span><span class="n">F_a</span><span class="p">,</span> <span class="n">F_b</span><span class="p">),</span> <span class="p">(</span><span class="n">G_a</span><span class="p">,</span> <span class="n">G_b</span><span class="p">),</span> <span class="n">N</span><span class="o">=</span><span class="mi">50000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>It would be useful to use simulations to verify that unconditional means
<span class="math notranslate nohighlight">\(E\left[L\left(w^{t}\right)\right]\)</span> equal unity by averaging across sample
paths.</p>
<p>But it would be too computer-time-consuming for us to do that here simply by applying a standard Monte Carlo simulation approach.</p>
<p>The reason is that the distribution of <span class="math notranslate nohighlight">\(L\left(w^{t}\right)\)</span> is extremely skewed for large values of <span class="math notranslate nohighlight">\(t\)</span>.</p>
<p>Because the probability density in the right tail is close to <span class="math notranslate nohighlight">\(0\)</span>, it just takes too much computer time to sample enough points from the right tail.</p>
<p>We explain the problem in more detail in <a class="reference internal" href="imp_sample.html"><span class="doc">this lecture</span></a>.</p>
<p>There we describe an alternative way to compute the mean of a likelihood ratio by computing the mean of a <em>different</em> random variable by sampling from a <em>different</em> probability distribution.</p>
</section>
<section id="nature-permanently-draws-from-density-f">
<h2><a class="toc-backref" href="#id10" role="doc-backlink"><span class="section-number">22.5. </span>Nature permanently draws from density f</a><a class="headerlink" href="#nature-permanently-draws-from-density-f" title="Link to this heading">#</a></h2>
<p>Now suppose that before time <span class="math notranslate nohighlight">\(0\)</span> nature permanently decided to draw repeatedly from density <span class="math notranslate nohighlight">\(f\)</span>.</p>
<p>While the mean of the likelihood ratio <span class="math notranslate nohighlight">\(\ell \left(w_{t}\right)\)</span> under density
<span class="math notranslate nohighlight">\(g\)</span> is <span class="math notranslate nohighlight">\(1\)</span>, its mean under the density <span class="math notranslate nohighlight">\(f\)</span> exceeds one.</p>
<p>To see this, we compute</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
E\left[\ell \left(w_{t}\right)\bigm|q=f\right]  &amp;=\int\frac{f\left(w_{t}\right)}{g\left(w_{t}\right)}f\left(w_{t}\right)dw_{t} \\
     &amp;=\int\frac{f\left(w_{t}\right)}{g\left(w_{t}\right)}\frac{f\left(w_{t}\right)}{g\left(w_{t}\right)}g\left(w_{t}\right)dw_{t} \\
     &amp;=\int \ell \left(w_{t}\right)^{2}g\left(w_{t}\right)dw_{t} \\
     &amp;=E\left[\ell \left(w_{t}\right)^{2}\mid q=g\right] \\
     &amp;=E\left[\ell \left(w_{t}\right)\mid q=g\right]^{2}+Var\left(\ell \left(w_{t}\right)\mid q=g\right) \\
     &amp;&gt;E\left[\ell \left(w_{t}\right)\mid q=g\right]^{2} = 1 \\
       \end{aligned}
\end{split}\]</div>
<p>This in turn implies that the unconditional mean of the likelihood ratio process <span class="math notranslate nohighlight">\(L(w^t)\)</span>
diverges toward <span class="math notranslate nohighlight">\(+ \infty\)</span>.</p>
<p>Simulations below confirm this conclusion.</p>
<p>Please note the scale of the <span class="math notranslate nohighlight">\(y\)</span> axis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Simulate when nature draws from f</span>
<span class="n">l_arr_f</span><span class="p">,</span> <span class="n">l_seq_f</span> <span class="o">=</span> <span class="n">simulate_sequences</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> 
                        <span class="p">(</span><span class="n">F_a</span><span class="p">,</span> <span class="n">F_b</span><span class="p">),</span> <span class="p">(</span><span class="n">G_a</span><span class="p">,</span> <span class="n">G_b</span><span class="p">),</span> <span class="n">N</span><span class="o">=</span><span class="mi">50000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">l_arr_f</span><span class="o">.</span><span class="n">shape</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">l_seq_f</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ef11300befd82ade1be95dfa50a25d0c34fc5b7c0e4920a5c733fda4128e2089.png" src="_images/ef11300befd82ade1be95dfa50a25d0c34fc5b7c0e4920a5c733fda4128e2089.png" />
</div>
</div>
<p>We also plot the probability that <span class="math notranslate nohighlight">\(L\left(w^t\right)\)</span> falls into
the interval <span class="math notranslate nohighlight">\([10000, \infty)\)</span> as a function of time and watch how
fast probability mass diverges to <span class="math notranslate nohighlight">\(+\infty\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">l_seq_f</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">N</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b9b9341de21b025146dbce2156ede08b12e3795e042df0d2abfbfba5b3b97d1f.png" src="_images/b9b9341de21b025146dbce2156ede08b12e3795e042df0d2abfbfba5b3b97d1f.png" />
</div>
</div>
</section>
<section id="likelihood-ratio-test">
<h2><a class="toc-backref" href="#id11" role="doc-backlink"><span class="section-number">22.6. </span>Likelihood ratio test</a><a class="headerlink" href="#likelihood-ratio-test" title="Link to this heading">#</a></h2>
<p>We now describe how to employ the machinery
of Neyman and Pearson <span id="id3">[<a class="reference internal" href="zreferences.html#id269" title="J. Neyman and E. S Pearson. On the problem of the most efficient tests of statistical hypotheses. Phil. Trans. R. Soc. Lond. A. 231 (694–706), pages 289–337, 1933.">Neyman and Pearson, 1933</a>]</span> to test the hypothesis that history <span class="math notranslate nohighlight">\(w^t\)</span> is generated by repeated
IID draws from density <span class="math notranslate nohighlight">\(f\)</span>.</p>
<p>Denote <span class="math notranslate nohighlight">\(q\)</span> as the data generating process, so that
<span class="math notranslate nohighlight">\(q=f \text{ or } g\)</span>.</p>
<p>Upon observing a sample <span class="math notranslate nohighlight">\(\{W_i\}_{i=1}^t\)</span>, we want to decide
whether nature is drawing from <span class="math notranslate nohighlight">\(g\)</span> or from <span class="math notranslate nohighlight">\(f\)</span> by performing a (frequentist)
hypothesis test.</p>
<p>We specify</p>
<ul class="simple">
<li><p>Null hypothesis <span class="math notranslate nohighlight">\(H_0\)</span>: <span class="math notranslate nohighlight">\(q=f\)</span>,</p></li>
<li><p>Alternative hypothesis <span class="math notranslate nohighlight">\(H_1\)</span>: <span class="math notranslate nohighlight">\(q=g\)</span>.</p></li>
</ul>
<p>Neyman and Pearson proved that the best way to test this hypothesis is to use a <strong>likelihood ratio test</strong> that takes the
form:</p>
<ul class="simple">
<li><p>accept <span class="math notranslate nohighlight">\(H_0\)</span> if <span class="math notranslate nohighlight">\(L(W^t) &gt; c\)</span>,</p></li>
<li><p>reject <span class="math notranslate nohighlight">\(H_0\)</span> if <span class="math notranslate nohighlight">\(L(W^t) &lt; c\)</span>,</p></li>
</ul>
<p>where <span class="math notranslate nohighlight">\(c\)</span> is a given discrimination threshold.</p>
<p>Setting <span class="math notranslate nohighlight">\(c =1\)</span> is a common choice.</p>
<p>We’ll discuss consequences of other choices of <span class="math notranslate nohighlight">\(c\)</span> below.</p>
<p>This test is <em>best</em> in the sense that it is <strong>uniformly most powerful</strong>.</p>
<p>To understand what this means, we have to define probabilities of two important events that
allow us to characterize a test associated with a given
threshold <span class="math notranslate nohighlight">\(c\)</span>.</p>
<p>The two probabilities are:</p>
<ul>
<li><p>Probability of a Type I error in which we reject <span class="math notranslate nohighlight">\(H_0\)</span> when it is true:</p>
<div class="math notranslate nohighlight">
\[
  \alpha \equiv  \Pr\left\{ L\left(w^{t}\right)&lt;c\mid q=f\right\}
  \]</div>
</li>
<li><p>Probability of a Type II error in which we accept <span class="math notranslate nohighlight">\(H_0\)</span> when it is false:</p>
<div class="math notranslate nohighlight">
\[
  \beta \equiv \Pr\left\{ L\left(w^{t}\right)&gt;c\mid q=g\right\}
  \]</div>
</li>
</ul>
<p>These two probabilities underlie the following two concepts:</p>
<ul>
<li><p>Probability of false alarm (= significance level = probability of
Type I error):</p>
<div class="math notranslate nohighlight">
\[
  \alpha \equiv  \Pr\left\{ L\left(w^{t}\right)&lt;c\mid q=f\right\}
  \]</div>
</li>
<li><p>Probability of detection (= power = 1 minus probability
of Type II error):</p>
<div class="math notranslate nohighlight">
\[
  1-\beta \equiv \Pr\left\{ L\left(w^{t}\right)&lt;c\mid q=g\right\}
  \]</div>
</li>
</ul>
<p>The <a class="reference external" href="https://en.wikipedia.org/wiki/Neyman%E2%80%93Pearson_lemma">Neyman-Pearson
Lemma</a>
states that among all possible tests, a likelihood ratio test
maximizes the probability of detection for a given probability of false
alarm.</p>
<p>Another way to say the same thing is that among all possible tests, a likelihood ratio test
maximizes <strong>power</strong> for a given <strong>significance level</strong>.</p>
<p>We want a small probability of
false alarm and a large probability of detection.</p>
<p>With sample size <span class="math notranslate nohighlight">\(t\)</span> fixed, we can change our two probabilities by
adjusting <span class="math notranslate nohighlight">\(c\)</span>.</p>
<p>A troublesome “that’s life” fact is that these two probabilities move in the same direction as we vary the critical value
<span class="math notranslate nohighlight">\(c\)</span>.</p>
<p>Without specifying quantitative losses from making Type I and Type II errors, there is little that we can say
about how we <em>should</em> trade off probabilities of the two types of mistakes.</p>
<p>We do know that increasing sample size <span class="math notranslate nohighlight">\(t\)</span> improves
statistical inference.</p>
<p>Below we plot some informative figures that illustrate this.</p>
<p>We also present a classical frequentist method for choosing a sample
size <span class="math notranslate nohighlight">\(t\)</span>.</p>
<p>Let’s start with a case in which we fix the threshold <span class="math notranslate nohighlight">\(c\)</span> at
<span class="math notranslate nohighlight">\(1\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<p>Below we plot empirical distributions of logarithms of the cumulative
likelihood ratios simulated above, which are generated by either
<span class="math notranslate nohighlight">\(f\)</span> or <span class="math notranslate nohighlight">\(g\)</span>.</p>
<p>Taking logarithms has no effect on calculating the probabilities because
the log is a monotonic transformation.</p>
<p>As <span class="math notranslate nohighlight">\(t\)</span> increases, the probabilities of making Type I and Type II
errors both decrease, which is good.</p>
<p>This is because most of the probability mass of log<span class="math notranslate nohighlight">\((L(w^t))\)</span>
moves toward <span class="math notranslate nohighlight">\(-\infty\)</span> when <span class="math notranslate nohighlight">\(g\)</span> is the data generating
process, while log<span class="math notranslate nohighlight">\((L(w^t))\)</span> goes to
<span class="math notranslate nohighlight">\(\infty\)</span> when data are generated by <span class="math notranslate nohighlight">\(f\)</span>.</p>
<p>That disparate behavior of log<span class="math notranslate nohighlight">\((L(w^t))\)</span> under <span class="math notranslate nohighlight">\(f\)</span> and <span class="math notranslate nohighlight">\(g\)</span>
is what makes it possible eventually to distinguish
<span class="math notranslate nohighlight">\(q=f\)</span> from <span class="math notranslate nohighlight">\(q=g\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_log_histograms</span><span class="p">(</span><span class="n">l_seq_f</span><span class="p">,</span> <span class="n">l_seq_g</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">time_points</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">21</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot log likelihood ratio histograms.&quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">time_points</span><span class="p">):</span>
        <span class="n">nr</span><span class="p">,</span> <span class="n">nc</span> <span class="o">=</span> <span class="n">i</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span>
        
        <span class="n">axs</span><span class="p">[</span><span class="n">nr</span><span class="p">,</span> <span class="n">nc</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
        
        <span class="n">hist_f</span><span class="p">,</span> <span class="n">x_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">l_seq_f</span><span class="p">[:,</span> <span class="n">t</span><span class="p">]),</span> <span class="mi">200</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">hist_g</span><span class="p">,</span> <span class="n">x_g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">l_seq_g</span><span class="p">[:,</span> <span class="n">t</span><span class="p">]),</span> <span class="mi">200</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="n">axs</span><span class="p">[</span><span class="n">nr</span><span class="p">,</span> <span class="n">nc</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_f</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">hist_f</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;dist under f&quot;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">nr</span><span class="p">,</span> <span class="n">nc</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_g</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">hist_g</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;dist under g&quot;</span><span class="p">)</span>
        
        <span class="c1"># Fill error regions</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">hist</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">([</span><span class="n">x_f</span><span class="p">,</span> <span class="n">x_g</span><span class="p">],</span> <span class="p">[</span><span class="n">hist_f</span><span class="p">,</span> <span class="n">hist_g</span><span class="p">],</span> 
            <span class="p">[</span><span class="s2">&quot;Type I error&quot;</span><span class="p">,</span> <span class="s2">&quot;Type II error&quot;</span><span class="p">])):</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">nr</span><span class="p">,</span> <span class="n">nc</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:][</span><span class="n">ind</span><span class="p">],</span> <span class="n">hist</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> 
                                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
        
        <span class="n">axs</span><span class="p">[</span><span class="n">nr</span><span class="p">,</span> <span class="n">nc</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">nr</span><span class="p">,</span> <span class="n">nc</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;t=</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plot_log_histograms</span><span class="p">(</span><span class="n">l_seq_f</span><span class="p">,</span> <span class="n">l_seq_g</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/01f5bf79000e39d8176cf142eceeb02cac3da0e9e7f0bb8f3e47bfe32e41d7b8.png" src="_images/01f5bf79000e39d8176cf142eceeb02cac3da0e9e7f0bb8f3e47bfe32e41d7b8.png" />
</div>
</div>
<p>In the above graphs,</p>
<ul class="simple">
<li><p>the blue areas are related to but not equal to probabilities <span class="math notranslate nohighlight">\(\alpha \)</span> of a type I error because
they are integrals of <span class="math notranslate nohighlight">\(\log L_t\)</span>, not integrals of <span class="math notranslate nohighlight">\(L_t\)</span>, over rejection region <span class="math notranslate nohighlight">\(L_t &lt; 1\)</span></p></li>
<li><p>the orange areas are related to but not equal to probabilities <span class="math notranslate nohighlight">\(\beta \)</span> of a type II error because
they are integrals of <span class="math notranslate nohighlight">\(\log L_t\)</span>, not integrals of <span class="math notranslate nohighlight">\(L_t\)</span>, over acceptance region <span class="math notranslate nohighlight">\(L_t &gt; 1\)</span></p></li>
</ul>
<p>When we hold <span class="math notranslate nohighlight">\(c\)</span> fixed at <span class="math notranslate nohighlight">\(c=1\)</span>, the following graph shows that</p>
<ul class="simple">
<li><p>the probability of detection monotonically increases with increases in
<span class="math notranslate nohighlight">\(t\)</span></p></li>
<li><p>the probability of a false alarm monotonically decreases with increases in <span class="math notranslate nohighlight">\(t\)</span>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">compute_error_probabilities</span><span class="p">(</span><span class="n">l_seq_f</span><span class="p">,</span> <span class="n">l_seq_g</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute Type I and Type II error probabilities.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">N</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">l_seq_f</span><span class="o">.</span><span class="n">shape</span>
    
    <span class="c1"># Type I error (false alarm) - reject H0 when true</span>
    <span class="n">PFA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">l_seq_f</span><span class="p">[:,</span> <span class="n">t</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="n">N</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">)])</span>
    
    <span class="c1"># Type II error - accept H0 when false</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">l_seq_g</span><span class="p">[:,</span> <span class="n">t</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="n">N</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">)])</span>
    
    <span class="c1"># Probability of detection (power)</span>
    <span class="n">PD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">l_seq_g</span><span class="p">[:,</span> <span class="n">t</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="n">N</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">)])</span>
    
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">PFA</span><span class="p">,</span>
        <span class="s1">&#39;beta&#39;</span><span class="p">:</span> <span class="n">beta</span><span class="p">,</span> 
        <span class="s1">&#39;PD&#39;</span><span class="p">:</span> <span class="n">PD</span><span class="p">,</span>
        <span class="s1">&#39;PFA&#39;</span><span class="p">:</span> <span class="n">PFA</span>
    <span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">plot_error_probabilities</span><span class="p">(</span><span class="n">error_dict</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">title_suffix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot error probabilities over time.&quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="n">error_dict</span><span class="p">[</span><span class="s1">&#39;PD&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Probability of detection&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="n">error_dict</span><span class="p">[</span><span class="s1">&#39;PFA&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Probability of false alarm&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Probability&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error Probabilities (c=</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">)</span><span class="si">{</span><span class="n">title_suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">error_probs</span> <span class="o">=</span> <span class="n">compute_error_probabilities</span><span class="p">(</span><span class="n">l_seq_f</span><span class="p">,</span> <span class="n">l_seq_g</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
<span class="n">N</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">l_seq_f</span><span class="o">.</span><span class="n">shape</span>
<span class="n">plot_error_probabilities</span><span class="p">(</span><span class="n">error_probs</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/47d77d0aed6dfa171e3531e3bdfe34e791f3a8b0682d5d063c61e58738184cc0.png" src="_images/47d77d0aed6dfa171e3531e3bdfe34e791f3a8b0682d5d063c61e58738184cc0.png" />
</div>
</div>
<p>For a given sample size <span class="math notranslate nohighlight">\(t\)</span>, the threshold <span class="math notranslate nohighlight">\(c\)</span> uniquely pins down probabilities
of both types of error.</p>
<p>If for a fixed <span class="math notranslate nohighlight">\(t\)</span> we now free up and move <span class="math notranslate nohighlight">\(c\)</span>, we will sweep out the probability
of detection as a function of the probability of false alarm.</p>
<p>This produces a <a class="reference external" href="https://en.wikipedia.org/wiki/Receiver_operating_characteristic">receiver operating characteristic
curve (ROC curve)</a>.</p>
<p>Below, we plot receiver operating characteristic curves for different
sample sizes <span class="math notranslate nohighlight">\(t\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_roc_curves</span><span class="p">(</span><span class="n">l_seq_f</span><span class="p">,</span> <span class="n">l_seq_g</span><span class="p">,</span> <span class="n">t_values</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">13</span><span class="p">],</span> <span class="n">N</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot ROC curves for different sample sizes.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">N</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">l_seq_f</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="n">PFA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_values</span><span class="p">:</span>
        <span class="n">percentile</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">l_seq_f</span><span class="p">[:,</span> <span class="n">t</span><span class="p">],</span> <span class="n">PFA</span><span class="p">)</span>
        <span class="n">PD</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">l_seq_g</span><span class="p">[:,</span> <span class="n">t</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="n">N</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">percentile</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">PFA</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span> <span class="n">PD</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;t=</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;perfect detection&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;random detection&quot;</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.03</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="s2">&quot;better&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Probability of false alarm&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Probability of detection&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;ROC Curve&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="n">plot_roc_curves</span><span class="p">(</span><span class="n">l_seq_f</span><span class="p">,</span> <span class="n">l_seq_g</span><span class="p">,</span> <span class="n">t_values</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/63e7890e873cc46f5fa743ac0a94a3a10421cdf09203ff427c6cef04fa824409.png" src="_images/63e7890e873cc46f5fa743ac0a94a3a10421cdf09203ff427c6cef04fa824409.png" />
</div>
</div>
<p>Notice that as <span class="math notranslate nohighlight">\(t\)</span> increases, we are assured a larger probability
of detection and a smaller probability of false alarm associated with
a given discrimination threshold <span class="math notranslate nohighlight">\(c\)</span>.</p>
<p>For a given sample size <span class="math notranslate nohighlight">\(t\)</span>, both <span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(\beta\)</span> change as we vary <span class="math notranslate nohighlight">\(c\)</span>.</p>
<p>As we increase <span class="math notranslate nohighlight">\(c\)</span></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\alpha \equiv  \Pr\left\{ L\left(w^{t}\right)&lt;c\mid q=f\right\}\)</span> increases</p></li>
<li><p><span class="math notranslate nohighlight">\(\beta \equiv \Pr\left\{ L\left(w^{t}\right)&gt;c\mid q=g\right\}\)</span> decreases</p></li>
</ul>
<p>As <span class="math notranslate nohighlight">\(t \rightarrow + \infty\)</span>, we approach the perfect detection
curve that is indicated by a right angle hinging on the blue dot.</p>
<p>For a given sample size <span class="math notranslate nohighlight">\(t\)</span>, the discrimination threshold <span class="math notranslate nohighlight">\(c\)</span> determines a point on the receiver operating
characteristic curve.</p>
<p>It is up to the test designer to trade off probabilities of
making the two types of errors.</p>
<p>But we know how to choose the smallest sample size to achieve given targets for
the probabilities.</p>
<p>Typically, frequentists aim for a high probability of detection that
respects an upper bound on the probability of false alarm.</p>
<p>Below we show an example in which we fix the probability of false alarm at
<span class="math notranslate nohighlight">\(0.05\)</span>.</p>
<p>The required sample size for making a decision is then determined by a
target probability of detection, for example, <span class="math notranslate nohighlight">\(0.9\)</span>, as depicted in the following graph.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PFA</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">PD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>

<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>

    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">l_seq_f</span><span class="p">[:,</span> <span class="n">t</span><span class="p">],</span> <span class="n">PFA</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">PD</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">l_seq_g</span><span class="p">[:,</span> <span class="n">t</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="n">N</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="n">PD</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Probability of detection&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Probability of false alarm=</span><span class="si">{</span><span class="n">PFA</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/02b1ed0725ecb494a378ae69cd8cb58fbb35eedfa0339e8a9e2da56a0e954433.png" src="_images/02b1ed0725ecb494a378ae69cd8cb58fbb35eedfa0339e8a9e2da56a0e954433.png" />
</div>
</div>
<p>The United States Navy evidently used a procedure like this to select a sample size <span class="math notranslate nohighlight">\(t\)</span> for doing quality
control tests during World War II.</p>
<p>A Navy Captain who had been ordered to perform tests of this kind had doubts about it that he
presented to Milton Friedman, as we describe in <a class="reference internal" href="wald_friedman.html"><span class="doc">this lecture</span></a>.</p>
<section id="a-third-distribution-h">
<span id="llr-h"></span><h3><span class="section-number">22.6.1. </span>A third distribution <span class="math notranslate nohighlight">\(h\)</span><a class="headerlink" href="#a-third-distribution-h" title="Link to this heading">#</a></h3>
<p>Now let’s consider a case in which neither <span class="math notranslate nohighlight">\(g\)</span> nor <span class="math notranslate nohighlight">\(f\)</span>
generates the data.</p>
<p>Instead, a third distribution <span class="math notranslate nohighlight">\(h\)</span> does.</p>
<p>Let’s study how accumulated likelihood ratios <span class="math notranslate nohighlight">\(L\)</span> behave
when <span class="math notranslate nohighlight">\(h\)</span> governs the data.</p>
<p>A key tool here is called <strong>Kullback–Leibler divergence</strong> we studied in <a class="reference internal" href="divergence_measures.html"><span class="doc">Statistical Divergence Measures</span></a>.</p>
<p>In our application, we want to measure how much <span class="math notranslate nohighlight">\(f\)</span> or <span class="math notranslate nohighlight">\(g\)</span>
diverges from <span class="math notranslate nohighlight">\(h\)</span></p>
<p>Two Kullback–Leibler divergences pertinent for us are <span class="math notranslate nohighlight">\(K_f\)</span>
and <span class="math notranslate nohighlight">\(K_g\)</span> defined as</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
K_{f} = D_{KL}\bigl(h\|f\bigr) = KL(h, f)
          &amp;= E_{h}\left[\log\frac{h(w)}{f(w)}\right] \\
          &amp;= \int \log\left(\frac{h(w)}{f(w)}\right)h(w)dw .
\end{aligned}
\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
K_{g} = D_{KL}\bigl(h\|g\bigr) = KL(h, g)
          &amp;= E_{h}\left[\log\frac{h(w)}{g(w)}\right] \\
          &amp;= \int \log\left(\frac{h(w)}{g(w)}\right)h(w)dw .
\end{aligned}
\end{split}\]</div>
<p>Let’s compute the Kullback–Leibler discrepancies using the same code in <a class="reference internal" href="divergence_measures.html"><span class="doc">Statistical Divergence Measures</span></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">compute_KL</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute KL divergence KL(f, g)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">integrand</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">w</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">/</span> <span class="n">g</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
    <span class="n">val</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span><span class="n">integrand</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="mf">1e-5</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">val</span>

<span class="k">def</span><span class="w"> </span><span class="nf">compute_KL_h</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute KL divergences with respect to reference distribution h</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Kf</span> <span class="o">=</span> <span class="n">compute_KL</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="n">Kg</span> <span class="o">=</span> <span class="n">compute_KL</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Kf</span><span class="p">,</span> <span class="n">Kg</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="a-helpful-formula">
<span id="kl-link"></span><h3><span class="section-number">22.6.2. </span>A helpful formula<a class="headerlink" href="#a-helpful-formula" title="Link to this heading">#</a></h3>
<p>There is a mathematical relationship between likelihood ratios and KL divergence.</p>
<p>When data is generated by distribution <span class="math notranslate nohighlight">\(h\)</span>, the expected log likelihood ratio is:</p>
<div class="math notranslate nohighlight" id="equation-eq-kl-likelihood-link">
<span class="eqno">(22.1)<a class="headerlink" href="#equation-eq-kl-likelihood-link" title="Link to this equation">#</a></span>\[
\frac{1}{t} E_{h}\!\bigl[\log L_t\bigr] = K_g - K_f
\]</div>
<p>where <span class="math notranslate nohighlight">\(L_t=\prod_{j=1}^{t}\frac{f(w_j)}{g(w_j)}\)</span> is the likelihood ratio process.</p>
<p>Equation <a class="reference internal" href="#equation-eq-kl-likelihood-link">(22.1)</a> tells us that:</p>
<ul class="simple">
<li><p>When <span class="math notranslate nohighlight">\(K_g &lt; K_f\)</span> (i.e., <span class="math notranslate nohighlight">\(g\)</span> is closer to <span class="math notranslate nohighlight">\(h\)</span> than <span class="math notranslate nohighlight">\(f\)</span> is), the expected log likelihood ratio is negative, so <span class="math notranslate nohighlight">\(L\left(w^t\right) \rightarrow 0\)</span>.</p></li>
<li><p>When <span class="math notranslate nohighlight">\(K_g &gt; K_f\)</span> (i.e., <span class="math notranslate nohighlight">\(f\)</span> is closer to <span class="math notranslate nohighlight">\(h\)</span> than <span class="math notranslate nohighlight">\(g\)</span> is), the expected log likelihood ratio is positive, so <span class="math notranslate nohighlight">\(L\left(w^t\right) \rightarrow + \infty\)</span>.</p></li>
</ul>
<p>Let’s verify this using simulation.</p>
<p>In the simulation, we generate multiple paths using Beta distributions <span class="math notranslate nohighlight">\(f\)</span>, <span class="math notranslate nohighlight">\(g\)</span>, and <span class="math notranslate nohighlight">\(h\)</span>, and compute the paths of <span class="math notranslate nohighlight">\(\log(L(w^t))\)</span>.</p>
<p>First, we write a function to compute the likelihood ratio process</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">compute_likelihood_ratios</span><span class="p">(</span><span class="n">sequences</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute likelihood ratios and cumulative products.&quot;&quot;&quot;</span>
    <span class="n">l_ratios</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">sequences</span><span class="p">)</span> <span class="o">/</span> <span class="n">g</span><span class="p">(</span><span class="n">sequences</span><span class="p">)</span>
    <span class="n">L_cumulative</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumprod</span><span class="p">(</span><span class="n">l_ratios</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">l_ratios</span><span class="p">,</span> <span class="n">L_cumulative</span>
</pre></div>
</div>
</div>
</div>
<p>We consider three cases: (1) <span class="math notranslate nohighlight">\(h\)</span> is closer to <span class="math notranslate nohighlight">\(f\)</span>, (2) <span class="math notranslate nohighlight">\(f\)</span> and <span class="math notranslate nohighlight">\(g\)</span> are approximately equidistant from <span class="math notranslate nohighlight">\(h\)</span>, and (3) <span class="math notranslate nohighlight">\(h\)</span> is closer to <span class="math notranslate nohighlight">\(g\)</span>.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define test scenarios</span>
<span class="n">scenarios</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;KL(h,g) &gt; KL(h,f)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;h_params&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">),</span>
        <span class="s2">&quot;expected&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$L_t \to \infty$&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;KL(h,g) ≈ KL(h,f)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;h_params&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.35</span><span class="p">),</span>
        <span class="s2">&quot;expected&quot;</span><span class="p">:</span> <span class="s2">&quot;$L_t$ fluctuates&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;KL(h,g) &lt; KL(h,f)&quot;</span><span class="p">,</span> 
        <span class="s2">&quot;h_params&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">3.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span>
        <span class="s2">&quot;expected&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$L_t \to 0$&quot;</span>
    <span class="p">}</span>
<span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">scenarios</span><span class="p">):</span>
    <span class="c1"># Define h</span>
    <span class="n">h</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">scenario</span><span class="p">[</span><span class="s2">&quot;h_params&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> 
                    <span class="n">scenario</span><span class="p">[</span><span class="s2">&quot;h_params&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    
    <span class="c1"># Compute KL divergences</span>
    <span class="n">Kf</span><span class="p">,</span> <span class="n">Kg</span> <span class="o">=</span> <span class="n">compute_KL_h</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
    <span class="n">kl_diff</span> <span class="o">=</span> <span class="n">Kg</span> <span class="o">-</span> <span class="n">Kf</span>
    
    <span class="c1"># Simulate paths</span>
    <span class="n">N_paths</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">T</span> <span class="o">=</span> <span class="mi">150</span>

    <span class="c1"># Generate data from h</span>
    <span class="n">h_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">scenario</span><span class="p">[</span><span class="s2">&quot;h_params&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> 
                <span class="n">scenario</span><span class="p">[</span><span class="s2">&quot;h_params&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">N_paths</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>
    <span class="n">l_ratios</span><span class="p">,</span> <span class="n">l_cumulative</span> <span class="o">=</span> <span class="n">compute_likelihood_ratios</span><span class="p">(</span><span class="n">h_data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
    <span class="n">log_l_cumulative</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">l_cumulative</span><span class="p">)</span>
    
    <span class="c1"># Plot distributions</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
    <span class="n">x_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.999</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_range</span><span class="p">,</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">x_range</span><span class="p">],</span> 
        <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_range</span><span class="p">,</span> <span class="p">[</span><span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">x_range</span><span class="p">],</span> 
        <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_range</span><span class="p">,</span> <span class="p">[</span><span class="n">h</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">x_range</span><span class="p">],</span> 
        <span class="s1">&#39;g--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;h (data)&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;density&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">scenario</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    
    <span class="c1"># Plot log likelihood ratio paths</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">N_paths</span><span class="p">)):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">log_l_cumulative</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">)</span>
    
    <span class="c1"># Plot theoretical expectation</span>
    <span class="n">theory_line</span> <span class="o">=</span> <span class="n">kl_diff</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">theory_line</span><span class="p">,</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$t \times (K_g - K_f)$&#39;</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$log L_t$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;KL(h,f)=</span><span class="si">{</span><span class="n">Kf</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">, KL(h,g)=</span><span class="si">{</span><span class="n">Kg</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">scenario</span><span class="p">[</span><span class="s2">&quot;expected&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> 
                 <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/4560c1332b4fd5676af38372180dc335fba042fa826e4d46cf065e1da0732458.png" src="_images/4560c1332b4fd5676af38372180dc335fba042fa826e4d46cf065e1da0732458.png" />
</div>
</div>
<p>Note that</p>
<ul class="simple">
<li><p>In the first figure, <span class="math notranslate nohighlight">\(\log L(w^t)\)</span> diverges to <span class="math notranslate nohighlight">\(\infty\)</span> because <span class="math notranslate nohighlight">\(K_g &gt; K_f\)</span>.</p></li>
<li><p>In the second figure, we still have <span class="math notranslate nohighlight">\(K_g &gt; K_f\)</span>, but the difference is smaller, so <span class="math notranslate nohighlight">\(L(w^t)\)</span> diverges to infinity at a slower pace.</p></li>
<li><p>In the last figure, <span class="math notranslate nohighlight">\(\log L(w^t)\)</span> diverges to <span class="math notranslate nohighlight">\(-\infty\)</span> because <span class="math notranslate nohighlight">\(K_g &lt; K_f\)</span>.</p></li>
<li><p>The black dotted line, <span class="math notranslate nohighlight">\(t \left(D_{KL}(h\|g) - D_{KL}(h\|f)\right)\)</span>, closely fits the paths verifying <a class="reference internal" href="#equation-eq-kl-likelihood-link">(22.1)</a>.</p></li>
</ul>
<p>These observations align with the theory.</p>
<p>In <a class="reference internal" href="likelihood_ratio_process_2.html"><span class="doc">Heterogeneous Beliefs and Financial Markets</span></a>, we will see an application of these ideas.</p>
</section>
</section>
<section id="hypothesis-testing-and-classification">
<h2><a class="toc-backref" href="#id12" role="doc-backlink"><span class="section-number">22.7. </span>Hypothesis testing and classification</a><a class="headerlink" href="#hypothesis-testing-and-classification" title="Link to this heading">#</a></h2>
<p>This section discusses another application of likelihood ratio processes.</p>
<p>We describe how a statistician can combine frequentist probabilities of type I and type II errors in order to</p>
<ul class="simple">
<li><p>compute an anticipated frequency of  selecting a wrong model based on a sample length <span class="math notranslate nohighlight">\(T\)</span></p></li>
<li><p>compute an anticipated error  rate in a classification problem</p></li>
</ul>
<p>We consider a situation in which  nature generates data by mixing known densities <span class="math notranslate nohighlight">\(f\)</span> and <span class="math notranslate nohighlight">\(g\)</span> with known mixing
parameter <span class="math notranslate nohighlight">\(\pi_{-1} \in (0,1)\)</span> so that the random variable <span class="math notranslate nohighlight">\(w\)</span> is drawn from the density</p>
<div class="math notranslate nohighlight">
\[
h (w) = \pi_{-1} f(w) + (1-\pi_{-1}) g(w) 
\]</div>
<p>We assume that the statistician knows the densities <span class="math notranslate nohighlight">\(f\)</span> and <span class="math notranslate nohighlight">\(g\)</span> and also the mixing parameter <span class="math notranslate nohighlight">\(\pi_{-1}\)</span>.</p>
<p>Below, we’ll  set <span class="math notranslate nohighlight">\(\pi_{-1} = .5\)</span>, although much of the analysis would follow through with other settings of <span class="math notranslate nohighlight">\(\pi_{-1} \in (0,1)\)</span>.</p>
<p>We assume that <span class="math notranslate nohighlight">\(f\)</span> and <span class="math notranslate nohighlight">\(g\)</span> both put positive probabilities on the same intervals of possible realizations of the random variable <span class="math notranslate nohighlight">\(W\)</span>.</p>
<p>In the simulations below, we specify that <span class="math notranslate nohighlight">\(f\)</span> is a <span class="math notranslate nohighlight">\(\text{Beta}(1, 1)\)</span> distribution and that <span class="math notranslate nohighlight">\(g\)</span> is <span class="math notranslate nohighlight">\(\text{Beta}(3, 1.2)\)</span> distribution.</p>
<p>We consider two alternative timing protocols.</p>
<ul class="simple">
<li><p>Timing protocol 1 is for   the model selection problem</p></li>
<li><p>Timing protocol 2 is for the individual classification problem</p></li>
</ul>
<p><strong>Timing Protocol 1:</strong>  Nature flips a coin only <strong>once</strong> at time <span class="math notranslate nohighlight">\(t=-1\)</span> and with probability <span class="math notranslate nohighlight">\(\pi_{-1}\)</span>  generates a sequence  <span class="math notranslate nohighlight">\(\{w_t\}_{t=1}^T\)</span>
of  IID  draws from  <span class="math notranslate nohighlight">\(f\)</span>  and with probability <span class="math notranslate nohighlight">\(1-\pi_{-1}\)</span> generates a sequence  <span class="math notranslate nohighlight">\(\{w_t\}_{t=1}^T\)</span>
of  IID  draws from  <span class="math notranslate nohighlight">\(g\)</span>.</p>
<p><strong>Timing Protocol 2.</strong> Nature flips a coin <strong>often</strong>.  At each time <span class="math notranslate nohighlight">\(t \geq 0\)</span>, nature flips a coin and with probability <span class="math notranslate nohighlight">\(\pi_{-1}\)</span> draws <span class="math notranslate nohighlight">\(w_t\)</span> from <span class="math notranslate nohighlight">\(f\)</span> and with probability <span class="math notranslate nohighlight">\(1-\pi_{-1}\)</span> draws <span class="math notranslate nohighlight">\(w_t\)</span> from <span class="math notranslate nohighlight">\(g\)</span>.</p>
<p>Here is  Python code that we’ll use to implement timing protocol 1 and 2</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">protocol_1</span><span class="p">(</span><span class="n">π_minus_1</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">F_params</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">G_params</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simulate Protocol 1: Nature decides once at t=-1 which model to use.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">F_a</span><span class="p">,</span> <span class="n">F_b</span> <span class="o">=</span> <span class="n">F_params</span>
    <span class="n">G_a</span><span class="p">,</span> <span class="n">G_b</span> <span class="o">=</span> <span class="n">G_params</span>
    
    <span class="c1"># Single coin flip for the true model</span>
    <span class="n">true_models_F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">π_minus_1</span>
    <span class="n">sequences</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>
    
    <span class="n">n_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">true_models_F</span><span class="p">)</span>
    <span class="n">n_g</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">n_f</span>
    
    <span class="k">if</span> <span class="n">n_f</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">sequences</span><span class="p">[</span><span class="n">true_models_F</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">F_a</span><span class="p">,</span> <span class="n">F_b</span><span class="p">,</span> <span class="p">(</span><span class="n">n_f</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">n_g</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">sequences</span><span class="p">[</span><span class="o">~</span><span class="n">true_models_F</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">G_a</span><span class="p">,</span> <span class="n">G_b</span><span class="p">,</span> <span class="p">(</span><span class="n">n_g</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">sequences</span><span class="p">,</span> <span class="n">true_models_F</span>

<span class="k">def</span><span class="w"> </span><span class="nf">protocol_2</span><span class="p">(</span><span class="n">π_minus_1</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">F_params</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">G_params</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simulate Protocol 2: Nature decides at each time step which model to use.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">F_a</span><span class="p">,</span> <span class="n">F_b</span> <span class="o">=</span> <span class="n">F_params</span>
    <span class="n">G_a</span><span class="p">,</span> <span class="n">G_b</span> <span class="o">=</span> <span class="n">G_params</span>
    
    <span class="c1"># Coin flips for each time step</span>
    <span class="n">true_models_F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">π_minus_1</span>
    <span class="n">sequences</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>
    
    <span class="n">n_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">true_models_F</span><span class="p">)</span>
    <span class="n">n_g</span> <span class="o">=</span> <span class="n">N</span> <span class="o">*</span> <span class="n">T</span> <span class="o">-</span> <span class="n">n_f</span>
    
    <span class="k">if</span> <span class="n">n_f</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">sequences</span><span class="p">[</span><span class="n">true_models_F</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">F_a</span><span class="p">,</span> <span class="n">F_b</span><span class="p">,</span> <span class="n">n_f</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n_g</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">sequences</span><span class="p">[</span><span class="o">~</span><span class="n">true_models_F</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">G_a</span><span class="p">,</span> <span class="n">G_b</span><span class="p">,</span> <span class="n">n_g</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">sequences</span><span class="p">,</span> <span class="n">true_models_F</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Remark:</strong> Under timing protocol 2, the <span class="math notranslate nohighlight">\(\{w_t\}_{t=1}^T\)</span> is a sequence of IID draws from <span class="math notranslate nohighlight">\(h(w)\)</span>. Under timing protocol 1, the <span class="math notranslate nohighlight">\(\{w_t\}_{t=1}^T\)</span> is
not IID. It is <strong>conditionally IID</strong> – meaning that with probability <span class="math notranslate nohighlight">\(\pi_{-1}\)</span> it is a sequence of IID draws from <span class="math notranslate nohighlight">\(f(w)\)</span> and with probability <span class="math notranslate nohighlight">\(1-\pi_{-1}\)</span> it is a sequence of IID draws from <span class="math notranslate nohighlight">\(g(w)\)</span>. For more about this, see <a class="reference internal" href="exchangeable.html"><span class="doc">this lecture about exchangeability</span></a>.</p>
<p>We again deploy a <strong>likelihood ratio process</strong> with time <span class="math notranslate nohighlight">\(t\)</span> component being the likelihood ratio</p>
<div class="math notranslate nohighlight">
\[
\ell (w_t)=\frac{f\left(w_t\right)}{g\left(w_t\right)},\quad t\geq1.
\]</div>
<p>The <strong>likelihood ratio process</strong> for sequence <span class="math notranslate nohighlight">\(\left\{ w_{t}\right\} _{t=1}^{\infty}\)</span> is</p>
<div class="math notranslate nohighlight">
\[
L\left(w^{t}\right)=\prod_{i=1}^{t} \ell (w_i),
\]</div>
<p>For shorthand we’ll write <span class="math notranslate nohighlight">\(L_t =  L(w^t)\)</span>.</p>
<section id="model-selection-mistake-probability">
<h3><span class="section-number">22.7.1. </span>Model selection mistake probability<a class="headerlink" href="#model-selection-mistake-probability" title="Link to this heading">#</a></h3>
<p>We first study  a problem that assumes  timing protocol 1.</p>
<p>Consider a decision maker who wants to know whether model <span class="math notranslate nohighlight">\(f\)</span> or model <span class="math notranslate nohighlight">\(g\)</span> governs a data set of length <span class="math notranslate nohighlight">\(T\)</span> observations.</p>
<p>The decision makers has observed a sequence <span class="math notranslate nohighlight">\(\{w_t\}_{t=1}^T\)</span>.</p>
<p>On the basis of that observed  sequence, a likelihood ratio test selects model <span class="math notranslate nohighlight">\(f\)</span> when
<span class="math notranslate nohighlight">\(L_T \geq 1 \)</span> and model <span class="math notranslate nohighlight">\(g\)</span> when  <span class="math notranslate nohighlight">\(L_T &lt; 1\)</span>.</p>
<p>When model <span class="math notranslate nohighlight">\(f\)</span> generates the data, the probability that the likelihood ratio test selects the wrong model is</p>
<div class="math notranslate nohighlight">
\[ 
p_f = {\rm Prob}\left(L_T &lt; 1\Big| f\right) = \alpha_T .
\]</div>
<p>When model <span class="math notranslate nohighlight">\(g\)</span> generates the data, the probability that the likelihood ratio test selects the wrong model is</p>
<div class="math notranslate nohighlight">
\[ 
p_g = {\rm Prob}\left(L_T \geq 1 \Big|g \right) = \beta_T.
\]</div>
<p>We can construct a probability that the likelihood ratio selects the wrong model by assigning a Bayesian prior probability of <span class="math notranslate nohighlight">\(\pi_{-1} = .5\)</span> that nature selects model <span class="math notranslate nohighlight">\(f\)</span> then  averaging <span class="math notranslate nohighlight">\(p_f\)</span> and <span class="math notranslate nohighlight">\(p_g\)</span> to form the Bayesian posterior probability of a detection error equal to</p>
<div class="math notranslate nohighlight" id="equation-eq-detectionerrorprob">
<span class="eqno">(22.2)<a class="headerlink" href="#equation-eq-detectionerrorprob" title="Link to this equation">#</a></span>\[ 
p(\textrm{wrong decision}) = {1 \over 2} (\alpha_T + \beta_T) .
\]</div>
<p>Now let’s simulate timing protocol 1 and compute the error probabilities</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">compute_protocol_1_errors</span><span class="p">(</span><span class="n">π_minus_1</span><span class="p">,</span> <span class="n">T_max</span><span class="p">,</span> <span class="n">N_simulations</span><span class="p">,</span> <span class="n">f_func</span><span class="p">,</span> <span class="n">g_func</span><span class="p">,</span> 
                              <span class="n">F_params</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">G_params</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute error probabilities for Protocol 1.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sequences</span><span class="p">,</span> <span class="n">true_models</span> <span class="o">=</span> <span class="n">protocol_1</span><span class="p">(</span>
        <span class="n">π_minus_1</span><span class="p">,</span> <span class="n">T_max</span><span class="p">,</span> <span class="n">N_simulations</span><span class="p">,</span> <span class="n">F_params</span><span class="p">,</span> <span class="n">G_params</span><span class="p">)</span>
    <span class="n">l_ratios</span><span class="p">,</span> <span class="n">L_cumulative</span> <span class="o">=</span> <span class="n">compute_likelihood_ratios</span><span class="p">(</span><span class="n">sequences</span><span class="p">,</span> 
                                    <span class="n">f_func</span><span class="p">,</span> <span class="n">g_func</span><span class="p">)</span>
    
    <span class="n">T_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="n">mask_f</span> <span class="o">=</span> <span class="n">true_models</span>
    <span class="n">mask_g</span> <span class="o">=</span> <span class="o">~</span><span class="n">true_models</span>
    
    <span class="n">L_f</span> <span class="o">=</span> <span class="n">L_cumulative</span><span class="p">[</span><span class="n">mask_f</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">L_g</span> <span class="o">=</span> <span class="n">L_cumulative</span><span class="p">[</span><span class="n">mask_g</span><span class="p">,</span> <span class="p">:]</span>
    
    <span class="n">α_T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">L_f</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">β_T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">L_g</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">error_prob</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">α_T</span> <span class="o">+</span> <span class="n">β_T</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;T_range&#39;</span><span class="p">:</span> <span class="n">T_range</span><span class="p">,</span>
        <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">α_T</span><span class="p">,</span>
        <span class="s1">&#39;beta&#39;</span><span class="p">:</span> <span class="n">β_T</span><span class="p">,</span> 
        <span class="s1">&#39;error_prob&#39;</span><span class="p">:</span> <span class="n">error_prob</span><span class="p">,</span>
        <span class="s1">&#39;L_cumulative&#39;</span><span class="p">:</span> <span class="n">L_cumulative</span><span class="p">,</span>
        <span class="s1">&#39;true_models&#39;</span><span class="p">:</span> <span class="n">true_models</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>The following code visualizes the error probabilities for timing protocol 1</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">analyze_protocol_1</span><span class="p">(</span><span class="n">π_minus_1</span><span class="p">,</span> <span class="n">T_max</span><span class="p">,</span> <span class="n">N_simulations</span><span class="p">,</span> <span class="n">f_func</span><span class="p">,</span> <span class="n">g_func</span><span class="p">,</span> 
                      <span class="n">F_params</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">G_params</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyze Protocol 1&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">compute_protocol_1_errors</span><span class="p">(</span><span class="n">π_minus_1</span><span class="p">,</span> <span class="n">T_max</span><span class="p">,</span> <span class="n">N_simulations</span><span class="p">,</span> 
                                      <span class="n">f_func</span><span class="p">,</span> <span class="n">g_func</span><span class="p">,</span> <span class="n">F_params</span><span class="p">,</span> <span class="n">G_params</span><span class="p">)</span>
    
    <span class="c1"># Plot results</span>
    <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;T_range&#39;</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> 
             <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\alpha_T$&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;T_range&#39;</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">],</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> 
             <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\beta_T$&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$T$&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;error probability&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;T_range&#39;</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;error_prob&#39;</span><span class="p">],</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> 
             <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\frac</span><span class="si">{1}{2}</span><span class="s1">(\alpha_T+\beta_T)$&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$T$&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;error probability&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="c1"># Print summary</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;At T=</span><span class="si">{</span><span class="n">T_max</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;α_</span><span class="si">{</span><span class="n">T_max</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;β_</span><span class="si">{</span><span class="n">T_max</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Model selection error probability = </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;error_prob&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">result</span>

<span class="c1"># Analyze Protocol 1</span>
<span class="n">π_minus_1</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">T_max</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">N_simulations</span> <span class="o">=</span> <span class="mi">10_000</span>

<span class="n">result_p1</span> <span class="o">=</span> <span class="n">analyze_protocol_1</span><span class="p">(</span><span class="n">π_minus_1</span><span class="p">,</span> <span class="n">T_max</span><span class="p">,</span> <span class="n">N_simulations</span><span class="p">,</span> 
                                <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="p">(</span><span class="n">F_a</span><span class="p">,</span> <span class="n">F_b</span><span class="p">),</span> <span class="p">(</span><span class="n">G_a</span><span class="p">,</span> <span class="n">G_b</span><span class="p">))</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/1e35696ffa732eeca1a6d1327bcee665ad5853234c12bb6467aa5a629f390214.png" src="_images/1e35696ffa732eeca1a6d1327bcee665ad5853234c12bb6467aa5a629f390214.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>At T=30:
α_30 = 0.0052
β_30 = 0.0034
Model selection error probability = 0.0043
</pre></div>
</div>
</div>
</div>
<p>Notice how the model selection  error probability approaches zero as <span class="math notranslate nohighlight">\(T\)</span> grows.</p>
</section>
<section id="classification">
<h3><span class="section-number">22.7.2. </span>Classification<a class="headerlink" href="#classification" title="Link to this heading">#</a></h3>
<p>We now consider a problem that assumes timing protocol 2.</p>
<p>A decision maker wants to classify components of an observed sequence <span class="math notranslate nohighlight">\(\{w_t\}_{t=1}^T\)</span> as having been drawn from either <span class="math notranslate nohighlight">\(f\)</span> or <span class="math notranslate nohighlight">\(g\)</span>.</p>
<p>The decision maker uses the following classification rule:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
w_t  &amp; \ {\rm is \ from \ }  f  \ {\rm if \ } l_t &gt; 1 \\
w_t  &amp; \ {\rm is \ from \ } g  \ {\rm if \ } l_t \leq 1 . 
\end{aligned}
\end{split}\]</div>
<p>Under this rule, the expected misclassification rate is</p>
<div class="math notranslate nohighlight" id="equation-eq-classerrorprob">
<span class="eqno">(22.3)<a class="headerlink" href="#equation-eq-classerrorprob" title="Link to this equation">#</a></span>\[
p(\textrm{misclassification}) = {1 \over 2} (\tilde \alpha_t + \tilde \beta_t) 
\]</div>
<p>where <span class="math notranslate nohighlight">\(\tilde \alpha_t = {\rm Prob}(l_t &lt; 1 \mid f)\)</span> and <span class="math notranslate nohighlight">\(\tilde \beta_t = {\rm Prob}(l_t \geq 1 \mid g)\)</span>.</p>
<p>Now let’s write some code to simulate it</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">compute_protocol_2_errors</span><span class="p">(</span><span class="n">π_minus_1</span><span class="p">,</span> <span class="n">T_max</span><span class="p">,</span> <span class="n">N_simulations</span><span class="p">,</span> <span class="n">f_func</span><span class="p">,</span> <span class="n">g_func</span><span class="p">,</span>
                              <span class="n">F_params</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">G_params</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute error probabilities for Protocol 2.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sequences</span><span class="p">,</span> <span class="n">true_models</span> <span class="o">=</span> <span class="n">protocol_2</span><span class="p">(</span><span class="n">π_minus_1</span><span class="p">,</span> 
                        <span class="n">T_max</span><span class="p">,</span> <span class="n">N_simulations</span><span class="p">,</span> <span class="n">F_params</span><span class="p">,</span> <span class="n">G_params</span><span class="p">)</span>
    <span class="n">l_ratios</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">compute_likelihood_ratios</span><span class="p">(</span><span class="n">sequences</span><span class="p">,</span> <span class="n">f_func</span><span class="p">,</span> <span class="n">g_func</span><span class="p">)</span>
    
    <span class="n">T_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="n">accuracy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">T_max</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T_max</span><span class="p">):</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="p">(</span><span class="n">l_ratios</span><span class="p">[:,</span> <span class="n">t</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">actual</span> <span class="o">=</span> <span class="n">true_models</span><span class="p">[:,</span> <span class="n">t</span><span class="p">]</span>
        <span class="n">accuracy</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">predictions</span> <span class="o">==</span> <span class="n">actual</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;T_range&#39;</span><span class="p">:</span> <span class="n">T_range</span><span class="p">,</span>
        <span class="s1">&#39;accuracy&#39;</span><span class="p">:</span> <span class="n">accuracy</span><span class="p">,</span>
        <span class="s1">&#39;l_ratios&#39;</span><span class="p">:</span> <span class="n">l_ratios</span><span class="p">,</span>
        <span class="s1">&#39;true_models&#39;</span><span class="p">:</span> <span class="n">true_models</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Since for each <span class="math notranslate nohighlight">\(t\)</span>, the decision boundary is the same, the decision boundary can be computed as</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">root</span> <span class="o">=</span> <span class="n">brentq</span><span class="p">(</span><span class="k">lambda</span> <span class="n">w</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">/</span> <span class="n">g</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.999</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>we can plot the distributions of <span class="math notranslate nohighlight">\(f\)</span> and <span class="math notranslate nohighlight">\(g\)</span> and the decision boundary</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">w_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1e-5</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="mf">1e-5</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">f_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">w_range</span><span class="p">]</span>
<span class="n">g_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">w_range</span><span class="p">]</span>
<span class="n">ratio_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">/</span><span class="n">g</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">w_range</span><span class="p">]</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w_range</span><span class="p">,</span> <span class="n">f_values</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> 
        <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$f(w) \sim Beta(1,1)$&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w_range</span><span class="p">,</span> <span class="n">g_values</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> 
        <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$g(w) \sim Beta(3,1.2)$&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">type1_prob</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">beta_dist</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">F_a</span><span class="p">,</span> <span class="n">F_b</span><span class="p">)</span>
<span class="n">type2_prob</span> <span class="o">=</span> <span class="n">beta_dist</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">G_a</span><span class="p">,</span> <span class="n">G_b</span><span class="p">)</span>

<span class="n">w_type1</span> <span class="o">=</span> <span class="n">w_range</span><span class="p">[</span><span class="n">w_range</span> <span class="o">&gt;=</span> <span class="n">root</span><span class="p">]</span>
<span class="n">f_type1</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">w_type1</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">w_type1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">f_type1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> 
                <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;$\tilde \alpha_t = </span><span class="si">{</span><span class="n">type1_prob</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">)</span>

<span class="n">w_type2</span> <span class="o">=</span> <span class="n">w_range</span><span class="p">[</span><span class="n">w_range</span> <span class="o">&lt;=</span> <span class="n">root</span><span class="p">]</span>
<span class="n">g_type2</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">w_type2</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">w_type2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">g_type2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> 
                <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;$\tilde \beta_t = </span><span class="si">{</span><span class="n">type2_prob</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> 
            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;decision boundary: $w=$</span><span class="si">{</span><span class="n">root</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;probability density&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/059d2493da5ff691511951e5392ad40c9d7048ba75a96c6b601f16b349acea74.png" src="_images/059d2493da5ff691511951e5392ad40c9d7048ba75a96c6b601f16b349acea74.png" />
</div>
</div>
<p>To the left of the green vertical line <span class="math notranslate nohighlight">\(g &lt; f\)</span>, so <span class="math notranslate nohighlight">\(l_t &gt; 1\)</span>; therefore a <span class="math notranslate nohighlight">\(w_t\)</span> that falls to the left of the green line is classified as a type <span class="math notranslate nohighlight">\(f\)</span> individual.</p>
<ul class="simple">
<li><p>The shaded red area equals <span class="math notranslate nohighlight">\(\beta\)</span> – the probability of classifying someone as a type <span class="math notranslate nohighlight">\(g\)</span> individual when it is really a type <span class="math notranslate nohighlight">\(f\)</span> individual.</p></li>
</ul>
<p>To the right of the green vertical line <span class="math notranslate nohighlight">\(g &gt; f\)</span>, so <span class="math notranslate nohighlight">\(l_t &lt; 1\)</span>; therefore a <span class="math notranslate nohighlight">\(w_t\)</span> that falls to the right of the green line is classified as a type <span class="math notranslate nohighlight">\(g\)</span> individual.</p>
<ul class="simple">
<li><p>The shaded blue area equals <span class="math notranslate nohighlight">\(\alpha\)</span> – the probability of classifying someone as a type <span class="math notranslate nohighlight">\(f\)</span> when it is really a type <span class="math notranslate nohighlight">\(g\)</span> individual.</p></li>
</ul>
<p>This gives us clues about how to compute the theoretical classification error probability</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute theoretical tilde α_t and tilde β_t</span>
<span class="k">def</span><span class="w"> </span><span class="nf">α_integrand</span><span class="p">(</span><span class="n">w</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Integrand for tilde α_t = P(l_t &lt; 1 | f)&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">/</span> <span class="n">g</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span>

<span class="k">def</span><span class="w"> </span><span class="nf">β_integrand</span><span class="p">(</span><span class="n">w</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Integrand for tilde β_t = P(l_t &gt;= 1 | g)&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">g</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">/</span> <span class="n">g</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span>

<span class="c1"># Compute the integrals</span>
<span class="n">α_theory</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span><span class="n">α_integrand</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">β_theory</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span><span class="n">β_integrand</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="n">theory_error</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">α_theory</span> <span class="o">+</span> <span class="n">β_theory</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;theoretical tilde α_t = </span><span class="si">{</span><span class="n">α_theory</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;theoretical tilde β_t = </span><span class="si">{</span><span class="n">β_theory</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;theoretical classification error probability = </span><span class="si">{</span><span class="n">theory_error</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>theoretical tilde α_t = 0.4752
theoretical tilde β_t = 0.1836
theoretical classification error probability = 0.3294
</pre></div>
</div>
</div>
</div>
<p>Now we simulate timing protocol 2 and compute the classification error probability.</p>
<p>In the next cell, we also compare the theoretical classification accuracy to the empirical classification accuracy</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">analyze_protocol_2</span><span class="p">(</span><span class="n">π_minus_1</span><span class="p">,</span> <span class="n">T_max</span><span class="p">,</span> <span class="n">N_simulations</span><span class="p">,</span> <span class="n">f_func</span><span class="p">,</span> <span class="n">g_func</span><span class="p">,</span> 
                      <span class="n">theory_error</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">F_params</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">G_params</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyze Protocol 2.&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">compute_protocol_2_errors</span><span class="p">(</span><span class="n">π_minus_1</span><span class="p">,</span> <span class="n">T_max</span><span class="p">,</span> <span class="n">N_simulations</span><span class="p">,</span> 
                                      <span class="n">f_func</span><span class="p">,</span> <span class="n">g_func</span><span class="p">,</span> <span class="n">F_params</span><span class="p">,</span> <span class="n">G_params</span><span class="p">)</span>
    
    <span class="c1"># Plot results</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;T_range&#39;</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">],</span> 
            <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;empirical accuracy&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">theory_error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">theory_error</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> 
                   <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;theoretical accuracy = </span><span class="si">{</span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">theory_error</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$t$&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;accuracy&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">result</span>

<span class="c1"># Analyze Protocol 2</span>
<span class="n">result_p2</span> <span class="o">=</span> <span class="n">analyze_protocol_2</span><span class="p">(</span><span class="n">π_minus_1</span><span class="p">,</span> <span class="n">T_max</span><span class="p">,</span> <span class="n">N_simulations</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> 
                              <span class="n">theory_error</span><span class="p">,</span> <span class="p">(</span><span class="n">F_a</span><span class="p">,</span> <span class="n">F_b</span><span class="p">),</span> <span class="p">(</span><span class="n">G_a</span><span class="p">,</span> <span class="n">G_b</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/77017c3559a44c0b72b865f1984423162d7c2b39bb572654f1c087a282b4e944.png" src="_images/77017c3559a44c0b72b865f1984423162d7c2b39bb572654f1c087a282b4e944.png" />
</div>
</div>
<p>Let’s watch decisions made by  the two timing protocols as more and more observations accrue.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">compare_protocols</span><span class="p">(</span><span class="n">result1</span><span class="p">,</span> <span class="n">result2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compare results from both protocols.&quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">result1</span><span class="p">[</span><span class="s1">&#39;T_range&#39;</span><span class="p">],</span> <span class="n">result1</span><span class="p">[</span><span class="s1">&#39;error_prob&#39;</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
            <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Protocol 1 (Model Selection)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">result2</span><span class="p">[</span><span class="s1">&#39;T_range&#39;</span><span class="p">],</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">result2</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">],</span> 
            <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
            <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Protocol 2 (classification)&#39;</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$T$&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;error probability&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
<span class="n">compare_protocols</span><span class="p">(</span><span class="n">result_p1</span><span class="p">,</span> <span class="n">result_p2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ca73212fa882482c794b259e5b0f8b9fb5e2b09d5ea01a456d86cc14f1f0e991.png" src="_images/ca73212fa882482c794b259e5b0f8b9fb5e2b09d5ea01a456d86cc14f1f0e991.png" />
</div>
</div>
<p>From the figure above, we can see:</p>
<ul class="simple">
<li><p>For both timing protocols, the error probability starts at the same level, subject to a little randomness.</p></li>
<li><p>For timing protocol 1, the error probability decreases as the sample size increases because we are  making just <strong>one</strong> decision – i.e., selecting whether <span class="math notranslate nohighlight">\(f\)</span> or <span class="math notranslate nohighlight">\(g\)</span> governs  <strong>all</strong> individuals.  More data provides better evidence.</p></li>
<li><p>For timing protocol 2, the error probability remains constant because we are making <strong>many</strong> decisions – one classification decision for each observation.</p></li>
</ul>
<p><strong>Remark:</strong> Think about how laws of large numbers are applied to compute error probabilities for the model selection problem and the classification problem.</p>
</section>
<section id="error-probability-and-divergence-measures">
<h3><span class="section-number">22.7.3. </span>Error probability and divergence measures<a class="headerlink" href="#error-probability-and-divergence-measures" title="Link to this heading">#</a></h3>
<p>A plausible guess is that the ability of a likelihood ratio to distinguish distributions <span class="math notranslate nohighlight">\(f\)</span> and <span class="math notranslate nohighlight">\(g\)</span> depends on how “different” they are.</p>
<p>We have learnt some measures of “difference” between distributions in <a class="reference internal" href="divergence_measures.html"><span class="doc">Statistical Divergence Measures</span></a>.</p>
<p>Let’s now study two more measures of “difference” between distributions that are useful in the context of model selection and classification.</p>
<p>Recall that Chernoff entropy between probability densities <span class="math notranslate nohighlight">\(f\)</span> and <span class="math notranslate nohighlight">\(g\)</span> is defined as:</p>
<div class="math notranslate nohighlight">
\[
C(f,g) = - \log \min_{\phi \in (0,1)} \int f^\phi(x) g^{1-\phi}(x) dx
\]</div>
<p>An upper bound on model selection error probability is</p>
<div class="math notranslate nohighlight">
\[
e^{-C(f,g)T} .
\]</div>
<p>Let’s compute Chernoff entropy numerically with some Python code</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">chernoff_integrand</span><span class="p">(</span><span class="n">ϕ</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the integrand for Chernoff entropy</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">integrand</span><span class="p">(</span><span class="n">w</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">**</span><span class="n">ϕ</span> <span class="o">*</span> <span class="n">g</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ϕ</span><span class="p">)</span>
    
    <span class="n">result</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span><span class="n">integrand</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="mf">1e-5</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="k">def</span><span class="w"> </span><span class="nf">compute_chernoff_entropy</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute Chernoff entropy C(f,g)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">objective</span><span class="p">(</span><span class="n">ϕ</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">chernoff_integrand</span><span class="p">(</span><span class="n">ϕ</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
    
    <span class="c1"># Find the minimum over ϕ in (0,1)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">minimize_scalar</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> 
                             <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">1e-5</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="mf">1e-5</span><span class="p">),</span> 
                             <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bounded&#39;</span><span class="p">)</span>
    <span class="n">min_value</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">fun</span>
    <span class="n">ϕ_optimal</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span>
    
    <span class="n">chernoff_entropy</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">min_value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">chernoff_entropy</span><span class="p">,</span> <span class="n">ϕ_optimal</span>
<span class="n">C_fg</span><span class="p">,</span> <span class="n">ϕ_optimal</span> <span class="o">=</span> <span class="n">compute_chernoff_entropy</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chernoff entropy C(f,g) = </span><span class="si">{</span><span class="n">C_fg</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Optimal ϕ = </span><span class="si">{</span><span class="n">ϕ_optimal</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Chernoff entropy C(f,g) = 0.1212
Optimal ϕ = 0.5969
</pre></div>
</div>
</div>
</div>
<p>Now let’s examine how <span class="math notranslate nohighlight">\(e^{-C(f,g)T}\)</span> behaves as a function of <span class="math notranslate nohighlight">\(T\)</span> and compare it to the model selection error probability</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T_max</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">chernoff_bound</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">C_fg</span> <span class="o">*</span> <span class="n">T_range</span><span class="p">)</span>

<span class="c1"># Plot comparison</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">ax</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">T_range</span><span class="p">,</span> <span class="n">chernoff_bound</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
           <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;$e^</span><span class="se">{{</span><span class="s1">-C(f,g)T</span><span class="se">}}</span><span class="s1">$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">T_range</span><span class="p">,</span> <span class="n">result_p1</span><span class="p">[</span><span class="s1">&#39;error_prob&#39;</span><span class="p">],</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Model selection error probability&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;error probability (log scale)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/42d4e1829be2c0c1e5114234631e1b6eb0c471e1e835a82e8e453df6af3170a1.png" src="_images/42d4e1829be2c0c1e5114234631e1b6eb0c471e1e835a82e8e453df6af3170a1.png" />
</div>
</div>
<p>Evidently, <span class="math notranslate nohighlight">\(e^{-C(f,g)T}\)</span> is an upper bound on the error rate.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">{doc}</span></code>divergence_measures`, we also studied <strong>Jensen-Shannon divergence</strong> as
a symmetric measure of distance between distributions.</p>
<p>We can use Jensen-Shannon divergence to measure the distance between distributions <span class="math notranslate nohighlight">\(f\)</span> and <span class="math notranslate nohighlight">\(g\)</span> and
compute how it covaries with the model selection error probability.</p>
<p>We also compute Jensen-Shannon divergence numerically with some Python code</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">compute_JS</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute Jensen-Shannon divergence</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">m</span><span class="p">(</span><span class="n">w</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">+</span> <span class="n">g</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
    
    <span class="n">js_div</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">compute_KL</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">compute_KL</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">js_div</span>
</pre></div>
</div>
</div>
</div>
<p>Now let’s return to our guess that the error probability at large sample sizes is related to the Chernoff entropy  between two distributions.</p>
<p>We verify this by computing the correlation between the log of the error probability at <span class="math notranslate nohighlight">\(T=50\)</span> under Timing Protocol 1 and the divergence measures.</p>
<p>In the simulation below, nature draws <span class="math notranslate nohighlight">\(N / 2\)</span> sequences from <span class="math notranslate nohighlight">\(g\)</span> and <span class="math notranslate nohighlight">\(N/2\)</span> sequences from <span class="math notranslate nohighlight">\(f\)</span>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Nature does this rather than flipping a fair coin to decide whether to draw from <span class="math notranslate nohighlight">\(g\)</span> or <span class="math notranslate nohighlight">\(f\)</span> once and for all before each simulation of length <span class="math notranslate nohighlight">\(T\)</span>.</p>
</div>
<p>We use the following pairs of Beta distributions for <span class="math notranslate nohighlight">\(f\)</span> and <span class="math notranslate nohighlight">\(g\)</span> as test cases</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">distribution_pairs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># (f_params, g_params)</span>
    <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)),</span>
    <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)),</span>
    <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)),</span>
    <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)),</span>
    <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">)),</span>
    <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)),</span>
    <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">)),</span>
    <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)),</span>
    <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)),</span>
    <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)),</span>
    <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">)),</span>
    <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)),</span>
    <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
    <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Now let’s run the simmulation</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parameters for simulation</span>
<span class="n">T_large</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">N_sims</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">N_half</span> <span class="o">=</span> <span class="n">N_sims</span> <span class="o">//</span> <span class="mi">2</span>

<span class="c1"># Initialize arrays</span>
<span class="n">n_pairs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">distribution_pairs</span><span class="p">)</span>
<span class="n">kl_fg_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_pairs</span><span class="p">)</span>
<span class="n">kl_gf_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_pairs</span><span class="p">)</span> 
<span class="n">js_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_pairs</span><span class="p">)</span>
<span class="n">chernoff_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_pairs</span><span class="p">)</span>
<span class="n">error_probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_pairs</span><span class="p">)</span>
<span class="n">pair_names</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">((</span><span class="n">f_a</span><span class="p">,</span> <span class="n">f_b</span><span class="p">),</span> <span class="p">(</span><span class="n">g_a</span><span class="p">,</span> <span class="n">g_b</span><span class="p">))</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">distribution_pairs</span><span class="p">):</span>
    <span class="c1"># Create density functions</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">jit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">f_a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">f_b</span><span class="p">:</span> <span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">jit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">g_a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">g_b</span><span class="p">:</span> <span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>

    <span class="c1"># Compute divergence measures</span>
    <span class="n">kl_fg_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">compute_KL</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
    <span class="n">kl_gf_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">compute_KL</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="n">js_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">compute_JS</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
    <span class="n">chernoff_vals</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">_</span> <span class="o">=</span> <span class="n">compute_chernoff_entropy</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>

    <span class="c1"># Generate samples</span>
    <span class="n">sequences_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">f_a</span><span class="p">,</span> <span class="n">f_b</span><span class="p">,</span> <span class="p">(</span><span class="n">N_half</span><span class="p">,</span> <span class="n">T_large</span><span class="p">))</span>
    <span class="n">sequences_g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">g_a</span><span class="p">,</span> <span class="n">g_b</span><span class="p">,</span> <span class="p">(</span><span class="n">N_half</span><span class="p">,</span> <span class="n">T_large</span><span class="p">))</span>

    <span class="c1"># Compute likelihood ratios and cumulative products</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">L_cumulative_f</span> <span class="o">=</span> <span class="n">compute_likelihood_ratios</span><span class="p">(</span><span class="n">sequences_f</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">L_cumulative_g</span> <span class="o">=</span> <span class="n">compute_likelihood_ratios</span><span class="p">(</span><span class="n">sequences_g</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
    
    <span class="c1"># Get final values</span>
    <span class="n">L_cumulative_f</span> <span class="o">=</span> <span class="n">L_cumulative_f</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">L_cumulative_g</span> <span class="o">=</span> <span class="n">L_cumulative_g</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Calculate error probabilities</span>
    <span class="n">error_probs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">L_cumulative_f</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> 
                            <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">L_cumulative_g</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">pair_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Beta(</span><span class="si">{</span><span class="n">f_a</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">f_b</span><span class="si">}</span><span class="s2">) and Beta(</span><span class="si">{</span><span class="n">g_a</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">g_b</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="n">cor_data</span> <span class="o">=</span>  <span class="p">{</span>
    <span class="s1">&#39;kl_fg&#39;</span><span class="p">:</span> <span class="n">kl_fg_vals</span><span class="p">,</span>
    <span class="s1">&#39;kl_gf&#39;</span><span class="p">:</span> <span class="n">kl_gf_vals</span><span class="p">,</span>
    <span class="s1">&#39;js&#39;</span><span class="p">:</span> <span class="n">js_vals</span><span class="p">,</span> 
    <span class="s1">&#39;chernoff&#39;</span><span class="p">:</span> <span class="n">chernoff_vals</span><span class="p">,</span>
    <span class="s1">&#39;error_prob&#39;</span><span class="p">:</span> <span class="n">error_probs</span><span class="p">,</span>
    <span class="s1">&#39;names&#39;</span><span class="p">:</span> <span class="n">pair_names</span><span class="p">,</span>
    <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="n">T_large</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Now let’s visualize the correlations</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_error_divergence</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot correlations between error probability and divergence measures.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Filter out near-zero error probabilities for log scale</span>
    <span class="n">nonzero_mask</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;error_prob&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1e-6</span>
    <span class="n">log_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;error_prob&#39;</span><span class="p">][</span><span class="n">nonzero_mask</span><span class="p">])</span>
    <span class="n">js_vals</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;js&#39;</span><span class="p">][</span><span class="n">nonzero_mask</span><span class="p">]</span>
    <span class="n">chernoff_vals</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;chernoff&#39;</span><span class="p">][</span><span class="n">nonzero_mask</span><span class="p">]</span>

    <span class="c1"># Create figure and axes</span>
    <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    
    <span class="c1"># function for plotting correlation</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_correlation</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">x_vals</span><span class="p">,</span> <span class="n">x_label</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span> <span class="n">log_error</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;log(Error probability) at T=</span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        
        <span class="c1"># Calculate correlation and trend line</span>
        <span class="n">corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span> <span class="n">log_error</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span> <span class="n">log_error</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">x_trend</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_vals</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">x_vals</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_trend</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)(</span><span class="n">x_trend</span><span class="p">),</span> 
                <span class="s2">&quot;r--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Log error probability and </span><span class="si">{</span><span class="n">x_label</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
                     <span class="sa">f</span><span class="s1">&#39;Correlation = </span><span class="si">{</span><span class="n">corr</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    
    <span class="c1"># Plot both correlations</span>
    <span class="n">plot_correlation</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">js_vals</span><span class="p">,</span> <span class="s1">&#39;JS divergence&#39;</span><span class="p">,</span> <span class="s1">&#39;C0&#39;</span><span class="p">)</span>
    <span class="n">plot_correlation</span><span class="p">(</span><span class="n">ax2</span><span class="p">,</span> <span class="n">chernoff_vals</span><span class="p">,</span> <span class="s1">&#39;Chernoff entropy&#39;</span><span class="p">,</span> <span class="s1">&#39;C1&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plot_error_divergence</span><span class="p">(</span><span class="n">cor_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/9b6ce267bdffd3ad978e82e6e7b776b20b7796fe8f8d4019667e073444ed199c.png" src="_images/9b6ce267bdffd3ad978e82e6e7b776b20b7796fe8f8d4019667e073444ed199c.png" />
</div>
</div>
<p>Evidently, Chernoff entropy and Jensen-Shannon entropy each covary tightly with the model selection error probability.</p>
<p>We’ll encounter related ideas in <a class="reference internal" href="wald_friedman.html"><span class="doc">A Problem that Stumped Milton Friedman</span></a> very soon.</p>
</section>
</section>
<section id="markov-chains">
<span id="lrp-markov"></span><h2><a class="toc-backref" href="#id13" role="doc-backlink"><span class="section-number">22.8. </span>Markov chains</a><a class="headerlink" href="#markov-chains" title="Link to this heading">#</a></h2>
<p>Let’s now look at a likelihood ratio process for a sequence of random variables that is not independently and identically distributed.</p>
<p>Here we assume that the sequence is generated by a Markov chain on a finite state space.</p>
<p>We consider two <span class="math notranslate nohighlight">\(n\)</span>-state irreducible and aperiodic Markov chain models on the same state space <span class="math notranslate nohighlight">\(\{1, 2, \ldots, n\}\)</span> with positive transition matrices <span class="math notranslate nohighlight">\(P^{(f)}\)</span>, <span class="math notranslate nohighlight">\(P^{(g)}\)</span> and initial distributions <span class="math notranslate nohighlight">\(\pi_0^{(f)}\)</span>, <span class="math notranslate nohighlight">\(\pi_0^{(g)}\)</span>.</p>
<p>We assume that nature samples from chain <span class="math notranslate nohighlight">\(f\)</span>.</p>
<p>For a sample path <span class="math notranslate nohighlight">\((x_0, x_1, \ldots, x_T)\)</span>, let <span class="math notranslate nohighlight">\(N_{ij}\)</span> count transitions from state <span class="math notranslate nohighlight">\(i\)</span> to <span class="math notranslate nohighlight">\(j\)</span>.</p>
<p>The likelihood process under model <span class="math notranslate nohighlight">\(m \in \{f, g\}\)</span> is</p>
<div class="math notranslate nohighlight">
\[
L_T^{(m)} = \pi_{0,x_0}^{(m)} \prod_{i=1}^n \prod_{j=1}^n \left(P_{ij}^{(m)}\right)^{N_{ij}}
\]</div>
<p>Hence,</p>
<div class="math notranslate nohighlight">
\[
\log L_T^{(m)} =\log\pi_{0,x_0}^{(m)} +\sum_{i,j}N_{ij}\log P_{ij}^{(m)}
\]</div>
<p>The log-likelihood ratio is</p>
<div class="math notranslate nohighlight" id="equation-eq-llr-markov">
<span class="eqno">(22.4)<a class="headerlink" href="#equation-eq-llr-markov" title="Link to this equation">#</a></span>\[
\log \frac{L_T^{(f)}}{L_T^{(g)}} = \log \frac{\pi_{0,x_0}^{(f)}}{\pi_{0,x_0}^{(g)}} + \sum_{i,j}N_{ij}\log \frac{P_{ij}^{(f)}}{P_{ij}^{(g)}}
\]</div>
<section id="kl-divergence-rate">
<h3><span class="section-number">22.8.1. </span>KL divergence rate<a class="headerlink" href="#kl-divergence-rate" title="Link to this heading">#</a></h3>
<p>By the ergodic theorem for irreducible, aperiodic Markov chains, we have</p>
<div class="math notranslate nohighlight">
\[
\frac{N_{ij}}{T} \xrightarrow{a.s.} \pi_i^{(f)}P_{ij}^{(f)} \quad \text{as } T \to \infty
\]</div>
<p>where <span class="math notranslate nohighlight">\(\boldsymbol{\pi}^{(f)}\)</span> is the stationary distribution satisfying <span class="math notranslate nohighlight">\(\boldsymbol{\pi}^{(f)} = \boldsymbol{\pi}^{(f)} P^{(f)}\)</span>.</p>
<p>Therefore,</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{T}\log \frac{L_T^{(f)}}{L_T^{(g)}} = \frac{1}{T}\log \frac{\pi_{0,x_0}^{(f)}}{\pi_{0,x_0}^{(g)}} + \frac{1}{T}\sum_{i,j}N_{ij}\log \frac{P_{ij}^{(f)}}{P_{ij}^{(g)}}
\]</div>
<p>Taking the limit as <span class="math notranslate nohighlight">\(T \to \infty\)</span>, we have:</p>
<ul class="simple">
<li><p>The first term: <span class="math notranslate nohighlight">\(\frac{1}{T}\log \frac{\pi_{0,x_0}^{(f)}}{\pi_{0,x_0}^{(g)}} \to 0\)</span></p></li>
<li><p>The second term: <span class="math notranslate nohighlight">\(\frac{1}{T}\sum_{i,j}N_{ij}\log \frac{P_{ij}^{(f)}}{P_{ij}^{(g)}} \xrightarrow{a.s.} \sum_{i,j}\pi_i^{(f)}P_{ij}^{(f)}\log \frac{P_{ij}^{(f)}}{P_{ij}^{(g)}}\)</span></p></li>
</ul>
<p>Define the <strong>KL divergence rate</strong> as</p>
<div class="math notranslate nohighlight">
\[
h_{KL}(f, g) = \sum_{i=1}^n \pi_i^{(f)} \underbrace{\sum_{j=1}^n P_{ij}^{(f)} \log \frac{P_{ij}^{(f)}}{P_{ij}^{(g)}}}_{=: KL(P_{i\cdot}^{(f)}, P_{i\cdot}^{(g)})}
\]</div>
<p>where <span class="math notranslate nohighlight">\(KL(P_{i\cdot}^{(f)}, P_{i\cdot}^{(g)})\)</span> is the row-wise KL divergence.</p>
<p>By the ergodic theorem, we have</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{T}\log \frac{L_T^{(f)}}{L_T^{(g)}} \xrightarrow{a.s.} h_{KL}(f, g) \quad \text{as } T \to \infty
\]</div>
<p>Taking expectations and using the dominated convergence theorem, we obtain</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{T}E_f\left[\log \frac{L_T^{(f)}}{L_T^{(g)}}\right] \to h_{KL}(f, g) \quad \text{as } T \to \infty
\]</div>
<p>Here we invite readers to pause and compare this result with <a class="reference internal" href="#equation-eq-kl-likelihood-link">(22.1)</a>.</p>
<p>Let’s confirm this in the simulation below.</p>
</section>
<section id="simulations">
<h3><span class="section-number">22.8.2. </span>Simulations<a class="headerlink" href="#simulations" title="Link to this heading">#</a></h3>
<p>Let’s implement simulations to illustrate these concepts with a three-state Markov chain.</p>
<p>We start by writing functions to compute the stationary distribution and the KL divergence rate for Markov chain models.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">compute_stationary_dist</span><span class="p">(</span><span class="n">P</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute stationary distribution of transition matrix P</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">eigenvalues</span><span class="p">,</span> <span class="n">eigenvectors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">eigenvalues</span><span class="p">))</span>
    <span class="n">stationary</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">eigenvectors</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">stationary</span> <span class="o">/</span> <span class="n">stationary</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">markov_kl_divergence</span><span class="p">(</span><span class="n">P_f</span><span class="p">,</span> <span class="n">P_g</span><span class="p">,</span> <span class="n">pi_f</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute KL divergence rate between two Markov chains</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">((</span><span class="n">P_f</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">P_g</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    
    <span class="n">valid_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">P_f</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">P_g</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">log_ratios</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">P_f</span><span class="p">)</span>
    <span class="n">log_ratios</span><span class="p">[</span><span class="n">valid_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">P_f</span><span class="p">[</span><span class="n">valid_mask</span><span class="p">]</span> <span class="o">/</span> <span class="n">P_g</span><span class="p">[</span><span class="n">valid_mask</span><span class="p">])</span>
    
    <span class="c1"># Weight by stationary probabilities and sum</span>
    <span class="n">kl_rate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">pi_f</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">*</span> <span class="n">P_f</span> <span class="o">*</span> <span class="n">log_ratios</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">kl_rate</span>

<span class="k">def</span><span class="w"> </span><span class="nf">simulate_markov_chain</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">pi_0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">N_paths</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simulate N_paths sample paths from a Markov chain</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mc</span> <span class="o">=</span> <span class="n">qe</span><span class="o">.</span><span class="n">MarkovChain</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">state_values</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">initial_states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">P</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">N_paths</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">pi_0</span><span class="p">)</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N_paths</span><span class="p">,</span> <span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_paths</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="n">initial_states</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">paths</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">path</span>
    
    <span class="k">return</span> <span class="n">paths</span>

<span class="k">def</span><span class="w"> </span><span class="nf">compute_likelihood_ratio_markov</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">P_f</span><span class="p">,</span> <span class="n">P_g</span><span class="p">,</span> <span class="n">π_0_f</span><span class="p">,</span> <span class="n">π_0_g</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute likelihood ratio process for Markov chain paths</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">N_paths</span><span class="p">,</span> <span class="n">T_plus_1</span> <span class="o">=</span> <span class="n">paths</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">T_plus_1</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">L_ratios</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">N_paths</span><span class="p">,</span> <span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    
    <span class="c1"># Initial likelihood ratio</span>
    <span class="n">L_ratios</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">π_0_f</span><span class="p">[</span><span class="n">paths</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]]</span> <span class="o">/</span> <span class="n">π_0_g</span><span class="p">[</span><span class="n">paths</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]]</span>
    
    <span class="c1"># Compute sequential likelihood ratios</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">prev_states</span> <span class="o">=</span> <span class="n">paths</span><span class="p">[:,</span> <span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">curr_states</span> <span class="o">=</span> <span class="n">paths</span><span class="p">[:,</span> <span class="n">t</span><span class="p">]</span>
        
        <span class="n">transition_ratios</span> <span class="o">=</span> <span class="p">(</span><span class="n">P_f</span><span class="p">[</span><span class="n">prev_states</span><span class="p">,</span> <span class="n">curr_states</span><span class="p">]</span> <span class="o">/</span> 
                           <span class="n">P_g</span><span class="p">[</span><span class="n">prev_states</span><span class="p">,</span> <span class="n">curr_states</span><span class="p">])</span>
        <span class="n">L_ratios</span><span class="p">[:,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">L_ratios</span><span class="p">[:,</span> <span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">transition_ratios</span>
    
    <span class="k">return</span> <span class="n">L_ratios</span>

<span class="k">def</span><span class="w"> </span><span class="nf">analyze_markov_chains</span><span class="p">(</span><span class="n">P_f</span><span class="p">,</span> <span class="n">P_g</span><span class="p">,</span> 
                <span class="n">T</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">N_paths</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">plot_paths</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n_show</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Complete analysis of two Markov chains</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Compute stationary distributions</span>
    <span class="n">π_f</span> <span class="o">=</span> <span class="n">compute_stationary_dist</span><span class="p">(</span><span class="n">P_f</span><span class="p">)</span>
    <span class="n">π_g</span> <span class="o">=</span> <span class="n">compute_stationary_dist</span><span class="p">(</span><span class="n">P_g</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stationary distribution (f): </span><span class="si">{</span><span class="n">π_f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stationary distribution (g): </span><span class="si">{</span><span class="n">π_g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># Compute KL divergence rates</span>
    <span class="n">kl_rate_fg</span> <span class="o">=</span> <span class="n">markov_kl_divergence</span><span class="p">(</span><span class="n">P_f</span><span class="p">,</span> <span class="n">P_g</span><span class="p">,</span> <span class="n">π_f</span><span class="p">)</span>
    <span class="n">kl_rate_gf</span> <span class="o">=</span> <span class="n">markov_kl_divergence</span><span class="p">(</span><span class="n">P_g</span><span class="p">,</span> <span class="n">P_f</span><span class="p">,</span> <span class="n">π_g</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">KL divergence rate h(f, g): </span><span class="si">{</span><span class="n">kl_rate_fg</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;KL divergence rate h(g, f): </span><span class="si">{</span><span class="n">kl_rate_gf</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">plot_paths</span><span class="p">:</span>
        <span class="c1"># Simulate and plot paths</span>
        <span class="n">paths_from_f</span> <span class="o">=</span> <span class="n">simulate_markov_chain</span><span class="p">(</span><span class="n">P_f</span><span class="p">,</span> <span class="n">π_f</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">N_paths</span><span class="p">)</span>
        <span class="n">L_ratios_f</span> <span class="o">=</span> <span class="n">compute_likelihood_ratio_markov</span><span class="p">(</span>
            <span class="n">paths_from_f</span><span class="p">,</span> <span class="n">P_f</span><span class="p">,</span> <span class="n">P_g</span><span class="p">,</span> <span class="n">π_f</span><span class="p">,</span> <span class="n">π_g</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        
        <span class="c1"># Plot individual paths</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">n_show</span><span class="p">,</span> <span class="n">N_paths</span><span class="p">)):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">L_ratios_f</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
        
        <span class="c1"># Plot theoretical expectation</span>
        <span class="n">theory_line</span> <span class="o">=</span> <span class="n">kl_rate_fg</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">theory_line</span><span class="p">,</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span> 
                <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$T \times h_</span><span class="si">{KL}</span><span class="s1">(f,g)$&#39;</span><span class="p">)</span>
        
        <span class="c1"># Plot empirical mean</span>
        <span class="n">avg_log_L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">L_ratios_f</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">avg_log_L</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span> 
                <span class="n">label</span><span class="o">=</span><span class="s1">&#39;empirical average&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$T$&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\log L_T$&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Markov chain likelihood ratios (nature = f)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;stationary_f&#39;</span><span class="p">:</span> <span class="n">π_f</span><span class="p">,</span>
        <span class="s1">&#39;stationary_g&#39;</span><span class="p">:</span> <span class="n">π_g</span><span class="p">,</span>
        <span class="s1">&#39;kl_rate_fg&#39;</span><span class="p">:</span> <span class="n">kl_rate_fg</span><span class="p">,</span>
        <span class="s1">&#39;kl_rate_gf&#39;</span><span class="p">:</span> <span class="n">kl_rate_gf</span>
    <span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">compute_markov_selection_error</span><span class="p">(</span><span class="n">T_values</span><span class="p">,</span> <span class="n">P_f</span><span class="p">,</span> <span class="n">P_g</span><span class="p">,</span> <span class="n">π_0_f</span><span class="p">,</span> <span class="n">π_0_g</span><span class="p">,</span> <span class="n">N_sim</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute model selection error probability for Markov chains</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">T</span> <span class="ow">in</span> <span class="n">T_values</span><span class="p">:</span>
        <span class="c1"># Simulate from both models</span>
        <span class="n">paths_f</span> <span class="o">=</span> <span class="n">simulate_markov_chain</span><span class="p">(</span><span class="n">P_f</span><span class="p">,</span> <span class="n">π_0_f</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">N_sim</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">paths_g</span> <span class="o">=</span> <span class="n">simulate_markov_chain</span><span class="p">(</span><span class="n">P_g</span><span class="p">,</span> <span class="n">π_0_g</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">N_sim</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="c1"># Compute likelihood ratios</span>
        <span class="n">L_f</span> <span class="o">=</span> <span class="n">compute_likelihood_ratio_markov</span><span class="p">(</span><span class="n">paths_f</span><span class="p">,</span> <span class="n">P_f</span><span class="p">,</span> <span class="n">P_g</span><span class="p">,</span> <span class="n">π_0_f</span><span class="p">,</span> <span class="n">π_0_g</span><span class="p">)</span>
        <span class="n">L_g</span> <span class="o">=</span> <span class="n">compute_likelihood_ratio_markov</span><span class="p">(</span><span class="n">paths_g</span><span class="p">,</span> <span class="n">P_f</span><span class="p">,</span> <span class="n">P_g</span><span class="p">,</span> <span class="n">π_0_f</span><span class="p">,</span> <span class="n">π_0_g</span><span class="p">)</span>
        
        <span class="c1"># Decision rule: choose f if L_T &gt;= 1</span>
        <span class="n">error_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">L_f</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span>   <span class="c1"># Type I error</span>
        <span class="n">error_g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">L_g</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Type II error</span>
        
        <span class="n">total_error</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">error_f</span> <span class="o">+</span> <span class="n">error_g</span><span class="p">)</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">total_error</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Now let’s create an example with two different 3-state Markov chains.</p>
<p>We are now ready to simulate paths and visualize how likelihood ratios evolve.</p>
<p>We verify <span class="math notranslate nohighlight">\(\frac{1}{T}E_f\left[\log \frac{L_T^{(f)}}{L_T^{(g)}}\right] = h_{KL}(f, g)\)</span> starting from the stationary distribution by plotting both the empirical average and the line predicted by the theory</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define example Markov chain transition matrices</span>
<span class="n">P_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">]])</span>

<span class="n">P_g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">]])</span>

<span class="n">markov_results</span> <span class="o">=</span> <span class="n">analyze_markov_chains</span><span class="p">(</span><span class="n">P_f</span><span class="p">,</span> <span class="n">P_g</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Stationary distribution (f): [0.41176471 0.32352941 0.26470588]
Stationary distribution (g): [0.28571429 0.38095238 0.33333333]

KL divergence rate h(f, g): 0.0588
KL divergence rate h(g, f): 0.0563
</pre></div>
</div>
<img alt="_images/68293d132ebbfeaf37de78865fc339ea8d41f80f9de931753ec1e8682d540fd1.png" src="_images/68293d132ebbfeaf37de78865fc339ea8d41f80f9de931753ec1e8682d540fd1.png" />
</div>
</div>
</section>
</section>
<section id="related-lectures">
<h2><a class="toc-backref" href="#id14" role="doc-backlink"><span class="section-number">22.9. </span>Related lectures</a><a class="headerlink" href="#related-lectures" title="Link to this heading">#</a></h2>
<p>Likelihood processes play an important role in Bayesian learning, as described in <a class="reference internal" href="likelihood_bayes.html"><span class="doc">Likelihood Ratio Processes and Bayesian Learning</span></a>
and as applied in <a class="reference internal" href="odu.html"><span class="doc">Job Search VIII: Search with Learning</span></a>.</p>
<p>Likelihood ratio processes are central to  Lawrence Blume and David Easley’s answer to their question “If you’re so smart, why aren’t you rich?” <span id="id4">[<a class="reference internal" href="zreferences.html#id14" title="Lawrence Blume and David Easley. If you're so smart, why aren't you rich? belief selection in complete and incomplete markets. Econometrica, 74(4):929–966, 2006.">Blume and Easley, 2006</a>]</span>, the subject of the lecture<a class="reference internal" href="likelihood_ratio_process_2.html"><span class="doc">Heterogeneous Beliefs and Financial Markets</span></a>.</p>
<p>Likelihood ratio processes also appear  in <a class="reference external" href="https://python-advanced.quantecon.org/additive_functionals.html" title="(in Project name not set)"><span>Additive and Multiplicative Functionals</span></a>, which contains another illustration of the <strong>peculiar property</strong> of likelihood ratio processes described above.</p>
</section>
<section id="exercises">
<h2><a class="toc-backref" href="#id15" role="doc-backlink"><span class="section-number">22.10. </span>Exercises</a><a class="headerlink" href="#exercises" title="Link to this heading">#</a></h2>
<div class="exercise admonition" id="lr_ex1">

<p class="admonition-title"><span class="caption-number">Exercise 22.1 </span></p>
<section id="exercise-content">
<p>Consider the setting where nature generates data from a third density <span class="math notranslate nohighlight">\(h\)</span>.</p>
<p>Let <span class="math notranslate nohighlight">\(\{w_t\}_{t=1}^T\)</span> be IID draws from <span class="math notranslate nohighlight">\(h\)</span>, and let <span class="math notranslate nohighlight">\(L_t = L(w^t)\)</span> be the likelihood ratio process defined as in the lecture.</p>
<p>Show that:</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{t} E_h[\log L_t] = K_g - K_f
\]</div>
<p>with finite <span class="math notranslate nohighlight">\(K_g, K_f\)</span>, <span class="math notranslate nohighlight">\(E_h |\log f(W)| &lt; \infty\)</span> and <span class="math notranslate nohighlight">\(E_h |\log g(W)| &lt; \infty\)</span>.</p>
<p><em>Hint:</em> Start by expressing <span class="math notranslate nohighlight">\(\log L_t\)</span> as a sum of <span class="math notranslate nohighlight">\(\log \ell(w_i)\)</span> terms and compare with the definition of <span class="math notranslate nohighlight">\(K_f\)</span> and <span class="math notranslate nohighlight">\(K_g\)</span>.</p>
</section>
</div>
<div class="solution dropdown admonition" id="likelihood_ratio_process-solution-1">

<p class="admonition-title">Solution</p>
<section id="solution-content">
<p>Since <span class="math notranslate nohighlight">\(w_1, \ldots, w_t\)</span> are IID draws from <span class="math notranslate nohighlight">\(h\)</span>, we can write</p>
<div class="math notranslate nohighlight">
\[
\log L_t = \log \prod_{i=1}^t \ell(w_i) = \sum_{i=1}^t \log \ell(w_i) = \sum_{i=1}^t \log \frac{f(w_i)}{g(w_i)}
\]</div>
<p>Taking the expectation under <span class="math notranslate nohighlight">\(h\)</span></p>
<div class="math notranslate nohighlight">
\[
E_h[\log L_t] 
= E_h\left[\sum_{i=1}^t \log \frac{f(w_i)}{g(w_i)}\right] 
= \sum_{i=1}^t E_h\left[\log \frac{f(w_i)}{g(w_i)}\right]
\]</div>
<p>Since the <span class="math notranslate nohighlight">\(w_i\)</span> are identically distributed</p>
<div class="math notranslate nohighlight">
\[
E_h[\log L_t] = t \cdot E_h\left[\log \frac{f(w)}{g(w)}\right]
\]</div>
<p>where <span class="math notranslate nohighlight">\(w \sim h\)</span>.</p>
<p>Therefore</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{t} E_h[\log L_t] = E_h\left[\log \frac{f(w)}{g(w)}\right] = E_h[\log f(w)] - E_h[\log g(w)]
\]</div>
<p>Now, from the definition of Kullback-Leibler divergence</p>
<div class="math notranslate nohighlight">
\[
K_f = \int h(w) \log \frac{h(w)}{f(w)} dw = E_h[\log h(w)] - E_h[\log f(w)]
\]</div>
<p>This gives us</p>
<div class="math notranslate nohighlight">
\[
E_h[\log f(w)] = E_h[\log h(w)] - K_f
\]</div>
<p>Similarly</p>
<div class="math notranslate nohighlight">
\[
E_h[\log g(w)] = E_h[\log h(w)] - K_g
\]</div>
<p>Substituting back</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
\frac{1}{t} E_h[\log L_t] &amp;= E_h[\log f(w)] - E_h[\log g(w)] \\
&amp;= [E_h[\log h(w)] - K_f] - [E_h[\log h(w)] - K_g] \\
&amp;= K_g - K_f
\end{aligned}
\end{split}\]</div>
</section>
</div>
<div class="exercise admonition" id="lr_ex2">

<p class="admonition-title"><span class="caption-number">Exercise 22.2 </span></p>
<section id="exercise-content">
<p>Building on <a class="reference internal" href="#lr_ex1"><span class="std std-numref">Exercise 22.1</span></a>, use the result to explain what happens to <span class="math notranslate nohighlight">\(L_t\)</span> as <span class="math notranslate nohighlight">\(t \to \infty\)</span> in the following cases:</p>
<ol class="arabic simple">
<li><p>When <span class="math notranslate nohighlight">\(K_g &gt; K_f\)</span> (i.e., <span class="math notranslate nohighlight">\(f\)</span> is “closer” to <span class="math notranslate nohighlight">\(h\)</span> than <span class="math notranslate nohighlight">\(g\)</span> is)</p></li>
<li><p>When <span class="math notranslate nohighlight">\(K_g &lt; K_f\)</span> (i.e., <span class="math notranslate nohighlight">\(g\)</span> is “closer” to <span class="math notranslate nohighlight">\(h\)</span> than <span class="math notranslate nohighlight">\(f\)</span> is)</p></li>
</ol>
<p>Relate your answer to the simulation results shown in <a class="reference internal" href="#llr-h"><span class="std std-ref">this section</span></a>.</p>
</section>
</div>
<div class="solution dropdown admonition" id="likelihood_ratio_process-solution-3">

<p class="admonition-title">Solution</p>
<section id="solution-content">
<p>From <a class="reference internal" href="#lr_ex1"><span class="std std-numref">Exercise 22.1</span></a>, we know that:</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{t} E_h[\log L_t] = K_g - K_f
\]</div>
<p><strong>Case 1:</strong> When <span class="math notranslate nohighlight">\(K_g &gt; K_f\)</span></p>
<p>Here, <span class="math notranslate nohighlight">\(f\)</span> is “closer” to <span class="math notranslate nohighlight">\(h\)</span> than <span class="math notranslate nohighlight">\(g\)</span> is. Since <span class="math notranslate nohighlight">\(K_g - K_f &gt; 0\)</span></p>
<div class="math notranslate nohighlight">
\[
E_h[\log L_t] = t \cdot (K_g - K_f) \to +\infty \text{ as } t \to \infty
\]</div>
<p>By the Law of Large Numbers, <span class="math notranslate nohighlight">\(\frac{1}{t} \log L_t \to K_g - K_f &gt; 0\)</span> almost surely.</p>
<p>Therefore <span class="math notranslate nohighlight">\(L_t \to +\infty\)</span> almost surely.</p>
<p><strong>Case 2:</strong> When <span class="math notranslate nohighlight">\(K_g &lt; K_f\)</span></p>
<p>Here, <span class="math notranslate nohighlight">\(g\)</span> is “closer” to <span class="math notranslate nohighlight">\(h\)</span> than <span class="math notranslate nohighlight">\(f\)</span> is. Since <span class="math notranslate nohighlight">\(K_g - K_f &lt; 0\)</span></p>
<div class="math notranslate nohighlight">
\[
E_h[\log L_t] = t \cdot (K_g - K_f) \to -\infty \text{ as } t \to \infty
\]</div>
<p>Therefore by similar reasoning <span class="math notranslate nohighlight">\(L_t \to 0\)</span> almost surely.</p>
</section>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                    </div>
                    
                </main> <!-- .page__content -->
                


                <footer class="qe-page__footer">

                    <p><a href="https://creativecommons.org/licenses/by-sa/4.0/"><img src="https://licensebuttons.net/l/by-sa/4.0/80x15.png"></a></p>

                    <p>Creative Commons License &ndash; This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International.</p>

                    <p>A theme by <a href="https://quantecon.org">QuantEcon</a></p>

                </footer> <!-- .page__footer -->

            </div> <!-- .page -->

            

            
            <div class="qe-sidebar bd-sidebar inactive" id="site-navigation">

                <div class="qe-sidebar__header">


                    Contents

                </div>

                <nav class="qe-sidebar__nav" id="qe-sidebar-nav" aria-label="Main navigation">
                    <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tools and Techniques
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="sir_model.html">
   1. Modeling COVID 19
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="linear_algebra.html">
   2. Linear Algebra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="qr_decomp.html">
   3. QR Decomposition
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="eig_circulant.html">
   4. Circulant Matrices
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="svd_intro.html">
   5. Singular Value Decomposition (SVD)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="var_dmd.html">
   6. VARs and DMDs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="newton_method.html">
   7. Using Newton’s Method to Solve Economic Models
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Elementary Statistics
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="prob_matrix.html">
   8. Elementary Probability with Matrices
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stats_examples.html">
   9. Some Probability Distributions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lln_clt.html">
   10. LLN and CLT
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="prob_meaning.html">
   11. Two Meanings of Probability
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="multi_hyper.html">
   12. Multivariate Hypergeometric Distribution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="multivariate_normal.html">
   13. Multivariate Normal Distribution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="hoist_failure.html">
   14. Fault Tree Uncertainties
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="back_prop.html">
   15. Introduction to Artificial Neural Networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rand_resp.html">
   16. Randomized Response Surveys
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="util_rand_resp.html">
   17. Expected Utilities of Random Responses
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Bayes Law
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="bayes_nonconj.html">
   18. Non-Conjugate Priors
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ar1_bayes.html">
   19. Posterior Distributions for  AR(1) Parameters
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ar1_turningpts.html">
   20. Forecasting  an AR(1) Process
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Statistics and Information
 </span>
</p>
<ul class="current nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="divergence_measures.html">
   21. Statistical Divergence Measures
  </a>
 </li>
 <li class="toctree-l1 current active active">
  <a class="current reference internal" href="#">
   22. Likelihood Ratio Processes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="likelihood_ratio_process_2.html">
   23. Heterogeneous Beliefs and Financial Markets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="likelihood_var.html">
   24. Likelihood Processes For VAR Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="imp_sample.html">
   25. Mean of a Likelihood Ratio Process
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wald_friedman.html">
   26. A Problem that Stumped Milton Friedman
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wald_friedman_2.html">
   27. A Bayesian Formulation of Friedman and Wald’s Problem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="exchangeable.html">
   28. Exchangeability and Bayesian Updating
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="likelihood_bayes.html">
   29. Likelihood Ratio Processes and Bayesian Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mix_model.html">
   30. Incorrect Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="navy_captain.html">
   31. Bayesian versus Frequentist Decision Rules
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Linear Programming
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="opt_transport.html">
   32. Optimal Transport
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="von_neumann_model.html">
   33. Von Neumann Growth Model (and a Generalization)
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introduction to Dynamics
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="finite_markov.html">
   34. Finite Markov Chains
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="inventory_dynamics.html">
   35. Inventory Dynamics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="linear_models.html">
   36. Linear State Space Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="samuelson.html">
   37. Samuelson Multiplier-Accelerator
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="kesten_processes.html">
   38. Kesten Processes and Firm Dynamics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wealth_dynamics.html">
   39. Wealth Distribution Dynamics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="kalman.html">
   40. A First Look at the Kalman Filter
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="kalman_2.html">
   41. Another Look at the Kalman Filter
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Search
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_model.html">
   42. Job Search I: The McCall Search Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_model_with_separation.html">
   43. Job Search II: Search and Separation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_model_with_sep_markov.html">
   44. Job Search III: Search with Separation and Markov Wages
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_fitted_vfi.html">
   45. Job Search IV: Fitted Value Function Iteration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_persist_trans.html">
   46. Job Search V: Persistent and Transitory Wage Shocks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="career.html">
   47. Job Search VI: Modeling Career Choice
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="jv.html">
   48. Job Search VII: On-the-Job Search
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="odu.html">
   49. Job Search VIII: Search with Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_q.html">
   50. Job Search IX: Search with Q-Learning
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Household Problems
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="cake_eating.html">
   51. Cake Eating I: Introduction to Optimal Saving
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cake_eating_numerical.html">
   52. Cake Eating II: Numerical Methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cake_eating_stochastic.html">
   53. Cake Eating III: Stochastic Dynamics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cake_eating_time_iter.html">
   54. Cake Eating IV: Time Iteration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cake_eating_egm.html">
   55. Cake Eating V: The Endogenous Grid Method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cake_eating_egm_jax.html">
   56. Cake Eating VI: EGM with JAX
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ifp.html">
   57. The Income Fluctuation Problem I: Basic Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ifp_advanced.html">
   58. The Income Fluctuation Problem II: Stochastic Returns on Assets
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  LQ Control
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="lqcontrol.html">
   59. LQ Control: Foundations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lagrangian_lqdp.html">
   60. Lagrangian for LQ Control
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cross_product_trick.html">
   61. Eliminating Cross Products
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="perm_income.html">
   62. The Permanent Income Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="perm_income_cons.html">
   63. Permanent Income II: LQ Techniques
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lq_inventories.html">
   64. Production Smoothing via Inventories
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Optimal Growth
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="cass_koopmans_1.html">
   65. Cass-Koopmans Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cass_koopmans_2.html">
   66. Cass-Koopmans Competitive Equilibrium
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cass_fiscal.html">
   67. Cass-Koopmans Model with Distorting Taxes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cass_fiscal_2.html">
   68. Two-Country Model with Distorting Taxes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ak2.html">
   69. Transitions in an Overlapping Generations Model
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Multiple Agent Models
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="lake_model.html">
   70. A Lake Model of Employment and Unemployment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="endogenous_lake.html">
   71. Lake Model with an Endogenous Job Finding Rate
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rational_expectations.html">
   72. Rational Expectations Equilibrium
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="re_with_feedback.html">
   73. Stability in Linear Rational Expectations Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="markov_perf.html">
   74. Markov Perfect Equilibrium
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="uncertainty_traps.html">
   75. Uncertainty Traps
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="aiyagari.html">
   76. The Aiyagari Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ak_aiyagari.html">
   77. A Long-Lived, Heterogeneous Agent, Overlapping Generations Model
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Asset Pricing and Finance
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="markov_asset.html">
   78. Asset Pricing: Finite State Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ge_arrow.html">
   79. Competitive Equilibria with Arrow Securities
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="harrison_kreps.html">
   80. Heterogeneous Beliefs and Bubbles
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="morris_learn.html">
   81. Speculative Behavior with Bayesian Learning
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Data and Empirics
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="pandas_panel.html">
   82. Pandas for Panel Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ols.html">
   83. Linear Regression in Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mle.html">
   84. Maximum Likelihood Estimation
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Auctions
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="two_auctions.html">
   85. First-Price and Second-Price Auctions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="house_auction.html">
   86. Multiple Good Allocation Mechanisms
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Other
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="troubleshooting.html">
   87. Troubleshooting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="zreferences.html">
   88. References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="status.html">
   89. Execution Statistics
  </a>
 </li>
</ul>

                </nav>

                <div class="qe-sidebar__footer">

                </div>

            </div> <!-- .sidebar -->
            
        </div> <!-- .main -->

        <div class="qe-toolbar">

            <div class="qe-toolbar__inner">

                <ul class="qe-toolbar__main">
                    <li data-tippy-content="Table of Contents" class="btn__sidebar"><i data-feather="menu"></i></li>
                    <li data-tippy-content="Home"><a href="intro.html"><i data-feather="home"></i></a></li>
                    <li class="btn__qelogo"><a href="https://quantecon.org" title=""><span class="show-for-sr">QuantEcon</span></a></li>
                </ul>

                <ul class="qe-toolbar__links">
                    <li class="btn__search">
                        <form action="search.html" method="get">
                            <input type="search" class="form-control" name="q" id="search-input" placeholder="Search..." aria-label="Search..." autocomplete="off" accesskey="k">
                            <i data-feather="search" id="search-icon"></i>
                        </form>
                    </li>
                    <li data-tippy-content="Fullscreen" class="btn__fullscreen"><i data-feather="maximize"></i></li>
                    <li data-tippy-content="Increase font size" class="btn__plus"><i data-feather="plus-circle"></i></li>
                    <li data-tippy-content="Decrease font size" class="btn__minus"><i data-feather="minus-circle"></i></li>
                    <li data-tippy-content="Change contrast" class="btn__contrast"><i data-feather="sunset"></i></li>
                    <li data-tippy-content="Download Notebook"><a href="/_notebooks/likelihood_ratio_process.ipynb" download><i data-feather="download-cloud"></i></a></li>
                    <li class="settings-button" id="settingsButton"><div data-tippy-content="Launch Notebook"><i data-feather="play-circle"></i></div></li>
                        <li class="download-pdf" id="downloadButton"><i data-feather="file"></i></li>
                    <!--
                    # Enable if looking for link to specific document hosted on GitHub
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/QuantEcon/lecture-python.myst/blob/main/lectures/likelihood_ratio_process.md" download><i data-feather="github"></i></a></li>
                    -->
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/QuantEcon/lecture-python.myst" download><i data-feather="github"></i></a></li>
                </ul>

            </div>

        </div> <!-- .toolbar -->
        <div id="downloadPDFModal" style="display: none;">
            <ul class="pdf-options" style="display: block;">
                <li class="download-pdf-book" onClick="window.print()">
                    <p>Lecture (PDF)</p>
                </li>
                <li class="download-pdf-file">
                    <a href="/_pdf/quantecon-python.pdf" download><p>Book (PDF)</p></a>
                </li>
            </ul>
        </div>
        <div id="settingsModal" style="display: none;">
            <p class="modal-title"> Notebook Launcher </p>
            <div class="modal-desc">
            <p>
                Choose public or private cloud service for "Launch" button.
            </p>
            </div>
            <p class="modal-subtitle">Select a server</p>
            <ul class="modal-servers">
            <li class="active launcher-public">
                <span class="label">Public</span>
                <select id="launcher-public-input">
                
                    <option value="https://colab.research.google.com/github/QuantEcon/lecture-python.notebooks/blob/main/lectures/likelihood_ratio_process.ipynb">Colab</option>
                
                </select>
                <i class="fas fa-check-circle"></i>
            </li>
            <li class="launcher-private">
                <span class="label">Private</span>
                <input type="text" id="launcher-private-input" data-repourl="https://github.com/QuantEcon/lecture-python.notebooks" data-urlpath="tree/lecture-python.notebooks/lectures/likelihood_ratio_process.ipynb" data-branch=main>
                <i class="fas fa-check-circle"></i>
            </li>
            </ul>
            <p class="launch"><a href="https://colab.research.google.com/github/QuantEcon/lecture-python.notebooks/blob/main/lectures/likelihood_ratio_process.ipynb" id="advancedLaunchButton" target="_blank">Launch Notebook</a></p>
            <script>
                // QuantEcon Notebook Launcher
                const launcherTypeElements = document.querySelectorAll('#settingsModal .modal-servers li');
                // Highlight the server type if previous selection exists
                if (typeof localStorage.launcherType !== 'undefined') {
                  for (var i = 0; i < launcherTypeElements.length; i++) {
                    launcherTypeElements[i].classList.remove('active');
                    if ( launcherTypeElements[i].classList.contains(localStorage.launcherType) ) {
                      launcherTypeElements[i].classList.add('active');
                    }
                  }
                }
                // Highlight server type on click and set local storage value
                for (var i = 0; i < launcherTypeElements.length; i++) {
                  launcherTypeElements[i].addEventListener('click', function() {
                    for (var j = 0; j < launcherTypeElements.length; j++) {
                      launcherTypeElements[j].classList.remove('active');
                    }
                    this.classList.add('active');
                    if ( this.classList.contains('launcher-private') ) {
                      localStorage.launcherType = 'launcher-private';
                    } else if ( this.classList.contains('launcher-public') ) {
                      localStorage.launcherType = 'launcher-public';
                    }
                    setLaunchServer();
                  })
                }
                const launcherPublic = document.getElementById('launcher-public-input');
                const launcherPrivate = document.getElementById('launcher-private-input');
                const pageName = "likelihood_ratio_process";
                const repoURL = "https://github.com/QuantEcon/lecture-python.notebooks";
                const urlPath = "tree/lecture-python.notebooks/lectures/likelihood_ratio_process.ipynb";
                const branch = "main"
                const launchNotebookLink = document.getElementById('advancedLaunchButton');

                // Highlight public server option if previous selection exists
                if (typeof localStorage.launcherPublic !== 'undefined') {
                  launcherPublic.value = localStorage.launcherPublic;
                }
                // Update local storage upon public server selection
                launcherPublic.addEventListener('change', (event) => {
                  setLaunchServer();
                });
                // Populate private server input if previous entry exists
                if (typeof localStorage.launcherPrivate !== 'undefined') {
                  launcherPrivate.value = localStorage.launcherPrivate;
                }
                // Update local storage when a private server is entered
                launcherPrivate.addEventListener('input', (event) => {
                  setLaunchServer();
                });

                // Function to update the "Launch Notebook" link href
                function setLaunchServer() {
                  launchNotebookLink.removeAttribute("style")
                  if ( localStorage.launcherType == 'launcher-private' ) {
                    let repoPrefix = "/user-redirect/git-pull?repo=" + repoURL + "&branch=" + branch + "&urlpath=" + urlPath;
                    launcherPrivateValue = launcherPrivate.value
                    if (!launcherPrivateValue) {
                        launchNotebookLink.removeAttribute("href")
                        launchNotebookLink.style.background = "grey"
                        return
                    }
                    localStorage.launcherPrivate = launcherPrivateValue;
                    privateServer = localStorage.launcherPrivate.replace(/\/$/, "")
                    if (!privateServer.includes("http")) {
                        privateServer = "http://" + privateServer
                    }
                    launchNotebookLinkURL = privateServer + repoPrefix;
                  } else if ( localStorage.launcherType == 'launcher-public' ) {
                    launcherPublicValue = launcherPublic.options[launcherPublic.selectedIndex].value;
                    localStorage.launcherPublic = launcherPublicValue;
                    launchNotebookLinkURL = localStorage.launcherPublic;
                  }
                  if (launchNotebookLinkURL) launchNotebookLink.href = launchNotebookLinkURL;
                }
                // Check if user has previously selected a server
                if ( (typeof localStorage.launcherPrivate !== 'undefined') || (typeof localStorage.launcherPublic !== 'undefined') ) {
                  setLaunchServer();
                }
                </script>

        </div>

    </div> <!-- .wrapper-->
  </body>
</html>