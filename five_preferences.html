
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>13. Risk and Model Uncertainty &#8212; Quantitative Economics with Python</title>
    <script src="https://unpkg.com/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/tippy.js@6.3.1/dist/tippy-bundle.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
        <script>
            MathJax = {
            loader: {load: ['[tex]/boldsymbol', '[tex]/textmacros']},
            tex: {
                packages: {'[+]': ['boldsymbol', 'textmacros']},
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                processEscapes: true,
                macros: {
                    "argmax" : "arg\\,max",
                    "argmin" : "arg\\,min",
                    "col"    : "col",
                    "Span"   :  "span",
                    "epsilon": "\\varepsilon",
                    "EE": "\\mathbb{E}",
                    "PP": "\\mathbb{P}",
                    "RR": "\\mathbb{R}",
                    "NN": "\\mathbb{N}",
                    "ZZ": "\\mathbb{Z}",
                    "aA": "\\mathcal{A}",
                    "bB": "\\mathcal{B}",
                    "cC": "\\mathcal{C}",
                    "dD": "\\mathcal{D}",
                    "eE": "\\mathcal{E}",
                    "fF": "\\mathcal{F}",
                    "gG": "\\mathcal{G}",
                    "hH": "\\mathcal{H}",
                }
            },
            svg: {
                fontCache: 'global',
                scale: 0.92,
                displayAlign: "center",
            },
            };
        </script>
    
    
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/quantecon-book-theme.857ff391aaabaeb8c161d2309c375fe6.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">


    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script src="_static/quantecon-book-theme.76bf49d7bbc59738cdb03766fad654af.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-svg.js"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"TeX": {"Macros": {"argmax": "arg\\,max", "argmin": "arg\\,min"}}, "tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://python.quantecon.org/five_preferences.html" />
    <link rel="shortcut icon" href="_static/lectures-favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="14. Linear Programming" href="lp_intro.html" />
    <link rel="prev" title="12. Univariate Time Series with Matrix Algebra" href="time_series_with_matrices.html" />

<!-- Normal Meta Tags -->
<meta name="author" context="Thomas J. Sargent &amp; John Stachurski" />
<meta name="keywords" content="Python, QuantEcon, Quantitative Economics, Economics, Sloan, Alfred P. Sloan Foundation, Tom J. Sargent, John Stachurski" />
<meta name="description" content=This website presents a set of lectures on quantitative economic modeling, designed and written by Thomas J. Sargent and John Stachurski. />

<!-- Twitter tags -->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@quantecon" />
<meta name="twitter:title" content="Risk and Model Uncertainty"/>
<meta name="twitter:description" content="This website presents a set of lectures on quantitative economic modeling, designed and written by Thomas J. Sargent and John Stachurski.">
<meta name="twitter:creator" content="@quantecon">
<meta name="twitter:image" content="https://assets.quantecon.org/img/qe-twitter-logo.png">

<!-- Opengraph tags -->
<meta property="og:title" content="Risk and Model Uncertainty" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://python.quantecon.org/five_preferences.html" />
<meta property="og:image" content="https://assets.quantecon.org/img/qe-og-logo.png" />
<meta property="og:description" content="This website presents a set of lectures on quantitative economic modeling, designed and written by Thomas J. Sargent and John Stachurski." />
<meta property="og:site_name" content="Quantitative Economics with Python" />
<meta name="theme-color" content="#ffffff" />

  </head>
<body>


    <span id="top"></span>

    <div class="wrapper">

        <div class="main">

            <div class="page" id=five_preferences>

                <div class="page__toc">

                    <div class="inner">

                        
                        <div class="page__toc-header">
                            On this page
                        </div>


                        <nav id="bd-toc-nav" class="page__toc-nav">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#overview">
   13.1. Overview
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#basic-objects">
   13.2. Basic objects
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#five-preference-specifications">
   13.3. Five preference specifications
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#expected-utility">
   13.4. Expected utility
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#constraint-preferences">
   13.5. Constraint preferences
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#multiplier-preferences">
   13.6. Multiplier preferences
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#risk-sensitive-preferences">
   13.7. Risk-sensitive preferences
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#digression-on-moment-generating-functions">
     13.7.1. Digression on moment generating functions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ex-post-bayesian-preferences">
   13.8. Ex post Bayesian preferences
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#comparing-preferences">
   13.9. Comparing preferences
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#risk-aversion-and-misspecification-aversion">
   13.10. Risk aversion and misspecification aversion
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#indifference-curves">
   13.11. Indifference curves
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#state-price-deflators">
   13.12. State price deflators
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#consumption-equivalent-measures-of-uncertainty-aversion">
     13.12.1. Consumption-equivalent measures of uncertainty aversion
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#iso-utility-and-iso-entropy-curves-and-expansion-paths">
   13.13. Iso-utility and iso-entropy curves and expansion paths
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bounds-on-expected-utility">
   13.14. Bounds on expected utility
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#why-entropy">
   13.15. Why entropy?
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#entropy-and-statistical-detection">
     13.15.1. Entropy and statistical detection
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#axiomatic-justifications">
     13.15.2. Axiomatic justifications
    </a>
   </li>
  </ul>
 </li>
</ul>

                            <p class="logo">
                                
                                    
                                    <a href=https://quantecon.org><img src="_static/qe-logo-large.png" class="logo" alt="logo"></a>
                                    
                                
                            </p>

                            <p class="powered">Powered by <a href="https://jupyterbook.org/">Jupyter Book</a></p>

                        </nav>

                        <div class="page__toc-footer">
                            
                            
                            <p><a href="#top"><strong>Back to top</strong></a></p>
                        </div>

                    </div>

                </div>

                <div class="page__header">

                    <div class="page__header-copy">

                        <p class="page__header-heading"><a href="intro.html">Quantitative Economics with Python</a></p>

                        <p class="page__header-subheading">Risk and Model Uncertainty</p>

                    </div>

                    <p class="page__header-authors">Thomas J. Sargent & John Stachurski</p>

                </div> <!-- .page__header -->



                
                <main class="page__content" role="main">
                    
                    <div>
                        
  <div class="section" id="risk-and-model-uncertainty">
<h1><span class="section-number">13. </span>Risk and Model Uncertainty<a class="headerlink" href="#risk-and-model-uncertainty" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2><span class="section-number">13.1. </span>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>As an introduction to one possible approach to modeling <strong>Knightian  uncertainty</strong>,
this lecture describes static representations of five classes of preferences over risky prospects.</p>
<p>These preference specifications  allow  us to distinguish <strong>risk</strong> from <strong>uncertainty</strong> along lines proposed by
<span id="id1">[<a class="reference internal" href="zreferences.html#id3">Kni21</a>]</span>.</p>
<p>All  five preference specifications incorporate <strong>risk aversion</strong>, meaning displeasure from  risks governed by  well known probability distributions.</p>
<p>Two of them also incorporate  <strong>uncertainty aversion</strong>, meaning  dislike of not knowing a  probability distribution.</p>
<p>The preference orderings are</p>
<ul class="simple">
<li><p>Expected utility preferences</p></li>
<li><p>Constraint preferences</p></li>
<li><p>Multiplier preferences</p></li>
<li><p>Risk-sensitive preferences</p></li>
<li><p>Ex post Bayesian expected utility preferences</p></li>
</ul>
<p>This labeling  scheme is taken from <span id="id2">[<a class="reference internal" href="zreferences.html#id46">HS01</a>]</span>.</p>
<p>Constraint and multiplier preferences express  aversion to not knowing a unique probabiity distribution
that desribes random outcomes.</p>
<p>Expected utility, risk-sensitive, and ex post Bayesian expected utility preferences all attribute a unique known
probability distribution to a decision maker.</p>
<p>We present things in a simple before-and-after one-period setting.</p>
<p>In addition to learning about these preference orderings, this lecture also describes some interesting code for computing and graphing some representations  of indifference curves, utility functions, and related objects.</p>
<p>Staring at these indifference curves provides insights into the different preferences.</p>
<p>Watch for the presence of a kink at the <span class="math notranslate nohighlight">\(45\)</span> degree line for the constraint preference indifference curves.</p>
<p>We begin with some that we’ll use to create some graphs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Package imports</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rc</span><span class="p">,</span> <span class="n">cm</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">optimize</span><span class="p">,</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">scipy.io</span> <span class="kn">import</span> <span class="n">loadmat</span>
<span class="kn">from</span> <span class="nn">matplotlib.collections</span> <span class="kn">import</span> <span class="n">LineCollection</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">ListedColormap</span><span class="p">,</span> <span class="n">BoundaryNorm</span>
<span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">njit</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting parameters</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="o">%</span><span class="k">config</span> InlineBackend.figure_format=&#39;retina&#39;

<span class="n">rc</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">usetex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">label_size</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">label_tick_size</span> <span class="o">=</span> <span class="mi">18</span>
<span class="n">title_size</span> <span class="o">=</span> <span class="mi">24</span>
<span class="n">legend_size</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">text_size</span> <span class="o">=</span> <span class="mi">18</span>

<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">label_size</span> 
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;ytick.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">label_tick_size</span> 
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;xtick.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">label_tick_size</span> 
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.titlesize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">title_size</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;legend.fontsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legend_size</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">text_size</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Useful functions</span>
<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">ent</span><span class="p">(</span><span class="n">π</span><span class="p">,</span> <span class="n">π_hat</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the relative entropy of a probability vector `π_hat` with respect to `π`. JIT-compiled using Numba.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ent_val</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">π_hat</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">π</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">π_hat</span><span class="p">)))</span>
    
    <span class="k">return</span> <span class="n">ent_val</span>


<span class="k">def</span> <span class="nf">T_θ_factory</span><span class="p">(</span><span class="n">θ</span><span class="p">,</span> <span class="n">π</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return an operator `T_θ` for a given penalty parameter `θ` and probability distribution vector `π`.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">T_θ</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>  
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Risk-sensitivity operator of Jacobson (1973) and Whittle (1981) taking a function `u` as argument.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="o">-</span><span class="n">θ</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">π</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">u</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="n">θ</span><span class="p">)))</span>
    
    <span class="k">return</span> <span class="n">T_θ</span>


<span class="k">def</span> <span class="nf">compute_change_measure</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">θ</span><span class="p">,</span> <span class="n">π</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the channge of measure given a utility function `u`, a consumption vector `c`,</span>
<span class="sd">    a penalty parameter `θ` and a baseline probability vector `π` </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">m_unnormalized</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">u</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="n">θ</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span>  <span class="n">m_unnormalized</span> <span class="o">/</span> <span class="p">(</span><span class="n">π</span> <span class="o">*</span> <span class="n">m_unnormalized</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">m</span>


<span class="k">def</span> <span class="nf">utility_function_factory</span><span class="p">(</span><span class="n">α</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a CRRA utility function parametrized by `α` </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">α</span> <span class="o">==</span> <span class="mf">1.</span><span class="p">:</span>
        <span class="k">return</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="k">return</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">α</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">α</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="basic-objects">
<h2><span class="section-number">13.2. </span>Basic objects<a class="headerlink" href="#basic-objects" title="Permalink to this headline">¶</a></h2>
<p>Basic ingredients are</p>
<ul class="simple">
<li><p>a set of states of the world</p></li>
<li><p>plans describing outcomes as functions of the state of the world,</p></li>
<li><p>a utility function mapping outcomes into utilities</p></li>
<li><p>either a probability distribution or a <strong>set</strong> of probability distributions over states of the world; and</p></li>
<li><p>a way of measuring a discrepancy between two probability distributions.</p></li>
</ul>
<p>In more detail, we’ll work with the following setting.</p>
<ul class="simple">
<li><p>A finite set of possible <strong>states</strong> <span class="math notranslate nohighlight">\({\cal I} = \{i= 1, \ldots, I\}\)</span>.</p></li>
<li><p>A (consumption) <strong>plan</strong> is a function <span class="math notranslate nohighlight">\(c: {\cal I} \rightarrow {\mathbb R}\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(u: {\mathbb R} \rightarrow {\mathbb R}\)</span>  is a <strong>utility function</strong>.</p></li>
<li><p><span class="math notranslate nohighlight">\(\pi\)</span> is an <span class="math notranslate nohighlight">\(I \times 1\)</span> vector of nonnegative <strong>probabilities</strong> over  states, with <span class="math notranslate nohighlight">\(\pi_ i \geq 0, \sum_{i=1}^I \pi_i = 1\)</span>.</p></li>
<li><p><strong>Relative entropy</strong>  <span class="math notranslate nohighlight">\( \textrm{ent}(\pi, \hat \pi)\)</span> of a probability vector  <span class="math notranslate nohighlight">\(\hat \pi\)</span> with respect to a probability vector <span class="math notranslate nohighlight">\(\pi\)</span> is the expected value of the logarithm of the  likelihood ratio <span class="math notranslate nohighlight">\(m_i \doteq \Bigl( \frac{\hat \pi_i}{\pi_i} \Bigr) \)</span>  under   distribution <span class="math notranslate nohighlight">\(\hat \pi\)</span> defined as:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
\textrm{ent}(\pi, \hat \pi) = \sum_{i=1}^I \hat \pi_i  \log \Bigl( \frac{\hat \pi_i}{\pi_i} \Bigr)   = \sum_{i=1}^I \pi_i \Bigl( \frac{\hat \pi_i}{\pi_i} \Bigr) \log \Bigl( \frac{\hat \pi_i}{\pi_i} \Bigr)  
\]</div>
<p>or</p>
<div class="math notranslate nohighlight">
\[
\textrm{ent}(\pi, \hat \pi) = \sum_{i=1}^I \pi_i m_i \log m_i  .
\]</div>
<p><strong>Remark:</strong> A likelihood ratio <span class="math notranslate nohighlight">\(m_i\)</span> is a discrete random variable. For any discrete random variable <span class="math notranslate nohighlight">\(\{x_i\}_{i=1}^I\)</span>, the expected  value of <span class="math notranslate nohighlight">\(x\)</span>  under the <span class="math notranslate nohighlight">\(\hat \pi_i\)</span> distribution can be represented as the expected  value  under the <span class="math notranslate nohighlight">\(\pi\)</span> distribution of the product of  <span class="math notranslate nohighlight">\(x_i\)</span> times the `shock’  <span class="math notranslate nohighlight">\(m_i\)</span>:</p>
<div class="math notranslate nohighlight">
\[
\hat E x = \sum_{i=1}^I x_i \hat \pi_i = \sum_{i=1}^I m_i x_i  \pi_i = E m x ,
\]</div>
<p>where <span class="math notranslate nohighlight">\(\hat E\)</span> is the mathematical  expectation under the <span class="math notranslate nohighlight">\(\hat \pi\)</span> distribution and <span class="math notranslate nohighlight">\(E\)</span> is the expectation under the <span class="math notranslate nohighlight">\(\pi\)</span> distribution.</p>
<p>Evidently,</p>
<div class="math notranslate nohighlight">
\[ 
\hat E 1 = E m = 1
\]</div>
<p>and relative entropy is</p>
<div class="math notranslate nohighlight">
\[
E m \log m  = \hat E \log m .
\]</div>
<p>In the three figures below, we plot relative entropy from several perspectives.</p>
<p>Our first figure depicts  entropy as a function of <span class="math notranslate nohighlight">\(\hat \pi_1\)</span> when <span class="math notranslate nohighlight">\(I=2\)</span> and <span class="math notranslate nohighlight">\(\pi_1 = .5\)</span>.</p>
<p>When <span class="math notranslate nohighlight">\(\pi_1 \in (0,1)\)</span>, entropy is finite for both <span class="math notranslate nohighlight">\(\hat \pi_1 = 0\)</span>  and <span class="math notranslate nohighlight">\(\hat \pi_1 = 1\)</span> because <span class="math notranslate nohighlight">\(\lim_{x\rightarrow 0} x \log x = 0\)</span></p>
<p>However, when <span class="math notranslate nohighlight">\(\pi_1=0\)</span> or <span class="math notranslate nohighlight">\(\pi_1=1\)</span>, entropy  is infinite.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Specify baseline probability vector `π`</span>
<span class="n">π</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>

<span class="c1"># Construct grid for `π_hat_0` values</span>
<span class="n">min_prob</span> <span class="o">=</span> <span class="mf">1e-2</span>
<span class="n">π_hat_0_nb</span> <span class="o">=</span> <span class="mi">201</span>
<span class="n">π_hat_0_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">min_prob</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">min_prob</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">π_hat_0_nb</span><span class="p">)</span>

<span class="c1"># Initialize `π_hat` vector with arbitrary values</span>
<span class="n">π_hat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Initialize `ent_vals` to store entropy values</span>
<span class="n">ent_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">π_hat_0_vals</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">π_hat_0_vals</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>  <span class="c1"># Loop over all possible values for `π_hat_0` </span>
    <span class="c1"># Update `π_hat` values</span>
    <span class="n">π_hat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">π_hat_0_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">π_hat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">π_hat_0_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    
    <span class="c1"># Compute and store entropy value</span>
    <span class="n">ent_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ent</span><span class="p">(</span><span class="n">π</span><span class="p">,</span> <span class="n">π_hat</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">π_hat_0_vals</span><span class="p">,</span> <span class="n">ent_vals</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;entropy ($\pi_</span><span class="si">{1}</span><span class="s1">=</span><span class="si">%.2f</span><span class="s1">$)&#39;</span> <span class="o">%</span> <span class="n">π</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\hat{\pi}_1$&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="figure" id="figure1">
<img alt="_images/five_preferences_6_0.png" src="_images/five_preferences_6_0.png" />
<p class="caption"><span class="caption-text"><p>Figure 1</p>
</span><a class="headerlink" href="#figure1" title="Permalink to this image">¶</a></p>
</div>
</div>
</div>
<p>The heat maps in  the next two  figures vary both <span class="math notranslate nohighlight">\(\hat{\pi}_1\)</span> and <span class="math notranslate nohighlight">\(\pi_1\)</span>.</p>
<p>The following figure plots  entropy.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use same grid for `π_0_vals` as for `π_hat_0_vals` </span>
<span class="n">π_0_vals</span> <span class="o">=</span> <span class="n">π_hat_0_vals</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> 

<span class="c1"># Initialize matrix of entropy values</span>
<span class="n">ent_vals_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">π_0_vals</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">π_hat_0_vals</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">π_0_vals</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>  <span class="c1"># Loop over all possible values for `π_0` </span>
    <span class="c1"># Update `π` values</span>
    <span class="n">π</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">π_0_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">π</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">π_0_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">π_hat_0_vals</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>  <span class="c1"># Loop over all possible values for `π_hat_0` </span>
        <span class="c1"># Update `π_hat` values</span>
        <span class="n">π_hat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">π_hat_0_vals</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">π_hat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">π_hat_0_vals</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        
        <span class="c1"># Compute and store entropy value</span>
        <span class="n">ent_vals_mat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">ent</span><span class="p">(</span><span class="n">π</span><span class="p">,</span> <span class="n">π_hat</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">π_0_vals</span><span class="p">,</span> <span class="n">π_hat_0_vals</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ent_vals_mat</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;seismic&#39;</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;gouraud&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">();</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\hat{\pi}_1$&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\pi_1$&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Entropy Heat Map&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/five_preferences_9_0.png" src="_images/five_preferences_9_0.png" />
</div>
</div>
<p>The next figure plots  the logarithm of entropy.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check the point (0.01, 0.9)</span>
<span class="n">π</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">])</span>
<span class="n">π_hat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])</span>
<span class="n">ent</span><span class="p">(</span><span class="n">π</span><span class="p">,</span> <span class="n">π_hat</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.8205752275831846
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">ent_vals_mat</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;gouraud&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;seismic&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\hat{\pi}_1$&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\pi_1$&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Log Entropy Heat Map&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-9-e6e121469615&gt;:2: RuntimeWarning: divide by zero encountered in log
  plt.pcolormesh(x, y, np.log(ent_vals_mat.T), shading=&#39;gouraud&#39;, cmap=&#39;seismic&#39;)
</pre></div>
</div>
<img alt="_images/five_preferences_12_1.png" src="_images/five_preferences_12_1.png" />
</div>
</div>
</div>
<div class="section" id="five-preference-specifications">
<h2><span class="section-number">13.3. </span>Five preference specifications<a class="headerlink" href="#five-preference-specifications" title="Permalink to this headline">¶</a></h2>
<p>We describe five types of preferences over plans.</p>
<ul class="simple">
<li><p>Expected utility preferences</p></li>
<li><p>Constraint preferences</p></li>
<li><p>Multiplier preferences</p></li>
<li><p>Risk-sensitive preferences</p></li>
<li><p>Ex post Bayesian expected utility preferences</p></li>
</ul>
<p>Expected utility, risk-sensitive, and ex post Bayesian prefernces are  each cast in terms of a unique probability distribution, so they can express risk-aversion, but not model ambiguity aversion.</p>
<p>Multiplier and constraint prefernces both  express aversion to
concerns about model misppecification, i.e., model uncertainty;  both are cast  in terms of a set or sets  of probability distributions.</p>
<ul class="simple">
<li><p>The set of distributions expresses the decision maker’s ambiguity about the probability model.</p></li>
<li><p>Minimization over probability distributions expresses his aversion to ambiguity.</p></li>
</ul>
</div>
<div class="section" id="expected-utility">
<h2><span class="section-number">13.4. </span>Expected utility<a class="headerlink" href="#expected-utility" title="Permalink to this headline">¶</a></h2>
<p>A decision maker is said to have <strong>expected utility preferences</strong> when he ranks plans <span class="math notranslate nohighlight">\(c\)</span> by their expected utilities</p>
<div class="math notranslate nohighlight" id="equation-tom1">
<span class="eqno">(13.1)<a class="headerlink" href="#equation-tom1" title="Permalink to this equation">¶</a></span>\[
\sum_{i=1}^I u(c_i) \pi_i, 
\]</div>
<p>where <span class="math notranslate nohighlight">\(u\)</span> is a unique utility function and <span class="math notranslate nohighlight">\(\pi\)</span> is a unique probability measure over states.</p>
<ul class="simple">
<li><p>A known <span class="math notranslate nohighlight">\(\pi\)</span> expresses risk.</p></li>
<li><p>Curvature of <span class="math notranslate nohighlight">\(u\)</span> expresses
risk aversion.</p></li>
</ul>
</div>
<div class="section" id="constraint-preferences">
<h2><span class="section-number">13.5. </span>Constraint preferences<a class="headerlink" href="#constraint-preferences" title="Permalink to this headline">¶</a></h2>
<p>A decision maker is said to have <strong>constraint preferences</strong> when he ranks plans <span class="math notranslate nohighlight">\(c\)</span> according to</p>
<div class="math notranslate nohighlight" id="equation-tom2">
<span class="eqno">(13.2)<a class="headerlink" href="#equation-tom2" title="Permalink to this equation">¶</a></span>\[
\min_{\{m_i \geq 0\}_{i=1}^I}  \sum_{i=1}^I m_i\pi_i  u(c_i)
\]</div>
<p>subject to</p>
<div class="math notranslate nohighlight" id="equation-tom3">
<span class="eqno">(13.3)<a class="headerlink" href="#equation-tom3" title="Permalink to this equation">¶</a></span>\[
\sum_{i=1}^I \pi_i m_i \log m_i \leq \eta
\]</div>
<p>and</p>
<div class="math notranslate nohighlight" id="equation-tom4">
<span class="eqno">(13.4)<a class="headerlink" href="#equation-tom4" title="Permalink to this equation">¶</a></span>\[
\sum_{i=1}^I \pi_i m_i = 1 .
\]</div>
<p>In <a class="reference internal" href="#equation-tom3">(13.3)</a>,  <span class="math notranslate nohighlight">\(\eta \geq 0\)</span> defines an  entropy ball of probability distributions <span class="math notranslate nohighlight">\(\hat \pi = m \pi\)</span>  that surround a baseline distribution <span class="math notranslate nohighlight">\(\pi\)</span>.</p>
<p>As noted earlier,     <span class="math notranslate nohighlight">\(\sum_{i=1}^I m_i\pi_i  u(c_i)\)</span> is the expected value of <span class="math notranslate nohighlight">\(u(c)\)</span> under a twisted probability distribution <span class="math notranslate nohighlight">\(\{\hat \pi_i\}_{i=1}^I = \{m_i \pi_i\}_{i=1}^I\)</span>.</p>
<p>Larger values of the entropy constraint <span class="math notranslate nohighlight">\(\eta\)</span> indicate more apprehension about the baseline probability distribution <span class="math notranslate nohighlight">\(\{\pi_i\}_{i=1}^I\)</span>.</p>
<p>Following <span id="id3">[<a class="reference internal" href="zreferences.html#id46">HS01</a>]</span> and <span id="id4">[<a class="reference internal" href="zreferences.html#id142">HS08</a>]</span>, we call minimization problem  <a class="reference internal" href="#equation-tom2">(13.2)</a> subject to <a class="reference internal" href="#equation-tom3">(13.3)</a> and<a class="reference internal" href="#equation-tom4">(13.4)</a> a <strong>constraint problem</strong>.</p>
<p>To find  minimizing probabilities, we form a Lagrangian</p>
<div class="math notranslate nohighlight" id="equation-tom5">
<span class="eqno">(13.5)<a class="headerlink" href="#equation-tom5" title="Permalink to this equation">¶</a></span>\[
L = \sum_{i=1}^I m_i \pi_i u(c_i) +  \tilde \theta\bigl[\sum_{i=1}^I \pi_i m_i \log m_i - \eta \bigr]
\]</div>
<p>where <span class="math notranslate nohighlight">\(\tilde \theta \geq 0\)</span> is a Lagrange multiplier associated     with the entropy constraint.</p>
<p>Subject to the additional constraint that <span class="math notranslate nohighlight">\(\sum_{i=1}^I m_i  \pi_i =1\)</span>, we want to minimize <a class="reference internal" href="#equation-tom5">(13.5)</a> with respect to     <span class="math notranslate nohighlight">\(\{m_i\}_{i=1}^I\)</span> and to maximize it with respect to   <span class="math notranslate nohighlight">\(\tilde \theta\)</span>.</p>
<p>The minimizing probability distortions (likelihood ratios) are</p>
<div class="math notranslate nohighlight" id="equation-tom6">
<span class="eqno">(13.6)<a class="headerlink" href="#equation-tom6" title="Permalink to this equation">¶</a></span>\[
\tilde m_i(c;\tilde \theta)
= \frac{ \exp \bigl(- u(c_i)/\tilde \theta\bigr)}{\sum_j \pi_j \exp \bigl(- u(c_j) /\tilde \theta\bigr) } .
\]</div>
<p>To compute the Lagrange multiplier <span class="math notranslate nohighlight">\(\tilde \theta(c, \eta)\)</span>, we must
solve</p>
<div class="math notranslate nohighlight">
\[
\sum_i \pi_i \tilde m_i (c;\tilde \theta ) \log (\tilde m_i (c;\tilde \theta ))  = \eta
\]</div>
<p>or</p>
<div class="math notranslate nohighlight" id="equation-tom7">
<span class="eqno">(13.7)<a class="headerlink" href="#equation-tom7" title="Permalink to this equation">¶</a></span>\[
\sum_i \pi_i \frac{ \exp \bigl(- u(c_i)/\tilde \theta\bigr)}{\sum_j \pi_j \exp \bigl(- u(c_j)/\tilde \theta\bigr) }
\log \biggl[\frac{ \exp \bigl(- u(c_i)/\tilde \theta\bigr)}{\sum_j \pi_j \exp \bigl(- u(c_j)/\tilde \theta\bigr) }
\biggr] = \eta
\]</div>
<p>for <span class="math notranslate nohighlight">\(\tilde \theta = \tilde \theta(c; \eta)\)</span>.</p>
<p>For a fixed <span class="math notranslate nohighlight">\(\eta\)</span>, the <span class="math notranslate nohighlight">\(\tilde \theta\)</span> that solves equation <a class="reference internal" href="#equation-tom7">(13.7)</a> is evidently a function of the consumption plan <span class="math notranslate nohighlight">\(c\)</span>.</p>
<p>With <span class="math notranslate nohighlight">\(\tilde \theta(c;\eta)\)</span> in hand we can obtain worst-case  probabilities as functions <span class="math notranslate nohighlight">\(\pi_i\tilde m_i(c;\eta)\)</span> of <span class="math notranslate nohighlight">\(\eta\)</span>.</p>
<p>The <strong>indirect (expected) utility function</strong> under constraint preferences is</p>
<div class="math notranslate nohighlight" id="equation-tom8">
<span class="eqno">(13.8)<a class="headerlink" href="#equation-tom8" title="Permalink to this equation">¶</a></span>\[
\sum_{i=1}^I   \pi_i \tilde m_i(c_i;\eta) u(c_i) = \sum_{i=1}^I  \pi_i \left[\frac{\exp(-\tilde \theta^{-1} u(c_i))}
    {\sum_{j=1}^I \exp(-\tilde \theta^{-1} u(c_j) ) \pi_j } \right]    u(c_i) .
\]</div>
<p>Entropy evaluated at the minimizing probability distortion
<a class="reference internal" href="#equation-tom6">(13.6)</a> equals <span class="math notranslate nohighlight">\(E \tilde m \log \tilde m\)</span> or</p>
<div class="math notranslate nohighlight" id="equation-tom9">
<span class="eqno">(13.9)<a class="headerlink" href="#equation-tom9" title="Permalink to this equation">¶</a></span>\[
\begin{aligned}
&amp; &amp; \sum_{i=1}^I   \left[\frac{\exp(-\tilde \theta^{-1} u(c_i))}
    {\sum_{j=1}^I \exp(-\tilde \theta^{-1} u(c_j) ) \pi_j } \right]  \times \cr
    &amp; &amp; \left\{ -\tilde \theta^{-1} u(c_i) + \log \left(\sum_{j=1}^I \exp(-\tilde \theta^{-1} u(c_j) ) \pi_j \right)
        \right\}  \pi_i \cr
    &amp; = &amp; -\tilde \theta^{-1} \sum_{i=1}^I  \pi_i \left[\frac{\exp(-\tilde \theta^{-1} u(c_i))}
    {\sum_{j=1}^I \exp(-\tilde \theta^{-1} u(c_j) ) \pi_j } \right]    u(c_i)  \cr
    &amp; &amp; + \log \left(\sum_{j=1}^I \exp(-\tilde \theta^{-1} u(c_j) ) \pi_j \right) .
\end{aligned}  
\]</div>
<p>Expression <a class="reference internal" href="#equation-tom9">(13.9)</a> implies that</p>
<div class="math notranslate nohighlight" id="equation-tom10">
<span class="eqno">(13.10)<a class="headerlink" href="#equation-tom10" title="Permalink to this equation">¶</a></span>\[
\begin{aligned} 
    - \tilde \theta \log \left(\sum_{j=1}^I \exp(-\tilde \theta^{-1} u(c_j) ) \pi_j \right) &amp; = &amp;
    \sum_{i=1}^I  \pi_i \left[\frac{\exp(-\tilde \theta^{-1} u(c_i))}
    {\sum_{j=1}^I \exp(-\tilde \theta^{-1} u(c_j) ) \pi_j } \right]    u(c_i) \cr
    &amp;   &amp;   + \tilde \theta (c;\eta) \sum_{i=1}^I \log \tilde m_i(c;\eta) \tilde m_i(c;   \eta) \pi_i ,
\end{aligned} 
\]</div>
<p>where the last term is <span class="math notranslate nohighlight">\(\tilde \theta\)</span> times the entropy of the worst-case probability distribution.</p>
</div>
<div class="section" id="multiplier-preferences">
<h2><span class="section-number">13.6. </span>Multiplier preferences<a class="headerlink" href="#multiplier-preferences" title="Permalink to this headline">¶</a></h2>
<p>A decision maker is said to have <strong>multiplier preferences</strong> when he ranks consumption plans <span class="math notranslate nohighlight">\(c\)</span>    according to</p>
<div class="math notranslate nohighlight" id="equation-tom11">
<span class="eqno">(13.11)<a class="headerlink" href="#equation-tom11" title="Permalink to this equation">¶</a></span>\[
{\sf T}u(c) \doteq \min_{\{m_i \geq 0\}_{i=1}^I}  \sum_{i=1}^I \pi_i m_i [  u(c_i) + \theta \log m_i ]
\]</div>
<p>where minimization is subject to</p>
<div class="math notranslate nohighlight">
\[
\sum_{i=1}^I \pi_i m_i = 1 .
\]</div>
<p>Here <span class="math notranslate nohighlight">\(\theta \in (\underline \theta, +\infty )\)</span> is a ‘penalty parameter’  that governs a ‘cost’ to an ‘evil alter ego’ who distorts probabilities  by choosing <span class="math notranslate nohighlight">\(\{m_i\}_{i=1}^I\)</span>.</p>
<p>Lower values of the penalty parameter <span class="math notranslate nohighlight">\(\theta\)</span> express more apprehension about the baseline probability  distribution <span class="math notranslate nohighlight">\(\pi\)</span>.</p>
<p>Following <span id="id5">[<a class="reference internal" href="zreferences.html#id46">HS01</a>]</span> and <span id="id6">[<a class="reference internal" href="zreferences.html#id142">HS08</a>]</span>, we call the minimization problem on the right side of <a class="reference internal" href="#equation-tom11">(13.11)</a> a <strong>multiplier problem</strong>.</p>
<p>The minimizing probability distortion that solves the multiplier problem is</p>
<div class="math notranslate nohighlight" id="equation-tom12">
<span class="eqno">(13.12)<a class="headerlink" href="#equation-tom12" title="Permalink to this equation">¶</a></span>\[
\hat m_i(c; \theta) = \frac{ \exp \bigl(- u(c_i)/\theta\bigr)}{\sum_j \pi_j \exp \bigl(- u(c_j)/\theta\bigr) } .
\]</div>
<p>We can solve</p>
<div class="math notranslate nohighlight" id="equation-tom20">
<span class="eqno">(13.13)<a class="headerlink" href="#equation-tom20" title="Permalink to this equation">¶</a></span>\[
\sum_i \pi_i \frac{ \exp \bigl(- u(c_i)/ \theta\bigr)}{\sum_j \pi_j \exp \bigl(- u(c_j)/ \theta\bigr) }
\log \biggl[\frac{ \exp \bigl(- u(c_i)/\theta\bigr)}{\sum_j \pi_j \exp \bigl(- u(c_j)/\theta\bigr) }
\biggr] = \tilde \eta
\]</div>
<p>to find an entropy level  <span class="math notranslate nohighlight">\(\tilde \eta (c; \theta)\)</span> associated with multiplier preferences with penalty parameter <span class="math notranslate nohighlight">\(\theta\)</span> and allocation <span class="math notranslate nohighlight">\(c\)</span>.</p>
<p>For a fixed <span class="math notranslate nohighlight">\(\theta\)</span>, the <span class="math notranslate nohighlight">\(\tilde \eta\)</span> that solves equation <a class="reference internal" href="#equation-tom20">(13.13)</a> is a function of the consumption plan <span class="math notranslate nohighlight">\(c\)</span></p>
<p>The forms of expressions <a class="reference internal" href="#equation-tom6">(13.6)</a>  and <a class="reference internal" href="#equation-tom12">(13.12)</a> are identical, but the Lagrange multiplier <span class="math notranslate nohighlight">\(\tilde \theta\)</span> appears in <a class="reference internal" href="#equation-tom6">(13.6)</a>,  while the penalty parameter <span class="math notranslate nohighlight">\(\theta\)</span> appears in <a class="reference internal" href="#equation-tom12">(13.12)</a>.</p>
<p>Formulas <a class="reference internal" href="#equation-tom6">(13.6)</a>  and <a class="reference internal" href="#equation-tom12">(13.12)</a> show that worst-case probabilities are <strong>context specific</strong> in the sense that they depend  on both the utility function <span class="math notranslate nohighlight">\(u\)</span> and the consumption plan <span class="math notranslate nohighlight">\(c\)</span>.</p>
<p>If we add <span class="math notranslate nohighlight">\(\theta\)</span> times entropy under the worst-case model to expected utility under the worst-case model, we find that the
<strong>indirect expected utility function</strong> under multiplier preferences is</p>
<div class="math notranslate nohighlight" id="equation-tom13">
<span class="eqno">(13.14)<a class="headerlink" href="#equation-tom13" title="Permalink to this equation">¶</a></span>\[
-  \theta \log \left(\sum_{j=1}^I \exp(- \theta^{-1} u(c_j) ) \pi_j \right) .
\]</div>
</div>
<div class="section" id="risk-sensitive-preferences">
<h2><span class="section-number">13.7. </span>Risk-sensitive preferences<a class="headerlink" href="#risk-sensitive-preferences" title="Permalink to this headline">¶</a></h2>
<p>Substituting <span class="math notranslate nohighlight">\(\hat m_i\)</span> into <span class="math notranslate nohighlight">\(\sum_{i=1}^I \pi_i \hat m_i [  u(c_i) + \theta \log \hat m_i ]\)</span> gives the indirect utility function</p>
<div class="math notranslate nohighlight" id="equation-tom14">
<span class="eqno">(13.15)<a class="headerlink" href="#equation-tom14" title="Permalink to this equation">¶</a></span>\[
{\sf T} u(c) \doteq - \theta \log \sum_{i=1}^I \pi_i \exp\bigl(- u(c_i)/\theta  \bigr).
\]</div>
<p>Here <span class="math notranslate nohighlight">\({\sf T} u\)</span> in    <a class="reference internal" href="#equation-tom14">(13.15)</a> is the <strong>risk-sensitivity</strong> operator of  <span id="id7">[<a class="reference internal" href="zreferences.html#id9">Jac73</a>]</span>, <span id="id8">[<a class="reference internal" href="zreferences.html#id12">Whi81</a>]</span>,  and <span id="id9">[<a class="reference internal" href="zreferences.html#id11">Whi90</a>]</span>.</p>
<p>It defines a <strong>risk-sensitive</strong> preference    ordering over plans <span class="math notranslate nohighlight">\(c\)</span>.</p>
<p>Because it is not linear in utilities <span class="math notranslate nohighlight">\(u(c_i)\)</span> and probabilities <span class="math notranslate nohighlight">\(\pi_i\)</span>, it is said not to be separable across states.</p>
<p>Because risk-sensitive preferences use a unique probability distribution, they apparently express no model distrust or ambiguity.</p>
<p>Instead, they make an additional adjustment for risk-aversion beyond that embedded in the curvature of <span class="math notranslate nohighlight">\(u\)</span>.</p>
<p>For <span class="math notranslate nohighlight">\(I=2, c_1=2, c_2=1\)</span>, <span class="math notranslate nohighlight">\(u(c) = \ln c\)</span>, the following figure plots the risk-sensitive criterion <span class="math notranslate nohighlight">\({\sf T} u(c)\)</span> defined in    <a class="reference internal" href="#equation-tom14">(13.15)</a> as a function of <span class="math notranslate nohighlight">\(\pi_1\)</span> for values of <span class="math notranslate nohighlight">\(\theta\)</span> of 100 and .6.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c_bundle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>  <span class="c1"># Consumption bundle</span>
<span class="n">θ_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">])</span>  <span class="c1"># Array containing the different values of θ</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">utility_function_factory</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span>  <span class="c1"># Utility function</span>

<span class="c1"># Intialize arrays containing values for Tu(c)</span>
<span class="n">Tuc_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">θ_vals</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">π_hat_0_vals</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">θ_vals</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>  <span class="c1"># Loop over θ values</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">π_hat_0_vals</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>  <span class="c1"># Loop over `π_hat_0` values</span>
        <span class="c1"># Update `π` values</span>
        <span class="n">π</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">π_0_vals</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">π</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">π_0_vals</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

        <span class="c1"># Create T operator</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">T_θ_factory</span><span class="p">(</span><span class="n">θ_vals</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">π</span><span class="p">)</span>
        
        <span class="c1"># Apply T operator to utility function</span>
        <span class="n">Tu</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
        
        <span class="c1"># Compute and store Tu(c)</span>
        <span class="n">Tuc_vals</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tu</span><span class="p">(</span><span class="n">c_bundle</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">π_0_vals</span><span class="p">,</span> <span class="n">Tuc_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\theta=100$&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">π_0_vals</span><span class="p">,</span> <span class="n">Tuc_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\theta=0.6$&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\mathbf</span><span class="si">{T}</span><span class="s1">u\left(c\right)$&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\pi_1$&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/five_preferences_15_0.png" src="_images/five_preferences_15_0.png" />
</div>
</div>
<p>For large values of <span class="math notranslate nohighlight">\(\theta\)</span>, <span class="math notranslate nohighlight">\({\sf T} u(c)\)</span> is approximately linear in the probability <span class="math notranslate nohighlight">\(\pi_1\)</span>, but for lower values of <span class="math notranslate nohighlight">\(\theta\)</span>, <span class="math notranslate nohighlight">\({\sf T} u(c)\)</span> has considerable    curvature as a function of <span class="math notranslate nohighlight">\(\pi_1\)</span>.</p>
<p>Under expected utility, i.e., <span class="math notranslate nohighlight">\(\theta =+\infty\)</span>, <span class="math notranslate nohighlight">\({\sf T}u(c)\)</span> is linear in <span class="math notranslate nohighlight">\(\pi_1\)</span>, but it is convex as a function of <span class="math notranslate nohighlight">\(\pi_1\)</span> when <span class="math notranslate nohighlight">\(\theta&lt; + \infty\)</span>.</p>
<p>The two  panels in the next  figure below  can help us to visualize the extra adjustment for risk that the risk-sensitive operator entails.</p>
<p>This will help us understand  how the <span class="math notranslate nohighlight">\(\mathbf{T}\)</span> transformation works by envisioning  what function is being averaged.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parameter values</span>
<span class="n">θ</span><span class="o">=</span> <span class="mf">0.8</span>
<span class="n">π</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<span class="n">c_bundle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>  <span class="c1"># Consumption bundle</span>

<span class="c1"># Compute the average consumption level implied by `c_bundle` wrt to `π` </span>
<span class="n">avg_c_bundle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">π</span> <span class="o">*</span> <span class="n">c_bundle</span><span class="p">)</span>

<span class="c1"># Construct grid for consumption values</span>
<span class="n">c_grid_nb</span> <span class="o">=</span> <span class="mi">101</span>
<span class="n">c_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">c_grid_nb</span><span class="p">)</span>

<span class="c1"># Evaluate utility function on the grid</span>
<span class="n">u_c_grid</span> <span class="o">=</span> <span class="n">u</span><span class="p">(</span><span class="n">c_grid</span><span class="p">)</span>

<span class="c1"># Evaluate utility function at bundle points</span>
<span class="n">u_c_bundle</span> <span class="o">=</span> <span class="n">u</span><span class="p">(</span><span class="n">c_bundle</span><span class="p">)</span>

<span class="c1"># Compute the average utility level implied by `c_bundle` wrt to `π` </span>
<span class="n">avg_u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">π</span> <span class="o">*</span> <span class="n">u_c_bundle</span><span class="p">)</span>

<span class="c1"># Compute the first transformation exp(-u(c) / θ) for grid values</span>
<span class="n">first_trnsf_u_c_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">u_c_grid</span> <span class="o">/</span> <span class="n">θ</span><span class="p">)</span> 

<span class="c1"># Compute the first transformation exp(-u(c) / θ) for bundle values</span>
<span class="n">first_trnsf_u_c_bundle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">u_c_bundle</span><span class="o">/</span><span class="n">θ</span><span class="p">)</span>

<span class="c1"># Take expectations in the transformed space for bundle values (second transformation)</span>
<span class="n">second_trnsf_u_c_bundle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">π</span> <span class="o">*</span> <span class="n">first_trnsf_u_c_bundle</span><span class="p">)</span>

<span class="c1"># Send expectation back to the original space (third transformation)</span>
<span class="n">third_trnsf_u_c_bundle</span> <span class="o">=</span> <span class="o">-</span><span class="n">θ</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">second_trnsf_u_c_bundle</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_grid</span><span class="p">,</span> <span class="n">u_c_grid</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\log\left(c\right)$&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_bundle</span><span class="p">,</span> <span class="n">u_c_bundle</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">avg_c_bundle</span><span class="p">,</span> <span class="n">third_trnsf_u_c_bundle</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">);</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$-\theta\log E\left[\exp\left(\frac{-\log\left(c\right)}{\theta}\right)\right]$&#39;</span><span class="p">,</span>
             <span class="p">(</span><span class="n">avg_c_bundle</span><span class="o">+</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">third_trnsf_u_c_bundle</span><span class="o">-</span><span class="mf">0.15</span><span class="p">))</span>

<span class="c1"># Consumption dots</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_bundle</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">u_c_bundle</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_bundle</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">u_c_bundle</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$c_1$&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">c_bundle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.08</span><span class="p">,</span> <span class="n">u_c_bundle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.03</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$c_2$&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">c_bundle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mf">0.08</span><span class="p">,</span> <span class="n">u_c_bundle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.03</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$c$&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original space&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_grid</span><span class="p">,</span> <span class="n">first_trnsf_u_c_grid</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\exp\left(\frac{-\log\left(c\right)}{\theta}\right)$&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">);</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_bundle</span><span class="p">,</span> <span class="n">first_trnsf_u_c_bundle</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">avg_c_bundle</span><span class="p">,</span> <span class="n">second_trnsf_u_c_bundle</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$E\left[\exp\left(\frac{-\log\left(c\right)}{\theta}\right)\right]$&#39;</span><span class="p">,</span>
             <span class="p">(</span><span class="n">avg_c_bundle</span><span class="o">+</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">second_trnsf_u_c_bundle</span><span class="o">+</span><span class="mf">0.08</span><span class="p">))</span>

<span class="c1"># Consumption dots</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_bundle</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">first_trnsf_u_c_bundle</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_bundle</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">first_trnsf_u_c_bundle</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$c_1$&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">c_bundle</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">first_trnsf_u_c_bundle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.05</span><span class="p">))</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$c_2$&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">c_bundle</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">first_trnsf_u_c_bundle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.05</span><span class="p">))</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$c$&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Transformed space&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/five_preferences_18_0.png" src="_images/five_preferences_18_0.png" />
</div>
</div>
<p>The panel on the right portrays how the transformation <span class="math notranslate nohighlight">\(\exp\left(\frac{-u\left(c\right)}{\theta}\right)\)</span> sends <span class="math notranslate nohighlight">\(u\left(c\right)\)</span> to a new function by  (i)  flipping the  sign,  and (ii) increasing curvature in proportion to <span class="math notranslate nohighlight">\(\theta\)</span>.</p>
<p>In the left panel, the red line is our tool for computing  the mathematical expectation for different
values  of <span class="math notranslate nohighlight">\(\pi\)</span>.</p>
<p>The green lot indicates the mathematical expectation of <span class="math notranslate nohighlight">\(\exp\left(\frac{-u\left(c\right)}{\theta}\right)\)</span>
when <span class="math notranslate nohighlight">\(\pi = .5\)</span>.</p>
<p>Notice that the distance between the green dot  and the curve is greater in the transformed space than the original space as a result of additional curvature.</p>
<p>The inverse transformation  <span class="math notranslate nohighlight">\(\theta\log E\left[\exp\left(\frac{-u\left(c\right)}{\theta}\right)\right]\)</span> generates  the green dot on the left panel that constitutes the risk-sensitive utility  index.</p>
<p>The gap between the green dot and the red line on the left panel measures the additional adjustment for risk
that risk-sensitive preferences make relative to plain vanilla expected utility preferences.</p>
<div class="section" id="digression-on-moment-generating-functions">
<h3><span class="section-number">13.7.1. </span>Digression on moment generating functions<a class="headerlink" href="#digression-on-moment-generating-functions" title="Permalink to this headline">¶</a></h3>
<p>The risk-sensitivity operator <span class="math notranslate nohighlight">\({\sf T}\)</span> is intimately connected to a moment generating function.</p>
<p>In particular, a principal constinuent of the <span class="math notranslate nohighlight">\({\sf T}\)</span> operator, namely,</p>
<div class="math notranslate nohighlight">
\[
E \exp\bigl(-u(c_i)/\theta\bigr) = \sum_{i=1}^I \pi_i \exp\bigl(- u(c_i)/\theta  \bigr)
\]</div>
<p>is evidently a <strong>moment generating function</strong> for the random variable <span class="math notranslate nohighlight">\(u(c_i)\)</span>, while</p>
<div class="math notranslate nohighlight">
\[
g(\theta^{-1}) \doteq  \log \sum_{i=1}^I \pi_i \exp\bigl(- u(c_i)/\theta  \bigr)
\]</div>
<p>is a <strong>cumulant generating function</strong>,</p>
<div class="math notranslate nohighlight">
\[
g(\theta^{-1}) = \sum_{j=1}^\infty \kappa_j \frac{{(-\theta^{-1})}^{j}}{j!}. 
\]</div>
<p>where <span class="math notranslate nohighlight">\(\kappa_j\)</span> is the <span class="math notranslate nohighlight">\(j\)</span>th cumulant of the random variable <span class="math notranslate nohighlight">\(u(c)\)</span>.</p>
<p>Then</p>
<div class="math notranslate nohighlight">
\[
{\sf T}u(c) = -\theta g(\theta^{-1}) = -\theta \sum_{j=1}^\infty \kappa_j \frac{{(-\theta^{-1})}^{j}}{j!}.
\]</div>
<p>In general, when <span class="math notranslate nohighlight">\(\theta &lt; +\infty\)</span>, <span class="math notranslate nohighlight">\({\sf T} u(c)\)</span> depends on cumulants of all orders.</p>
<p>These statements extend to cases with continuous probability distributions for <span class="math notranslate nohighlight">\(c\)</span> and therefore for <span class="math notranslate nohighlight">\(u(c)\)</span>.</p>
<p>For the special case <span class="math notranslate nohighlight">\(u(c) \sim {\mathcal N}(\mu_u, \sigma_u^2)\)</span>, <span class="math notranslate nohighlight">\(\kappa_1 = \mu_u, \kappa_2 = \sigma_u^2,\)</span>  and <span class="math notranslate nohighlight">\(\kappa_j = 0 \ \forall j \geq 3\)</span>, so</p>
<div class="math notranslate nohighlight" id="equation-tom200">
<span class="eqno">(13.16)<a class="headerlink" href="#equation-tom200" title="Permalink to this equation">¶</a></span>\[
 {\sf T} u(c) = \mu_u - \frac{1}{2 \theta} \sigma_u^2, 
\]</div>
<p>which becomes expected utility <span class="math notranslate nohighlight">\(\mu_u\)</span> when <span class="math notranslate nohighlight">\(\theta^{-1} = 0\)</span>.</p>
<p>The right side of equation <a class="reference internal" href="#equation-tom200">(13.16)</a> is a special case of <strong>stochastic differential utility</strong> preferences in which consumption plans are ranked not just by their expected utilities <span class="math notranslate nohighlight">\(\mu_u\)</span> but also the variances <span class="math notranslate nohighlight">\(\sigma_u^2\)</span>  of their expected utilities.</p>
</div>
</div>
<div class="section" id="ex-post-bayesian-preferences">
<h2><span class="section-number">13.8. </span>Ex post Bayesian preferences<a class="headerlink" href="#ex-post-bayesian-preferences" title="Permalink to this headline">¶</a></h2>
<p>A decision maker is said to have <strong>ex post Bayesian preferences</strong> when he ranks consumption plans according to the expected utility function</p>
<div class="math notranslate nohighlight" id="equation-tom15">
<span class="eqno">(13.17)<a class="headerlink" href="#equation-tom15" title="Permalink to this equation">¶</a></span>\[
\sum_i \hat \pi_i (c^*) u(c_i)
\]</div>
<p>where <span class="math notranslate nohighlight">\(\hat \pi(c^*)\)</span> is the worst-case probability distribution associated with multiplier or constraint preferences evaluated at a particular consumption plan <span class="math notranslate nohighlight">\(c^* = \{c_i^*\}_{i=1}^I\)</span>.</p>
<p>At <span class="math notranslate nohighlight">\(c^*\)</span>, an ex post Bayesian’s indifference curves are tangent to those for multiplier and constraint preferences with appropriately chosen <span class="math notranslate nohighlight">\(\theta\)</span> and <span class="math notranslate nohighlight">\(\eta\)</span>, respectively.</p>
</div>
<div class="section" id="comparing-preferences">
<h2><span class="section-number">13.9. </span>Comparing preferences<a class="headerlink" href="#comparing-preferences" title="Permalink to this headline">¶</a></h2>
<p>For the special case in which <span class="math notranslate nohighlight">\(I=2\)</span>, <span class="math notranslate nohighlight">\(c_1=2, c_2=1\)</span>, <span class="math notranslate nohighlight">\(u(c) = \ln c\)</span>, and
<span class="math notranslate nohighlight">\(\pi_1 =.5\)</span>, the following two figures depict how worst-case
probabilities are determined under  constraint and multiplier preferences, respectively.</p>
<p>The first figure  graphs entropy as a function of <span class="math notranslate nohighlight">\(\hat \pi_1\)</span>.</p>
<p>It also plots expected utility under the twisted probability distribution, namely,
<span class="math notranslate nohighlight">\(\hat E u(c) = u(c_2) + \hat \pi_1 (u(c_1) - u(c_2))\)</span>, which is
evidently a linear function of <span class="math notranslate nohighlight">\(\hat \pi_1\)</span>.</p>
<p>The entropy constraint  <span class="math notranslate nohighlight">\(\sum_{i=1}^I \pi_i m_i \log m_i \leq \eta\)</span> implies a convex set
<span class="math notranslate nohighlight">\(\hat \Pi_1\)</span> of <span class="math notranslate nohighlight">\(\hat \pi_1\)</span>’s that constrains the adversary who chooses <span class="math notranslate nohighlight">\(\hat \pi_1\)</span>, namely, the set of <span class="math notranslate nohighlight">\(\hat \pi_1\)</span>’s for which the
entropy curve lies below the horizontal dotted line at an entropy level of <span class="math notranslate nohighlight">\(\eta = .25\)</span>.</p>
<p>Unless <span class="math notranslate nohighlight">\(u(c_1) = u(c_2)\)</span>, the <span class="math notranslate nohighlight">\(\hat \pi_1\)</span> that minimizes <span class="math notranslate nohighlight">\(\hat E u(c)\)</span> is at the boundary of the set <span class="math notranslate nohighlight">\(\hat \Pi_1\)</span>.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parameter </span>
<span class="n">η</span> <span class="o">=</span> <span class="mf">0.25</span>
<span class="n">π</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<span class="n">c_bundle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>  <span class="c1"># Consumption bundle</span>

<span class="c1"># Create η array for putting an upper bound on entropy values</span>
<span class="n">η_line</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">π_hat_0_vals</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">*</span> <span class="n">η</span>

<span class="c1"># Initialize array for storing values for \hat{E}[u(c)]</span>
<span class="n">E_hat_uc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">π_hat_0_vals</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">π_hat_0_vals</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>  <span class="c1"># Loop over π_hat_0</span>
    <span class="c1"># Compute and store \hat{E}[u(c)]</span>
    <span class="n">E_hat_uc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">(</span><span class="n">c_bundle</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">π_hat_0_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">u</span><span class="p">(</span><span class="n">c_bundle</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="n">u</span><span class="p">(</span><span class="n">c_bundle</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

<span class="c1"># Set up a root finding problem to find the solution to the constraint problem</span>
<span class="c1"># First argument to `root_scalar` is a function that takes a value for π_hat_0 and returns </span>
<span class="c1"># the entropy of π_hat wrt π minus η</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">root_scalar</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ent</span><span class="p">(</span><span class="n">π</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="p">]))</span> <span class="o">-</span> <span class="n">η</span><span class="p">,</span> <span class="n">bracket</span><span class="o">=</span><span class="p">[</span><span class="mf">1e-4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span><span class="o">.</span><span class="n">root</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">π_hat_0_vals</span><span class="p">,</span> <span class="n">E_hat_uc</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\hat</span><span class="si">{E}</span><span class="s1">u\left(c\right)$&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">π_hat_0_vals</span><span class="p">,</span> <span class="n">η_line</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\mathrm</span><span class="si">{ent}</span><span class="s1">\left(\pi,\hat{\pi}\right)\leq\eta$&#39;</span><span class="p">,</span>
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span>
                 <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">π_hat_0_vals</span><span class="p">,</span> <span class="n">ent_vals</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\mathrm</span><span class="si">{ent}</span><span class="s1">\left(\pi,\hat{\pi}\right)$&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">η</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;constraint problem solution&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\hat{\pi}_1$&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/five_preferences_21_0.png" src="_images/five_preferences_21_0.png" />
</div>
</div>
<p>The next  figure shows the function <span class="math notranslate nohighlight">\(\sum_{i=1}^I \pi_i m_i [  u(c_i) + \theta \log m_i ]\)</span> that is to be
minimized in the multiplier problem.</p>
<p>The argument of the function is  <span class="math notranslate nohighlight">\(\hat \pi_1 = m_1 \pi_1\)</span>.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parameter values</span>
<span class="n">θ_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.42</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>

<span class="c1"># Initialize values for storing the multiplier criterion values</span>
<span class="n">multi_crit_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">θ_vals</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">π_hat_0_vals</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">θ_vals</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>  <span class="c1"># Loop over θ values</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">π_hat_0_vals</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>  <span class="c1"># Loop over π_hat_0 values</span>
        <span class="c1"># Update `π_hat` values</span>
        <span class="n">π_hat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">π_hat_0_vals</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">π_hat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">π_hat_0_vals</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        
        <span class="c1"># Compute distorting measure</span>
        <span class="n">m_i</span> <span class="o">=</span> <span class="n">π_hat</span> <span class="o">/</span> <span class="n">π</span>
        
        <span class="c1"># Compute and store multiplier criterion objective value</span>
        <span class="n">multi_crit_vals</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">π_hat</span> <span class="o">*</span> <span class="p">(</span><span class="n">u</span><span class="p">(</span><span class="n">c_bundle</span><span class="p">)</span> <span class="o">+</span> <span class="n">θ_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">m_i</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1"># Expected utility values</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">π_hat_0_vals</span><span class="p">,</span> <span class="n">E_hat_uc</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\hat</span><span class="si">{E}</span><span class="s1">u\left(c\right)$&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

<span class="c1"># First multiplier criterion objective values</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">π_hat_0_vals</span><span class="p">,</span> <span class="n">multi_crit_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
         <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\sum_{i=1}^</span><span class="si">{I}</span><span class="s1">\pi_</span><span class="si">{i}</span><span class="s1">m_</span><span class="si">{i}</span><span class="s1">\left[u\left(c_</span><span class="si">{i}</span><span class="s1">\right)+0.42\log\left(m_</span><span class="si">{i}</span><span class="s1">\right)\right]$&#39;</span><span class="p">,</span>
         <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>

<span class="c1"># Second multiplier criterion objective values</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">π_hat_0_vals</span><span class="p">,</span> <span class="n">multi_crit_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
         <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\sum_{i=1}^</span><span class="si">{I}</span><span class="s1">\pi_</span><span class="si">{i}</span><span class="s1">m_</span><span class="si">{i}</span><span class="s1">\left[u\left(c_</span><span class="si">{i}</span><span class="s1">\right)+\log\left(m_</span><span class="si">{i}</span><span class="s1">\right)\right]$&#39;</span><span class="p">,</span>
         <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">)</span>

<span class="c1"># Entropy values</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">π_hat_0_vals</span><span class="p">,</span> <span class="n">ent_vals</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\mathrm</span><span class="si">{ent}</span><span class="s1">\left(\pi,\hat{\pi}\right)$&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

<span class="c1"># Area fill</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">π_hat_0_vals</span><span class="p">,</span> <span class="n">η_line</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\mathrm</span><span class="si">{ent}</span><span class="s1">\left(\pi,\hat{\pi}\right)\leq\eta$&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>

<span class="c1"># Problem solution dots</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">η</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;constraint problem solution&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">π_hat_0_vals</span><span class="p">[</span><span class="n">multi_crit_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">argmin</span><span class="p">()],</span> <span class="n">multi_crit_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;multiplier problem solution&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">π_hat_0_vals</span><span class="p">[</span><span class="n">multi_crit_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">argmin</span><span class="p">()],</span> <span class="n">multi_crit_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\hat{\pi}_1$&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/five_preferences_24_0.png" src="_images/five_preferences_24_0.png" />
</div>
</div>
<p>Evidently, from this figure and also from formula <a class="reference internal" href="#equation-tom12">(13.12)</a>, lower values of <span class="math notranslate nohighlight">\(\theta\)</span> lead to lower,
and thus more distorted, minimizing values of <span class="math notranslate nohighlight">\(\hat \pi_1\)</span>.</p>
<p>The figure
indicates how one can construct a Lagrange multiplier <span class="math notranslate nohighlight">\(\tilde \theta\)</span>
associated with a given entropy constraint <span class="math notranslate nohighlight">\(\eta\)</span> and a given
consumption plan.</p>
<p>Thus, to draw the figure, we set the penalty parameter for
multiplier preferences <span class="math notranslate nohighlight">\(\theta\)</span> so that the minimizing <span class="math notranslate nohighlight">\(\hat \pi_1\)</span>
equals the minimizing <span class="math notranslate nohighlight">\(\hat \pi_1\)</span> for the constraint problem from
the previous figure.</p>
<p>The penalty parameter <span class="math notranslate nohighlight">\(\theta=.42\)</span> also equals the
Lagrange multiplier <span class="math notranslate nohighlight">\(\tilde \theta\)</span> on the entropy constraint for the
constraint preferences depicted in the previous figure
because the <span class="math notranslate nohighlight">\(\hat \pi_1\)</span> that minimizes the
asymmetric curve associated with penalty parameter <span class="math notranslate nohighlight">\(\theta=.42\)</span> is the
same <span class="math notranslate nohighlight">\(\hat \pi_1\)</span> associated with the intersection of the entropy curve
and the entropy constraint dashed vertical
line.</p>
</div>
<div class="section" id="risk-aversion-and-misspecification-aversion">
<h2><span class="section-number">13.10. </span>Risk aversion and misspecification aversion<a class="headerlink" href="#risk-aversion-and-misspecification-aversion" title="Permalink to this headline">¶</a></h2>
<p>All five types of preferences use curvature of <span class="math notranslate nohighlight">\(u\)</span> to express risk
aversion.</p>
<p>Constraint preferences express <strong>concern about misspecification</strong> or <strong>ambiguity</strong> for short with a positive
<span class="math notranslate nohighlight">\(\eta\)</span> that circumscribes an entropy ball around an approximating
probability distribution <span class="math notranslate nohighlight">\(\pi\)</span>, and <em>aversion aversion to model misspecification</em> through
minimization with respect to a likelihood ratio <span class="math notranslate nohighlight">\(m\)</span>.</p>
<p>Multiplier preferences express misspecification concerns with a parameter <span class="math notranslate nohighlight">\(\theta&lt;+\infty\)</span> that
penalizes deviations from the approximating model as measured by
relative entropy, and they express  aversion to misspecification  concerns with minimization
over a probability distortion <span class="math notranslate nohighlight">\(m\)</span>.</p>
<p>By penalizing minimization over the
likelihood ratio <span class="math notranslate nohighlight">\(m\)</span>, a decrease in <span class="math notranslate nohighlight">\(\theta\)</span> represents an <strong>increase</strong> in
ambiguity (or what <span id="id10">[<a class="reference internal" href="zreferences.html#id3">Kni21</a>]</span> called uncertainty) about the specification of the baseline
approximating model <span class="math notranslate nohighlight">\(\{\pi_i\}_{i=1}^I\)</span>.</p>
<p>Formulas <a class="reference internal" href="#equation-tom6">(13.6)</a>  assert that the decision maker acts as if
he is pessimistic relative to an approximating model <span class="math notranslate nohighlight">\(\pi\)</span>.</p>
<p>It expresses what <span id="id11">[<a class="reference internal" href="zreferences.html#id10">Buc04</a>]</span> [p. 27] calls a statistical version of <em>Murphy’s law</em>:</p>
<p><strong><span class="math notranslate nohighlight">\(\quad \quad\)</span> The probability of anything happening is in inverse ratio to its desirability.</strong></p>
<p>The minimizing likelihood ratio <span class="math notranslate nohighlight">\(\hat m\)</span> slants worst-case probabilities
<span class="math notranslate nohighlight">\(\hat \pi\)</span> exponentially to increase probabilities of events that give
lower utilities.</p>
<p>As expressed by the value function bound <a class="reference internal" href="#equation-eqn-bound1">(13.19)</a> to be displayed below, the decision maker uses <strong>pessimism</strong> instrumentally to protect himself against model misspecification.</p>
<p>The penalty parameter <span class="math notranslate nohighlight">\(\theta\)</span> for multipler preferences or the entropy level <span class="math notranslate nohighlight">\(\eta\)</span> that determines the
Lagrange multiplier <span class="math notranslate nohighlight">\(\tilde \theta\)</span> for constraint  preferences controls how adversely the decision maker exponentially slants probabilities.</p>
<p>A decision rule is said to be <strong>undominated</strong> in the sense of Bayesian
decision theory if there exists a probability distribution <span class="math notranslate nohighlight">\(\pi\)</span> for
which it is optimal.</p>
<p>A decision rule is said to be <strong>admissible</strong> if it is undominated.</p>
<p><span id="id12">[<a class="reference internal" href="zreferences.html#id142">HS08</a>]</span> use ex post Bayesian preferences to show that robust
decision rules are undominated and therefore admissible.</p>
</div>
<div class="section" id="indifference-curves">
<h2><span class="section-number">13.11. </span>Indifference curves<a class="headerlink" href="#indifference-curves" title="Permalink to this headline">¶</a></h2>
<p>Indifference curves illuminate how concerns about robustness affect
asset pricing and utility costs of fluctuations. For <span class="math notranslate nohighlight">\(I=2\)</span>, the slopes
of the indifference curves for our five preference specifications are</p>
<ul>
<li><p>Expected utility:</p>
<div class="math notranslate nohighlight">
\[
    \frac{d c_2}{d c_1} = - \frac{\pi_1}{\pi_2}\frac{u'(c_1)}{u'(c_2)}
    \]</div>
</li>
<li><p>Constraint and ex post Bayesian preferences:</p>
<div class="math notranslate nohighlight">
\[
    \frac{d c_2}{d c_1} = - \frac{\hat \pi_1}{\hat \pi_2}\frac{u'(c_1)}{u'(c_2)}
    \]</div>
<p>where <span class="math notranslate nohighlight">\(\hat \pi_1, \hat \pi_2\)</span> are the minimizing probabilities
computed from the worst-case distortions <a class="reference internal" href="#equation-tom6">(13.6)</a> from the constraint problem at  <span class="math notranslate nohighlight">\((c_1, c_2)\)</span>.</p>
</li>
<li><p>Multiplier and risk-sensitive preferences:</p>
<div class="math notranslate nohighlight">
\[
    \frac{d c_2}{d c_1} = - \frac{\pi_1}{\pi_2} \frac{\exp(- u(c_1)/\theta)}{\exp (- u(c_2)/\theta)}    \frac{u'(c_1)}{u'(c_2)}
    \]</div>
</li>
</ul>
<p>When <span class="math notranslate nohighlight">\(c_1 &gt; c_2\)</span>, the exponential twisting formula <a class="reference internal" href="#equation-tom12">(13.12)</a>
implies that <span class="math notranslate nohighlight">\(\hat \pi_1 &lt; \pi_1\)</span>, which in
turn implies that the indifference curves through <span class="math notranslate nohighlight">\((c_1, c_2)\)</span> for both
constraint and multiplier preferences are flatter than the indifference
curve associated with expected utility preferences.</p>
<p>As we shall see soon when we discuss state price
deflators, this gives rise to higher estimates of prices of risk.</p>
<p>For an example with <span class="math notranslate nohighlight">\(u(c) = \ln c\)</span>, <span class="math notranslate nohighlight">\(I=2\)</span>, and <span class="math notranslate nohighlight">\(\pi_1 = .5\)</span>, the next two  figures show indifference curves for expected
utility, multiplier, and constraint preferences.</p>
<p>The following figure shows indifference curves going through a
point along the 45 degree line.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">multiplier_criterion_factory</span><span class="p">(</span><span class="n">θ</span><span class="p">,</span> <span class="n">π</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a function to compute the multiplier preferences objective function parametrized </span>
<span class="sd">    by a penalty parameter `θ`, a probability vector `π` and a utility function `u`</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">criterion</span><span class="p">(</span><span class="n">c_1</span><span class="p">,</span> <span class="n">c_2</span><span class="p">,</span> <span class="n">return_entropy</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the multiplier preferences objective function and</span>
<span class="sd">        associated entropy level if return_entropy=True for a</span>
<span class="sd">        consumption bundle (c_1, c_2).</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Compute the distorting measure</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">compute_change_measure</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c_1</span><span class="p">,</span> <span class="n">c_2</span><span class="p">]),</span> <span class="n">θ</span><span class="p">,</span> <span class="n">π</span><span class="p">)</span>
        
        <span class="c1"># Compute objective value</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">π</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">u</span><span class="p">(</span><span class="n">c_1</span><span class="p">)</span> <span class="o">+</span> <span class="n">θ</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="n">π</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">u</span><span class="p">(</span><span class="n">c_2</span><span class="p">)</span> <span class="o">+</span> <span class="n">θ</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        
        <span class="k">if</span> <span class="n">return_entropy</span><span class="p">:</span>        
            <span class="c1"># Compute associated entropy value</span>
            <span class="n">π_hat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">π</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">π</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">ent_val</span> <span class="o">=</span> <span class="n">ent</span><span class="p">(</span><span class="n">π</span><span class="p">,</span> <span class="n">π_hat</span><span class="p">)</span>
        
            <span class="k">return</span> <span class="n">ent_val</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">obj</span>
    
    <span class="k">return</span> <span class="n">criterion</span>


<span class="k">def</span> <span class="nf">constraint_criterion_factory</span><span class="p">(</span><span class="n">η</span><span class="p">,</span> <span class="n">π</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a function to compute the constraint preferences objective function parametrized </span>
<span class="sd">    by a penalty parameter `η`, a probability vector `π` and a utility function `u`</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">inner_root_problem</span><span class="p">(</span><span class="n">θ_tilde</span><span class="p">,</span> <span class="n">c_1</span><span class="p">,</span> <span class="n">c_2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inner root problem associated with the constraint preferences objective function. </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Compute the change of measure</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">compute_change_measure</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c_1</span><span class="p">,</span> <span class="n">c_2</span><span class="p">]),</span> <span class="n">θ_tilde</span><span class="p">,</span> <span class="n">π</span><span class="p">)</span>
            
        <span class="c1"># Compute the associated entropy value</span>
        <span class="n">π_hat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">π</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">π</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">ent_val</span> <span class="o">=</span> <span class="n">ent</span><span class="p">(</span><span class="n">π</span><span class="p">,</span> <span class="n">π_hat</span><span class="p">)</span>
        
        <span class="c1"># Compute the error</span>
        <span class="n">Δ</span> <span class="o">=</span> <span class="n">ent_val</span> <span class="o">-</span> <span class="n">η</span>
        
        <span class="k">return</span> <span class="n">ent_val</span> <span class="o">-</span> <span class="n">η</span>
    
    <span class="k">def</span> <span class="nf">criterion</span><span class="p">(</span><span class="n">c_1</span><span class="p">,</span> <span class="n">c_2</span><span class="p">,</span> <span class="n">return_θ_tilde</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Solve for the Lagrange multiplier</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">root_scalar</span><span class="p">(</span><span class="n">inner_root_problem</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">c_1</span><span class="p">,</span> <span class="n">c_2</span><span class="p">),</span> <span class="n">bracket</span><span class="o">=</span><span class="p">[</span><span class="mf">3e-3</span><span class="p">,</span> <span class="mf">10.</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bisect&#39;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">converged</span><span class="p">:</span>
                <span class="n">θ_tilde</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">root</span>

                <span class="c1"># Compute change of measure</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">compute_change_measure</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c_1</span><span class="p">,</span> <span class="n">c_2</span><span class="p">]),</span> <span class="n">θ_tilde</span><span class="p">,</span> <span class="n">π</span><span class="p">)</span>

                <span class="n">obj</span> <span class="o">=</span> <span class="n">π</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="p">(</span><span class="n">c_1</span><span class="p">)</span> <span class="o">+</span> <span class="n">π</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="p">(</span><span class="n">c_2</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">return_θ_tilde</span><span class="p">:</span> 
                    <span class="k">return</span> <span class="n">θ_tilde</span>

                <span class="k">else</span><span class="p">:</span> 
                    <span class="k">return</span> <span class="n">obj</span>

            <span class="k">else</span><span class="p">:</span> 
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            
        <span class="k">except</span><span class="p">:</span> 
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        
    <span class="k">return</span> <span class="n">criterion</span>


<span class="k">def</span> <span class="nf">solve_root_problem</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">u_bar</span><span class="p">,</span> <span class="n">c_1_grid</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bisect&#39;</span><span class="p">,</span> <span class="n">bracket</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">3.</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solve root finding problem `problem` for all values in `c_1_grid` taking `u_bar` as</span>
<span class="sd">    given and using `method`.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Initialize array to be filled with c_2 values</span>
    <span class="n">c_2_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">c_1_grid</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">c_1_grid</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>  <span class="c1"># Loop over c_1 values</span>
        <span class="n">c_1</span> <span class="o">=</span> <span class="n">c_1_grid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        
        <span class="k">try</span><span class="p">:</span> 
            <span class="c1"># Solve root problem given c_1 and u_bar</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">root_scalar</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">c_1</span><span class="p">,</span> <span class="n">u_bar</span><span class="p">),</span> <span class="n">bracket</span><span class="o">=</span><span class="n">bracket</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">converged</span><span class="p">:</span>  <span class="c1"># Store values if successfully converged</span>
                <span class="n">c_2_grid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">root</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># Store np.nan otherwise</span>
                <span class="n">c_2_grid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                
        <span class="k">except</span><span class="p">:</span>
            <span class="n">c_2_grid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            
    <span class="k">return</span> <span class="n">c_2_grid</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parameters</span>
<span class="n">c_bundle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>  <span class="c1"># Consumption bundle</span>
<span class="n">u_inv</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># Inverse of the utility function</span>
<span class="n">θ</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">η</span> <span class="o">=</span> <span class="mf">0.12</span>


<span class="c1"># Conustruct grid for c_1</span>
<span class="n">c_1_grid_nb</span> <span class="o">=</span> <span class="mi">102</span>
<span class="n">c_1_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">c_1_grid_nb</span><span class="p">)</span>

<span class="c1"># Compute \bar{u}</span>
<span class="n">u_bar</span> <span class="o">=</span> <span class="n">u</span><span class="p">(</span><span class="n">c_bundle</span><span class="p">)</span> <span class="o">@</span> <span class="n">π</span>

<span class="c1"># Compute c_2 values for the expected utility case</span>
<span class="n">c_2_grid_EU</span> <span class="o">=</span> <span class="n">u_inv</span><span class="p">((</span><span class="n">u_bar</span> <span class="o">-</span> <span class="n">u</span><span class="p">(</span><span class="n">c_1_grid</span><span class="p">)</span> <span class="o">*</span> <span class="n">π</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">π</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Compute c_2 values for the multiplier preferences case</span>
<span class="n">multi_pref_crit</span> <span class="o">=</span> <span class="n">multiplier_criterion_factory</span><span class="p">(</span><span class="n">θ</span><span class="p">,</span> <span class="n">π</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>  <span class="c1"># Create criterion</span>
<span class="n">multi_pref_root_problem</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">c_2</span><span class="p">,</span> <span class="n">c_1</span><span class="p">,</span> <span class="n">u_bar</span><span class="p">:</span> <span class="n">u_bar</span> <span class="o">-</span> <span class="n">multi_pref_crit</span><span class="p">(</span><span class="n">c_1</span><span class="p">,</span> <span class="n">c_2</span><span class="p">)</span>  <span class="c1"># Formulate root problem</span>
<span class="n">c_2_grid_mult</span> <span class="o">=</span> <span class="n">solve_root_problem</span><span class="p">(</span><span class="n">multi_pref_root_problem</span><span class="p">,</span> <span class="n">u_bar</span><span class="p">,</span> <span class="n">c_1_grid</span><span class="p">)</span>  <span class="c1"># Solve root problem for all c_1 values</span>

<span class="c1"># Compute c_2 values for the constraint preferences case</span>
<span class="n">constraint_pref_crit</span> <span class="o">=</span> <span class="n">constraint_criterion_factory</span><span class="p">(</span><span class="n">η</span><span class="p">,</span> <span class="n">π</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>  <span class="c1"># Create criterion</span>
<span class="n">constraint_pref_root_problem</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">c_2</span><span class="p">,</span> <span class="n">c_1</span><span class="p">,</span> <span class="n">u_bar</span><span class="p">:</span> <span class="n">u_bar</span> <span class="o">-</span> <span class="n">constraint_pref_crit</span><span class="p">(</span><span class="n">c_1</span><span class="p">,</span> <span class="n">c_2</span><span class="p">)</span>  <span class="c1"># Formulate root problem</span>
<span class="c1"># Solve root problem for all c_1 values</span>
<span class="n">c_2_grid_cons</span> <span class="o">=</span> <span class="n">solve_root_problem</span><span class="p">(</span><span class="n">constraint_pref_root_problem</span><span class="p">,</span> <span class="n">u_bar</span><span class="p">,</span> <span class="n">c_1_grid</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bisect&#39;</span><span class="p">,</span> <span class="n">bracket</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">])</span>  

<span class="c1"># Compute associated η and θ values</span>
<span class="n">ηs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">c_1_grid</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
<span class="n">θs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">c_1_grid</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">c_1_grid</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
    <span class="n">ηs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">multi_pref_crit</span><span class="p">(</span><span class="n">c_1_grid</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">c_2_grid_mult</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">return_entropy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">θs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">constraint_pref_crit</span><span class="p">(</span><span class="n">c_1_grid</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">c_2_grid_cons</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">return_θ_tilde</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
<span class="n">θs</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">c_2_grid_cons</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_1_grid</span><span class="p">,</span> <span class="n">c_1_grid</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_1_grid</span><span class="p">,</span> <span class="n">c_2_grid_EU</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Expected Utility&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_1_grid</span><span class="p">,</span> <span class="n">c_2_grid_mult</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Multiplier Preferences&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_1_grid</span><span class="p">,</span> <span class="n">c_2_grid_cons</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Constraint Preferences&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$c_1$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$c_2$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;(1, 1)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mf">0.16</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="mf">0.02</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_1_grid</span><span class="p">,</span> <span class="n">ηs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\eta^{*}$&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_1_grid</span><span class="p">,</span> <span class="n">θs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\theta^{*}$&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$c_1$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/five_preferences_28_0.png" src="_images/five_preferences_28_0.png" />
</div>
</div>
<p><strong>Kink at 45 degree line</strong></p>
<p>Notice the kink in the indifference curve for constraint  preferences at the 45 degree line.</p>
<p>To understand the source of the kink, consider how the Lagrange multiplier and worst-case probabilities vary with the consumption plan under  constraint preferences.</p>
<p>For fixed <span class="math notranslate nohighlight">\(\eta\)</span>, a given plan <span class="math notranslate nohighlight">\(c\)</span>, and a utility function increasing in <span class="math notranslate nohighlight">\(c\)</span>,  worst case probabilities are <strong>fixed numbers</strong> <span class="math notranslate nohighlight">\(\hat \pi_1 &lt; .5\)</span> when <span class="math notranslate nohighlight">\(c_1 &gt; c_2\)</span> and <span class="math notranslate nohighlight">\(\hat \pi_1 &gt; .5\)</span> when
<span class="math notranslate nohighlight">\(c_2 &gt; c_1\)</span>.</p>
<p>This pattern makes the Lagrange multiplier <span class="math notranslate nohighlight">\(\tilde \theta\)</span> vary discontinuously at <span class="math notranslate nohighlight">\(\hat \pi_1 = .5\)</span>.</p>
<p>The  discontinuity in the worst case <span class="math notranslate nohighlight">\(\hat \pi_1\)</span> at the 45 degree line accounts for the kink at the 45 degree line in an indifference curve for constraint preferences associated with a given positive entropy constraint <span class="math notranslate nohighlight">\(\eta\)</span>.</p>
<p>The code for generating the preceding figure is somewhat intricate we formulate a root finding problem for finding indifference curves.</p>
<p>Here is a brief literary  description of the method we use.</p>
<p><strong>Parameters</strong></p>
<ul class="simple">
<li><p>Consumption bundle <span class="math notranslate nohighlight">\(c=\left(1,1\right)\)</span></p></li>
<li><p>Penalty parameter <span class="math notranslate nohighlight">\(θ=2\)</span></p></li>
<li><p>Utility function <span class="math notranslate nohighlight">\(u=\log\)</span></p></li>
<li><p>Probability vector <span class="math notranslate nohighlight">\(\pi=\left(0.5,0.5\right)\)</span></p></li>
</ul>
<p><strong>Algorithm:</strong></p>
<ul class="simple">
<li><p>Compute <span class="math notranslate nohighlight">\(\bar{u}=\pi_{1}u\left(c_{1}\right)+\pi_{2}u\left(c_{2}\right)\)</span></p></li>
<li><p>Given values for <span class="math notranslate nohighlight">\(c_{1}\)</span>, solve for values of <span class="math notranslate nohighlight">\(c_{2}\)</span> such that <span class="math notranslate nohighlight">\(\bar{u}=u\left(c_{1},c_{2}\right)\)</span>:</p>
<ul>
<li><p>Expected utility: <span class="math notranslate nohighlight">\(c_{2,EU}=u^{-1}\left(\frac{\bar{u}-\pi_{1}u\left(c_{1}\right)}{\pi_{2}}\right)\)</span></p></li>
<li><p>Multiplier preferences: solve <span class="math notranslate nohighlight">\(\bar{u}-\sum_{i}\pi_{i}\frac{\exp\left(\frac{-u\left(c_{i}\right)}{\theta}\right)}{\sum_{j}\exp\left(\frac{-u\left(c_{j}\right)}{\theta}\right)}\left(u\left(c_{i}\right)+\theta\log\left(\frac{\exp\left(\frac{-u\left(c_{i}\right)}{\theta}\right)}{\sum_{j}\exp\left(\frac{-u\left(c_{j}\right)}{\theta}\right)}\right)\right)=0\)</span> numerically</p></li>
<li><p>Constraint preference: solve <span class="math notranslate nohighlight">\(\bar{u}-\sum_{i}\pi_{i}\frac{\exp\left(\frac{-u\left(c_{i}\right)}{\theta^{*}}\right)}{\sum_{j}\exp\left(\frac{-u\left(c_{j}\right)}{\theta^{*}}\right)}u\left(c_{i}\right)=0\)</span> numerically where <span class="math notranslate nohighlight">\(\theta^{*}\)</span> solves <span class="math notranslate nohighlight">\(\sum_{i}\pi_{i}\frac{\exp\left(\frac{-u\left(c_{i}\right)}{\theta^{*}}\right)}{\sum_{j}\exp\left(\frac{-u\left(c_{j}\right)}{\theta^{*}}\right)}\log\left(\frac{\exp\left(\frac{-u\left(c_{i}\right)}{\theta^{*}}\right)}{\sum_{j}\exp\left(\frac{-u\left(c_{j}\right)}{\theta^{*}}\right)}\right)-\eta=0\)</span> numerically.</p></li>
</ul>
</li>
</ul>
<p><strong>Remark:</strong> It seems that the constraint problem is hard to solve in its original form, i.e. by finding the distorting measure that minimizes the expected utility.</p>
<p>It seems that viewing equation <a class="reference internal" href="#equation-tom7">(13.7)</a> as a root finding problem works much better.</p>
<p>But notice that  equation <a class="reference internal" href="#equation-tom7">(13.7)</a> does not always have a solution.</p>
<p>Under <span class="math notranslate nohighlight">\(u=\log\)</span>, <span class="math notranslate nohighlight">\(c_{1}=c_{2}=1\)</span>, we have:</p>
<div class="math notranslate nohighlight">
\[
\sum_{i}\pi_{i}\frac{\exp\left(\frac{-u\left(c_{i}\right)}{\tilde{\theta}}\right)}{\sum_{j}\pi_{j}\exp\left(\frac{-u\left(c_{j}\right)}{\tilde{\theta}}\right)}\log\left(\frac{\exp\left(\frac{-u\left(c_{i}\right)}{\tilde{\theta}}\right)}{\sum_{j}\pi_{j}\exp\left(\frac{-u\left(c_{j}\right)}{\tilde{\theta}}\right)}\right)=0
\]</div>
<p><strong>Conjecture:</strong> when our numerical  method fails it  because the derivative of the objective doesn’t exist for our choice of  parameters.</p>
<p><strong>Remark:</strong> It is tricky to get the algorithm  to work properly for all values of <span class="math notranslate nohighlight">\(c_{1}\)</span>. In particular, parameters were chosen with <a class="reference external" href="https://sciencedryad.wordpress.com/2014/01/25/grad-student-descent/">graduate student descent</a>.</p>
<p><strong>Tangent indifference curves off 45 degree line</strong></p>
<p>For a given <span class="math notranslate nohighlight">\(\eta\)</span> and a given allocatin <span class="math notranslate nohighlight">\((c_1, c_2)\)</span> off the 45 degree line, by solving
equations <a class="reference internal" href="#equation-tom7">(13.7)</a> and <a class="reference internal" href="#equation-tom20">(13.13)</a>, we can find <span class="math notranslate nohighlight">\(\tilde \theta (\eta, c)\)</span>
and <span class="math notranslate nohighlight">\(\tilde \eta(\theta,c)\)</span> that make indifference curves for
multiplier and constraint preferences be tangent to one another.</p>
<p>The following figure shows indifference curves for
multiplier and constraint preferences through a point off the 45 degree
line, namely, <span class="math notranslate nohighlight">\((c(1),c(2)) = (3,1)\)</span>, at which <span class="math notranslate nohighlight">\(\eta\)</span> and <span class="math notranslate nohighlight">\(\theta\)</span> are
adjusted to render the indifference curves for constraint and multiplier
preferences tangent.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parameters</span>
<span class="n">θ</span> <span class="o">=</span> <span class="mf">2.</span>
<span class="n">η</span> <span class="o">=</span> <span class="mf">0.036</span>
<span class="n">c_bundle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>

<span class="c1"># Conustruct grid for c_1</span>
<span class="n">c_1_grid_num</span> <span class="o">=</span> <span class="mi">101</span>
<span class="n">c_1_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">c_1_grid_num</span><span class="p">)</span>

<span class="c1"># Compute u_bar</span>
<span class="n">u_bar</span> <span class="o">=</span> <span class="n">u</span><span class="p">(</span><span class="n">c_bundle</span><span class="p">)</span> <span class="o">@</span> <span class="n">π</span>

<span class="c1"># Compute c_2 values for the expected utility case</span>
<span class="n">c_2_grid_EU</span> <span class="o">=</span> <span class="n">u_inv</span><span class="p">((</span><span class="n">u_bar</span> <span class="o">-</span> <span class="n">u</span><span class="p">(</span><span class="n">c_1_grid</span><span class="p">)</span> <span class="o">*</span> <span class="n">π</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">π</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Compute c_2 values for the multiplier preferences case</span>
<span class="n">multi_pref_crit</span> <span class="o">=</span> <span class="n">multiplier_criterion_factory</span><span class="p">(</span><span class="n">θ</span><span class="p">,</span> <span class="n">π</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>  <span class="c1"># Create criterion</span>
<span class="n">multi_crit_bar</span> <span class="o">=</span> <span class="n">multi_pref_crit</span><span class="p">(</span><span class="o">*</span><span class="n">c_bundle</span><span class="p">)</span>  <span class="c1"># Evaluate criterion at consumption bundle</span>
<span class="n">multi_pref_root_problem</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">c_2</span><span class="p">,</span> <span class="n">c_1</span><span class="p">,</span> <span class="n">u_bar</span><span class="p">:</span> <span class="n">u_bar</span> <span class="o">-</span> <span class="n">multi_pref_crit</span><span class="p">(</span><span class="n">c_1</span><span class="p">,</span> <span class="n">c_2</span><span class="p">)</span>  <span class="c1"># Formulate root problem</span>
<span class="c1"># Solve root problem for all c_1 values</span>
<span class="n">c_2_grid_mult</span> <span class="o">=</span> <span class="n">solve_root_problem</span><span class="p">(</span><span class="n">multi_pref_root_problem</span><span class="p">,</span> <span class="n">multi_crit_bar</span><span class="p">,</span> <span class="n">c_1_grid</span><span class="p">,</span> <span class="n">bracket</span><span class="o">=</span><span class="p">[</span><span class="mf">1e-5</span><span class="p">,</span> <span class="mf">5.</span><span class="p">])</span>  

<span class="c1"># Compute c_2 values for the constraint preferences case</span>
<span class="n">constraint_pref_crit</span> <span class="o">=</span> <span class="n">constraint_criterion_factory</span><span class="p">(</span><span class="n">η</span><span class="p">,</span> <span class="n">π</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>  <span class="c1"># Create criterion</span>
<span class="n">cons_crit_bar</span> <span class="o">=</span> <span class="n">constraint_pref_crit</span><span class="p">(</span><span class="o">*</span><span class="n">c_bundle</span><span class="p">)</span>  <span class="c1"># Evaluate criterion at consumption bundle</span>
<span class="n">constraint_pref_root_problem</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">c_2</span><span class="p">,</span> <span class="n">c_1</span><span class="p">,</span> <span class="n">u_bar</span><span class="p">:</span> <span class="n">u_bar</span> <span class="o">-</span> <span class="n">constraint_pref_crit</span><span class="p">(</span><span class="n">c_1</span><span class="p">,</span> <span class="n">c_2</span><span class="p">)</span>  <span class="c1"># Formulate root problem</span>
<span class="c1"># Solve root problem for all c_1 values</span>
<span class="n">c_2_grid_cons</span> <span class="o">=</span> <span class="n">solve_root_problem</span><span class="p">(</span><span class="n">constraint_pref_root_problem</span><span class="p">,</span> <span class="n">cons_crit_bar</span><span class="p">,</span> <span class="n">c_1_grid</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bisect&#39;</span><span class="p">,</span> <span class="n">bracket</span><span class="o">=</span><span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">4.4</span><span class="p">])</span>  

<span class="c1"># Compute associated η and θ values</span>
<span class="n">ηs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">c_1_grid</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
<span class="n">θs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">c_1_grid</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">c_1_grid</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
    <span class="n">ηs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">multi_pref_crit</span><span class="p">(</span><span class="n">c_1_grid</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">c_2_grid_mult</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">return_entropy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">θs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">constraint_pref_crit</span><span class="p">(</span><span class="n">c_1_grid</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">c_2_grid_cons</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">return_θ_tilde</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
<span class="n">θs</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">c_2_grid_cons</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_1_grid</span><span class="p">,</span> <span class="n">c_1_grid</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_1_grid</span><span class="p">,</span> <span class="n">c_2_grid_EU</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Expected Utility&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_1_grid</span><span class="p">,</span> <span class="n">c_2_grid_mult</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Multiplier Preferences&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_1_grid</span><span class="p">,</span> <span class="n">c_2_grid_cons</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Constraint Preferences&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$c_1$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$c_2$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;(3, 1)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="mf">0.07</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">4.</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">4.</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_1_grid</span><span class="p">,</span> <span class="n">ηs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\eta^{*}$&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_1_grid</span><span class="p">,</span> <span class="n">θs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\theta^{*}$&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$c_1$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/five_preferences_31_0.png" src="_images/five_preferences_31_0.png" />
</div>
</div>
<p>Note that all three lines of the left graph intersect at (1, 3). While the intersection at (3, 1) is hard-coded, the intersection at (1,3) arises from the computation,  which confirms that the code seems to be
working properly.</p>
<p>As we move along the (kinked) indifference curve for the constraint
preferences for a given <span class="math notranslate nohighlight">\(\eta\)</span>, the worst-case probabilities remain
constant, but the Lagrange multiplier <span class="math notranslate nohighlight">\(\tilde \theta\)</span> on the entropy
constraint <span class="math notranslate nohighlight">\(\sum_{i=1}^I m_i \log m_i \leq \eta\)</span> varies with
<span class="math notranslate nohighlight">\((c_1, c_2)\)</span>.</p>
<p>As we move along the (smooth) indifference curve for the
multiplier preferences for a given penalty parameter <span class="math notranslate nohighlight">\(\theta\)</span>, the
implied entropy <span class="math notranslate nohighlight">\(\tilde \eta\)</span> from equation <a class="reference internal" href="#equation-tom20">(13.13)</a> and the worst-case probabilities both
change with <span class="math notranslate nohighlight">\((c_1, c_2)\)</span>.</p>
<p>For constraint preferences, there is a kink in the indifference curve.</p>
<p>For ex post Bayesian preferences, there are effectively two sets of indifference curves depending on which
side of the 45 degree line the <span class="math notranslate nohighlight">\((c_1, c_2)\)</span> endowment point sits.</p>
<p>There are two sets of indifference curves because, while the worst-case
probabilities differ above and below the 45 degree line, the idea of ex
post Bayesian preferences is to use a <em>single</em> probability distribution
to compute expected utilities for all consumption bundles.</p>
<p>Indifference curves through point <span class="math notranslate nohighlight">\((c_1, c_2) = (3,1)\)</span> for expected
logarithmic utility (less curved smooth line), multiplier (more curved
line), constraint (solid line kinked at 45 degree line), and <em>ex post</em>
Bayesian (dotted lines) preferences. The worst-case probability
<span class="math notranslate nohighlight">\(\hat \pi_1 &lt; .5\)</span> when <span class="math notranslate nohighlight">\(c_1 =3 &gt; c_2 =1\)</span> and <span class="math notranslate nohighlight">\(\hat \pi_1 &gt; .5\)</span> when
<span class="math notranslate nohighlight">\(c_1=1 &lt; c_2 = 3\)</span>.</p>
</div>
<div class="section" id="state-price-deflators">
<h2><span class="section-number">13.12. </span>State price deflators<a class="headerlink" href="#state-price-deflators" title="Permalink to this headline">¶</a></h2>
<p>Concerns about model uncertainty boost prices of risk that are embedded
in state-price deflators. With complete markets, let <span class="math notranslate nohighlight">\(q_i\)</span> be the price
of consumption in state <span class="math notranslate nohighlight">\(i\)</span>.</p>
<p>The budget set of a representative consumer
having endowment <span class="math notranslate nohighlight">\(\bar c = \{\bar c_i\}_{i=1}^I\)</span> is expressed by
<span class="math notranslate nohighlight">\(\sum_{i}^I q_i (c_i - \bar c_i) \leq 0\)</span>.</p>
<p>When a representative consumer has multiplier preferences, the state prices are</p>
<div class="math notranslate nohighlight" id="equation-eqn-state-price">
<span class="eqno">(13.18)<a class="headerlink" href="#equation-eqn-state-price" title="Permalink to this equation">¶</a></span>\[
q_i = \pi_i \hat m_i u'(\bar c_i) = \pi_i \Biggl(\frac{\exp(-u(\bar c_i)/\theta)}{\sum_j  \pi_j \exp(-u(\bar c_j)/\theta)}\Biggr) u'(\bar c_i) .
\]</div>
<p>The worst-case likelihood ratio <span class="math notranslate nohighlight">\(\hat m_i\)</span> operates to increase prices
<span class="math notranslate nohighlight">\(q_i\)</span> in relatively low utility states <span class="math notranslate nohighlight">\(i\)</span>.</p>
<p>State prices agree under multiplier and constraint preferences when <span class="math notranslate nohighlight">\(\eta\)</span> and <span class="math notranslate nohighlight">\(\theta\)</span> are
adjusted according to <a class="reference internal" href="#equation-tom7">(13.7)</a> or <a class="reference internal" href="#equation-tom20">(13.13)</a> to make the indifference curves tangent
at the endowment point.</p>
<p>The next figure can help us think about state-price deflators under our different preference orderings.</p>
<p>In this figure, budget line and indifference curves through point <span class="math notranslate nohighlight">\((c_1, c_2) = (3,1)\)</span>
for expected logarithmic utility, multiplier, constraint (kinked at 45
degree line), and <em>ex post</em> Bayesian (dotted lines) preferences.</p>
<p><strong>Figure 2.7:</strong></p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parameters</span>
<span class="n">θ</span> <span class="o">=</span> <span class="mf">2.</span>
<span class="n">η</span> <span class="o">=</span> <span class="mf">0.036</span>
<span class="n">c_bundle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">utility_function_factory</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span>
<span class="n">u_prime</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">c</span>  <span class="c1"># Derivative of the utility function</span>

<span class="c1"># Compute value of θ at c_1=3</span>
<span class="n">θ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="mf">3.</span><span class="p">,</span> <span class="n">c_1_grid</span><span class="p">,</span> <span class="n">θs</span><span class="p">)</span>

<span class="c1"># Compute change of measure</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">compute_change_measure</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">c_bundle</span><span class="p">,</span> <span class="n">θ</span><span class="p">,</span> <span class="n">π</span><span class="p">)</span>

<span class="c1"># Compute budget constraint</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">π</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="n">u_prime</span><span class="p">(</span><span class="n">c_bundle</span><span class="p">)</span>
<span class="n">endowment</span> <span class="o">=</span> <span class="p">(</span><span class="n">c_bundle</span> <span class="o">*</span> <span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">intercept</span> <span class="o">=</span> <span class="n">endowment</span> <span class="o">/</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">slope</span> <span class="o">=</span> <span class="o">-</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">budget_constraint</span> <span class="o">=</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">c_1_grid</span> <span class="o">+</span> <span class="n">intercept</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_1_grid</span><span class="p">,</span> <span class="n">c_1_grid</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_1_grid</span><span class="p">,</span> <span class="n">c_2_grid_mult</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Multiplier Preferences&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_1_grid</span><span class="p">,</span> <span class="n">c_2_grid_cons</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Constraint Preferences&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_1_grid</span><span class="p">,</span> <span class="n">budget_constraint</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Budget Constraint&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$c_1$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$c_2$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;(3, 1)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="mf">0.07</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">4.</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">4.</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/five_preferences_34_0.png" src="_images/five_preferences_34_0.png" />
</div>
</div>
<p>Because budget constraints are linear, asset prices are identical under
multiplier and constraint preferences for which <span class="math notranslate nohighlight">\(\theta\)</span> and <span class="math notranslate nohighlight">\(\eta\)</span> are
adjusted to verify <a class="reference internal" href="#equation-tom7">(13.7)</a> or <a class="reference internal" href="#equation-tom20">(13.13)</a> at a given consumption endowment
<span class="math notranslate nohighlight">\(\{c_i\}_{i=1}^I\)</span>.</p>
<p>However, as we note next, though they are tangent at
the endowment point, the fact that indifference curves differ for
multiplier and constraint preferences means that certainty equivalent
consumption compensations of the kind that <span id="id13">[<a class="reference internal" href="zreferences.html#id87">Luc87</a>]</span>,
<span id="id14">[<a class="reference internal" href="zreferences.html#id8">HST99</a>]</span>, <span id="id15">[<a class="reference internal" href="zreferences.html#id86">Tal00</a>]</span>, and <span id="id16">[<a class="reference internal" href="zreferences.html#id7">BHS09</a>]</span> used to measure the costs of
business cycles must differ.</p>
<div class="section" id="consumption-equivalent-measures-of-uncertainty-aversion">
<h3><span class="section-number">13.12.1. </span>Consumption-equivalent measures of uncertainty aversion<a class="headerlink" href="#consumption-equivalent-measures-of-uncertainty-aversion" title="Permalink to this headline">¶</a></h3>
<p>For each of our five types of preferences, the following figure allows us to construct a certainty
equivalent point <span class="math notranslate nohighlight">\((c^*, c^*)\)</span> on the 45 degree line that renders the consumer indifferent between it and the risky point
<span class="math notranslate nohighlight">\((c(1), c(2)) = (3,1)\)</span>.</p>
<p><strong>Figure 2.8:</strong></p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute values for the certainty equivalent line </span>
<span class="n">intercept</span> <span class="o">=</span> <span class="mf">4.</span>  <span class="c1"># Intercept value</span>
<span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">&lt;=</span> <span class="n">c_1_grid</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">c_1_grid</span> <span class="o">&lt;=</span> <span class="mf">3.</span><span class="p">)</span>  <span class="c1"># Mask to keep only data between c_1=1 and c_1=3</span>

<span class="c1"># Initialize array </span>
<span class="n">certainty_equiv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">c_1_grid</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="c1"># Fill relevant locations</span>
<span class="n">certainty_equiv</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">intercept</span> <span class="o">-</span> <span class="n">c_1_grid</span><span class="p">)[</span><span class="n">mask</span><span class="p">]</span>


<span class="c1"># Set up a fixed point problem to find intersections with x=x line</span>
<span class="c1"># Function used to approximate indifference curves using linear interpolation</span>
<span class="n">func_approx</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">c_1</span><span class="p">,</span> <span class="n">fp</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">c_1</span><span class="p">,</span> <span class="n">c_1_grid</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>  
<span class="n">x0</span> <span class="o">=</span> <span class="mf">2.</span>  <span class="c1"># Initial guess</span>

<span class="c1"># Solve for fixed points</span>
<span class="n">fp_CE</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">fixed_point</span><span class="p">(</span><span class="n">func_approx</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">([</span><span class="n">certainty_equiv</span><span class="p">]))</span>
<span class="n">fp_EU</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">fixed_point</span><span class="p">(</span><span class="n">func_approx</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">([</span><span class="n">c_2_grid_EU</span><span class="p">]))</span>
<span class="n">fp_mult</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">fixed_point</span><span class="p">(</span><span class="n">func_approx</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">([</span><span class="n">c_2_grid_mult</span><span class="p">]))</span>
<span class="n">fp_cons</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">fixed_point</span><span class="p">(</span><span class="n">func_approx</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">([</span><span class="n">c_2_grid_cons</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_1_grid</span><span class="p">,</span> <span class="n">c_1_grid</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_1_grid</span><span class="p">,</span> <span class="n">c_2_grid_EU</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Expected Utility&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_1_grid</span><span class="p">,</span> <span class="n">c_2_grid_mult</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Multiplier Preferences&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_1_grid</span><span class="p">,</span> <span class="n">c_2_grid_cons</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Constraint Preferences&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_1_grid</span><span class="p">,</span> <span class="n">certainty_equiv</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$c_1$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$c_2$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;(3, 1)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="mf">0.07</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;(1, 3)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mf">0.02</span><span class="p">,</span> <span class="mi">3</span><span class="o">+</span><span class="mf">0.07</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">4.</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">4.</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fp_CE</span><span class="p">,</span> <span class="n">fp_CE</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fp_EU</span><span class="p">,</span> <span class="n">fp_EU</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fp_mult</span><span class="p">,</span> <span class="n">fp_mult</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fp_cons</span><span class="p">,</span> <span class="n">fp_cons</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">fp_CE</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">fp_CE</span><span class="o">+</span><span class="mf">0.06</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">fp_EU</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">fp_EU</span><span class="o">+</span><span class="mf">0.06</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">fp_mult</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">fp_mult</span><span class="o">+</span><span class="mf">0.06</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">fp_cons</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">fp_cons</span><span class="o">+</span><span class="mf">0.06</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/five_preferences_37_0.png" src="_images/five_preferences_37_0.png" />
</div>
</div>
<p>The figure indicates that the certainty equivalent
level <span class="math notranslate nohighlight">\(c^*\)</span> is higher for the consumer with expected utility preferences
than for the consumer with multiplier preferences, and that it is higher
for the consumer with multiplier preferences than for the consumer with
constraint preferences.</p>
<p>The gap between these certainty equivalents
measures the uncertainty aversion of the multiplier preferences or
constraint preferences consumer.</p>
<p>The gap between the expected value
<span class="math notranslate nohighlight">\(.5 c(1) + .5 c(2)\)</span> at point A and the certainty equivalent for the
expected utility decision maker at point B is a measure of his risk
aversion.</p>
<p>The gap between points <span class="math notranslate nohighlight">\(B\)</span> and <span class="math notranslate nohighlight">\(C\)</span> measures the multiplier
preference consumer’s aversion to model uncertainty.</p>
<p>The gap between
points B and D measures the constraint preference consumer’s aversion to
model uncertainty.</p>
</div>
</div>
<div class="section" id="iso-utility-and-iso-entropy-curves-and-expansion-paths">
<h2><span class="section-number">13.13. </span>Iso-utility and iso-entropy curves and expansion paths<a class="headerlink" href="#iso-utility-and-iso-entropy-curves-and-expansion-paths" title="Permalink to this headline">¶</a></h2>
<p>The following figures show iso-entropy and iso-utility lines for the special case in which <span class="math notranslate nohighlight">\(I = 3\)</span>, <span class="math notranslate nohighlight">\(\pi_1 = .3, \pi_2 = .4\)</span>, and the utility function is <span class="math notranslate nohighlight">\(u(c)= \frac{c^{1-\alpha}}{1-\alpha}\)</span> with <span class="math notranslate nohighlight">\(\alpha =0\)</span> and <span class="math notranslate nohighlight">\(\alpha =3\)</span>, respectively, for the fixed plan <span class="math notranslate nohighlight">\(c(1) = 1, c(2) =2 , c(3) =3\)</span>.</p>
<p>The iso-utility lines are the level curves of</p>
<div class="math notranslate nohighlight">
\[ 
\hat \pi_1 c_1 + \hat \pi_2 c_2 + (1-\hat \pi_1 - \hat \pi_2) c_3
\]</div>
<p>and are linear in <span class="math notranslate nohighlight">\((\hat \pi_1, \hat \pi_2)\)</span>.</p>
<p>This is what it means to say ‘expected utility is linear in probabilities.’</p>
<p>Both figures plot the locus of points of tangency between the iso-entropy and the iso-utility
curves that is traced out as one varies <span class="math notranslate nohighlight">\(\theta^{-1}\)</span> in the interval
<span class="math notranslate nohighlight">\([0, 2]\)</span>.</p>
<p>While the iso-entropy lines are identical in the two figures, these ‘expansion paths’ differ because the utility functions differ,
meaning that for a given <span class="math notranslate nohighlight">\(\theta\)</span> and <span class="math notranslate nohighlight">\((c_1, c_2, c_3)\)</span> triple, the worst-case probabilities <span class="math notranslate nohighlight">\(\hat \pi_i(\theta) =  \pi_i \frac{\exp(-u(c_i)/\theta )} {E\exp(-u(c)/\theta )}\)</span> differ as we vary <span class="math notranslate nohighlight">\(\theta\)</span>, causing the associated entropies to differ.</p>
<p><strong>Color bars:</strong></p>
<ul class="simple">
<li><p>First color bar: variation in <span class="math notranslate nohighlight">\(\theta\)</span></p></li>
<li><p>Second color bar: variation in utility levels</p></li>
<li><p>Third color bar: variation in entropy levels</p></li>
</ul>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting functions</span>
<span class="k">def</span> <span class="nf">make_segments</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Create list of line segments from x and y coordinates, in the correct format for LineCollection:</span>
<span class="sd">    an array of the form   numlines x (points per line) x 2 (x and y) array</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">segments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">points</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">:]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">segments</span>


<span class="k">def</span> <span class="nf">colorline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;copper&#39;</span><span class="p">),</span> <span class="n">norm</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Plot a colored line with coordinates x and y</span>
<span class="sd">    Optionally specify colors in the array z</span>
<span class="sd">    Optionally specify a colormap, a norm function and a line width</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="c1"># Default colors equally spaced on [0,1]:</span>
    <span class="k">if</span> <span class="n">z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
           
    <span class="c1"># Special case if a single number:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="s2">&quot;__iter__&quot;</span><span class="p">):</span>  <span class="c1"># to check for numerical input -- this is a hack</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">z</span><span class="p">])</span>
        
    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    
    <span class="n">segments</span> <span class="o">=</span> <span class="n">make_segments</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">lc</span> <span class="o">=</span> <span class="n">LineCollection</span><span class="p">(</span><span class="n">segments</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
    
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">lc</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">lc</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">lc</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parameters</span>
<span class="n">π_1</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">π_2</span> <span class="o">=</span> <span class="mf">0.4</span>
<span class="n">π_3</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">π_1</span> <span class="o">-</span> <span class="n">π_2</span>
<span class="n">π_base</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">π_1</span><span class="p">,</span> <span class="n">π_2</span><span class="p">,</span> <span class="n">π_3</span><span class="p">])</span>
<span class="n">c_bundle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">contour_plot</span><span class="p">(</span><span class="n">α</span><span class="p">,</span> <span class="n">π_vals_nb</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">levels_nb</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">min_π_val</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a contour plot containing iso-utility and iso-entropy curves given utility</span>
<span class="sd">    function parameter `α`.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Create utility function</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">utility_function_factory</span><span class="p">(</span><span class="n">α</span><span class="p">)</span>

    <span class="c1"># Initialize arrays </span>
    <span class="n">π_hat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">EU_levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">π_vals_nb</span><span class="p">,</span> <span class="n">π_vals_nb</span><span class="p">))</span>
    <span class="n">ent_levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">EU_levels</span><span class="p">)</span>

    <span class="c1"># Create grids for π_hat_1 and π_hat_2 values</span>
    <span class="n">π_hat_1_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">min_π_val</span><span class="p">,</span> <span class="mf">1.</span><span class="o">-</span><span class="n">min_π_val</span><span class="p">,</span> <span class="n">π_vals_nb</span><span class="p">)</span>
    <span class="n">π_hat_2_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">min_π_val</span><span class="p">,</span> <span class="mf">1.</span><span class="o">-</span><span class="n">min_π_val</span><span class="p">,</span> <span class="n">π_vals_nb</span><span class="p">)</span>

    <span class="c1"># Evaluate utility function at consumption bundle</span>
    <span class="n">u_c_bundle</span> <span class="o">=</span> <span class="n">u</span><span class="p">(</span><span class="n">c_bundle</span><span class="p">)</span>

    <span class="c1"># Loop over all (π_hat_1,  π_hat_2) pairs</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">π_hat_1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">π_hat_1_vals</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">π_hat_2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">π_hat_2_vals</span><span class="p">):</span>
            <span class="c1"># Update π_hat vector with current values</span>
            <span class="n">π_hat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">π_hat_1</span>
            <span class="n">π_hat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">π_hat_2</span>
            <span class="n">π_hat</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">π_hat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">π_hat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1"># Compute and store expected utility and entropy level if π_hat is a valid probability vector</span>
            <span class="k">if</span> <span class="mf">0.</span> <span class="o">&lt;=</span> <span class="n">π_hat</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">EU_levels</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">π_hat</span> <span class="o">*</span> <span class="n">u_c_bundle</span><span class="p">)</span>
                <span class="n">ent_levels</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ent</span><span class="p">(</span><span class="n">π_base</span><span class="p">,</span> <span class="n">π_hat</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">EU_levels</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="n">ent_levels</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                
    <span class="c1"># Create grid of θ values</span>
    <span class="n">θ_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1e-4</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">π_hat_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">π_base</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">θ_vals</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
    
    <span class="c1"># For each θ, compute distorted probability distribution</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">θ_vals</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>  
        <span class="n">m</span> <span class="o">=</span> <span class="n">compute_change_measure</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">c_bundle</span><span class="p">,</span> <span class="n">θ_vals</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">π_base</span><span class="p">)</span>
        <span class="n">π_hat_coord</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">π_base</span> <span class="o">*</span> <span class="n">m</span>
    
    <span class="c1"># Create contour plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">π_hat_1_vals</span><span class="p">,</span> <span class="n">π_hat_2_vals</span><span class="p">,</span> <span class="n">EU_levels</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels_nb</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;spring&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">π_hat_1_vals</span><span class="p">,</span> <span class="n">π_hat_2_vals</span><span class="p">,</span> <span class="n">ent_levels</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels_nb</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;winter&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="n">colorline</span><span class="p">(</span><span class="n">π_hat_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">π_hat_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">z</span><span class="o">=</span><span class="n">θ_vals</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\hat{\pi}_</span><span class="si">{1}</span><span class="s1">$&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\hat{\pi}_</span><span class="si">{2}</span><span class="s1">$&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">α</span> <span class="o">=</span> <span class="mf">0.</span>

<span class="n">contour_plot</span><span class="p">(</span><span class="n">α</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-3-938bd72046ba&gt;:36: RuntimeWarning: invalid value encountered in true_divide
  m =  m_unnormalized / (π * m_unnormalized).sum()
</pre></div>
</div>
<img alt="_images/five_preferences_41_1.png" src="_images/five_preferences_41_1.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">α</span> <span class="o">=</span> <span class="mf">3.</span>

<span class="n">contour_plot</span><span class="p">(</span><span class="n">α</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-3-938bd72046ba&gt;:35: RuntimeWarning: overflow encountered in exp
  m_unnormalized = np.exp(-u(c) / θ)
&lt;ipython-input-3-938bd72046ba&gt;:36: RuntimeWarning: invalid value encountered in true_divide
  m =  m_unnormalized / (π * m_unnormalized).sum()
</pre></div>
</div>
<img alt="_images/five_preferences_42_1.png" src="_images/five_preferences_42_1.png" />
</div>
</div>
</div>
<div class="section" id="bounds-on-expected-utility">
<h2><span class="section-number">13.14. </span>Bounds on expected utility<a class="headerlink" href="#bounds-on-expected-utility" title="Permalink to this headline">¶</a></h2>
<p>Suppose that a decision maker wants a lower bound on expected utility
<span class="math notranslate nohighlight">\(\sum_{i=1}^I  \hat \pi_i u(c_i)\)</span> that is satisfied for <strong>any</strong>
distribution <span class="math notranslate nohighlight">\(\hat \pi\)</span> with relative entropy less than or equal to
<span class="math notranslate nohighlight">\(\eta\)</span>.</p>
<p>An attractive feature of multiplier and constraint preferences
is that they carry with them such a bound.</p>
<p>To show this, it is useful to collect some findings in the following
string of inequalities associated with multiplier preferences:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
{\sf T}_\theta u(c) &amp; = &amp; -\theta \log \sum_{i=1}^I \exp\Biggl(\frac{-u(c_i)}{\theta}\Biggr) \pi_i \nonumber \\
    &amp; = &amp; \sum_{i=1}^I m_i^* \pi_i \bigl( u(c_i) + \theta \log m_i^* \bigr) \nonumber \\
    &amp; \leq &amp; \sum_{i=1}^I m_i \pi_i u(c_i) + \theta \sum_{i=1}^i m_i \log m_i \pi_i
\end{aligned}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(m_i^* \propto \exp \Bigl( \frac{- u(c_i)}{\theta} \Bigr)\)</span> are the
worst-case distortions to probabilities.</p>
<p>The inequality in the last line just asserts that minimizers minimize.</p>
<p>Therefore, we have the following useful bound:</p>
<div class="math notranslate nohighlight" id="equation-eqn-bound1">
<span class="eqno">(13.19)<a class="headerlink" href="#equation-eqn-bound1" title="Permalink to this equation">¶</a></span>\[
\sum_{i=1}^I m_i \pi_i u(c_i ) \geq {\sf T}_\theta u(c) - \theta \sum_{i=1}^I \pi_i m_i \log m_i .
\]</div>
<p>The left side is expected utility under the probability distribution <span class="math notranslate nohighlight">\(\{ m_i \pi_i\}\)</span>.</p>
<p>The right side is a <em>lower bound</em> on expected utility
under <em>all</em> distributions expressed as an affine function of relative
entropy <span class="math notranslate nohighlight">\(\sum_{i=1}^I \pi_i m_i \log m_i\)</span>.</p>
<p>The bound is attained for <span class="math notranslate nohighlight">\(m_i =  m_i^* \propto \exp \Bigl(\frac{- u (c_i)}{\theta} \Bigr)\)</span>.</p>
<p>The <em>intercept</em> in the bound is the risk-sensitive criterion <span class="math notranslate nohighlight">\({\sf T}_\theta u(c)\)</span>, while the <em>slope</em> is the penalty parameter <span class="math notranslate nohighlight">\(\theta\)</span>.</p>
<p>Lowering <span class="math notranslate nohighlight">\(\theta\)</span> does two things:</p>
<ul class="simple">
<li><p>it lowers the intercept <span class="math notranslate nohighlight">\({\sf T}_\theta u(c)\)</span>, which makes the bound less informative for small
values of entropy; and</p></li>
<li><p>it lowers the absolute value of the slope, which makes the bound more informative for larger values of relative
entropy <span class="math notranslate nohighlight">\(\sum_{i=1}^I \pi_i m_i \log m_i\)</span>.</p></li>
</ul>
<p>The following figure reports  best-case and worst-case expected utilities.</p>
<p>We calculate the lines in this figure  numerically by solving optimization problems with respect to the change of measure.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parameters</span>
<span class="n">α</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">utility_function_factory</span><span class="p">(</span><span class="n">α</span><span class="p">)</span>
<span class="n">u_c_bundle</span> <span class="o">=</span> <span class="n">u</span><span class="p">(</span><span class="n">c_bundle</span><span class="p">)</span>

<span class="c1"># Create grid for η values </span>
<span class="n">η_vals_nb</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">η_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1e-10</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="n">η_vals_nb</span><span class="p">)</span>


<span class="c1"># Initialize arrays to be filled by minimum and maximum expected utility values</span>
<span class="n">min_EU</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">η_vals_nb</span><span class="p">)</span>
<span class="n">min_EU</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">max_EU</span> <span class="o">=</span> <span class="n">min_EU</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>


<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">m_0_and_1</span><span class="p">,</span> <span class="n">η</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute expected utility with respect to the distorted probability measure</span>
<span class="sd">    given the first two values of the change of measure `m_0_and_1`. </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Back out third implied value for the change of measure</span>
    <span class="n">m_2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">π_base</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">m_0_and_1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="o">/</span> <span class="n">π_base</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    
    <span class="c1"># Compute distorted probability measure π_hat</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">m_0_and_1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m_0_and_1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">m_2</span><span class="p">])</span>
    <span class="n">π_hat</span> <span class="o">=</span> <span class="n">π_base</span> <span class="o">*</span> <span class="n">m</span>
    
    <span class="c1"># Compute expected utility wrt π_hat</span>
    <span class="n">EU</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">π_hat</span> <span class="o">*</span> <span class="n">u_c_bundle</span><span class="p">)</span>
    
    <span class="c1"># Return np.inf if entropy constraint is violated</span>
    <span class="k">if</span> <span class="n">ent</span><span class="p">(</span><span class="n">π_base</span><span class="p">,</span> <span class="n">π_hat</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">η</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    
    <span class="c1"># Return np.inf if π_hat is not a valid probability vector</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">((</span><span class="mf">0.</span> <span class="o">&lt;=</span> <span class="n">π_hat</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">π_hat</span> <span class="o">&lt;=</span> <span class="mf">1.</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    
    <span class="k">return</span> <span class="n">EU</span>


<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">max_obj_wrapper</span><span class="p">(</span><span class="n">m_0_and_1</span><span class="p">,</span> <span class="n">η</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrap `objective` to make it suitable for maximization using minimization routines.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">obj_val</span> <span class="o">=</span> <span class="n">objective</span><span class="p">(</span><span class="n">m_0_and_1</span><span class="p">,</span> <span class="n">η</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">obj_val</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">obj_val</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">obj_val</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;Nelder-Mead&#39;</span>
<span class="n">m_0_and_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># Initial guess</span>

<span class="c1"># Compute worst-case expected utility values</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">η_vals_nb</span><span class="p">):</span>
    <span class="n">opt_res</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">m_0_and_1</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">η_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="n">opt_res</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">opt_res</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">η_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">opt_res</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
        <span class="n">min_EU</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">opt_res</span><span class="o">.</span><span class="n">fun</span>
         
<span class="c1"># Compute best-case expected utility values</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">η_vals_nb</span><span class="p">):</span>
    <span class="n">opt_res</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">max_obj_wrapper</span><span class="p">,</span> <span class="n">m_0_and_1</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">η_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="n">opt_res</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">max_obj_wrapper</span><span class="p">,</span> <span class="n">opt_res</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">η_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">opt_res</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
        <span class="n">max_EU</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">opt_res</span><span class="o">.</span><span class="n">fun</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute lower bound line</span>
<span class="n">θ</span> <span class="o">=</span> <span class="mf">1.269230769133136</span>
<span class="n">T_θ</span> <span class="o">=</span> <span class="n">T_θ_factory</span><span class="p">(</span><span class="n">θ</span><span class="p">,</span> <span class="n">π_base</span><span class="p">)</span>
<span class="n">intercept</span> <span class="o">=</span> <span class="n">T_θ</span><span class="p">(</span><span class="n">u</span><span class="p">)(</span><span class="n">c_bundle</span><span class="p">)</span>
<span class="n">lower_bound</span> <span class="o">=</span> <span class="n">intercept</span> <span class="o">-</span> <span class="n">θ</span> <span class="o">*</span> <span class="n">η_vals</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">η_vals</span><span class="p">,</span> <span class="n">min_EU</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">η_vals</span><span class="p">,</span> <span class="n">max_EU</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">η_vals</span><span class="p">,</span> <span class="n">min_EU</span><span class="p">,</span> <span class="n">max_EU</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">η_vals</span><span class="p">,</span> <span class="n">lower_bound</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$E\left[mu\left(c\right)\right]$&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\eta$&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/five_preferences_47_0.png" src="_images/five_preferences_47_0.png" />
</div>
</div>
<p>In this figure, expected utility is on the co-ordinate axis
while entropy is on the ordinate axis.</p>
<p>The <em>lower</em> curved line depicts
expected utility under the worst-case model associated with each value
of entropy <span class="math notranslate nohighlight">\(\eta\)</span> recorded on the ordinate axis, i.e., it is
<span class="math notranslate nohighlight">\(\sum_{i=1}^I \pi_i \tilde m_i (\tilde \theta(c,\eta)) u(c_i)\)</span>, where
<span class="math notranslate nohighlight">\(\tilde m_i (\tilde \theta(\eta)) \propto \exp \Bigl(\frac{-u(c_i)}{\tilde \theta}\Bigr)\)</span>
and <span class="math notranslate nohighlight">\(\tilde \theta\)</span> is the Lagrange multiplier associated with the
constraint that entropy cannot exceed the value on the ordinate axis.</p>
<p>The <em>higher</em> curved line depicts expected utility under the <em>best</em>-case
model indexed by the value of the Lagrange multiplier <span class="math notranslate nohighlight">\(\check \theta &gt;0\)</span>
associated with each value of entropy less than or equal to <span class="math notranslate nohighlight">\(\eta\)</span>
recorded on the ordinate axis, i.e., it is
<span class="math notranslate nohighlight">\(\sum_{i=1}^I \pi_i \check m_i (\check \theta(\eta)) u(c_i)\)</span> where
<span class="math notranslate nohighlight">\(\check m_i (\check \theta(c,\eta)) \propto \exp \Bigl(\frac{u(c_i)}{\check \theta}\Bigr)\)</span>.</p>
<p>(Here <span class="math notranslate nohighlight">\(\check \theta\)</span> is the Lagrange multiplier associated with
max-max expected utility.)</p>
<p>Points between these two curves are
possible values of expected utility for some distribution with entropy
less than or equal to the value <span class="math notranslate nohighlight">\(\eta\)</span> on the ordinate axis.</p>
<p>The straight line depicts the right side of inequality <a class="reference internal" href="#equation-eqn-bound1">(13.19)</a> for a particular value of the penalty parameter
<span class="math notranslate nohighlight">\(\theta\)</span>.</p>
<p>As noted, when one lowers <span class="math notranslate nohighlight">\(\theta\)</span>, the intercept <span class="math notranslate nohighlight">\({\sf T}_\theta u(c)\)</span> and the absolute value of the slope both decrease.</p>
<p>Thus, as <span class="math notranslate nohighlight">\(\theta\)</span> is lowered, <span class="math notranslate nohighlight">\({\sf T}_\theta u(c)\)</span> becomes a more
conservative estimate of expected utility under the approximating model
<span class="math notranslate nohighlight">\(\pi\)</span>.</p>
<p>However, as <span class="math notranslate nohighlight">\(\theta\)</span> is lowered, the robustness bound <a class="reference internal" href="#equation-eqn-bound1">(13.19)</a> becomes more informative for sufficiently large
values of entropy.</p>
<p>The slope of straight line depicting a bound is <span class="math notranslate nohighlight">\(-\theta\)</span> and the projection of the point of tangency with the curved
depicting the lower bound of expected utility is the entropy associated
with that <span class="math notranslate nohighlight">\(\theta\)</span> when it is interpreted as a Lagrange multiplier on
the entropy constraint in the constraint problem .</p>
<p>This is an application of the envelope theorem.</p>
</div>
<div class="section" id="why-entropy">
<h2><span class="section-number">13.15. </span>Why entropy?<a class="headerlink" href="#why-entropy" title="Permalink to this headline">¶</a></h2>
<p>Beyond the helpful mathematical fact that it leads directly to
convenient exponential twisting formulas <a class="reference internal" href="#equation-tom6">(13.6)</a> and
<a class="reference internal" href="#equation-tom12">(13.12)</a> for worst-case probability distortions,
there are two related justifications for using entropy to measure
discrepancies between probability distribution.</p>
<p>One arises from the role of entropy in statistical tests for discriminating between models.</p>
<p>The other comes from axioms.</p>
<div class="section" id="entropy-and-statistical-detection">
<h3><span class="section-number">13.15.1. </span>Entropy and statistical detection<a class="headerlink" href="#entropy-and-statistical-detection" title="Permalink to this headline">¶</a></h3>
<p>Robust control theory starts with a decision maker who has constructed a
good baseline approximating model whose free parameters he has estimated
to fit historical data well.</p>
<p>The decision maker recognizes that actual outcomes might be generated by one of a vast number of other models that fit the historical data nearly as well as his.</p>
<p>Therefore, he wants to evaluate outcomes under a set of alternative models that are plausible
in the sense of being statistically close to his model.</p>
<p>He uses relative entropy to quantify what  close means.</p>
<p><span id="id17">[<a class="reference internal" href="zreferences.html#id6">AHS03</a>]</span> and <span id="id18">[<a class="reference internal" href="zreferences.html#id7">BHS09</a>]</span>describe links between entropy and large deviations
bounds on test statistics for discriminating between models, in particular, statistics that describe the probability of making an error in applying a likelihood ratio test to decide whether model A or model B
generated a data record of length <span class="math notranslate nohighlight">\(T\)</span>.</p>
<p>For a given sample size, an
informative bound on the detection error probability is a function of
the entropy parameter <span class="math notranslate nohighlight">\(\eta\)</span> in constraint preferences. <span id="id19">[<a class="reference internal" href="zreferences.html#id6">AHS03</a>]</span> and <span id="id20">[<a class="reference internal" href="zreferences.html#id7">BHS09</a>]</span>
use detection error probabilities to calibrate reasonable values of <span class="math notranslate nohighlight">\(\eta\)</span>.</p>
<p><span id="id21">[<a class="reference internal" href="zreferences.html#id6">AHS03</a>]</span>  and  <span id="id22">[<a class="reference internal" href="zreferences.html#id142">HS08</a>]</span> also
use detection error probabilities to calibrate reasonable values of the
penalty parameter <span class="math notranslate nohighlight">\(\theta\)</span> in multiplier preferences.</p>
<p>For a fixed sample size and a fixed <span class="math notranslate nohighlight">\(\theta\)</span>, they would calculate the worst-case
<span class="math notranslate nohighlight">\(\hat m_i(\theta)\)</span>, an associated entropy <span class="math notranslate nohighlight">\(\eta(\theta)\)</span>, and an
associated detection error probability. In this way they build up a
detection error probability as a function of <span class="math notranslate nohighlight">\(\theta\)</span>.</p>
<p>They then invert this function to calibrate <span class="math notranslate nohighlight">\(\theta\)</span> to deliver a reasonable detection
error probability.</p>
<p>To indicate outcomes from this approach, the following figure
plots the histogram for U.S. quarterly consumption growth along with a
representative agent’s approximating density and a worst-case density
that <span id="id23">[<a class="reference internal" href="zreferences.html#id7">BHS09</a>]</span> show imply high measured market prices of risk even when a
representative consumer has the unit coefficient of relative risk
aversion associated with a logarithmic one-period utility function.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">loadmat</span><span class="p">(</span><span class="s1">&#39;dataBHS.mat&#39;</span><span class="p">)</span>

<span class="c1"># Set parameter values</span>
<span class="n">μ_c</span> <span class="o">=</span> <span class="mf">0.004952</span>
<span class="n">σ_c</span> <span class="o">=</span> <span class="mf">0.005050</span><span class="p">;</span>
<span class="n">μ_c_tilde</span> <span class="o">=</span> <span class="n">μ_c</span> <span class="o">-</span> <span class="n">σ_c</span> <span class="o">*</span> <span class="mf">0.304569723799467</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute consumption growth</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>
<span class="n">c_growth</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">c</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Create histogram of consumption growth</span>
<span class="n">nb_bins</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">cnt</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">c_growth</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">nb_bins</span><span class="p">)</span>

<span class="n">bins_min</span> <span class="o">=</span> <span class="n">bins</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="n">bins_max</span> <span class="o">=</span> <span class="n">bins</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="c1"># Create grid for PDF values</span>
<span class="n">pdf_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">bins_min</span><span class="p">,</span> <span class="n">bins_max</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># Evaluate PDF at grid points</span>
<span class="n">approx</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">μ_c</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">σ_c</span><span class="p">)</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">pdf_x</span><span class="p">)</span>
<span class="n">worst_case</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">μ_c_tilde</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">σ_c</span><span class="p">)</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">pdf_x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">lns1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">c_growth</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;consumption growth (LHS)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">30.</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
<span class="n">lns2</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pdf_x</span><span class="p">,</span> <span class="n">approx</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;approximating model (RHS)&#39;</span><span class="p">)</span>
<span class="n">lns3</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pdf_x</span><span class="p">,</span> <span class="n">worst_case</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;worst case model (RHS)&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">90.</span><span class="p">)</span>

<span class="n">lns</span> <span class="o">=</span> <span class="p">[</span><span class="n">lns1</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span><span class="o">+</span><span class="n">lns2</span><span class="o">+</span><span class="n">lns3</span>
<span class="n">labs</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">get_label</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lns</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">lns</span><span class="p">,</span> <span class="n">labs</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/five_preferences_51_0.png" src="_images/five_preferences_51_0.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span><span class="n">usetex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The density for the approximating model is
<span class="math notranslate nohighlight">\(\log c_{t+1} - \log c_t = \mu + \sigma_c \epsilon_{t+1}\)</span> where
<span class="math notranslate nohighlight">\(\epsilon_{t+1} \sim {\cal N}(0,1)\)</span> and <span class="math notranslate nohighlight">\(\mu\)</span> and <span class="math notranslate nohighlight">\(\sigma_c\)</span> are
estimated by maximum likelihood from the U.S. quarterly data in the
histogram over the period 1948.I-2006.IV.</p>
<p>The consumer’s value function under logarithmic utility implies that the worst-case model is
<span class="math notranslate nohighlight">\(\log c_{t+1} - \log c_t = (\mu + \sigma_c w)  + \sigma_c \tilde \epsilon_{t+1}\)</span>
where <span class="math notranslate nohighlight">\(\{\tilde \epsilon_{t+1}\}\)</span> is also a normalized Gaussian random
sequence and where <span class="math notranslate nohighlight">\(w\)</span> is calculated by setting a detection error
probability to <span class="math notranslate nohighlight">\(.05\)</span>.</p>
<p>The worst-case model appears to fit the histogram nearly as well as the approximating model.</p>
</div>
<div class="section" id="axiomatic-justifications">
<h3><span class="section-number">13.15.2. </span>Axiomatic justifications<a class="headerlink" href="#axiomatic-justifications" title="Permalink to this headline">¶</a></h3>
<p>Multiplier and constraint preferences are both special cases of what
<span id="id24">[<a class="reference internal" href="zreferences.html#id4">MMR06</a>]</span> call variational preferences.</p>
<p>They provide an axiomatic foundation for variational preferences and describe how they
express ambiguity aversion.</p>
<p>Constraint preferences are particular instances of the multiple priors model of <span id="id25">[<a class="reference internal" href="zreferences.html#id5">GS89</a>]</span>.</p>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                    </div>
                    
                </main> <!-- .page__content -->
                


                <footer class="page__footer">

                    <p><a href="https://creativecommons.org/licenses/by-sa/4.0/"><img src="https://licensebuttons.net/l/by-sa/4.0/80x15.png"></a></p>

                    <p>Creative Commons License &ndash; This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International.</p>

                </footer> <!-- .page__footer -->

            </div> <!-- .page -->

            

            
            <div class="sidebar bd-sidebar inactive" id="site-navigation">

                <div class="sidebar__header">


                    Contents

                </div>

                <nav class="sidebar__nav" id="sidebar-nav" aria-label="Main navigation">
                    <p class="caption">
 <span class="caption-text">
  Tools and Techniques
 </span>
</p>
<ul class="current nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="geom_series.html">
   1. Geometric Series for Elementary Economics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="multi_hyper.html">
   2. Multivariate Hypergeometric Distribution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="sir_model.html">
   3. Modeling COVID 19
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="linear_algebra.html">
   4. Linear Algebra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="qr_decomp.html">
   5. QR Decomposition
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="svd_intro.html">
   6. Singular Value Decomposition (SVD)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="complex_and_trig.html">
   7. Complex Numbers and Trigonometry
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lln_clt.html">
   8. LLN and CLT
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="prob_meaning.html">
   9. Two Meanings of Probability
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="heavy_tails.html">
   10. Heavy-Tailed Distributions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="multivariate_normal.html">
   11. Multivariate Normal Distribution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="time_series_with_matrices.html">
   12. Univariate Time Series with Matrix Algebra
  </a>
 </li>
 <li class="toctree-l1 current active active">
  <a class="current reference internal" href="#">
   13. Risk and Model Uncertainty
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Linear Programming
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="lp_intro.html">
   14. Linear Programming
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="opt_transport.html">
   15. Optimal Transport
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Introduction to Dynamics
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="scalar_dynam.html">
   16. Dynamics in One Dimension
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ar1_processes.html">
   17. AR1 Processes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="finite_markov.html">
   18. Finite Markov Chains
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="inventory_dynamics.html">
   19. Inventory Dynamics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="linear_models.html">
   20. Linear State Space Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="samuelson.html">
   21. Application: The Samuelson Multiplier-Accelerator
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="kesten_processes.html">
   22. Kesten Processes and Firm Dynamics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wealth_dynamics.html">
   23. Wealth Distribution Dynamics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="kalman.html">
   24. A First Look at the Kalman Filter
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="short_path.html">
   25. Shortest Paths
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cass_koopmans_1.html">
   26. Cass-Koopmans Planning Problem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cass_koopmans_2.html">
   27. Cass-Koopmans Competitive Equilibrium
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Search
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_model.html">
   28. Job Search I: The McCall Search Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_model_with_separation.html">
   29. Job Search II: Search and Separation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_fitted_vfi.html">
   30. Job Search III: Fitted Value Function Iteration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_correlated.html">
   31. Job Search IV: Correlated Wage Offers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="career.html">
   32. Job Search V: Modeling Career Choice
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="jv.html">
   33. Job Search VI: On-the-Job Search
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Consumption, Savings and Growth
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="cake_eating_problem.html">
   34. Cake Eating I: Introduction to Optimal Saving
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cake_eating_numerical.html">
   35. Cake Eating II: Numerical Methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="optgrowth.html">
   36. Optimal Growth I: The Stochastic Optimal Growth Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="optgrowth_fast.html">
   37. Optimal Growth II: Accelerating the Code with Numba
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="coleman_policy_iter.html">
   38. Optimal Growth III: Time Iteration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="egm_policy_iter.html">
   39. Optimal Growth IV: The Endogenous Grid Method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ifp.html">
   40. The Income Fluctuation Problem I: Basic Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ifp_advanced.html">
   41. The Income Fluctuation Problem II: Stochastic Returns on Assets
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Information
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="odu.html">
   42. Job Search VII: Search with Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="likelihood_ratio_process.html">
   43. Likelihood Ratio Processes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="imp_sample.html">
   44. Computing Mean of a Likelihood Ratio Process
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wald_friedman.html">
   45. A Problem that Stumped Milton Friedman
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="exchangeable.html">
   46. Exchangeability and Bayesian Updating
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="likelihood_bayes.html">
   47. Likelihood Ratio Processes and Bayesian Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="navy_captain.html">
   48. Bayesian versus Frequentist Decision Rules
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  LQ Control
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="lqcontrol.html">
   49. LQ Control: Foundations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="perm_income.html">
   50. The Permanent Income Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="perm_income_cons.html">
   51. Permanent Income II: LQ Techniques
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lq_inventories.html">
   52. Production Smoothing via Inventories
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Multiple Agent Models
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="schelling.html">
   53. Schelling’s Segregation Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lake_model.html">
   54. A Lake Model of Employment and Unemployment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rational_expectations.html">
   55. Rational Expectations Equilibrium
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="re_with_feedback.html">
   56. Stability in Linear Rational Expectations Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="markov_perf.html">
   57. Markov Perfect Equilibrium
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="uncertainty_traps.html">
   58. Uncertainty Traps
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="aiyagari.html">
   59. The Aiyagari Model
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Asset Pricing and Finance
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="markov_asset.html">
   60. Asset Pricing: Finite State Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ge_arrow.html">
   61. Competitive equilibria with Arrow securities
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="harrison_kreps.html">
   62. Heterogeneous Beliefs and Bubbles
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Data and Empirics
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="pandas_panel.html">
   63. Pandas for Panel Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ols.html">
   64. Linear Regression in Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mle.html">
   65. Maximum Likelihood Estimation
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Other
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="troubleshooting.html">
   66. Troubleshooting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="zreferences.html">
   67. References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="status.html">
   68. Execution Statistics
  </a>
 </li>
</ul>

                </nav>

                <div class="sidebar__footer">

                </div>

            </div> <!-- .sidebar -->
            
        </div> <!-- .main -->

        <div class="toolbar">

            <div class="toolbar__inner">

                <ul class="toolbar__main">
                    <li data-tippy-content="Table of Contents" class="btn__sidebar"><i data-feather="menu"></i></li>
                    <li data-tippy-content="Home"><a href="intro.html"><i data-feather="home"></i></a></li>
                    <li class="btn__qelogo"><a href="https://quantecon.org" title=""><span class="show-for-sr">QuantEcon</span></a></li>
                    <!-- <li class="btn__search">
                        <form action="search.html" method="get">
                            <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off">
                            <i data-feather="search"></i>
                        </form>
                    </li> -->
                </ul>

                <ul class="toolbar__links">
                    <li data-tippy-content="Fullscreen" class="btn__fullscreen"><i data-feather="maximize"></i></li>
                    <li data-tippy-content="Increase font size" class="btn__plus"><i data-feather="plus-circle"></i></li>
                    <li data-tippy-content="Decrease font size" class="btn__minus"><i data-feather="minus-circle"></i></li>
                    <li data-tippy-content="Change contrast" class="btn__contrast"><i data-feather="sunset"></i></li>
                    <li data-tippy-content="Download Notebook"><a href="_notebooks/five_preferences.ipynb" download><i data-feather="download-cloud"></i></a></li>
                    <li class="settings-button" id="settingsButton"><div data-tippy-content="Launch Notebook"><i data-feather="play-circle"></i></div></li>
                        <li class="download-pdf" id="downloadButton"><i data-feather="file"></i></li>
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/QuantEcon/lecture-python.myst/tree/master/lectures/five_preferences.md" download><i data-feather="github"></i></a></li>
                </ul>

            </div>

        </div> <!-- .toolbar -->
        <div id="downloadPDFModal" style="display: none;">
            <ul class="pdf-options" style="display: block;">
                <li class="download-pdf-book" onClick="window.print()">
                    <p>Lecture (PDF)</p>
                </li>
                <li class="download-pdf-file">
                    <a href="_pdf/quantecon-python.pdf" download><p>Book (PDF)</p></a>
                </li>
            </ul>
        </div>
        <div id="settingsModal" style="display: none;">
            <p class="modal-title"> Notebook Launcher </p>
            <div class="modal-desc">
            <p>
                Choose public or private cloud service for "Launch" button.
            </p>
            </div>
            <p class="modal-subtitle">Select a server</p>
            <ul class="modal-servers">
            <li class="active launcher-public">
                <span class="label">Public</span>
                <select id="launcher-public-input">
                
                    <option value="https://mybinder.org/v2/gh/QuantEcon/lecture-python.notebooks/master?urlpath=tree/five_preferences.ipynb">BinderHub</option>
                
                </select>
                <i class="fas fa-check-circle"></i>
            </li>
            <li class="launcher-private">
                <span class="label">Private</span>
                <input type="text" id="launcher-private-input" data-repourl="https://github.com/QuantEcon/lecture-python.notebooks" data-urlpath="tree/lecture-python.notebooks/five_preferences.ipynb" data-branch=master>
                <i class="fas fa-check-circle"></i>
            </li>
            </ul>
            <p class="launch"><a href="https://mybinder.org/v2/gh/QuantEcon/lecture-python.notebooks/master?urlpath=tree/five_preferences.ipynb" id="advancedLaunchButton" target="_blank">Launch Notebook</a></p>
            <script>
                // QuantEcon Notebook Launcher
                const launcherTypeElements = document.querySelectorAll('#settingsModal .modal-servers li');
                // Highlight the server type if previous selection exists
                if (typeof localStorage.launcherType !== 'undefined') {
                  for (var i = 0; i < launcherTypeElements.length; i++) {
                    launcherTypeElements[i].classList.remove('active');
                    if ( launcherTypeElements[i].classList.contains(localStorage.launcherType) ) {
                      launcherTypeElements[i].classList.add('active');
                    }
                  }
                }
                // Highlight server type on click and set local storage value
                for (var i = 0; i < launcherTypeElements.length; i++) {
                  launcherTypeElements[i].addEventListener('click', function() {
                    for (var j = 0; j < launcherTypeElements.length; j++) {
                      launcherTypeElements[j].classList.remove('active');
                    }
                    this.classList.add('active');
                    if ( this.classList.contains('launcher-private') ) {
                      localStorage.launcherType = 'launcher-private';
                    } else if ( this.classList.contains('launcher-public') ) {
                      localStorage.launcherType = 'launcher-public';
                    }
                    setLaunchServer();
                  })
                }
                const launcherPublic = document.getElementById('launcher-public-input');
                const launcherPrivate = document.getElementById('launcher-private-input');
                const pageName = "five_preferences";
                const repoURL = "https://github.com/QuantEcon/lecture-python.notebooks";
                const urlPath = "tree/lecture-python.notebooks/five_preferences.ipynb";
                const branch = "master"
                const launchNotebookLink = document.getElementById('advancedLaunchButton');

                // Highlight public server option if previous selection exists
                if (typeof localStorage.launcherPublic !== 'undefined') {
                  launcherPublic.value = localStorage.launcherPublic;
                }
                // Update local storage upon public server selection
                launcherPublic.addEventListener('change', (event) => {
                  setLaunchServer();
                });
                // Populate private server input if previous entry exists
                if (typeof localStorage.launcherPrivate !== 'undefined') {
                  launcherPrivate.value = localStorage.launcherPrivate;
                }
                // Update local storage when a private server is entered
                launcherPrivate.addEventListener('input', (event) => {
                  setLaunchServer();
                });

                // Function to update the "Launch Notebook" link href
                function setLaunchServer() {
                  launchNotebookLink.removeAttribute("style")
                  if ( localStorage.launcherType == 'launcher-private' ) {
                    let repoPrefix = "/jupyter/hub/user-redirect/git-pull?repo=" + repoURL + "&branch=" + branch + "&urlpath=" + urlPath;
                    launcherPrivateValue = launcherPrivate.value
                    if (!launcherPrivateValue) {
                        launchNotebookLink.removeAttribute("href")
                        launchNotebookLink.style.background = "grey"
                        return
                    }
                    localStorage.launcherPrivate = launcherPrivateValue;
                    privateServer = localStorage.launcherPrivate.replace(/\/$/, "")
                    if (!privateServer.includes("http")) {
                        privateServer = "http://" + privateServer
                    }
                    launchNotebookLinkURL = privateServer + repoPrefix;
                  } else if ( localStorage.launcherType == 'launcher-public' ) {
                    launcherPublicValue = launcherPublic.options[launcherPublic.selectedIndex].value;
                    localStorage.launcherPublic = launcherPublicValue;
                    launchNotebookLinkURL = localStorage.launcherPublic;
                  }
                  if (launchNotebookLinkURL) launchNotebookLink.href = launchNotebookLinkURL;
                }
                // Check if user has previously selected a server
                if ( (typeof localStorage.launcherPrivate !== 'undefined') || (typeof localStorage.launcherPublic !== 'undefined') ) {
                  setLaunchServer();
                }
                </script>

        </div>

    </div> <!-- .wrapper-->
    
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-54984338-10', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </body>
</html>